UEDITOR_CONFIG=window.UEDITOR_CONFIG||{};var baidu=window.baidu||{};window.baidu=baidu;window.UE=baidu.editor=window.UE||{};UE.plugins={};UE.commands={};UE.instants={};UE.I18N={};UE._customizeUI={};UE.version="1.4.3";var dom=UE.dom={};var browser=UE.browser=function(){var d=navigator.userAgent.toLowerCase(),b=window.opera,c={ie:/(msie\s|trident.*rv:)([\w.]+)/.test(d),opera:(!!b&&b.version),webkit:(d.indexOf(" applewebkit/")>-1),mac:(d.indexOf("macintosh")>-1),quirks:(document.compatMode=="BackCompat")};c.gecko=(navigator.product=="Gecko"&&!c.webkit&&!c.opera&&!c.ie);var a=0;if(c.ie){var g=d.match(/(?:msie\s([\w.]+))/);var f=d.match(/(?:trident.*rv:([\w.]+))/);if(g&&f&&g[1]&&f[1]){a=Math.max(g[1]*1,f[1]*1)}else{if(g&&g[1]){a=g[1]*1}else{if(f&&f[1]){a=f[1]*1}else{a=0}}}c.ie11Compat=document.documentMode==11;c.ie9Compat=document.documentMode==9;c.ie8=!!document.documentMode;c.ie8Compat=document.documentMode==8;c.ie7Compat=((a==7&&!document.documentMode)||document.documentMode==7);c.ie6Compat=(a<7||c.quirks);c.ie9above=a>8;c.ie9below=a<9;c.ie11above=a>10;c.ie11below=a<11}if(c.gecko){var e=d.match(/rv:([\d\.]+)/);if(e){e=e[1].split(".");a=e[0]*10000+(e[1]||0)*100+(e[2]||0)*1}}if(/chrome\/(\d+\.\d)/i.test(d)){c.chrome=+RegExp["\x241"]}if(/(\d+\.\d)?(?:\.\d)?\s+safari\/?(\d+\.\d+)?/i.test(d)&&!/chrome/i.test(d)){c.safari=+(RegExp["\x241"]||RegExp["\x242"])}if(c.opera){a=parseFloat(b.version())}if(c.webkit){a=parseFloat(d.match(/ applewebkit\/(\d+)/)[1])}c.version=a;c.isCompatible=!c.mobile&&((c.ie&&a>=6)||(c.gecko&&a>=10801)||(c.opera&&a>=9.5)||(c.air&&a>=1)||(c.webkit&&a>=522)||false);return c}();var ie=browser.ie,webkit=browser.webkit,gecko=browser.gecko,opera=browser.opera;var utils=UE.utils={each:function(f,e,d){if(f==null){return}if(f.length===+f.length){for(var c=0,a=f.length;c<a;c++){if(e.call(d,f[c],c,f)===false){return false}}}else{for(var b in f){if(f.hasOwnProperty(b)){if(e.call(d,f[b],b,f)===false){return false}}}}},makeInstance:function(b){var a=new Function();a.prototype=b;b=new a;a.prototype=null;return b},extend:function(d,e,a){if(e){for(var c in e){if(!a||!d.hasOwnProperty(c)){d[c]=e[c]}}}return d},extend2:function(f){var c=arguments;for(var e=1;e<c.length;e++){var b=c[e];for(var d in b){if(!f.hasOwnProperty(d)){f[d]=b[d]}}}return f},inherits:function(d,b){var a=d.prototype,c=utils.makeInstance(b.prototype);utils.extend(c,a,true);d.prototype=c;return(c.constructor=d)},bind:function(b,a){return function(){return b.apply(a,arguments)}},defer:function(b,a,c){var d;return function(){if(c){clearTimeout(d)}d=setTimeout(b,a)}},indexOf:function(d,b,c){var a=-1;c=this.isNumber(c)?c:0;this.each(d,function(e,f){if(f>=c&&e===b){a=f;return false}});return a},removeItem:function(d,c){for(var b=0,a=d.length;b<a;b++){if(d[b]===c){d.splice(b,1);b--}}},trim:function(a){return a.replace(/(^[ \t\n\r]+)|([ \t\n\r]+$)/g,"")},listToMap:function(c){if(!c){return{}}c=utils.isArray(c)?c:c.split(",");for(var b=0,a,d={};a=c[b++];){d[a.toUpperCase()]=d[a]=1}return d},unhtml:function(b,a){return b?b.replace(a||/[&<">'](?:(amp|lt|quot|gt|#39|nbsp|#\d+);)?/g,function(d,c){if(c){return d}else{return{"<":"&lt;","&":"&amp;",'"':"&quot;",">":"&gt;","'":"&#39;"}[d]}}):""},unhtmlForUrl:function(b,a){return b?b.replace(a||/[<">']/g,function(c){return{"<":"&lt;","&":"&amp;",'"':"&quot;",">":"&gt;","'":"&#39;"}[c]}):""},html:function(a){return a?a.replace(/&((g|l|quo)t|amp|#39|nbsp);/g,function(b){return{"&lt;":"<","&amp;":"&","&quot;":'"',"&gt;":">","&#39;":"'","&nbsp;":" "}[b]}):""},cssStyleToDomStyle:function(){var b=document.createElement("div").style,a={"float":b.cssFloat!=undefined?"cssFloat":b.styleFloat!=undefined?"styleFloat":"float"};return function(c){return a[c]||(a[c]=c.toLowerCase().replace(/-./g,function(d){return d.charAt(1).toUpperCase()}))}}(),loadFile:function(){var a=[];function b(h,g){try{for(var d=0,c;c=a[d++];){if(c.doc===h&&c.url==(g.src||g.href)){return c}}}catch(f){return null}}return function(j,h,e){var f=b(j,h);if(f){if(f.ready){e&&e()}else{f.funs.push(e)}return}a.push({doc:j,url:h.src||h.href,funs:[e]});if(!j.body){var d=[];for(var g in h){if(g=="tag"){continue}d.push(g+'="'+h[g]+'"')}j.write("<"+h.tag+" "+d.join(" ")+" ></"+h.tag+">");return}if(h.id&&j.getElementById(h.id)){return}var c=j.createElement(h.tag);delete h.tag;for(var g in h){c.setAttribute(g,h[g])}c.onload=c.onreadystatechange=function(){if(!this.readyState||/loaded|complete/.test(this.readyState)){f=b(j,h);if(f.funs.length>0){f.ready=1;for(var k;k=f.funs.pop();){k()}}c.onload=c.onreadystatechange=null}};c.onerror=function(){throw Error("The load "+(h.href||h.src)+" fails,check the url settings of file ueditor.config.js ")};j.getElementsByTagName("head")[0].appendChild(c)}}(),isEmptyObject:function(b){if(b==null){return true}if(this.isArray(b)||this.isString(b)){return b.length===0}for(var a in b){if(b.hasOwnProperty(a)){return false}}return true},fixColor:function(b,d){if(/color/i.test(b)&&/rgba?/.test(d)){var e=d.split(",");if(e.length>3){return""}d="#";for(var c=0,a;a=e[c++];){a=parseInt(a.replace(/[^\d]/gi,""),10).toString(16);d+=a.length==1?"0"+a:a}d=d.toUpperCase()}return d},optCss:function(e){var d,c,a;e=e.replace(/(padding|margin|border)\-([^:]+):([^;]+);?/gi,function(j,g,f,h){if(h.split(" ").length==1){switch(g){case"padding":!d&&(d={});d[f]=h;return"";case"margin":!c&&(c={});c[f]=h;return"";case"border":return h=="initial"?"":j}}return j});function b(n,h){if(!n){return""}var j=n.top,f=n.bottom,g=n.left,k=n.right,o="";if(!j||!g||!f||!k){for(var m in n){o+=";"+h+"-"+m+":"+n[m]+";"}}else{o+=";"+h+":"+(j==f&&f==g&&g==k?j:j==f&&g==k?(j+" "+g):g==k?(j+" "+g+" "+f):(j+" "+k+" "+f+" "+g))+";"}return o}e+=b(d,"padding")+b(c,"margin");return e.replace(/^[ \n\r\t;]*|[ \n\r\t]*$/,"").replace(/;([ \n\r\t]+)|\1;/g,";").replace(/(&((l|g)t|quot|#39))?;{2,}/g,function(g,f){return f?f+";;":";"})},clone:function(c,d){var b;d=d||{};for(var a in c){if(c.hasOwnProperty(a)){b=c[a];if(typeof b=="object"){d[a]=utils.isArray(b)?[]:{};utils.clone(c[a],d[a])}else{d[a]=b}}}return d},transUnitToPx:function(b){if(!/(pt|cm)/.test(b)){return b}var a;b.replace(/([\d.]+)(\w+)/,function(e,c,d){b=c;a=d});switch(a){case"cm":b=parseFloat(b)*25;break;case"pt":b=Math.round(parseFloat(b)*96/72)}return b+(b?"px":"")},domReady:function(){var a=[];function b(d){d.isReady=true;for(var c;c=a.pop();c()){}}return function(c,e){e=e||window;var d=e.document;c&&a.push(c);if(d.readyState==="complete"){b(d)}else{d.isReady&&b(d);if(browser.ie&&browser.version!=11){(function(){if(d.isReady){return}try{d.documentElement.doScroll("left")}catch(f){setTimeout(arguments.callee,0);return}b(d)})();e.attachEvent("onload",function(){b(d)})}else{d.addEventListener("DOMContentLoaded",function(){d.removeEventListener("DOMContentLoaded",arguments.callee,false);b(d)},false);e.addEventListener("load",function(){b(d)},false)}}}}(),cssRule:browser.ie&&browser.version!=11?function(c,d,e){var a,b;if(d===undefined||d&&d.nodeType&&d.nodeType==9){e=d&&d.nodeType&&d.nodeType==9?d:(e||document);a=e.indexList||(e.indexList={});b=a[c];if(b!==undefined){return e.styleSheets[b].cssText}return undefined}e=e||document;a=e.indexList||(e.indexList={});b=a[c];if(d===""){if(b!==undefined){e.styleSheets[b].cssText="";delete a[c];return true}return false}if(b!==undefined){sheetStyle=e.styleSheets[b]}else{sheetStyle=e.createStyleSheet("",b=e.styleSheets.length);a[c]=b}sheetStyle.cssText=d}:function(b,c,e){var a,d;if(c===undefined||c&&c.nodeType&&c.nodeType==9){e=c&&c.nodeType&&c.nodeType==9?c:(e||document);d=e.getElementById(b);return d?d.innerHTML:undefined}e=e||document;d=e.getElementById(b);if(c===""){if(d){d.parentNode.removeChild(d);return true}return false}if(d){d.innerHTML=c}else{d=e.createElement("style");d.id=b;d.innerHTML=c;e.getElementsByTagName("head")[0].appendChild(d)}},sort:function(g,f){f=f||function(j,h){return j.localeCompare(h)};for(var d=0,a=g.length;d<a;d++){for(var b=d,e=g.length;b<e;b++){if(f(g[d],g[b])>0){var c=g[d];g[d]=g[b];g[b]=c}}}return g},serializeParam:function(c){var d=[];for(var b in c){if(b=="method"||b=="timeout"||b=="async"){continue}if(!((typeof c[b]).toLowerCase()=="function"||(typeof c[b]).toLowerCase()=="object")){d.push(encodeURIComponent(b)+"="+encodeURIComponent(c[b]))}else{if(utils.isArray(c[b])){for(var a=0;a<c[b].length;a++){d.push(encodeURIComponent(b)+"[]="+encodeURIComponent(c[b][a]))}}}}return d.join("&")},formatUrl:function(b){var a=b.replace(/&&/g,"&");a=a.replace(/\?&/g,"?");a=a.replace(/&$/g,"");a=a.replace(/&#/g,"#");a=a.replace(/&+/g,"&");return a},isCrossDomainUrl:function(c){var b=document.createElement("a");b.href=c;if(browser.ie){b.href=b.href}return !(b.protocol==location.protocol&&b.hostname==location.hostname&&(b.port==location.port||(b.port=="80"&&location.port=="")||(b.port==""&&location.port=="80")))},clearEmptyAttrs:function(b){for(var a in b){if(b[a]===""){delete b[a]}}return b},str2json:function(a){if(!utils.isString(a)){return null}if(window.JSON){return JSON.parse(a)}else{return(new Function("return "+utils.trim(a||"")))()}},json2str:(function(){if(window.JSON){return JSON.stringify}else{var b={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};function a(f){if(/["\\\x00-\x1f]/.test(f)){f=f.replace(/["\\\x00-\x1f]/g,function(g){var h=b[g];if(h){return h}h=g.charCodeAt();return"\\u00"+Math.floor(h/16).toString(16)+(h%16).toString(16)})}return'"'+f+'"'}function d(m){var g=["["],h=m.length,f,j,k;for(j=0;j<h;j++){k=m[j];switch(typeof k){case"undefined":case"function":case"unknown":break;default:if(f){g.push(",")}g.push(utils.json2str(k));f=1}}g.push("]");return g.join("")}function c(f){return f<10?"0"+f:f}function e(f){return'"'+f.getFullYear()+"-"+c(f.getMonth()+1)+"-"+c(f.getDate())+"T"+c(f.getHours())+":"+c(f.getMinutes())+":"+c(f.getSeconds())+'"'}return function(l){switch(typeof l){case"undefined":return"undefined";case"number":return isFinite(l)?String(l):"null";case"string":return a(l);case"boolean":return String(l);default:if(l===null){return"null"}else{if(utils.isArray(l)){return d(l)}else{if(utils.isDate(l)){return e(l)}else{var g=["{"],k=utils.json2str,f,j;for(var h in l){if(Object.prototype.hasOwnProperty.call(l,h)){j=l[h];switch(typeof j){case"undefined":case"unknown":case"function":break;default:if(f){g.push(",")}f=1;g.push(k(h)+":"+k(j))}}}g.push("}");return g.join("")}}}}}}})()};utils.each(["String","Function","Array","Number","RegExp","Object","Date"],function(a){UE.utils["is"+a]=function(b){return Object.prototype.toString.apply(b)=="[object "+a+"]"}});var EventBase=UE.EventBase=function(){};EventBase.prototype={addListener:function(b,d){b=utils.trim(b).split(/\s+/);for(var a=0,c;c=b[a++];){getListener(this,c,true).push(d)}},on:function(a,b){return this.addListener(a,b)},off:function(a,b){return this.removeListener(a,b)},trigger:function(){return this.fireEvent.apply(this,arguments)},removeListener:function(b,d){b=utils.trim(b).split(/\s+/);for(var a=0,c;c=b[a++];){utils.removeItem(getListener(this,c)||[],d)}},fireEvent:function(){var d=arguments[0];d=utils.trim(d).split(" ");for(var c=0,f;f=d[c++];){var e=getListener(this,f),g,b,a;if(e){a=e.length;while(a--){if(!e[a]){continue}b=e[a].apply(this,arguments);if(b===true){return b}if(b!==undefined){g=b}}}if(b=this["on"+f.toLowerCase()]){g=b.apply(this,arguments)}}return g}};function getListener(d,b,c){var a;b=b.toLowerCase();return((a=(d.__allListeners||c&&(d.__allListeners={})))&&(a[b]||c&&(a[b]=[])))}var dtd=dom.dtd=(function(){function W(B){for(var A in B){B[A.toUpperCase()]=B[A]}return B}var a=utils.extend2;var z=W({isindex:1,fieldset:1}),y=W({input:1,button:1,select:1,textarea:1,label:1}),x=a(W({a:1}),y),w=a({iframe:1},x),v=W({hr:1,ul:1,menu:1,div:1,blockquote:1,noscript:1,table:1,center:1,address:1,dir:1,pre:1,h5:1,dl:1,h4:1,noframes:1,h6:1,ol:1,h1:1,h3:1,h2:1}),u=W({ins:1,del:1,script:1,style:1}),t=a(W({b:1,acronym:1,bdo:1,"var":1,"#":1,abbr:1,code:1,br:1,i:1,cite:1,kbd:1,u:1,strike:1,s:1,tt:1,strong:1,q:1,samp:1,em:1,dfn:1,span:1}),u),s=a(W({sub:1,img:1,embed:1,object:1,sup:1,basefont:1,map:1,applet:1,font:1,big:1,small:1}),t),r=a(W({p:1}),s),q=a(W({iframe:1}),s,y),o=W({img:1,embed:1,noscript:1,br:1,kbd:1,center:1,button:1,basefont:1,h5:1,h4:1,samp:1,h6:1,ol:1,h1:1,h3:1,h2:1,form:1,font:1,"#":1,select:1,menu:1,ins:1,abbr:1,label:1,code:1,table:1,script:1,cite:1,input:1,iframe:1,strong:1,textarea:1,noframes:1,big:1,small:1,span:1,hr:1,sub:1,bdo:1,"var":1,div:1,object:1,sup:1,strike:1,dir:1,map:1,dl:1,applet:1,del:1,isindex:1,fieldset:1,ul:1,b:1,acronym:1,a:1,blockquote:1,i:1,u:1,s:1,tt:1,address:1,q:1,pre:1,p:1,em:1,dfn:1}),n=a(W({a:0}),q),l=W({tr:1}),k=W({"#":1}),j=a(W({param:1}),o),h=a(W({form:1}),z,w,v,r),g=W({li:1,ol:1,ul:1}),f=W({style:1,script:1}),e=W({base:1,link:1,meta:1,title:1}),d=a(e,f),c=W({head:1,body:1}),b=W({html:1});var m=W({address:1,blockquote:1,center:1,dir:1,div:1,dl:1,fieldset:1,form:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,hr:1,isindex:1,menu:1,noframes:1,ol:1,p:1,pre:1,table:1,ul:1}),p=W({area:1,base:1,basefont:1,br:1,col:1,command:1,dialog:1,embed:1,hr:1,img:1,input:1,isindex:1,keygen:1,link:1,meta:1,param:1,source:1,track:1,wbr:1});return W({$nonBodyContent:a(b,c,e),$block:m,$inline:n,$inlineWithA:a(W({a:1}),n),$body:a(W({script:1,style:1}),m),$cdata:W({script:1,style:1}),$empty:p,$nonChild:W({iframe:1,textarea:1}),$listItem:W({dd:1,dt:1,li:1}),$list:W({ul:1,ol:1,dl:1}),$isNotEmpty:W({table:1,ul:1,ol:1,dl:1,iframe:1,area:1,base:1,col:1,hr:1,img:1,embed:1,input:1,link:1,meta:1,param:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1}),$removeEmpty:W({a:1,abbr:1,acronym:1,address:1,b:1,bdo:1,big:1,cite:1,code:1,del:1,dfn:1,em:1,font:1,i:1,ins:1,label:1,kbd:1,q:1,s:1,samp:1,small:1,span:1,strike:1,strong:1,sub:1,sup:1,tt:1,u:1,"var":1}),$removeEmptyBlock:W({p:1,div:1}),$tableContent:W({caption:1,col:1,colgroup:1,tbody:1,td:1,tfoot:1,th:1,thead:1,tr:1,table:1}),$notTransContent:W({pre:1,script:1,style:1,textarea:1}),html:c,head:d,style:k,script:k,body:h,base:{},link:{},meta:{},title:k,col:{},tr:W({td:1,th:1}),img:{},embed:{},colgroup:W({thead:1,col:1,tbody:1,tr:1,tfoot:1}),noscript:h,td:h,br:{},th:h,center:h,kbd:n,button:a(r,v),basefont:{},h5:n,h4:n,samp:n,h6:n,ol:g,h1:n,h3:n,option:k,h2:n,form:a(z,w,v,r),select:W({optgroup:1,option:1}),font:n,ins:n,menu:g,abbr:n,label:n,table:W({thead:1,col:1,tbody:1,tr:1,colgroup:1,caption:1,tfoot:1}),code:n,tfoot:l,cite:n,li:h,input:{},iframe:h,strong:n,textarea:k,noframes:h,big:n,small:n,span:W({"#":1,br:1,b:1,strong:1,u:1,i:1,em:1,sub:1,sup:1,strike:1,span:1}),hr:n,dt:n,sub:n,optgroup:W({option:1}),param:{},bdo:n,"var":n,div:h,object:j,sup:n,dd:h,strike:n,area:{},dir:g,map:a(W({area:1,form:1,p:1}),z,u,v),applet:j,dl:W({dt:1,dd:1}),del:n,isindex:{},fieldset:a(W({legend:1}),o),thead:l,ul:g,acronym:n,b:n,a:a(W({a:1}),q),blockquote:a(W({td:1,tr:1,tbody:1,li:1}),h),caption:n,i:n,u:n,tbody:l,s:n,address:a(w,r),tt:n,legend:n,q:n,pre:a(t,x),p:a(W({a:1}),n),em:n,dfn:n})})();function getDomNode(g,h,b,a,e,f){var d=a&&g[h],c;!d&&(d=g[b]);while(!d&&(c=(c||g).parentNode)){if(c.tagName=="BODY"||f&&!f(c)){return null}d=c[b]}if(d&&e&&!e(d)){return getDomNode(d,h,b,false,e)}return d}var attrFix=ie&&browser.version<9?{tabindex:"tabIndex",readonly:"readOnly","for":"htmlFor","class":"className",maxlength:"maxLength",cellspacing:"cellSpacing",cellpadding:"cellPadding",rowspan:"rowSpan",colspan:"colSpan",usemap:"useMap",frameborder:"frameBorder"}:{tabindex:"tabIndex",readonly:"readOnly"},styleBlock=utils.listToMap(["-webkit-box","-moz-box","block","list-item","table","table-row-group","table-header-group","table-footer-group","table-row","table-column-group","table-column","table-cell","table-caption"]);var domUtils=dom.domUtils={NODE_ELEMENT:1,NODE_DOCUMENT:9,NODE_TEXT:3,NODE_COMMENT:8,NODE_DOCUMENT_FRAGMENT:11,POSITION_IDENTICAL:0,POSITION_DISCONNECTED:1,POSITION_FOLLOWING:2,POSITION_PRECEDING:4,POSITION_IS_CONTAINED:8,POSITION_CONTAINS:16,fillChar:ie&&browser.version=="6"?"\ufeff":"\u200B",keys:{8:1,46:1,16:1,17:1,18:1,37:1,38:1,39:1,40:1,13:1},getPosition:function(f,d){if(f===d){return 0}var b,e=[f],c=[d];b=f;while(b=b.parentNode){if(b===d){return 10}e.push(b)}b=d;while(b=b.parentNode){if(b===f){return 20}c.push(b)}e.reverse();c.reverse();if(e[0]!==c[0]){return 1}var a=-1;while(a++,e[a]===c[a]){}f=e[a];d=c[a];while(f=f.nextSibling){if(f===d){return 4}}return 2},getNodeIndex:function(c,b){var d=c,a=0;while(d=d.previousSibling){if(b&&d.nodeType==3){if(d.nodeType!=d.nextSibling.nodeType){a++}continue}a++}return a},inDoc:function(a,b){return domUtils.getPosition(a,b)==10},findParent:function(b,c,a){if(b&&!domUtils.isBody(b)){b=a?b:b.parentNode;while(b){if(!c||c(b)||domUtils.isBody(b)){return c&&!c(b)&&domUtils.isBody(b)?null:b}b=b.parentNode}}return null},findParentByTagName:function(c,a,b,d){a=utils.listToMap(utils.isArray(a)?a:[a]);return domUtils.findParent(c,function(e){return a[e.tagName]&&!(d&&d(e))},b)},findParents:function(d,c,e,b){var a=c&&(e&&e(d)||!e)?[d]:[];while(d=domUtils.findParent(d,e)){a.push(d)}return b?a:a.reverse()},insertAfter:function(b,a){return b.nextSibling?b.parentNode.insertBefore(a,b.nextSibling):b.parentNode.appendChild(a)},remove:function(b,c){var a=b.parentNode,d;if(a){if(c&&b.hasChildNodes()){while(d=b.firstChild){a.insertBefore(d,b)}}a.removeChild(b)}return b},getNextDomNode:function(c,a,d,b){return getDomNode(c,"firstChild","nextSibling",a,d,b)},getPreDomNode:function(c,a,d,b){return getDomNode(c,"lastChild","previousSibling",a,d,b)},isBookmarkNode:function(a){return a.nodeType==1&&a.id&&/^_baidu_bookmark_/i.test(a.id)},getWindow:function(a){var b=a.ownerDocument||a;return b.defaultView||b.parentWindow},getCommonAncestor:function(f,d){if(f===d){return f}var e=[f],c=[d],b=f,a=-1;while(b=b.parentNode){if(b===d){return b}e.push(b)}b=d;while(b=b.parentNode){if(b===f){return b}c.push(b)}e.reverse();c.reverse();while(a++,e[a]===c[a]){}return a==0?null:e[a-1]},clearEmptySibling:function(d,b,c){function a(g,e){var f;while(g&&!domUtils.isBookmarkNode(g)&&(domUtils.isEmptyInlineElement(g)||!new RegExp("[^\t\n\r"+domUtils.fillChar+"]").test(g.nodeValue))){f=g[e];domUtils.remove(g);g=f}}!b&&a(d.nextSibling,"nextSibling");!c&&a(d.previousSibling,"previousSibling")},split:function(d,f){var e=d.ownerDocument;if(browser.ie&&f==d.nodeValue.length){var c=e.createTextNode("");return domUtils.insertAfter(d,c)}var a=d.splitText(f);if(browser.ie8){var b=e.createTextNode("");domUtils.insertAfter(a,b);domUtils.remove(b)}return a},isWhitespace:function(a){return !new RegExp("[^ \t\n\r"+domUtils.fillChar+"]").test(a.nodeValue)},getXY:function(b){var a=0,c=0;while(b.offsetParent){c+=b.offsetTop;a+=b.offsetLeft;b=b.offsetParent}return{x:a,y:c}},on:function(e,g,f){var d=utils.isArray(g)?g:utils.trim(g).split(/\s+/),a=d.length;if(a){while(a--){g=d[a];if(e.addEventListener){e.addEventListener(g,f,false)}else{if(!f._d){f._d={els:[]}}var c=g+f.toString(),b=utils.indexOf(f._d.els,e);if(!f._d[c]||b==-1){if(b==-1){f._d.els.push(e)}if(!f._d[c]){f._d[c]=function(h){return f.call(h.srcElement,h||window.event)}}e.attachEvent("on"+g,f._d[c])}}}}e=null},un:function(f,h,g){var d=utils.isArray(h)?h:utils.trim(h).split(/\s+/),a=d.length;if(a){while(a--){h=d[a];if(f.removeEventListener){f.removeEventListener(h,g,false)}else{var c=h+g.toString();try{f.detachEvent("on"+h,g._d?g._d[c]:g)}catch(j){}if(g._d&&g._d[c]){var b=utils.indexOf(g._d.els,f);if(b!=-1){g._d.els.splice(b,1)}g._d.els.length==0&&delete g._d[c]}}}}},isSameElement:function(d,c){if(d.tagName!=c.tagName){return false}var e=d.attributes,g=c.attributes;if(!ie&&e.length!=g.length){return false}var a,j,h=0,b=0;for(var f=0;a=e[f++];){if(a.nodeName=="style"){if(a.specified){h++}if(domUtils.isSameStyle(d,c)){continue}else{return false}}if(ie){if(a.specified){h++;j=g.getNamedItem(a.nodeName)}else{continue}}else{j=c.attributes[a.nodeName]}if(!j.specified||a.nodeValue!=j.nodeValue){return false}}if(ie){for(f=0;j=g[f++];){if(j.specified){b++}}if(h!=b){return false}}return true},isSameStyle:function(g,e){var b=g.style.cssText.replace(/( ?; ?)/g,";").replace(/( ?: ?)/g,":"),a=e.style.cssText.replace(/( ?; ?)/g,";").replace(/( ?: ?)/g,":");if(browser.opera){b=g.style;a=e.style;if(b.length!=a.length){return false}for(var f in b){if(/^(\d+|csstext)$/i.test(f)){continue}if(b[f]!=a[f]){return false}}return true}if(!b||!a){return b==a}b=b.split(";");a=a.split(";");if(b.length!=a.length){return false}for(var d=0,c;c=b[d++];){if(utils.indexOf(a,c)==-1){return false}}return true},isBlockElm:function(a){return a.nodeType==1&&(dtd.$block[a.tagName]||styleBlock[domUtils.getComputedStyle(a,"display")])&&!dtd.$nonChild[a.tagName]},isBody:function(a){return a&&a.nodeType==1&&a.tagName.toLowerCase()=="body"},breakParent:function(e,c){var b,g=e,f=e,a,d;do{g=g.parentNode;if(a){b=g.cloneNode(false);b.appendChild(a);a=b;b=g.cloneNode(false);b.appendChild(d);d=b}else{a=g.cloneNode(false);d=a.cloneNode(false)}while(b=f.previousSibling){a.insertBefore(b,a.firstChild)}while(b=f.nextSibling){d.appendChild(b)}f=g}while(c!==g);b=c.parentNode;b.insertBefore(a,c);b.insertBefore(d,c);b.insertBefore(e,d);domUtils.remove(c);return e},isEmptyInlineElement:function(a){if(a.nodeType!=1||!dtd.$removeEmpty[a.tagName]){return 0}a=a.firstChild;while(a){if(domUtils.isBookmarkNode(a)){return 0}if(a.nodeType==1&&!domUtils.isEmptyInlineElement(a)||a.nodeType==3&&!domUtils.isWhitespace(a)){return 0}a=a.nextSibling}return 1},trimWhiteTextNode:function(b){function a(c){var d;while((d=b[c])&&d.nodeType==3&&domUtils.isWhitespace(d)){b.removeChild(d)}}a("firstChild");a("lastChild")},mergeChild:function(c,b,g){var f=domUtils.getElementsByTagName(c,c.tagName.toLowerCase());for(var e=0,k;k=f[e++];){if(!k.parentNode||domUtils.isBookmarkNode(k)){continue}if(k.tagName.toLowerCase()=="span"){if(c===k.parentNode){domUtils.trimWhiteTextNode(c);if(c.childNodes.length==1){c.style.cssText=k.style.cssText+";"+c.style.cssText;domUtils.remove(k,true);continue}}k.style.cssText=c.style.cssText+";"+k.style.cssText;if(g){var a=g.style;if(a){a=a.split(";");for(var d=0,h;h=a[d++];){k.style[utils.cssStyleToDomStyle(h.split(":")[0])]=h.split(":")[1]}}}if(domUtils.isSameStyle(k,c)){domUtils.remove(k,true)}continue}if(domUtils.isSameElement(c,k)){domUtils.remove(k,true)}}},getElementsByTagName:function(e,a,b){if(b&&utils.isString(b)){var j=b;b=function(l){return domUtils.hasClass(l,j)}}a=utils.trim(a).replace(/[ ]{2,}/g," ").split(" ");var g=[];for(var d=0,c;c=a[d++];){var h=e.getElementsByTagName(c);for(var f=0,k;k=h[f++];){if(!b||b(k)){g.push(k)}}}return g},mergeToParent:function(b){var a=b.parentNode;while(a&&dtd.$removeEmpty[a.tagName]){if(a.tagName==b.tagName||a.tagName=="A"){domUtils.trimWhiteTextNode(a);if(a.tagName=="SPAN"&&!domUtils.isSameStyle(a,b)||(a.tagName=="A"&&b.tagName=="SPAN")){if(a.childNodes.length>1||a!==b.parentNode){b.style.cssText=a.style.cssText+";"+b.style.cssText;a=a.parentNode;continue}else{a.style.cssText+=";"+b.style.cssText;if(a.tagName=="A"){a.style.textDecoration="underline"}}}if(a.tagName!="A"){a===b.parentNode&&domUtils.remove(b,true);break}}a=a.parentNode}},mergeSibling:function(c,b,a){function d(g,h,f){var e;if((e=f[g])&&!domUtils.isBookmarkNode(e)&&e.nodeType==1&&domUtils.isSameElement(f,e)){while(e.firstChild){if(h=="firstChild"){f.insertBefore(e.lastChild,f.firstChild)}else{f.appendChild(e.firstChild)}}domUtils.remove(e)}}!b&&d("previousSibling","firstChild",c);!a&&d("nextSibling","lastChild",c)},unSelectable:ie&&browser.ie9below||browser.opera?function(c){c.onselectstart=function(){return false};c.onclick=c.onkeyup=c.onkeydown=function(){return false};c.unselectable="on";c.setAttribute("unselectable","on");for(var b=0,a;a=c.all[b++];){switch(a.tagName.toLowerCase()){case"iframe":case"textarea":case"input":case"select":break;default:a.unselectable="on";c.setAttribute("unselectable","on")}}}:function(a){a.style.MozUserSelect=a.style.webkitUserSelect=a.style.msUserSelect=a.style.KhtmlUserSelect="none"},removeAttributes:function(c,e){e=utils.isArray(e)?e:utils.trim(e).replace(/[ ]{2,}/g," ").split(" ");for(var b=0,a;a=e[b++];){a=attrFix[a]||a;switch(a){case"className":c[a]="";break;case"style":c.style.cssText="";var d=c.getAttributeNode("style");!browser.ie&&d&&c.removeAttributeNode(d)}c.removeAttribute(a)}},createElement:function(c,a,b){return domUtils.setAttributes(c.createElement(a),b)},setAttributes:function(c,b){for(var a in b){if(b.hasOwnProperty(a)){var d=b[a];switch(a){case"class":c.className=d;break;case"style":c.style.cssText=c.style.cssText+";"+d;break;case"innerHTML":c[a]=d;break;case"value":c.value=d;break;default:c.setAttribute(attrFix[a]||a,d)}}}return c},getComputedStyle:function(c,b){var g="width height top left";if(g.indexOf(b)>-1){return c["offset"+b.replace(/^\w/,function(e){return e.toUpperCase()})]+"px"}if(c.nodeType==3){c=c.parentNode}if(browser.ie&&browser.version<9&&b=="font-size"&&!c.style.fontSize&&!dtd.$empty[c.tagName]&&!dtd.$nonChild[c.tagName]){var d=c.ownerDocument.createElement("span");d.style.cssText="padding:0;border:0;font-family:simsun;";d.innerHTML=".";c.appendChild(d);var a=d.offsetHeight;c.removeChild(d);d=null;return a+"px"}try{var f=domUtils.getStyle(c,b)||(window.getComputedStyle?domUtils.getWindow(c).getComputedStyle(c,"").getPropertyValue(b):(c.currentStyle||c.style)[utils.cssStyleToDomStyle(b)])}catch(h){return""}return utils.transUnitToPx(utils.fixColor(b,f))},removeClasses:function(e,d){d=utils.isArray(d)?d:utils.trim(d).replace(/[ ]{2,}/g," ").split(" ");for(var c=0,b,a=e.className;b=d[c++];){a=a.replace(new RegExp("\\b"+b+"\\b"),"")}a=utils.trim(a).replace(/[ ]{2,}/g," ");if(a){e.className=a}else{domUtils.removeAttributes(e,["class"])}},addClass:function(e,d){if(!e){return}d=utils.trim(d).replace(/[ ]{2,}/g," ").split(" ");for(var c=0,b,a=e.className;b=d[c++];){if(!new RegExp("\\b"+b+"\\b").test(a)){a+=" "+b}}e.className=utils.trim(a)},hasClass:function(d,e){if(utils.isRegExp(e)){return e.test(d.className)}e=utils.trim(e).replace(/[ ]{2,}/g," ").split(" ");for(var c=0,b,a=d.className;b=e[c++];){if(!new RegExp("\\b"+b+"\\b","i").test(a)){return false}}return c-1==e.length},preventDefault:function(a){a.preventDefault?a.preventDefault():(a.returnValue=false)},removeStyle:function(b,a){if(browser.ie){if(a=="color"){a="(^|;)"+a}b.style.cssText=b.style.cssText.replace(new RegExp(a+"[^:]*:[^;]+;?","ig"),"")}else{if(b.style.removeProperty){b.style.removeProperty(a)}else{b.style.removeAttribute(utils.cssStyleToDomStyle(a))}}if(!b.style.cssText){domUtils.removeAttributes(b,["style"])}},getStyle:function(b,a){var c=b.style[utils.cssStyleToDomStyle(a)];return utils.fixColor(a,c)},setStyle:function(b,a,c){b.style[utils.cssStyleToDomStyle(a)]=c;if(!utils.trim(b.style.cssText)){this.removeAttributes(b,"style")}},setStyles:function(b,c){for(var a in c){if(c.hasOwnProperty(a)){domUtils.setStyle(b,a,c[a])}}},removeDirtyAttr:function(d){for(var c=0,b,a=d.getElementsByTagName("*");b=a[c++];){b.removeAttribute("_moz_dirty")}d.removeAttribute("_moz_dirty")},getChildCount:function(c,a){var b=0,d=c.firstChild;a=a||function(){return 1};while(d){if(a(d)){b++}d=d.nextSibling}return b},isEmptyNode:function(a){return !a.firstChild||domUtils.getChildCount(a,function(b){return !domUtils.isBr(b)&&!domUtils.isBookmarkNode(b)&&!domUtils.isWhitespace(b)})==0},clearSelectedArr:function(a){var b;while(b=a.pop()){domUtils.removeAttributes(b,["class"])}},scrollToView:function(c,j,a){var b=function(){var k=j.document,l=k.compatMode=="CSS1Compat";return{width:(l?k.documentElement.clientWidth:k.body.clientWidth)||0,height:(l?k.documentElement.clientHeight:k.body.clientHeight)||0}},h=function(l){if("pageXOffset" in l){return{x:l.pageXOffset||0,y:l.pageYOffset||0}}else{var k=l.document;return{x:k.documentElement.scrollLeft||k.body.scrollLeft||0,y:k.documentElement.scrollTop||k.body.scrollTop||0}}};var f=b().height,g=f*-1+a;g+=(c.offsetHeight||0);var d=domUtils.getXY(c);g+=d.y;var e=h(j).y;if(g>e||g<e-f){j.scrollTo(0,g+(g<0?-20:20))}},isBr:function(a){return a.nodeType==1&&a.tagName=="BR"},isFillChar:function(a,c){if(a.nodeType!=3){return false}var b=a.nodeValue;if(c){return new RegExp("^"+domUtils.fillChar).test(b)}return !b.replace(new RegExp(domUtils.fillChar,"g"),"").length},isStartInblock:function(b){var f=b.cloneRange(),a=0,g=f.startContainer,c;if(g.nodeType==1&&g.childNodes[f.startOffset]){g=g.childNodes[f.startOffset];var e=g.previousSibling;while(e&&domUtils.isFillChar(e)){g=e;e=e.previousSibling}}if(this.isFillChar(g,true)&&f.startOffset==1){f.setStartBefore(g);g=f.startContainer}while(g&&domUtils.isFillChar(g)){c=g;g=g.previousSibling}if(c){f.setStartBefore(c);g=f.startContainer}if(g.nodeType==1&&domUtils.isEmptyNode(g)&&f.startOffset==1){f.setStart(g,0).collapse(true)}while(!f.startOffset){g=f.startContainer;if(domUtils.isBlockElm(g)||domUtils.isBody(g)){a=1;break}var e=f.startContainer.previousSibling,d;if(!e){f.setStartBefore(f.startContainer)}else{while(e&&domUtils.isFillChar(e)){d=e;e=e.previousSibling}if(d){f.setStartBefore(d)}else{f.setStartBefore(f.startContainer)}}}return a&&!domUtils.isBody(f.startContainer)?1:0},isEmptyBlock:function(b,a){if(b.nodeType!=1){return 0}a=a||new RegExp("[ \xa0\t\r\n"+domUtils.fillChar+"]","g");if(b[browser.ie?"innerText":"textContent"].replace(a,"").length>0){return 0}for(var c in dtd.$isNotEmpty){if(b.getElementsByTagName(c).length){return 0}}return 1},setViewportOffset:function(a,g){var f=parseInt(a.style.left)|0;var e=parseInt(a.style.top)|0;var c=a.getBoundingClientRect();var d=g.left-c.left;var b=g.top-c.top;if(d){a.style.left=f+d+"px"}if(b){a.style.top=e+b+"px"}},fillNode:function(c,b){var a=browser.ie?c.createTextNode(domUtils.fillChar):c.createElement("br");b.innerHTML="";b.appendChild(a)},moveChild:function(c,a,b){while(c.firstChild){if(b&&a.firstChild){a.insertBefore(c.lastChild,a.firstChild)}else{a.appendChild(c.firstChild)}}},hasNoAttributes:function(a){return browser.ie?/^<\w+\s*?>/.test(a.outerHTML):a.attributes.length==0},isCustomeNode:function(a){return a.nodeType==1&&a.getAttribute("_ue_custom_node_")},isTagNode:function(b,a){return b.nodeType==1&&new RegExp("\\b"+b.tagName+"\\b","i").test(a)},filterNodeList:function(d,c,b){var a=[];if(!utils.isFunction(c)){var e=c;c=function(f){return utils.indexOf(utils.isArray(e)?e:e.split(" "),f.tagName.toLowerCase())!=-1}}utils.each(d,function(f){c(f)&&a.push(f)});return a.length==0?null:a.length==1||!b?a[0]:a},isInNodeEndBoundary:function(a,b){var c=a.startContainer;if(c.nodeType==3&&a.startOffset!=c.nodeValue.length){return 0}if(c.nodeType==1&&a.startOffset!=c.childNodes.length){return 0}while(c!==b){if(c.nextSibling){return 0}c=c.parentNode}return 1},isBoundaryNode:function(c,a){var b;while(!domUtils.isBody(c)){b=c;c=c.parentNode;if(b!==c[a]){return false}}return true},fillHtml:browser.ie11below?"&nbsp;":"<br/>"};var fillCharReg=new RegExp(domUtils.fillChar,"g");(function(){var f=0,g=domUtils.fillChar,c;function b(l){l.collapsed=l.startContainer&&l.endContainer&&l.startContainer===l.endContainer&&l.startOffset==l.endOffset}function k(l){return !l.collapsed&&l.startContainer.nodeType==1&&l.startContainer===l.endContainer&&l.endOffset-l.startOffset==1}function a(m,n,o,l){if(n.nodeType==1&&(dtd.$empty[n.tagName]||dtd.$nonChild[n.tagName])){o=domUtils.getNodeIndex(n)+(m?0:1);n=n.parentNode}if(m){l.startContainer=n;l.startOffset=o;if(!l.endContainer){l.collapse(true)}}else{l.endContainer=n;l.endOffset=o;if(!l.startContainer){l.collapse(false)}}b(l);return l}function j(r,v){var p=r.startContainer,o=r.endContainer,x=r.startOffset,q=r.endOffset,D=r.document,l=D.createDocumentFragment(),s,u;if(p.nodeType==1){p=p.childNodes[x]||(s=p.appendChild(D.createTextNode("")))}if(o.nodeType==1){o=o.childNodes[q]||(u=o.appendChild(D.createTextNode("")))}if(p===o&&p.nodeType==3){l.appendChild(D.createTextNode(p.substringData(x,q-x)));if(v){p.deleteData(x,q-x);r.collapse(true)}return l}var t,z,B=l,A=domUtils.findParents(p,true),m=domUtils.findParents(o,true);for(var y=0;A[y]==m[y];){y++}for(var w=y,C;C=A[w];w++){t=C.nextSibling;if(C==p){if(!s){if(r.startContainer.nodeType==3){B.appendChild(D.createTextNode(p.nodeValue.slice(x)));if(v){p.deleteData(x,p.nodeValue.length-x)}}else{B.appendChild(!v?p.cloneNode(true):p)}}}else{z=C.cloneNode(false);B.appendChild(z)}while(t){if(t===o||t===m[w]){break}C=t.nextSibling;B.appendChild(!v?t.cloneNode(true):t);t=C}B=z}B=l;if(!A[y]){B.appendChild(A[y-1].cloneNode(false));B=B.firstChild}for(var w=y,n;n=m[w];w++){t=n.previousSibling;if(n==o){if(!u&&r.endContainer.nodeType==3){B.appendChild(D.createTextNode(o.substringData(0,q)));if(v){o.deleteData(0,q)}}}else{z=n.cloneNode(false);B.appendChild(z)}if(w!=y||!A[y]){while(t){if(t===p){break}n=t.previousSibling;B.insertBefore(!v?t.cloneNode(true):t,B.firstChild);t=n}}B=z}if(v){r.setStartBefore(!m[y]?m[y-1]:!A[y]?A[y-1]:m[y]).collapse(true)}s&&domUtils.remove(s);u&&domUtils.remove(u);return l}var d=dom.Range=function(l){var m=this;m.startContainer=m.startOffset=m.endContainer=m.endOffset=null;m.document=l;m.collapsed=true};function e(o,l){try{if(c&&domUtils.inDoc(c,o)){if(!c.nodeValue.replace(fillCharReg,"").length){var m=c.parentNode;domUtils.remove(c);while(m&&domUtils.isEmptyInlineElement(m)&&(browser.safari?!(domUtils.getPosition(m,l)&domUtils.POSITION_CONTAINS):!m.contains(l))){c=m.parentNode;domUtils.remove(m);m=c}}else{c.nodeValue=c.nodeValue.replace(fillCharReg,"")}}}catch(n){}}function h(n,l){var m;n=n[l];while(n&&domUtils.isFillChar(n)){m=n[l];domUtils.remove(n);n=m}}d.prototype={cloneContents:function(){return this.collapsed?null:j(this,0)},deleteContents:function(){var l;if(!this.collapsed){j(this,1)}if(browser.webkit){l=this.startContainer;if(l.nodeType==3&&!l.nodeValue.length){this.setStartBefore(l).collapse(true);domUtils.remove(l)}}return this},extractContents:function(){return this.collapsed?null:j(this,2)},setStart:function(l,m){return a(true,l,m,this)},setEnd:function(l,m){return a(false,l,m,this)},setStartAfter:function(l){return this.setStart(l.parentNode,domUtils.getNodeIndex(l)+1)},setStartBefore:function(l){return this.setStart(l.parentNode,domUtils.getNodeIndex(l))},setEndAfter:function(l){return this.setEnd(l.parentNode,domUtils.getNodeIndex(l)+1)},setEndBefore:function(l){return this.setEnd(l.parentNode,domUtils.getNodeIndex(l))},setStartAtFirst:function(l){return this.setStart(l,0)},setStartAtLast:function(l){return this.setStart(l,l.nodeType==3?l.nodeValue.length:l.childNodes.length)},setEndAtFirst:function(l){return this.setEnd(l,0)},setEndAtLast:function(l){return this.setEnd(l,l.nodeType==3?l.nodeValue.length:l.childNodes.length)},selectNode:function(l){return this.setStartBefore(l).setEndAfter(l)},selectNodeContents:function(l){return this.setStart(l,0).setEndAtLast(l)},cloneRange:function(){var l=this;return new d(l.document).setStart(l.startContainer,l.startOffset).setEnd(l.endContainer,l.endOffset)},collapse:function(l){var m=this;if(l){m.endContainer=m.startContainer;m.endOffset=m.startOffset}else{m.startContainer=m.endContainer;m.startOffset=m.endOffset}m.collapsed=true;return m},shrinkBoundary:function(n){var m=this,p,o=m.collapsed;function l(q){return q.nodeType==1&&!domUtils.isBookmarkNode(q)&&!dtd.$empty[q.tagName]&&!dtd.$nonChild[q.tagName]}while(m.startContainer.nodeType==1&&(p=m.startContainer.childNodes[m.startOffset])&&l(p)){m.setStart(p,0)}if(o){return m.collapse(true)}if(!n){while(m.endContainer.nodeType==1&&m.endOffset>0&&(p=m.endContainer.childNodes[m.endOffset-1])&&l(p)){m.setEnd(p,p.childNodes.length)}}return m},getCommonAncestor:function(m,n){var o=this,p=o.startContainer,l=o.endContainer;if(p===l){if(m&&k(this)){p=p.childNodes[o.startOffset];if(p.nodeType==1){return p}}return n&&p.nodeType==3?p.parentNode:p}return domUtils.getCommonAncestor(p,l)},trimBoundary:function(m){this.txtToElmBoundary();var q=this.startContainer,p=this.startOffset,o=this.collapsed,l=this.endContainer;if(q.nodeType==3){if(p==0){this.setStartBefore(q)}else{if(p>=q.nodeValue.length){this.setStartAfter(q)}else{var n=domUtils.split(q,p);if(q===l){this.setEnd(n,this.endOffset-p)}else{if(q.parentNode===l){this.endOffset+=1}}this.setStartBefore(n)}}if(o){return this.collapse(true)}}if(!m){p=this.endOffset;l=this.endContainer;if(l.nodeType==3){if(p==0){this.setEndBefore(l)}else{p<l.nodeValue.length&&domUtils.split(l,p);this.setEndAfter(l)}}}return this},txtToElmBoundary:function(l){function m(o,q){var n=o[q+"Container"],p=o[q+"Offset"];if(n.nodeType==3){if(!p){o["set"+q.replace(/(\w)/,function(r){return r.toUpperCase()})+"Before"](n)}else{if(p>=n.nodeValue.length){o["set"+q.replace(/(\w)/,function(r){return r.toUpperCase()})+"After"](n)}}}}if(l||!this.collapsed){m(this,"start");m(this,"end")}return this},insertNode:function(n){var p=n,m=1;if(n.nodeType==11){p=n.firstChild;m=n.childNodes.length}this.trimBoundary(true);var q=this.startContainer,o=this.startOffset;var l=q.childNodes[o];if(l){q.insertBefore(n,l)}else{q.appendChild(n)}if(p.parentNode===this.endContainer){this.endOffset=this.endOffset+m}return this.setStartBefore(p)},setCursor:function(m,l){return this.collapse(!m).select(l)},createBookmark:function(n,o){var l,m=this.document.createElement("span");m.style.cssText="display:none;line-height:0px;";m.appendChild(this.document.createTextNode("\u200D"));m.id="_baidu_bookmark_start_"+(o?"":f++);if(!this.collapsed){l=m.cloneNode(true);l.id="_baidu_bookmark_end_"+(o?"":f++)}this.insertNode(m);if(l){this.collapse().insertNode(l).setEndBefore(l)}this.setStartAfter(m);return{start:n?m.id:m,end:l?n?l.id:l:null,id:n}},moveToBookmark:function(m){var n=m.id?this.document.getElementById(m.start):m.start,l=m.end&&m.id?this.document.getElementById(m.end):m.end;this.setStartBefore(n);domUtils.remove(n);if(l){this.setEndBefore(l);domUtils.remove(l)}else{this.collapse(true)}return this},enlarge:function(m,p){var l=domUtils.isBody,q,o,n=this.document.createTextNode("");if(m){o=this.startContainer;if(o.nodeType==1){if(o.childNodes[this.startOffset]){q=o=o.childNodes[this.startOffset]}else{o.appendChild(n);q=o=n}}else{q=o}while(1){if(domUtils.isBlockElm(o)){o=q;while((q=o.previousSibling)&&!domUtils.isBlockElm(q)){o=q}this.setStartBefore(o);break}q=o;o=o.parentNode}o=this.endContainer;if(o.nodeType==1){if(q=o.childNodes[this.endOffset]){o.insertBefore(n,q)}else{o.appendChild(n)}q=o=n}else{q=o}while(1){if(domUtils.isBlockElm(o)){o=q;while((q=o.nextSibling)&&!domUtils.isBlockElm(q)){o=q}this.setEndAfter(o);break}q=o;o=o.parentNode}if(n.parentNode===this.endContainer){this.endOffset--}domUtils.remove(n)}if(!this.collapsed){while(this.startOffset==0){if(p&&p(this.startContainer)){break}if(l(this.startContainer)){break}this.setStartBefore(this.startContainer)}while(this.endOffset==(this.endContainer.nodeType==1?this.endContainer.childNodes.length:this.endContainer.nodeValue.length)){if(p&&p(this.endContainer)){break}if(l(this.endContainer)){break}this.setEndAfter(this.endContainer)}}return this},enlargeToBlockElm:function(l){while(!domUtils.isBlockElm(this.startContainer)){this.setStartBefore(this.startContainer)}if(!l){while(!domUtils.isBlockElm(this.endContainer)){this.setEndAfter(this.endContainer)}}return this},adjustmentBoundary:function(){if(!this.collapsed){while(!domUtils.isBody(this.startContainer)&&this.startOffset==this.startContainer[this.startContainer.nodeType==3?"nodeValue":"childNodes"].length&&this.startContainer[this.startContainer.nodeType==3?"nodeValue":"childNodes"].length){this.setStartAfter(this.startContainer)}while(!domUtils.isBody(this.endContainer)&&!this.endOffset&&this.endContainer[this.endContainer.nodeType==3?"nodeValue":"childNodes"].length){this.setEndBefore(this.endContainer)}}return this},applyInlineStyle:function(n,y,u){if(this.collapsed){return this}this.trimBoundary().enlarge(false,function(C){return C.nodeType==1&&domUtils.isBlockElm(C)}).adjustmentBoundary();var v=this.createBookmark(),q=v.end,A=function(C){return C.nodeType==1?C.tagName.toLowerCase()!="br":!domUtils.isWhitespace(C)},t=domUtils.getNextDomNode(v.start,false,A),o,p,s=this.cloneRange();while(t&&(domUtils.getPosition(t,q)&domUtils.POSITION_PRECEDING)){if(t.nodeType==3||dtd[n][t.tagName]){s.setStartBefore(t);o=t;while(o&&(o.nodeType==3||dtd[n][o.tagName])&&o!==q){p=o;o=domUtils.getNextDomNode(o,o.nodeType==1,null,function(C){return dtd[n][C.tagName]})}var z=s.setEndAfter(p).extractContents(),w;if(u&&u.length>0){var l,x;x=l=u[0].cloneNode(false);for(var r=1,B;B=u[r++];){l.appendChild(B.cloneNode(false));l=l.firstChild}w=l}else{w=s.document.createElement(n)}if(y){domUtils.setAttributes(w,y)}w.appendChild(z);s.insertNode(u?x:w);var m;if(n=="span"&&y.style&&/text\-decoration/.test(y.style)&&(m=domUtils.findParentByTagName(w,"a",true))){domUtils.setAttributes(m,y);domUtils.remove(w,true);w=m}else{domUtils.mergeSibling(w);domUtils.clearEmptySibling(w)}domUtils.mergeChild(w,y);t=domUtils.getNextDomNode(w,false,A);domUtils.mergeToParent(w);if(o===q){break}}else{t=domUtils.getNextDomNode(t,true,A)}}return this.moveToBookmark(v)},removeInlineStyle:function(l){if(this.collapsed){return this}l=utils.isArray(l)?l:[l];this.shrinkBoundary().adjustmentBoundary();var s=this.startContainer,m=this.endContainer;while(1){if(s.nodeType==1){if(utils.indexOf(l,s.tagName.toLowerCase())>-1){break}if(s.tagName.toLowerCase()=="body"){s=null;break}}s=s.parentNode}while(1){if(m.nodeType==1){if(utils.indexOf(l,m.tagName.toLowerCase())>-1){break}if(m.tagName.toLowerCase()=="body"){m=null;break}}m=m.parentNode}var o=this.createBookmark(),r,q;if(s){q=this.cloneRange().setEndBefore(o.start).setStartBefore(s);r=q.extractContents();q.insertNode(r);domUtils.clearEmptySibling(s,true);s.parentNode.insertBefore(o.start,s)}if(m){q=this.cloneRange().setStartAfter(o.end).setEndAfter(m);r=q.extractContents();q.insertNode(r);domUtils.clearEmptySibling(m,false,true);m.parentNode.insertBefore(o.end,m.nextSibling)}var p=domUtils.getNextDomNode(o.start,false,function(t){return t.nodeType==1}),n;while(p&&p!==o.end){n=domUtils.getNextDomNode(p,true,function(t){return t.nodeType==1});if(utils.indexOf(l,p.tagName.toLowerCase())>-1){domUtils.remove(p,true)}p=n}return this.moveToBookmark(o)},getClosedNode:function(){var m;if(!this.collapsed){var l=this.cloneRange().adjustmentBoundary().shrinkBoundary();if(k(l)){var n=l.startContainer.childNodes[l.startOffset];if(n&&n.nodeType==1&&(dtd.$empty[n.tagName]||dtd.$nonChild[n.tagName])){m=n}}}return m},select:browser.ie?function(m,v){var r;if(!this.collapsed){this.shrinkBoundary()}var n=this.getClosedNode();if(n&&!v){try{r=this.document.body.createControlRange();r.addElement(n);r.select()}catch(s){}return this}var t=this.createBookmark(),l=t.start,o;r=this.document.body.createTextRange();r.moveToElementText(l);r.moveStart("character",1);if(!this.collapsed){var q=this.document.body.createTextRange();o=t.end;q.moveToElementText(o);r.setEndPoint("EndToEnd",q)}else{if(!m&&this.startContainer.nodeType!=3){var u=this.document.createTextNode(g),p=this.document.createElement("span");p.appendChild(this.document.createTextNode(g));l.parentNode.insertBefore(p,l);l.parentNode.insertBefore(u,l);e(this.document,u);c=u;h(p,"previousSibling");h(l,"nextSibling");r.moveStart("character",-1);r.collapse(true)}}this.moveToBookmark(t);p&&domUtils.remove(p);try{r.select()}catch(s){}return this}:function(l){function m(u){function t(w,x,v){if(w.nodeType==3&&w.nodeValue.length<x){u[v+"Offset"]=w.nodeValue.length}}t(u.startContainer,u.startOffset,"start");t(u.endContainer,u.endOffset,"end")}var q=domUtils.getWindow(this.document),p=q.getSelection(),o;browser.gecko?this.document.body.focus():q.focus();if(p){p.removeAllRanges();if(this.collapsed&&!l){var s=this.startContainer,r=s;if(s.nodeType==1){r=s.childNodes[this.startOffset]}if(!(s.nodeType==3&&this.startOffset)&&(r?(!r.previousSibling||r.previousSibling.nodeType!=3):(!s.lastChild||s.lastChild.nodeType!=3))){o=this.document.createTextNode(g);this.insertNode(o);e(this.document,o);h(o,"previousSibling");h(o,"nextSibling");c=o;this.setStart(o,browser.webkit?1:0).collapse(true)}}var n=this.document.createRange();if(this.collapsed&&browser.opera&&this.startContainer.nodeType==1){var r=this.startContainer.childNodes[this.startOffset];if(!r){r=this.startContainer.lastChild;if(r&&domUtils.isBr(r)){this.setStartBefore(r).collapse(true)}}else{while(r&&domUtils.isBlockElm(r)){if(r.nodeType==1&&r.childNodes[0]){r=r.childNodes[0]}else{break}}r&&this.setStartBefore(r).collapse(true)}}m(this);n.setStart(this.startContainer,this.startOffset);n.setEnd(this.endContainer,this.endOffset);p.addRange(n)}return this},scrollToView:function(n,o){n=n?window:domUtils.getWindow(this.document);var m=this,l=m.document.createElement("span");l.innerHTML="&nbsp;";m.cloneRange().insertNode(l);domUtils.scrollToView(l,n,o);domUtils.remove(l);return m},inFillChar:function(){var l=this.startContainer;if(this.collapsed&&l.nodeType==3&&l.nodeValue.replace(new RegExp("^"+domUtils.fillChar),"").length+1==l.nodeValue.length){return true}return false},createAddress:function(o,n){var p={},m=this;function l(q){var s=q?m.startContainer:m.endContainer;var x=domUtils.findParents(s,true,function(z){return !domUtils.isBody(z)}),w=[];for(var u=0,y;y=x[u++];){w.push(domUtils.getNodeIndex(y,n))}var r=0;if(n){if(s.nodeType==3){var t=s.previousSibling;while(t&&t.nodeType==3){r+=t.nodeValue.replace(fillCharReg,"").length;t=t.previousSibling}r+=(q?m.startOffset:m.endOffset)}else{s=s.childNodes[q?m.startOffset:m.endOffset];if(s){r=domUtils.getNodeIndex(s,n)}else{s=q?m.startContainer:m.endContainer;var v=s.firstChild;while(v){if(domUtils.isFillChar(v)){v=v.nextSibling;continue}r++;if(v.nodeType==3){while(v&&v.nodeType==3){v=v.nextSibling}}else{v=v.nextSibling}}}}}else{r=q?domUtils.isFillChar(s)?0:m.startOffset:m.endOffset}if(r<0){r=0}w.push(r);return w}p.startAddress=l(true);if(!o){p.endAddress=m.collapsed?[].concat(p.startAddress):l()}return p},moveToAddress:function(o,m){var l=this;function n(s,r){var v=l.document.body,p,w;for(var u=0,t,q=s.length;u<q;u++){t=s[u];p=v;v=v.childNodes[t];if(!v){w=t;break}}if(r){if(v){l.setStartBefore(v)}else{l.setStart(p,w)}}else{if(v){l.setEndBefore(v)}else{l.setEnd(p,w)}}}n(o.startAddress,true);!m&&o.endAddress&&n(o.endAddress);return l},equals:function(l){for(var m in this){if(this.hasOwnProperty(m)){if(this[m]!==l[m]){return false}}}return true},traversal:function(l,q){if(this.collapsed){return this}var o=this.createBookmark(),m=o.end,p=domUtils.getNextDomNode(o.start,false,q);while(p&&p!==m&&(domUtils.getPosition(p,m)&domUtils.POSITION_PRECEDING)){var n=domUtils.getNextDomNode(p,false,q);l(p);p=n}return this.moveToBookmark(o)}}})();(function(){function d(p,g){var h=domUtils.getNodeIndex;p=p.duplicate();p.collapse(g);var t=p.parentElement();if(!t.hasChildNodes()){return{container:t,offset:0}}var s=t.children,j,l=p.duplicate(),u=0,o=s.length-1,q=-1,f;while(u<=o){q=Math.floor((u+o)/2);j=s[q];l.moveToElementText(j);var n=l.compareEndPoints("StartToStart",p);if(n>0){o=q-1}else{if(n<0){u=q+1}else{return{container:t,offset:h(j)}}}}if(q==-1){l.moveToElementText(t);l.setEndPoint("StartToStart",p);f=l.text.replace(/(\r\n|\r)/g,"\n").length;s=t.childNodes;if(!f){j=s[s.length-1];return{container:j,offset:j.nodeValue.length}}var m=s.length;while(f>0){f-=s[--m].nodeValue.length}return{container:s[m],offset:-f}}l.collapse(n>0);l.setEndPoint(n>0?"StartToStart":"EndToStart",p);f=l.text.replace(/(\r\n|\r)/g,"\n").length;if(!f){return dtd.$empty[j.tagName]||dtd.$nonChild[j.tagName]?{container:t,offset:h(j)+(n>0?0:1)}:{container:j,offset:n>0?0:j.childNodes.length}}while(f>0){try{var k=j;j=j[n>0?"previousSibling":"nextSibling"];f-=j.nodeValue.length}catch(r){return{container:t,offset:h(k)}}}return{container:j,offset:n>0?-f:j.nodeValue.length+f}}function c(g,f){if(g.item){f.selectNode(g.item(0))}else{var e=d(g,true);f.setStart(e.container,e.offset);if(g.compareEndPoints("StartToEnd",g)!=0){e=d(g,false);f.setEnd(e.container,e.offset)}}return f}function b(h){var g;try{g=h.getNative().createRange()}catch(j){return null}var f=g.item?g.item(0):g.parentElement();if((f.ownerDocument||f)===h.document){return g}return null}var a=dom.Selection=function(g){var f=this,e;f.document=g;if(browser.ie9below){e=domUtils.getWindow(g).frameElement;domUtils.on(e,"beforedeactivate",function(){f._bakIERange=f.getIERange()});domUtils.on(e,"activate",function(){try{if(!b(f)&&f._bakIERange){f._bakIERange.select()}}catch(h){}f._bakIERange=null})}e=g=null};a.prototype={rangeInBody:function(e,f){var g=browser.ie9below||f?e.item?e.item():e.parentElement():e.startContainer;return g===this.document.body||domUtils.inDoc(g,this.document)},getNative:function(){var g=this.document;try{return !g?null:browser.ie9below?g.selection:domUtils.getWindow(g).getSelection()}catch(f){return null}},getIERange:function(){var e=b(this);if(!e){if(this._bakIERange){return this._bakIERange}}return e},cache:function(){this.clear();this._cachedRange=this.getRange();this._cachedStartElement=this.getStart();this._cachedStartElementPath=this.getStartElementPath()},getStartElementPath:function(){if(this._cachedStartElementPath){return this._cachedStartElementPath}var e=this.getStart();if(e){return domUtils.findParents(e,true,null,true)}return[]},clear:function(){this._cachedStartElementPath=this._cachedRange=this._cachedStartElement=null},isFocus:function(){try{if(browser.ie9below){var f=b(this);return !!(f&&this.rangeInBody(f))}else{return !!this.getNative().rangeCount}}catch(g){return false}},getRange:function(){var j=this;function h(e){var p=j.document.body.firstChild,o=e.collapsed;while(p&&p.firstChild){e.setStart(p,0);p=p.firstChild}if(!e.startContainer){e.setStart(j.document.body,0)}if(o){e.collapse(true)}}if(j._cachedRange!=null){return this._cachedRange}var g=new baidu.editor.dom.Range(j.document);if(browser.ie9below){var l=j.getIERange();if(l){try{c(l,g)}catch(m){h(g)}}else{h(g)}}else{var k=j.getNative();if(k&&k.rangeCount){var f=k.getRangeAt(0);var n=k.getRangeAt(k.rangeCount-1);g.setStart(f.startContainer,f.startOffset).setEnd(n.endContainer,n.endOffset);if(g.collapsed&&domUtils.isBody(g.startContainer)&&!g.startOffset){h(g)}}else{if(this._bakRange&&domUtils.inDoc(this._bakRange.startContainer,this.document)){return this._bakRange}h(g)}}return this._bakRange=g},getStart:function(){if(this._cachedStartElement){return this._cachedStartElement}var e=browser.ie9below?this.getIERange():this.getRange(),h,j,f,g;if(browser.ie9below){if(!e){return this.document.body.firstChild}if(e.item){return e.item(0)}h=e.duplicate();h.text.length>0&&h.moveStart("character",1);h.collapse(1);j=h.parentElement();g=f=e.parentElement();while(f=f.parentNode){if(f==j){j=g;break}}}else{e.shrinkBoundary();j=e.startContainer;if(j.nodeType==1&&j.hasChildNodes()){j=j.childNodes[Math.min(j.childNodes.length-1,e.startOffset)]}if(j.nodeType==3){return j.parentNode}}return j},getText:function(){var e,f;if(this.isFocus()&&(e=this.getNative())){f=browser.ie9below?e.createRange():e.getRangeAt(0);return browser.ie9below?f.text:f.toString()}return""},clearRange:function(){this.getNative()[browser.ie9below?"empty":"removeAllRanges"]()}}})();(function(){var e=0,c;function g(n,m){var h;if(m.textarea){if(utils.isString(m.textarea)){for(var k=0,l,j=domUtils.getElementsByTagName(n,"textarea");l=j[k++];){if(l.id=="ueditor_textarea_"+m.options.textarea){h=l;break}}}else{h=m.textarea}}if(!h){n.appendChild(h=domUtils.createElement(document,"textarea",{name:m.options.textarea,id:"ueditor_textarea_"+m.options.textarea,style:"display:none"}));m.textarea=h}!h.getAttribute("name")&&h.setAttribute("name",m.options.textarea);h.value=m.hasContents()?(m.options.allHtmlEnabled?m.getAllHtml():m.getContent(null,null,true)):""}function d(h){for(var j in UE.plugins){UE.plugins[j].call(h)}}function f(h){for(var j in h){return j}}function b(h){h.langIsReady=true;h.fireEvent("langReady")}var a=UE.Editor=function(h){var j=this;j.uid=e++;EventBase.call(j);j.commands={};j.options=utils.extend(utils.clone(h||{}),UEDITOR_CONFIG,true);j.shortcutkeys={};j.inputRules=[];j.outputRules=[];j.setOpt(a.defaultOptions(j));j.loadServerConfig();if(!utils.isEmptyObject(UE.I18N)){j.options.lang=f(UE.I18N);UE.plugin.load(j);b(j)}else{utils.loadFile(document,{src:j.options.langPath+j.options.lang+"/"+j.options.lang+".js",tag:"script",type:"text/javascript",defer:"defer"},function(){UE.plugin.load(j);b(j)})}UE.instants["ueditorInstant"+j.uid]=j};a.prototype={registerCommand:function(h,j){this.commands[h]=j},ready:function(h){var j=this;if(h){j.isReady?h.apply(j):j.addListener("ready",h)}},setOpt:function(h,k){var j={};if(utils.isString(h)){j[h]=k}else{j=h}utils.extend(this.options,j,true)},getOpt:function(h){return this.options[h]},destroy:function(){var l=this;l.fireEvent("destroy");var j=l.container.parentNode;var h=l.textarea;if(!h){h=document.createElement("textarea");j.parentNode.insertBefore(h,j)}else{h.style.display=""}h.style.width=l.iframe.offsetWidth+"px";h.style.height=l.iframe.offsetHeight+"px";h.value=l.getContent();h.id=l.key;j.innerHTML="";domUtils.remove(j);var k=l.key;for(var m in l){if(l.hasOwnProperty(m)){delete this[m]}}UE.delEditor(k)},render:function(h){var m=this,j=m.options,l=function(n){return parseInt(domUtils.getComputedStyle(h,n))};if(utils.isString(h)){h=document.getElementById(h)}if(h){if(j.initialFrameWidth){j.minFrameWidth=j.initialFrameWidth}else{j.minFrameWidth=j.initialFrameWidth=h.offsetWidth}if(j.initialFrameHeight){j.minFrameHeight=j.initialFrameHeight}else{j.initialFrameHeight=j.minFrameHeight=h.offsetHeight}h.style.width=/%$/.test(j.initialFrameWidth)?"100%":j.initialFrameWidth-l("padding-left")-l("padding-right")+"px";h.style.height=/%$/.test(j.initialFrameHeight)?"100%":j.initialFrameHeight-l("padding-top")-l("padding-bottom")+"px";h.style.zIndex=j.zIndex;var k=(ie&&browser.version<9?"":"<!DOCTYPE html>")+"<html xmlns='http://www.w3.org/1999/xhtml' class='view' ><head><style type='text/css'>.view{padding:0;word-wrap:break-word;cursor:text;height:90%;}\nbody{margin:8px;font-family:sans-serif;font-size:16px;}p{margin:5px 0;}</style>"+(j.iframeCssUrl?"<link rel='stylesheet' type='text/css' href='"+utils.unhtml(j.iframeCssUrl)+"'/>":"")+(j.initialStyle?"<style>"+j.initialStyle+"</style>":"")+"</head><body class='view' ></body><script type='text/javascript' "+(ie?"defer='defer'":"")+" id='_initialScript'>setTimeout(function(){editor = window.parent.UE.instants['ueditorInstant"+m.uid+"'];editor._setup(document);},0);var _tmpScript = document.getElementById('_initialScript');_tmpScript.parentNode.removeChild(_tmpScript);<\/script></html>";h.appendChild(domUtils.createElement(document,"iframe",{id:"ueditor_"+m.uid,width:"100%",height:"100%",frameborder:"0",src:"javascript:void(function(){document.open();"+(j.customDomain&&document.domain!=location.hostname?'document.domain="'+document.domain+'";':"")+'document.write("'+k+'");document.close();}())'}));h.style.overflow="hidden";setTimeout(function(){if(/%$/.test(j.initialFrameWidth)){j.minFrameWidth=j.initialFrameWidth=h.offsetWidth}if(/%$/.test(j.initialFrameHeight)){j.minFrameHeight=j.initialFrameHeight=h.offsetHeight;h.style.height=j.initialFrameHeight+"px"}})}},_setup:function(n){var l=this,h=l.options;if(ie){n.body.disabled=true;n.body.contentEditable=true;n.body.disabled=false}else{n.body.contentEditable=true}n.body.spellcheck=false;l.document=n;l.window=n.defaultView||n.parentWindow;l.iframe=l.window.frameElement;l.body=n.body;l.selection=new dom.Selection(n);var o;if(browser.gecko&&(o=this.selection.getNative())){o.removeAllRanges()}this._initEvents();for(var k=this.iframe.parentNode;!domUtils.isBody(k);k=k.parentNode){if(k.tagName=="FORM"){l.form=k;if(l.options.autoSyncData){domUtils.on(l.window,"blur",function(){g(k,l)})}else{domUtils.on(k,"submit",function(){g(this,l)})}break}}if(h.initialContent){if(h.autoClearinitialContent){var j=l.execCommand;l.execCommand=function(){l.fireEvent("firstBeforeExecCommand");return j.apply(l,arguments)};this._setDefaultContent(h.initialContent)}else{this.setContent(h.initialContent,false,true)}}if(domUtils.isEmptyNode(l.body)){l.body.innerHTML="<p>"+(browser.ie?"":"<br/>")+"</p>"}if(h.focus){setTimeout(function(){l.focus(l.options.focusInEnd);!l.options.autoClearinitialContent&&l._selectionChange()},0)}if(!l.container){l.container=this.iframe.parentNode}if(h.fullscreen&&l.ui){l.ui.setFullScreen(true)}try{l.document.execCommand("2D-position",false,false)}catch(m){}try{l.document.execCommand("enableInlineTableEditing",false,false)}catch(m){}try{l.document.execCommand("enableObjectResizing",false,false)}catch(m){}l._bindshortcutKeys();l.isReady=1;l.fireEvent("ready");h.onready&&h.onready.call(l);if(!browser.ie9below){domUtils.on(l.window,["blur","focus"],function(p){if(p.type=="blur"){l._bakRange=l.selection.getRange();try{l._bakNativeRange=l.selection.getNative().getRangeAt(0);l.selection.getNative().removeAllRanges()}catch(p){l._bakNativeRange=null}}else{try{l._bakRange&&l._bakRange.select()}catch(p){}}})}if(browser.gecko&&browser.version<=10902){l.body.contentEditable=false;setTimeout(function(){l.body.contentEditable=true},100);setInterval(function(){l.body.style.height=l.iframe.offsetHeight-20+"px"},100)}!h.isShow&&l.setHide();h.readonly&&l.setDisabled()},sync:function(k){var j=this,h=k?document.getElementById(k):domUtils.findParent(j.iframe.parentNode,function(l){return l.tagName=="FORM"},true);h&&g(h,j)},setHeight:function(h,j){if(h!==parseInt(this.iframe.parentNode.style.height)){this.iframe.parentNode.style.height=h+"px"}!j&&(this.options.minFrameHeight=this.options.initialFrameHeight=h);this.body.style.height=h+"px";!j&&this.trigger("setHeight")},addshortcutkey:function(j,h){var k={};if(h){k[j]=h}else{k=j}utils.extend(this.shortcutkeys,k)},_bindshortcutKeys:function(){var j=this,h=this.shortcutkeys;j.addListener("keydown",function(p,o){var r=o.keyCode||o.which;for(var m in h){var n=h[m].split(",");for(var s=0,k;k=n[s++];){k=k.split(":");var q=k[0],l=k[1];if(/^(ctrl)(\+shift)?\+(\d+)$/.test(q.toLowerCase())||/^(\d+)$/.test(q)){if(((RegExp.$1=="ctrl"?(o.ctrlKey||o.metaKey):0)&&(RegExp.$2!=""?o[RegExp.$2.slice(1)+"Key"]:1)&&r==RegExp.$3)||r==RegExp.$1){if(j.queryCommandState(m,l)!=-1){j.execCommand(m,l)}domUtils.preventDefault(o)}}}}})},getContent:function(o,m,j,l,k){var n=this;if(o&&utils.isFunction(o)){m=o;o=""}if(m?!m():!this.hasContents()){return""}n.fireEvent("beforegetcontent");var h=UE.htmlparser(n.body.innerHTML,l);n.filterOutputRule(h);n.fireEvent("aftergetcontent",o,h);return h.toHtml(k)},getAllHtml:function(){var k=this,j=[],h="";k.fireEvent("getAllHtml",j);if(browser.ie&&browser.version>8){var l="";utils.each(k.document.styleSheets,function(m){l+=(m.href?'<link rel="stylesheet" type="text/css" href="'+m.href+'" />':"<style>"+m.cssText+"</style>")});utils.each(k.document.getElementsByTagName("script"),function(m){l+=m.outerHTML})}return"<html><head>"+(k.options.charset?'<meta http-equiv="Content-Type" content="text/html; charset='+k.options.charset+'"/>':"")+(l||k.document.getElementsByTagName("head")[0].innerHTML)+j.join("\n")+"</head><body "+(ie&&browser.version<9?'class="view"':"")+">"+k.getContent(null,null,true)+"</body></html>"},getPlainTxt:function(){var j=new RegExp(domUtils.fillChar,"g"),h=this.body.innerHTML.replace(/[\n\r]/g,"");h=h.replace(/<(p|div)[^>]*>(<br\/?>|&nbsp;)<\/\1>/gi,"\n").replace(/<br\/?>/gi,"\n").replace(/<[^>/]+>/g,"").replace(/(\n)?<\/([^>]+)>/g,function(l,k,m){return dtd.$block[m]?"\n":k?k:""});return h.replace(j,"").replace(/\u00a0/g," ").replace(/&nbsp;/g," ")},getContentTxt:function(){var h=new RegExp(domUtils.fillChar,"g");return this.body[browser.ie?"innerText":"textContent"].replace(h,"").replace(/\u00a0/g," ")},setContent:function(m,q,l){var r=this;r.fireEvent("beforesetcontent",m);var s=UE.htmlparser(m);r.filterInputRule(s);m=s.toHtml();r.body.innerHTML=(q?r.body.innerHTML:"")+m;function o(p){return p.tagName=="DIV"&&p.getAttribute("cdata_tag")}if(r.options.enterTag=="p"){var j=this.body.firstChild,k;if(!j||j.nodeType==1&&(dtd.$cdata[j.tagName]||o(j)||domUtils.isCustomeNode(j))&&j===this.body.lastChild){this.body.innerHTML="<p>"+(browser.ie?"&nbsp;":"<br/>")+"</p>"+this.body.innerHTML}else{var h=r.document.createElement("p");while(j){while(j&&(j.nodeType==3||j.nodeType==1&&dtd.p[j.tagName]&&!dtd.$cdata[j.tagName])){k=j.nextSibling;h.appendChild(j);j=k}if(h.firstChild){if(!j){r.body.appendChild(h);break}else{j.parentNode.insertBefore(h,j);h=r.document.createElement("p")}}j=j.nextSibling}}}r.fireEvent("aftersetcontent");r.fireEvent("contentchange");!l&&r._selectionChange();r._bakRange=r._bakIERange=r._bakNativeRange=null;var n;if(browser.gecko&&(n=this.selection.getNative())){n.removeAllRanges()}if(r.options.autoSyncData){r.form&&g(r.form,r)}},focus:function(m){try{var k=this,h=k.selection.getRange();if(m){var j=k.body.lastChild;if(j&&j.nodeType==1&&!dtd.$empty[j.tagName]){if(domUtils.isEmptyBlock(j)){h.setStartAtFirst(j)}else{h.setStartAtLast(j)}h.collapse(true)}h.setCursor(true)}else{if(!h.collapsed&&domUtils.isBody(h.startContainer)&&h.startOffset==0){var j=k.body.firstChild;if(j&&j.nodeType==1&&!dtd.$empty[j.tagName]){h.setStartAtFirst(j).collapse(true)}}h.select(true)}this.fireEvent("focus selectionchange")}catch(l){}},isFocus:function(){return this.selection.isFocus()},blur:function(){var h=this.selection.getNative();if(h.empty&&browser.ie){var j=document.body.createTextRange();j.moveToElementText(document.body);j.collapse(true);j.select();h.empty()}else{h.removeAllRanges()}},_initEvents:function(){var h=this,k=h.document,j=h.window;h._proxyDomEvent=utils.bind(h._proxyDomEvent,h);domUtils.on(k,["click","contextmenu","mousedown","keydown","keyup","keypress","mouseup","mouseover","mouseout","selectstart"],h._proxyDomEvent);domUtils.on(j,["focus","blur"],h._proxyDomEvent);domUtils.on(h.body,"drop",function(l){if(browser.gecko&&l.stopPropagation){l.stopPropagation()}h.fireEvent("contentchange")});domUtils.on(k,["mouseup","keydown"],function(l){if(l.type=="keydown"&&(l.ctrlKey||l.metaKey||l.shiftKey||l.altKey)){return}if(l.button==2){return}h._selectionChange(250,l)})},_proxyDomEvent:function(h){if(this.fireEvent("before"+h.type.replace(/^on/,"").toLowerCase())===false){return false}if(this.fireEvent(h.type.replace(/^on/,""),h)===false){return false}return this.fireEvent("after"+h.type.replace(/^on/,"").toLowerCase())},_selectionChange:function(l,h){var o=this;var n=false;var m,k;if(browser.ie&&browser.version<9&&h&&h.type=="mouseup"){var j=this.selection.getRange();if(!j.collapsed){n=true;m=h.clientX;k=h.clientY}}clearTimeout(c);c=setTimeout(function(){if(!o.selection||!o.selection.getNative()){return}var q;if(n&&o.selection.getNative().type=="None"){q=o.document.body.createTextRange();try{q.moveToPoint(m,k)}catch(p){q=null}}var r;if(q){r=o.selection.getIERange;o.selection.getIERange=function(){return q}}o.selection.cache();if(r){o.selection.getIERange=r}if(o.selection._cachedRange&&o.selection._cachedStartElement){o.fireEvent("beforeselectionchange");o.fireEvent("selectionchange",!!h);o.fireEvent("afterselectionchange");o.selection.clear()}},l||50)},_callCmdFn:function(m,j){var h=j[0].toLowerCase(),l,k;l=this.commands[h]||UE.commands[h];k=l&&l[m];if((!l||!k)&&m=="queryCommandState"){return 0}else{if(k){return k.apply(this,j)}}},execCommand:function(j){j=j.toLowerCase();var k=this,h,l=k.commands[j]||UE.commands[j];if(!l||!l.execCommand){return null}if(!l.notNeedUndo&&!k.__hasEnterExecCommand){k.__hasEnterExecCommand=true;if(k.queryCommandState.apply(k,arguments)!=-1){k.fireEvent("saveScene");k.fireEvent.apply(k,["beforeexeccommand",j].concat(arguments));h=this._callCmdFn("execCommand",arguments);k.fireEvent.apply(k,["afterexeccommand",j].concat(arguments));k.fireEvent("saveScene")}k.__hasEnterExecCommand=false}else{h=this._callCmdFn("execCommand",arguments);(!k.__hasEnterExecCommand&&!l.ignoreContentChange&&!k._ignoreContentChange)&&k.fireEvent("contentchange")}(!k.__hasEnterExecCommand&&!l.ignoreContentChange&&!k._ignoreContentChange)&&k._selectionChange();return h},queryCommandState:function(h){return this._callCmdFn("queryCommandState",arguments)},queryCommandValue:function(h){return this._callCmdFn("queryCommandValue",arguments)},hasContents:function(j){if(j){for(var l=0,k;k=j[l++];){if(this.document.getElementsByTagName(k).length>0){return true}}}if(!domUtils.isEmptyBlock(this.body)){return true}j=["div"];for(l=0;k=j[l++];){var h=domUtils.getElementsByTagName(this.document,k);for(var o=0,m;m=h[o++];){if(domUtils.isCustomeNode(m)){return true}}}return false},reset:function(){this.fireEvent("reset")},setEnabled:function(){var j=this,h;if(j.body.contentEditable=="false"){j.body.contentEditable=true;h=j.selection.getRange();try{h.moveToBookmark(j.lastBk);delete j.lastBk}catch(k){h.setStartAtFirst(j.body).collapse(true)}h.select(true);if(j.bkqueryCommandState){j.queryCommandState=j.bkqueryCommandState;delete j.bkqueryCommandState}if(j.bkqueryCommandValue){j.queryCommandValue=j.bkqueryCommandValue;delete j.bkqueryCommandValue}j.fireEvent("selectionchange")}},enable:function(){return this.setEnabled()},setDisabled:function(h){var j=this;h=h?utils.isArray(h)?h:[h]:[];if(j.body.contentEditable=="true"){if(!j.lastBk){j.lastBk=j.selection.getRange().createBookmark(true)}j.body.contentEditable=false;j.bkqueryCommandState=j.queryCommandState;j.bkqueryCommandValue=j.queryCommandValue;j.queryCommandState=function(k){if(utils.indexOf(h,k)!=-1){return j.bkqueryCommandState.apply(j,arguments)}return -1};j.queryCommandValue=function(k){if(utils.indexOf(h,k)!=-1){return j.bkqueryCommandValue.apply(j,arguments)}return null};j.fireEvent("selectionchange")}},disable:function(h){return this.setDisabled(h)},_setDefaultContent:function(){function h(){var j=this;if(j.document.getElementById("initContent")){j.body.innerHTML="<p>"+(ie?"":"<br/>")+"</p>";j.removeListener("firstBeforeExecCommand focus",h);setTimeout(function(){j.focus();j._selectionChange()},0)}}return function(j){var k=this;k.body.innerHTML='<p id="initContent">'+j+"</p>";k.addListener("firstBeforeExecCommand focus",h)}}(),setShow:function(){var j=this,h=j.selection.getRange();if(j.container.style.display=="none"){try{h.moveToBookmark(j.lastBk);delete j.lastBk}catch(k){h.setStartAtFirst(j.body).collapse(true)}setTimeout(function(){h.select(true)},100);j.container.style.display=""}},show:function(){return this.setShow()},setHide:function(){var h=this;if(!h.lastBk){h.lastBk=h.selection.getRange().createBookmark(true)}h.container.style.display="none"},hide:function(){return this.setHide()},getLang:function(k){var l=UE.I18N[this.options.lang];if(!l){throw Error("not import language file")}k=(k||"").split(".");for(var j=0,h;h=k[j++];){l=l[h];if(!l){break}}return l},getContentLength:function(j,h){var m=this.getContent(false,false,true).length;if(j){h=(h||[]).concat(["hr","img","iframe"]);m=this.getContentTxt().replace(/[\t\r\n]+/g,"").length;for(var l=0,k;k=h[l++];){m+=this.document.getElementsByTagName(k).length}}return m},addInputRule:function(h){this.inputRules.push(h)},filterInputRule:function(h){for(var k=0,j;j=this.inputRules[k++];){j.call(this,h)}},addOutputRule:function(h){this.outputRules.push(h)},filterOutputRule:function(h){for(var k=0,j;j=this.outputRules[k++];){j.call(this,h)}},getActionUrl:function(l){var j=this.getOpt(l)||l,k=this.getOpt("imageUrl"),h=this.getOpt("serverUrl");if(!h&&k){h=k.replace(/^(.*[\/]).+([\.].+)$/,"$1controller$2")}if(h){h=h+(h.indexOf("?")==-1?"?":"&")+"action="+(j||"");return utils.formatUrl(h)}else{return""}}};utils.inherits(a,EventBase)})();UE.Editor.defaultOptions=function(b){var a=b.options.UEDITOR_HOME_URL;return{isShow:true,initialContent:"",initialStyle:"",autoClearinitialContent:false,iframeCssUrl:a+"themes/iframe.css",textarea:"editorValue",focus:false,focusInEnd:true,autoClearEmptyNode:true,fullscreen:false,readonly:false,zIndex:999,imagePopup:true,enterTag:"p",customDomain:false,lang:"zh-cn",langPath:a+"lang/",theme:"default",themePath:a+"themes/",allHtmlEnabled:false,scaleEnabled:false,tableNativeEditInFF:false,autoSyncData:true,fileNameFormat:"{time}{rand:6}"}};(function(){UE.Editor.prototype.loadServerConfig=function(){var me=this;setTimeout(function(){try{me.options.imageUrl&&me.setOpt("serverUrl",me.options.imageUrl.replace(/^(.*[\/]).+([\.].+)$/,"$1controller$2"));var configUrl=me.getActionUrl("config"),isJsonp=utils.isCrossDomainUrl(configUrl);me._serverConfigLoaded=false;configUrl&&UE.ajax.request(configUrl,{method:"GET",dataType:isJsonp?"jsonp":"",onsuccess:function(r){try{var config=isJsonp?r:eval("("+r.responseText+")");utils.extend(me.options,config);me.fireEvent("serverConfigLoaded");me._serverConfigLoaded=true}catch(e){showErrorMsg(me.getLang("loadconfigFormatError"))}},onerror:function(){showErrorMsg(me.getLang("loadconfigHttpError"))}})}catch(e){showErrorMsg(me.getLang("loadconfigError"))}});function showErrorMsg(msg){console&&console.error(msg)}};UE.Editor.prototype.isServerConfigLoaded=function(){var me=this;return me._serverConfigLoaded||false};UE.Editor.prototype.afterConfigReady=function(handler){if(!handler||!utils.isFunction(handler)){return}var me=this;var readyHandler=function(){handler.apply(me,arguments);me.removeListener("serverConfigLoaded",readyHandler)};if(me.isServerConfigLoaded()){handler.call(me,"serverConfigLoaded")}else{me.addListener("serverConfigLoaded",readyHandler)}}})();UE.ajax=function(){var c="XMLHttpRequest()";try{new ActiveXObject("Msxml2.XMLHTTP");c="ActiveXObject('Msxml2.XMLHTTP')"}catch(g){try{new ActiveXObject("Microsoft.XMLHTTP");c="ActiveXObject('Microsoft.XMLHTTP')"}catch(g){}}var f=new Function("return new "+c);function d(k){var l=[];for(var h in k){if(h=="method"||h=="timeout"||h=="async"||h=="dataType"||h=="callback"){continue}if(k[h]==undefined||k[h]==null){continue}if(!((typeof k[h]).toLowerCase()=="function"||(typeof k[h]).toLowerCase()=="object")){l.push(encodeURIComponent(h)+"="+encodeURIComponent(k[h]))}else{if(utils.isArray(k[h])){for(var e=0;e<k[h].length;e++){l.push(encodeURIComponent(h)+"[]="+encodeURIComponent(k[h][e]))}}}}return l.join("&")}function a(h,k){var q=f(),l=false,j={method:"POST",timeout:5000,async:true,data:{},onsuccess:function(){},onerror:function(){}};if(typeof h==="object"){k=h;h=k.url}if(!q||!h){return}var n=k?utils.extend(j,k):j;var p=d(n);if(!utils.isEmptyObject(n.data)){p+=(p?"&":"")+d(n.data)}var o=setTimeout(function(){if(q.readyState!=4){l=true;q.abort();clearTimeout(o)}},n.timeout);var e=n.method.toUpperCase();var m=h+(h.indexOf("?")==-1?"?":"&")+(e=="POST"?"":p+"&noCache="+ +new Date);q.open(e,m,n.async);q.onreadystatechange=function(){if(q.readyState==4){if(!l&&q.status==200){n.onsuccess(q)}else{n.onerror(q)}}};if(e=="POST"){q.setRequestHeader("Content-Type","application/x-www-form-urlencoded");q.send(p)}else{q.send(null)}}function b(h,e){var u=e.onsuccess||function(){},q=document.createElement("SCRIPT"),v=e||{},l=v.charset,t=v.jsonp||"callback",o,s=v.timeOut||0,j,k=new RegExp("(\\?|&)"+t+"=([^&]*)"),n;if(utils.isFunction(u)){o="bd__editor__"+Math.floor(Math.random()*2147483648).toString(36);window[o]=r(0)}else{if(utils.isString(u)){o=u}else{if(n=k.exec(h)){o=n[2]}}}h=h.replace(k,"\x241"+t+"="+o);if(h.search(k)<0){h+=(h.indexOf("?")<0?"?":"&")+t+"="+o}var m=d(e);if(!utils.isEmptyObject(e.data)){m+=(m?"&":"")+d(e.data)}if(m){h=h.replace(/\?/,"?"+m+"&")}q.onerror=r(1);if(s){j=setTimeout(r(1),s)}p(q,h,l);function p(x,w,y){x.setAttribute("type","text/javascript");x.setAttribute("defer","defer");y&&x.setAttribute("charset",y);x.setAttribute("src",w);document.getElementsByTagName("head")[0].appendChild(x)}function r(w){return function(){try{if(w){v.onerror&&v.onerror()}else{try{clearTimeout(j);u.apply(window,arguments)}catch(y){}}}catch(x){v.onerror&&v.onerror.call(window,x)}finally{v.oncomplete&&v.oncomplete.apply(window,arguments);q.parentNode&&q.parentNode.removeChild(q);window[o]=null;try{delete window[o]}catch(y){}}}}}return{request:function(e,h){if(h&&h.dataType=="jsonp"){b(e,h)}else{a(e,h)}},getJSONP:function(e,k,h){var j={data:k,oncomplete:h};b(e,j)}}}();var filterWord=UE.filterWord=function(){function c(d){return/(class="?Mso|style="[^"]*\bmso\-|w:WordDocument|<(v|o):|lang=)/ig.test(d)}function a(d){d=d.replace(/[\d.]+\w+/g,function(e){return utils.transUnitToPx(e)});return d}function b(d){return d.replace(/[\t\r\n]+/g," ").replace(/<!--[\s\S]*?-->/ig,"").replace(/<v:shape [^>]*>[\s\S]*?.<\/v:shape>/gi,function(k){if(browser.opera){return""}try{if(/Bitmap/i.test(k)){return""}var g=k.match(/width:([ \d.]*p[tx])/i)[1],f=k.match(/height:([ \d.]*p[tx])/i)[1],j=k.match(/src=\s*"([^"]*)"/i)[1];return'<img width="'+a(g)+'" height="'+a(f)+'" src="'+j+'" />'}catch(h){return""}}).replace(/<\/?div[^>]*>/g,"").replace(/v:\w+=(["']?)[^'"]+\1/g,"").replace(/<(!|script[^>]*>.*?<\/script(?=[>\s])|\/?(\?xml(:\w+)?|xml|meta|link|style|\w+:\w+)(?=[\s\/>]))[^>]*>/gi,"").replace(/<p [^>]*class="?MsoHeading"?[^>]*>(.*?)<\/p>/gi,"<p><strong>$1</strong></p>").replace(/\s+(class|lang|align)\s*=\s*(['"]?)([\w-]+)\2/ig,function(h,e,f,g){return e=="class"&&g=="MsoListParagraph"?h:""}).replace(/<(font|span)[^>]*>(\s*)<\/\1>/gi,function(f,e,g){return g.replace(/[\t\r\n ]+/g," ")}).replace(/(<[a-z][^>]*)\sstyle=(["'])([^\2]*?)\2/gi,function(l,q,j,f){var g=[],p=f.replace(/^\s+|\s+$/,"").replace(/&#39;/g,"'").replace(/&quot;/gi,"'").replace(/[\d.]+(cm|pt)/g,function(n){return utils.transUnitToPx(n)}).split(/;\s*/g);for(var k=0,o;o=p[k];k++){var e,m,h=o.split(":");if(h.length==2){e=h[0].toLowerCase();m=h[1].toLowerCase();if(/^(background)\w*/.test(e)&&m.replace(/(initial|\s)/g,"").length==0||/^(margin)\w*/.test(e)&&/^0\w+$/.test(m)){continue}switch(e){case"mso-padding-alt":case"mso-padding-top-alt":case"mso-padding-right-alt":case"mso-padding-bottom-alt":case"mso-padding-left-alt":case"mso-margin-alt":case"mso-margin-top-alt":case"mso-margin-right-alt":case"mso-margin-bottom-alt":case"mso-margin-left-alt":case"mso-height":case"mso-width":case"mso-vertical-align-alt":if(!/<table/.test(q)){g[k]=e.replace(/^mso-|-alt$/g,"")+":"+a(m)}continue;case"horiz-align":g[k]="text-align:"+m;continue;case"vert-align":g[k]="vertical-align:"+m;continue;case"font-color":case"mso-foreground":g[k]="color:"+m;continue;case"mso-background":case"mso-highlight":g[k]="background:"+m;continue;case"mso-default-height":g[k]="min-height:"+a(m);continue;case"mso-default-width":g[k]="min-width:"+a(m);continue;case"mso-padding-between-alt":g[k]="border-collapse:separate;border-spacing:"+a(m);continue;case"text-line-through":if((m=="single")||(m=="double")){g[k]="text-decoration:line-through"}continue;case"mso-zero-height":if(m=="yes"){g[k]="display:none"}continue;case"margin":if(!/[1-9]/.test(m)){continue}}if(/^(mso|column|font-emph|lang|layout|line-break|list-image|nav|panose|punct|row|ruby|sep|size|src|tab-|table-border|text-(?:decor|trans)|top-bar|version|vnd|word-break)/.test(e)||/text\-indent|padding|margin/.test(e)&&/\-[\d.]+/.test(m)){continue}g[k]=e+":"+h[1]}}return q+(g.length?' style="'+g.join(";").replace(/;{2,}/g,";")+'"':"")})}return function(d){return(c(d)?b(d):d)}}();(function(){var e=UE.uNode=function(p){this.type=p.type;this.data=p.data;this.tagName=p.tagName;this.parentNode=p.parentNode;this.attrs=p.attrs||{};this.children=p.children};var g={href:1,src:1,_src:1,_href:1,cdata_data:1};var k={style:1,script:1};var l="    ",j="\n";function c(p,r,q){p.push(j);return r+(q?1:-1)}function o(p,r){for(var q=0;q<r;q++){p.push(l)}}e.createElement=function(p){if(/[<>]/.test(p)){return UE.htmlparser(p).children[0]}else{return new e({type:"element",children:[],tagName:p})}};e.createText=function(q,p){return new UE.uNode({type:"text",data:p?q:utils.unhtml(q||"")})};function m(t,p,s,u){switch(t.type){case"root":for(var r=0,q;q=t.children[r++];){if(s&&q.type=="element"&&!dtd.$inlineWithA[q.tagName]&&r>1){c(p,u,true);o(p,u)}m(q,p,s,u)}break;case"text":f(t,p);break;case"element":h(t,p,s,u);break;case"comment":n(t,p,s)}return p}function f(q,p){if(q.parentNode.tagName=="pre"){p.push(q.data)}else{p.push(k[q.parentNode.tagName]?utils.html(q.data):q.data.replace(/[ ]{2}/g," &nbsp;"))}}function h(p,r,v,s){var t="";if(p.attrs){t=[];var w=p.attrs;for(var u in w){t.push(u+(w[u]!==undefined?'="'+(g[u]?utils.html(w[u]).replace(/["]/g,function(y){return"&quot;"}):utils.unhtml(w[u]))+'"':""))}t=t.join(" ")}r.push("<"+p.tagName+(t?" "+t:"")+(dtd.$empty[p.tagName]?"/":"")+">");if(v&&!dtd.$inlineWithA[p.tagName]&&p.tagName!="pre"){if(p.children&&p.children.length){s=c(r,s,true);o(r,s)}}if(p.children&&p.children.length){for(var q=0,x;x=p.children[q++];){if(v&&x.type=="element"&&!dtd.$inlineWithA[x.tagName]&&q>1){c(r,s);o(r,s)}m(x,r,v,s)}}if(!dtd.$empty[p.tagName]){if(v&&!dtd.$inlineWithA[p.tagName]&&p.tagName!="pre"){if(p.children&&p.children.length){s=c(r,s);o(r,s)}}r.push("</"+p.tagName+">")}}function n(q,p){p.push("<!--"+q.data+"-->")}function d(p,t){var s;if(p.type=="element"&&p.getAttr("id")==t){return p}if(p.children&&p.children.length){for(var r=0,q;q=p.children[r++];){if(s=d(q,t)){return s}}}}function b(t,s,p){if(t.type=="element"&&t.tagName==s){p.push(t)}if(t.children&&t.children.length){for(var r=0,q;q=t.children[r++];){b(q,s,p)}}}function a(p,s){if(p.children&&p.children.length){for(var r=0,q;q=p.children[r];){a(q,s);if(q.parentNode){if(q.children&&q.children.length){s(q)}if(q.parentNode){r++}}}}else{s(p)}}e.prototype={toHtml:function(q){var p=[];m(this,p,q,0);return p.join("")},innerHTML:function(q){if(this.type!="element"||dtd.$empty[this.tagName]){return this}if(utils.isString(q)){if(this.children){for(var s=0,r;r=this.children[s++];){r.parentNode=null}}this.children=[];var p=UE.htmlparser(q);for(var s=0,r;r=p.children[s++];){this.children.push(r);r.parentNode=this}return this}else{var p=new UE.uNode({type:"root",children:this.children});return p.toHtml()}},innerText:function(p,q){if(this.type!="element"||dtd.$empty[this.tagName]){return this}if(p){if(this.children){for(var s=0,r;r=this.children[s++];){r.parentNode=null}}this.children=[];this.appendChild(e.createText(p,q));return this}else{return this.toHtml().replace(/<[^>]+>/g,"")}},getData:function(){if(this.type=="element"){return""}return this.data},firstChild:function(){return this.children?this.children[0]:null},lastChild:function(){return this.children?this.children[this.children.length-1]:null},previousSibling:function(){var r=this.parentNode;for(var q=0,p;p=r.children[q];q++){if(p===this){return q==0?null:r.children[q-1]}}},nextSibling:function(){var r=this.parentNode;for(var q=0,p;p=r.children[q++];){if(p===this){return r.children[q]}}},replaceChild:function(s,r){if(this.children){if(s.parentNode){s.parentNode.removeChild(s)}for(var q=0,p;p=this.children[q];q++){if(p===r){this.children.splice(q,1,s);r.parentNode=null;s.parentNode=this;return s}}}},appendChild:function(r){if(this.type=="root"||(this.type=="element"&&!dtd.$empty[this.tagName])){if(!this.children){this.children=[]}if(r.parentNode){r.parentNode.removeChild(r)}for(var q=0,p;p=this.children[q];q++){if(p===r){this.children.splice(q,1);break}}this.children.push(r);r.parentNode=this;return r}},insertBefore:function(s,r){if(this.children){if(s.parentNode){s.parentNode.removeChild(s)}for(var q=0,p;p=this.children[q];q++){if(p===r){this.children.splice(q,0,s);s.parentNode=this;return s}}}},insertAfter:function(s,r){if(this.children){if(s.parentNode){s.parentNode.removeChild(s)}for(var q=0,p;p=this.children[q];q++){if(p===r){this.children.splice(q+1,0,s);s.parentNode=this;return s}}}},removeChild:function(t,u){if(this.children){for(var s=0,r;r=this.children[s];s++){if(r===t){this.children.splice(s,1);r.parentNode=null;if(u&&r.children&&r.children.length){for(var q=0,p;p=r.children[q];q++){this.children.splice(s+q,0,p);p.parentNode=this}}return r}}}},getAttr:function(p){return this.attrs&&this.attrs[p.toLowerCase()]},setAttr:function(r,q){if(!r){delete this.attrs;return}if(!this.attrs){this.attrs={}}if(utils.isObject(r)){for(var p in r){if(!r[p]){delete this.attrs[p]}else{this.attrs[p.toLowerCase()]=r[p]}}}else{if(!q){delete this.attrs[r]}else{this.attrs[r.toLowerCase()]=q}}},getIndex:function(){var r=this.parentNode;for(var q=0,p;p=r.children[q];q++){if(p===this){return q}}return -1},getNodeById:function(s){var r;if(this.children&&this.children.length){for(var q=0,p;p=this.children[q++];){if(r=d(p,s)){return r}}}},getNodesByTagName:function(q){q=utils.trim(q).replace(/[ ]{2,}/g," ").split(" ");var p=[],r=this;utils.each(q,function(u){if(r.children&&r.children.length){for(var t=0,s;s=r.children[t++];){b(s,u,p)}}});return p},getStyle:function(q){var s=this.getAttr("style");if(!s){return""}var r=new RegExp("(^|;)\\s*"+q+":([^;]+)","i");var p=s.match(r);if(p&&p[0]){return p[2]}return""},setStyle:function(r,s){function q(u,w){var v=new RegExp("(^|;)\\s*"+u+":([^;]+;?)","gi");t=t.replace(v,"$1");if(w){t=u+":"+utils.unhtml(w)+";"+t}}var t=this.getAttr("style");if(!t){t=""}if(utils.isObject(r)){for(var p in r){q(p,r[p])}}else{q(r,s)}this.setAttr("style",utils.trim(t))},traversal:function(p){if(this.children&&this.children.length){a(this,p)}return this}}})();var htmlparser=UE.htmlparser=function(c,r){var l=/<(?:(?:\/([^>]+)>)|(?:!--([\S|\s]*?)-->)|(?:([^\s\/<>]+)\s*((?:(?:"[^"]*")|(?:'[^']*')|[^"'<>])*)\/?>))/g,q=/([\w\-:.]+)(?:(?:\s*=\s*(?:(?:"([^"]*)")|(?:'([^']*)')|([^\s>]+)))|(?=\s|$))/g;var k={b:1,code:1,i:1,u:1,strike:1,s:1,tt:1,strong:1,q:1,samp:1,em:1,span:1,sub:1,img:1,sup:1,font:1,big:1,small:1,iframe:1,a:1,br:1,pre:1};c=c.replace(new RegExp(domUtils.fillChar,"g"),"");if(!r){c=c.replace(new RegExp("[\\r\\t\\n"+(r?"":" ")+"]*</?(\\w+)\\s*(?:[^>]*)>[\\r\\t\\n"+(r?"":" ")+"]*","g"),function(v,e){if(e&&k[e.toLowerCase()]){return v.replace(/(^[\n\r]+)|([\n\r]+$)/g,"")}return v.replace(new RegExp("^[\\r\\n"+(r?"":" ")+"]+"),"").replace(new RegExp("[\\r\\n"+(r?"":" ")+"]+$"),"")})}var t={href:1,src:1};var d=UE.uNode,n={td:"tr",tr:["tbody","thead","tfoot"],tbody:"table",th:"tr",thead:"table",tfoot:"table",caption:"table",li:["ul","ol"],dt:"dl",dd:"dl",option:"select"},o={ol:"li",ul:"li"};function m(v,w){if(o[v.tagName]){var e=d.createElement(o[v.tagName]);v.appendChild(e);e.appendChild(d.createText(w));v=e}else{v.appendChild(d.createText(w))}}function f(z,v,A){var e;if(e=n[v]){var w=z,C;while(w.type!="root"){if(utils.isArray(e)?utils.indexOf(e,w.tagName)!=-1:e==w.tagName){z=w;C=true;break}w=w.parentNode}if(!C){z=f(z,utils.isArray(e)?e[0]:e)}}var y=new d({parentNode:z,type:"element",tagName:v.toLowerCase(),children:dtd.$empty[v]?null:[]});if(A){var B={},x;while(x=q.exec(A)){B[x[1].toLowerCase()]=t[x[1].toLowerCase()]?(x[2]||x[3]||x[4]):utils.unhtml(x[2]||x[3]||x[4])}y.attrs=B}z.children.push(y);return dtd.$empty[v]?z:y}function b(e,v){e.children.push(new d({type:"comment",data:v,parentNode:e}))}var h,a=0,j=0;var p=new d({type:"root",children:[]});var u=p;while(h=l.exec(c)){a=h.index;try{if(a>j){m(u,c.slice(j,a))}if(h[3]){if(dtd.$cdata[u.tagName]){m(u,h[0])}else{u=f(u,h[3].toLowerCase(),h[4])}}else{if(h[1]){if(u.type!="root"){if(dtd.$cdata[u.tagName]&&!dtd.$cdata[h[1]]){m(u,h[0])}else{var g=u;while(u.type=="element"&&u.tagName!=h[1].toLowerCase()){u=u.parentNode;if(u.type=="root"){u=g;throw"break"}}u=u.parentNode}}}else{if(h[2]){b(u,h[2])}}}}catch(s){}j=l.lastIndex}if(j<c.length){m(u,c.slice(j))}return p};var filterNode=UE.filterNode=function(){function a(e,m){switch(e.type){case"text":break;case"element":var c;if(c=m[e.tagName]){if(c==="-"){e.parentNode.removeChild(e)}else{if(utils.isFunction(c)){var h=e.parentNode,j=e.getIndex();c(e);if(e.parentNode){if(e.children){for(var f=0,n;n=e.children[f];){a(n,m);if(n.parentNode){f++}}}}else{for(var f=j,n;n=h.children[f];){a(n,m);if(n.parentNode){f++}}}}else{var l=c["$"];if(l&&e.attrs){var d={},b;for(var k in l){b=e.getAttr(k);if(k=="style"&&utils.isArray(l[k])){var g=[];utils.each(l[k],function(o){var p;if(p=e.getStyle(o)){g.push(o+":"+p)}});b=g.join(";")}if(b){d[k]=b}}e.attrs=d}if(e.children){for(var f=0,n;n=e.children[f];){a(n,m);if(n.parentNode){f++}}}}}}else{if(dtd.$cdata[e.tagName]){e.parentNode.removeChild(e)}else{var h=e.parentNode,j=e.getIndex();e.parentNode.removeChild(e,true);for(var f=j,n;n=h.children[f];){a(n,m);if(n.parentNode){f++}}}}break;case"comment":e.parentNode.removeChild(e)}}return function(b,f){if(utils.isEmptyObject(f)){return b}var e;if(e=f["-"]){utils.each(e.split(" "),function(g){f[g]="-"})}for(var d=0,c;c=b.children[d];){a(c,f);if(c.parentNode){d++}}return b}}();UE.plugin=function(){var a={};return{register:function(e,c,d,b){if(d&&utils.isFunction(d)){b=d;d=null}a[e]={optionName:d||e,execFn:c,afterDisabled:b}},load:function(b){utils.each(a,function(d){var c=d.execFn.call(b);if(b.options[d.optionName]!==false){if(c){utils.each(c,function(f,e){switch(e.toLowerCase()){case"shortcutkey":b.addshortcutkey(f);break;case"bindevents":utils.each(f,function(h,g){b.addListener(g,h)});break;case"bindmultievents":utils.each(utils.isArray(f)?f:[f],function(h){var g=utils.trim(h.type).split(/\s+/);utils.each(g,function(j){b.addListener(j,h.handler)})});break;case"commands":utils.each(f,function(h,g){b.commands[g]=h});break;case"outputrule":b.addOutputRule(f);break;case"inputrule":b.addInputRule(f);break;case"defaultoptions":b.setOpt(f)}})}}else{if(d.afterDisabled){d.afterDisabled.call(b)}}});utils.each(UE.plugins,function(c){c.call(b)})},run:function(d,b){var c=a[d];if(c){c.exeFn.call(b)}}}}();var keymap=UE.keymap={Backspace:8,Tab:9,Enter:13,Shift:16,Control:17,Alt:18,CapsLock:20,Esc:27,Spacebar:32,PageUp:33,PageDown:34,End:35,Home:36,Left:37,Up:38,Right:39,Down:40,Insert:45,Del:46,NumLock:144,Cmd:91,"=":187,"-":189,b:66,i:73,z:90,y:89,v:86,x:88,s:83,n:78};var LocalStorage=UE.LocalStorage=(function(){var c=window.localStorage||a()||null,b="localStorage";return{saveLocalData:function(d,e){if(c&&e){c.setItem(d,e);return true}return false},getLocalData:function(d){if(c){return c.getItem(d)}return null},removeItem:function(d){c&&c.removeItem(d)}};function a(){var d=document.createElement("div");d.style.display="none";if(!d.addBehavior){return null}d.addBehavior("#default#userdata");return{getItem:function(g){var f=null;try{document.body.appendChild(d);d.load(b);f=d.getAttribute(g);document.body.removeChild(d)}catch(h){}return f},setItem:function(e,f){document.body.appendChild(d);d.setAttribute(e,f);d.save(b);document.body.removeChild(d)},removeItem:function(e){document.body.appendChild(d);d.removeAttribute(e);d.save(b);document.body.removeChild(d)}}}})();(function(){var a="ueditor_preference";UE.Editor.prototype.setPreferences=function(b,d){var e={};if(utils.isString(b)){e[b]=d}else{e=b}var c=LocalStorage.getLocalData(a);if(c&&(c=utils.str2json(c))){utils.extend(c,e)}else{c=e}c&&LocalStorage.saveLocalData(a,utils.json2str(c))};UE.Editor.prototype.getPreferences=function(b){var c=LocalStorage.getLocalData(a);if(c&&(c=utils.str2json(c))){return b?c[b]:c}return null};UE.Editor.prototype.removePreferences=function(b){var c=LocalStorage.getLocalData(a);if(c&&(c=utils.str2json(c))){c[b]=undefined;delete c[b]}c&&LocalStorage.saveLocalData(a,utils.json2str(c))}})();UE.plugins.defaultfilter=function(){var a=this;a.setOpt({allowDivTransToP:true,disabledTableInTable:true});a.addInputRule(function(c){var d=this.options.allowDivTransToP;var e;function b(f){while(f&&f.type=="element"){if(f.tagName=="td"){return true}f=f.parentNode}return false}c.traversal(function(h){if(h.type=="element"){if(!dtd.$cdata[h.tagName]&&a.options.autoClearEmptyNode&&dtd.$inline[h.tagName]&&!dtd.$empty[h.tagName]&&(!h.attrs||utils.isEmptyObject(h.attrs))){if(!h.firstChild()){h.parentNode.removeChild(h)}else{if(h.tagName=="span"&&(!h.attrs||utils.isEmptyObject(h.attrs))){h.parentNode.removeChild(h,true)}}return}switch(h.tagName){case"style":case"script":h.setAttr({cdata_tag:h.tagName,cdata_data:(h.innerHTML()||""),_ue_custom_node_:"true"});h.tagName="div";h.innerHTML("");break;case"a":if(e=h.getAttr("href")){h.setAttr("_href",e)}break;case"img":if(e=h.getAttr("src")){if(/^data:/.test(e)){h.parentNode.removeChild(h);break}}h.setAttr("_src",h.getAttr("src"));break;case"span":if(browser.webkit&&(e=h.getStyle("white-space"))){if(/nowrap|normal/.test(e)){h.setStyle("white-space","");if(a.options.autoClearEmptyNode&&utils.isEmptyObject(h.attrs)){h.parentNode.removeChild(h,true)}}}e=h.getAttr("id");if(e&&/^_baidu_bookmark_/i.test(e)){h.parentNode.removeChild(h)}break;case"p":if(e=h.getAttr("align")){h.setAttr("align");h.setStyle("text-align",e)}utils.each(h.children,function(p){if(p.type=="element"&&p.tagName=="p"){var m=p.nextSibling();h.parentNode.insertAfter(p,h);var o=p;while(m){var l=m.nextSibling();h.parentNode.insertAfter(m,o);o=m;m=l}return false}});if(!h.firstChild()){h.innerHTML(browser.ie?"&nbsp;":"<br/>")}break;case"div":if(h.getAttr("cdata_tag")){break}e=h.getAttr("class");if(e&&/^line number\d+/.test(e)){break}if(!d){break}var g,k=UE.uNode.createElement("p");while(g=h.firstChild()){if(g.type=="text"||!UE.dom.dtd.$block[g.tagName]){k.appendChild(g)}else{if(k.firstChild()){h.parentNode.insertBefore(k,h);k=UE.uNode.createElement("p")}else{h.parentNode.insertBefore(g,h)}}}if(k.firstChild()){h.parentNode.insertBefore(k,h)}h.parentNode.removeChild(h);break;case"dl":h.tagName="ul";break;case"dt":case"dd":h.tagName="li";break;case"li":var f=h.getAttr("class");if(!f||!/list\-/.test(f)){h.setAttr()}var j=h.getNodesByTagName("ol ul");UE.utils.each(j,function(l){h.parentNode.insertAfter(l,h)});break;case"td":case"th":case"caption":if(!h.children||!h.children.length){h.appendChild(browser.ie11below?UE.uNode.createText(" "):UE.uNode.createElement("br"))}break;case"table":if(a.options.disabledTableInTable&&b(h)){h.parentNode.insertBefore(UE.uNode.createText(h.innerText()),h);h.parentNode.removeChild(h)}}}})});a.addOutputRule(function(b){var c;b.traversal(function(d){if(d.type=="element"){if(a.options.autoClearEmptyNode&&dtd.$inline[d.tagName]&&!dtd.$empty[d.tagName]&&(!d.attrs||utils.isEmptyObject(d.attrs))){if(!d.firstChild()){d.parentNode.removeChild(d)}else{if(d.tagName=="span"&&(!d.attrs||utils.isEmptyObject(d.attrs))){d.parentNode.removeChild(d,true)}}return}switch(d.tagName){case"div":if(c=d.getAttr("cdata_tag")){d.tagName=c;d.appendChild(UE.uNode.createText(d.getAttr("cdata_data")));d.setAttr({cdata_tag:"",cdata_data:"",_ue_custom_node_:""})}break;case"a":if(c=d.getAttr("_href")){d.setAttr({href:utils.html(c),_href:""})}break;break;case"span":c=d.getAttr("id");if(c&&/^_baidu_bookmark_/i.test(c)){d.parentNode.removeChild(d)}break;case"img":if(c=d.getAttr("_src")){d.setAttr({src:d.getAttr("_src"),_src:""})}}}})})};UE.commands.inserthtml={execCommand:function(c,k,s){var x=this,m,n;if(!k){return}if(k.indexOf("://")!==-1){const b=/https?:\/\/(?:[a-zA-Z0-9.-]+|\d{1,3}(?:\.\d{1,3}){3})(?::\d+)?\//g;k=k.replaceAll(b,"/")}if(x.fireEvent("beforeinserthtml",k)===true){return}m=x.selection.getRange();n=m.document.createElement("div");n.style.display="inline";if(!s){var t=UE.htmlparser(k);if(x.options.filterRules){UE.filterNode(t,x.options.filterRules)}x.filterInputRule(t);k=t.toHtml()}n.innerHTML=utils.trim(k);if(!m.collapsed){var w=m.startContainer;if(domUtils.isFillChar(w)){m.setStartBefore(w)}w=m.endContainer;if(domUtils.isFillChar(w)){m.setEndAfter(w)}m.txtToElmBoundary();if(m.endContainer&&m.endContainer.nodeType==1){w=m.endContainer.childNodes[m.endOffset];if(w&&domUtils.isBr(w)){m.setEndAfter(w)}}if(m.startOffset==0){w=m.startContainer;if(domUtils.isBoundaryNode(w,"firstChild")){w=m.endContainer;if(m.endOffset==(w.nodeType==3?w.nodeValue.length:w.childNodes.length)&&domUtils.isBoundaryNode(w,"lastChild")){x.body.innerHTML="<p>"+(browser.ie?"":"<br/>")+"</p>";m.setStart(x.body.firstChild,0).collapse(true)}}}!m.collapsed&&m.deleteContents();if(m.startContainer.nodeType==1){var f=m.startContainer.childNodes[m.startOffset],q;if(f&&domUtils.isBlockElm(f)&&(q=f.previousSibling)&&domUtils.isBlockElm(q)){m.setEnd(q,q.childNodes.length).collapse();while(f.firstChild){q.appendChild(f.firstChild)}domUtils.remove(f)}}}var f,j,q,v,d=0,a;if(m.inFillChar()){f=m.startContainer;if(domUtils.isFillChar(f)){m.setStartBefore(f).collapse(true);domUtils.remove(f)}else{if(domUtils.isFillChar(f,true)){f.nodeValue=f.nodeValue.replace(fillCharReg,"");m.startOffset--;m.collapsed&&m.collapse(true)}}}var l=domUtils.findParentByTagName(m.startContainer,"li",true);if(l){var r,h;while(f=n.firstChild){while(f&&(f.nodeType==3||!domUtils.isBlockElm(f)||f.tagName=="HR")){r=f.nextSibling;m.insertNode(f).collapse();h=f;f=r}if(f){if(/^(ol|ul)$/i.test(f.tagName)){while(f.firstChild){h=f.firstChild;domUtils.insertAfter(l,f.firstChild);l=l.nextSibling}domUtils.remove(f)}else{var g;r=f.nextSibling;g=x.document.createElement("li");domUtils.insertAfter(l,g);g.appendChild(f);h=f;f=r;l=g}}}l=domUtils.findParentByTagName(m.startContainer,"li",true);if(domUtils.isEmptyBlock(l)){domUtils.remove(l)}if(h){m.setStartAfter(h).collapse(true).select(true)}}else{while(f=n.firstChild){if(d){var o=x.document.createElement("p");while(f&&(f.nodeType==3||!dtd.$block[f.tagName])){a=f.nextSibling;o.appendChild(f);f=a}if(o.firstChild){f=o}}m.insertNode(f);a=f.nextSibling;if(!d&&f.nodeType==domUtils.NODE_ELEMENT&&domUtils.isBlockElm(f)){j=domUtils.findParent(f,function(e){return domUtils.isBlockElm(e)});if(j&&j.tagName.toLowerCase()!="body"&&!(dtd[j.tagName][f.nodeName]&&f.parentNode===j)){if(!dtd[j.tagName][f.nodeName]){q=j}else{v=f.parentNode;while(v!==j){q=v;v=v.parentNode}}domUtils.breakParent(f,q||v);var q=f.previousSibling;domUtils.trimWhiteTextNode(q);if(!q.childNodes.length){domUtils.remove(q)}if(!browser.ie&&(r=f.nextSibling)&&domUtils.isBlockElm(r)&&r.lastChild&&!domUtils.isBr(r.lastChild)){r.appendChild(x.document.createElement("br"))}d=1}}var r=f.nextSibling;if(!n.firstChild&&r&&domUtils.isBlockElm(r)){m.setStart(r,0).collapse(true);break}m.setEndAfter(f).collapse()}f=m.startContainer;if(a&&domUtils.isBr(a)){domUtils.remove(a)}if(domUtils.isBlockElm(f)&&domUtils.isEmptyNode(f)){if(a=f.nextSibling){domUtils.remove(f);if(a.nodeType==1&&dtd.$block[a.tagName]){m.setStart(a,0).collapse(true).shrinkBoundary()}}else{try{f.innerHTML=browser.ie?domUtils.fillChar:"<br/>"}catch(u){m.setStartBefore(f);domUtils.remove(f)}}}try{m.select(true)}catch(u){}}setTimeout(function(){m=x.selection.getRange();m.scrollToView(x.autoHeightEnabled,x.autoHeightEnabled?domUtils.getXY(x.iframe).y:0);x.fireEvent("afterinserthtml",k)},200)}};UE.plugins.autotypeset=function(){this.setOpt({autotypeset:{mergeEmptyline:true,removeClass:true,removeEmptyline:false,textAlign:"left",imageBlockLine:"center",pasteFilter:false,clearFontSize:false,clearFontFamily:false,removeEmptyNode:false,removeTagNames:utils.extend({div:1},dtd.$removeEmpty),indent:false,indentValue:"2em",bdc2sb:false,tobdc:false}});var k=this,a=k.options.autotypeset,b={selectTdClass:1,pagebreak:1,anchorclass:1},c={li:1},m={div:1,p:1,blockquote:1,center:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,span:1},f;if(!a){return}l();function d(o,n){if(!o||o.nodeType==3){return 0}if(domUtils.isBr(o)){return 1}if(o&&o.parentNode&&m[o.tagName.toLowerCase()]){if(f&&f.contains(o)||o.getAttribute("pagebreak")){return 0}return n?!domUtils.isEmptyBlock(o):domUtils.isEmptyBlock(o,new RegExp("[\\s"+domUtils.fillChar+"]","g"))}}function g(n){if(!n.style.cssText){domUtils.removeAttributes(n,["style"]);if(n.tagName.toLowerCase()=="span"&&domUtils.hasNoAttributes(n)){domUtils.remove(n,true)}}}function j(y,u){var x=this,C;if(u){if(!a.pasteFilter){return}C=x.document.createElement("div");C.innerHTML=u.html}else{C=x.document.body}var n=domUtils.getElementsByTagName(C,"*");for(var r=0,B;B=n[r++];){if(x.fireEvent("excludeNodeinautotype",B)===true){continue}if(a.clearFontSize&&B.style.fontSize){domUtils.removeStyle(B,"font-size");g(B)}if(a.clearFontFamily&&B.style.fontFamily){domUtils.removeStyle(B,"font-family");g(B)}if(d(B)){if(a.mergeEmptyline){var t=B.nextSibling,o,w=domUtils.isBr(B);while(d(t)){o=t;t=o.nextSibling;if(w&&(!t||t&&!domUtils.isBr(t))){break}domUtils.remove(o)}}if(a.removeEmptyline&&domUtils.inDoc(B,C)&&!c[B.parentNode.tagName.toLowerCase()]){if(domUtils.isBr(B)){t=B.nextSibling;if(t&&!domUtils.isBr(t)){continue}}domUtils.remove(B);continue}}if(d(B,true)&&B.tagName!="SPAN"){if(a.indent){B.style.textIndent=a.indentValue}if(a.textAlign){B.style.textAlign=a.textAlign}}if(a.removeClass&&B.className&&!b[B.className.toLowerCase()]){if(f&&f.contains(B)){continue}domUtils.removeAttributes(B,["class"])}if(a.imageBlockLine&&B.tagName.toLowerCase()=="img"&&!B.getAttribute("emotion")){if(u){var q=B;switch(a.imageBlockLine){case"left":case"right":case"none":var v=q.parentNode,o,p,t;while(dtd.$inline[v.tagName]||v.tagName=="A"){v=v.parentNode}o=v;if(o.tagName=="P"&&domUtils.getStyle(o,"text-align")=="center"){if(!domUtils.isBody(o)&&domUtils.getChildCount(o,function(D){return !domUtils.isBr(D)&&!domUtils.isWhitespace(D)})==1){p=o.previousSibling;t=o.nextSibling;if(p&&t&&p.nodeType==1&&t.nodeType==1&&p.tagName==t.tagName&&domUtils.isBlockElm(p)){p.appendChild(o.firstChild);while(t.firstChild){p.appendChild(t.firstChild)}domUtils.remove(o);domUtils.remove(t)}else{domUtils.setStyle(o,"text-align","")}}}domUtils.setStyle(q,"float",a.imageBlockLine);break;case"center":if(x.queryCommandValue("imagefloat")!="center"){v=q.parentNode;domUtils.setStyle(q,"float","none");o=q;while(v&&domUtils.getChildCount(v,function(D){return !domUtils.isBr(D)&&!domUtils.isWhitespace(D)})==1&&(dtd.$inline[v.tagName]||v.tagName=="A")){o=v;v=v.parentNode}var A=x.document.createElement("p");domUtils.setAttributes(A,{style:"text-align:center"});o.parentNode.insertBefore(A,o);A.appendChild(o);domUtils.setStyle(o,"float","")}}}else{var s=x.selection.getRange();s.selectNode(B).select();x.execCommand("imagefloat",a.imageBlockLine)}}if(a.removeEmptyNode){if(a.removeTagNames[B.tagName.toLowerCase()]&&domUtils.hasNoAttributes(B)&&domUtils.isEmptyBlock(B)){domUtils.remove(B)}}}if(a.tobdc){var z=UE.htmlparser(C.innerHTML);z.traversal(function(D){if(D.type=="text"){D.data=h(D.data)}});C.innerHTML=z.toHtml()}if(a.bdc2sb){var z=UE.htmlparser(C.innerHTML);z.traversal(function(D){if(D.type=="text"){D.data=e(D.data)}});C.innerHTML=z.toHtml()}if(u){u.html=C.innerHTML}}if(a.pasteFilter){k.addListener("beforepaste",j)}function e(q){var n="";for(var o=0;o<q.length;o++){var p=q.charCodeAt(o);if(p>=65281&&p<=65373){n+=String.fromCharCode(q.charCodeAt(o)-65248)}else{if(p==12288){n+=String.fromCharCode(q.charCodeAt(o)-12288+32)}else{n+=q.charAt(o)}}}return n}function h(p){p=utils.html(p);var o="";var q="";for(var n=0;n<p.length;n++){if(p.charCodeAt(n)==32){o=o+String.fromCharCode(12288)}else{if(p.charCodeAt(n)<127){o=o+String.fromCharCode(p.charCodeAt(n)+65248)}else{o+=p.charAt(n)}}}return o}function l(){var n=k.getPreferences("autotypeset");utils.extend(k.options.autotypeset,n)}k.commands.autotypeset={execCommand:function(){k.removeListener("beforepaste",j);if(a.pasteFilter){k.addListener("beforepaste",j)}j.call(k)}}};UE.plugin.register("autosubmit",function(){return{shortcutkey:{autosubmit:"ctrl+13"},commands:{autosubmit:{execCommand:function(){var b=this,a=domUtils.findParentByTagName(b.iframe,"form",false);if(a){if(b.fireEvent("beforesubmit")===false){return}b.sync();a.submit()}}}}}});UE.plugin.register("background",function(){var c=this,g="editor_background",e,b=new RegExp("body[\\s]*\\{(.+)\\}","i");function f(k){var j={},h=k.split(";");utils.each(h,function(l){var m=l.indexOf(":"),n=utils.trim(l.substr(0,m)).toLowerCase();n&&(j[n]=utils.trim(l.substr(m+1)||""))});return j}function a(k){if(k){var j=[];for(var h in k){if(k.hasOwnProperty(h)){j.push(h+":"+k[h]+"; ")}}utils.cssRule(g,j.length?("body{"+j.join("")+"}"):"",c.document)}else{utils.cssRule(g,"",c.document)}}var d=c.hasContents;c.hasContents=function(){if(c.queryCommandValue("background")){return true}return d.apply(c,arguments)};return{bindEvents:{getAllHtml:function(o,n){var h=this.body,j=domUtils.getComputedStyle(h,"background-image"),l="";if(j.indexOf(c.options.imagePath)>0){l=j.substring(j.indexOf(c.options.imagePath),j.length-1).replace(/"|\(|\)/ig,"")}else{l=j!="none"?j.replace(/url\("?|"?\)/ig,""):""}var m='<style type="text/css">body{';var p={"background-color":domUtils.getComputedStyle(h,"background-color")||"#ffffff","background-image":l?"url("+l+")":"","background-repeat":domUtils.getComputedStyle(h,"background-repeat")||"","background-position":browser.ie?(domUtils.getComputedStyle(h,"background-position-x")+" "+domUtils.getComputedStyle(h,"background-position-y")):domUtils.getComputedStyle(h,"background-position"),height:domUtils.getComputedStyle(h,"height")};for(var k in p){if(p.hasOwnProperty(k)){m+=k+":"+p[k]+"; "}}m+="}</style> ";n.push(m)},aftersetcontent:function(){if(e==false){a()}}},inputRule:function(h){e=false;utils.each(h.getNodesByTagName("p"),function(k){var j=k.getAttr("data-background");if(j){e=true;a(f(j));k.parentNode.removeChild(k)}})},outputRule:function(h){var k=this,j=(utils.cssRule(g,k.document)||"").replace(/[\n\r]+/g,"").match(b);if(j){h.appendChild(UE.uNode.createElement('<p style="display:none;" data-background="'+utils.trim(j[1].replace(/"/g,"").replace(/[\s]+/g," "))+'"><br/></p>'))}},commands:{background:{execCommand:function(h,j){a(j)},queryCommandValue:function(){var j=this,h=(utils.cssRule(g,j.document)||"").replace(/[\n\r]+/g,"").match(b);return h?f(h[1]):null},notNeedUndo:true}}}});UE.commands.imagefloat={execCommand:function(a,g){var j=this,f=j.selection.getRange();if(!f.collapsed){var d=f.getClosedNode();if(d&&d.tagName=="IMG"){switch(g){case"left":case"right":case"none":var h=d.parentNode,b,c,e;while(dtd.$inline[h.tagName]||h.tagName=="A"){h=h.parentNode}b=h;if(b.tagName=="P"&&domUtils.getStyle(b,"text-align")=="center"){if(!domUtils.isBody(b)&&domUtils.getChildCount(b,function(k){return !domUtils.isBr(k)&&!domUtils.isWhitespace(k)})==1){c=b.previousSibling;e=b.nextSibling;if(c&&e&&c.nodeType==1&&e.nodeType==1&&c.tagName==e.tagName&&domUtils.isBlockElm(c)){c.appendChild(b.firstChild);while(e.firstChild){c.appendChild(e.firstChild)}domUtils.remove(b);domUtils.remove(e)}else{domUtils.setStyle(b,"text-align","")}}f.selectNode(d).select()}domUtils.setStyle(d,"float",g=="none"?"":g);if(g=="none"){domUtils.removeAttributes(d,"align")}break;case"center":if(j.queryCommandValue("imagefloat")!="center"){h=d.parentNode;domUtils.setStyle(d,"float","");domUtils.removeAttributes(d,"align");b=d;while(h&&domUtils.getChildCount(h,function(k){return !domUtils.isBr(k)&&!domUtils.isWhitespace(k)})==1&&(dtd.$inline[h.tagName]||h.tagName=="A")){b=h;h=h.parentNode}f.setStartBefore(b).setCursor(false);h=j.document.createElement("div");h.appendChild(b);domUtils.setStyle(b,"float","");j.execCommand("insertHtml",'<p id="_img_parent_tmp" style="text-align:center">'+h.innerHTML+"</p>");b=j.document.getElementById("_img_parent_tmp");b.removeAttribute("id");b=b.firstChild;f.selectNode(b).select();e=b.parentNode.nextSibling;if(e&&domUtils.isEmptyNode(e)){domUtils.remove(e)}}break}}}},queryCommandValue:function(){var a=this.selection.getRange(),b,c;if(a.collapsed){return"none"}b=a.getClosedNode();if(b&&b.nodeType==1&&b.tagName=="IMG"){c=domUtils.getComputedStyle(b,"float")||b.getAttribute("align");if(c=="none"){c=domUtils.getComputedStyle(b.parentNode,"text-align")=="center"?"center":c}return{left:1,right:1,center:1}[c]?c:"none"}return"none"},queryCommandState:function(){var a=this.selection.getRange(),b;if(a.collapsed){return -1}b=a.getClosedNode();if(b&&b.nodeType==1&&b.tagName=="IMG"){return 0}return -1}};UE.commands.insertimage={execCommand:function(b,a){a=utils.isArray(a)?a:[a];if(!a.length){return}var j=this,g=j.selection.getRange(),d=g.getClosedNode();if(j.fireEvent("beforeinsertimage",a)===true){return}function k(n){utils.each("width,height,border,hspace,vspace".split(","),function(o){if(n[o]){n[o]=parseInt(n[o],10)||0}});utils.each("src,_src".split(","),function(o){if(n[o]){n[o]=utils.unhtmlForUrl(n[o])}});utils.each("title,alt".split(","),function(o){if(n[o]){n[o]=utils.unhtml(n[o])}})}if(d&&/img/i.test(d.tagName)&&(d.className!="edui-faked-video"||d.className.indexOf("edui-upload-video")!=-1)&&!d.getAttribute("word_img")){var f=a.shift();var l=f.floatStyle;delete f.floatStyle;domUtils.setAttributes(d,f);j.execCommand("imagefloat",l);if(a.length>0){g.setStartAfter(d).setCursor(false,true);j.execCommand("insertimage",a)}}else{var e=[],h="",m;m=a[0];if(a.length==1){k(m);h='<img src="'+m.src+'" '+(m._src?' _src="'+m._src+'" ':"")+(m.width?'width="'+m.width+'" ':"")+(m.height?' height="'+m.height+'" ':"")+(m.floatStyle=="left"||m.floatStyle=="right"?' style="float:'+m.floatStyle+';"':"")+(m.title&&m.title!=""?' title="'+m.title+'"':"")+(m.border&&m.border!="0"?' border="'+m.border+'"':"")+(m.alt&&m.alt!=""?' alt="'+m.alt+'"':"")+(m.hspace&&m.hspace!="0"?' hspace = "'+m.hspace+'"':"")+(m.vspace&&m.vspace!="0"?' vspace = "'+m.vspace+'"':"")+"/>";if(m.floatStyle=="center"){h='<p style="text-align: center">'+h+"</p>"}e.push(h)}else{for(var c=0;m=a[c++];){k(m);h="<p "+(m.floatStyle=="center"?'style="text-align: center" ':"")+'><img src="'+m.src+'" '+(m.width?'width="'+m.width+'" ':"")+(m._src?' _src="'+m._src+'" ':"")+(m.height?' height="'+m.height+'" ':"")+' style="'+(m.floatStyle&&m.floatStyle!="center"?"float:"+m.floatStyle+";":"")+(m.border||"")+'" '+(m.title?' title="'+m.title+'"':"")+" /></p>";e.push(h)}}j.execCommand("insertHtml",e.join(""))}j.fireEvent("afterinsertimage",a)}};UE.plugins.justify=function(){var c=this,d=domUtils.isBlockElm,b={left:1,right:1,center:1,justify:1},a=function(h,e){var l=h.createBookmark(),o=function(p){return p.nodeType==1?p.tagName.toLowerCase()!="br"&&!domUtils.isBookmarkNode(p):!domUtils.isWhitespace(p)};h.enlarge(true);var q=h.createBookmark(),k=domUtils.getNextDomNode(q.start,false,o),m=h.cloneRange(),g;while(k&&!(domUtils.getPosition(k,q.end)&domUtils.POSITION_FOLLOWING)){if(k.nodeType==3||!d(k)){m.setStartBefore(k);while(k&&k!==q.end&&!d(k)){g=k;k=domUtils.getNextDomNode(k,false,null,function(p){return !d(p)})}m.setEndAfter(g);var j=m.getCommonAncestor();if(!domUtils.isBody(j)&&d(j)){domUtils.setStyles(j,utils.isString(e)?{"text-align":e}:e);k=j}else{var f=h.document.createElement("p");domUtils.setStyles(f,utils.isString(e)?{"text-align":e}:e);var n=m.extractContents();f.appendChild(n);m.insertNode(f);k=f}k=domUtils.getNextDomNode(k,false,o)}else{k=domUtils.getNextDomNode(k,true,o)}}return h.moveToBookmark(q).moveToBookmark(l)};UE.commands.justify={execCommand:function(g,h){var f=this.selection.getRange(),e;if(f.collapsed){e=this.document.createTextNode("p");f.insertNode(e)}a(f,h);if(e){f.setStartBefore(e).collapse(true);domUtils.remove(e)}f.select();return true},queryCommandValue:function(){var e=this.selection.getStart(),f=domUtils.getComputedStyle(e,"text-align");return b[f]?f:"left"},queryCommandState:function(){var f=this.selection.getStart(),e=f&&domUtils.findParentByTagName(f,["td","th","caption"],true);return e?-1:0}}};UE.plugins.font=function(){var d=this,h={forecolor:"color",backcolor:"background-color",fontsize:"font-size",fontfamily:"font-family",underline:"text-decoration",strikethrough:"text-decoration",fontborder:"border"},b={underline:1,strikethrough:1,fontborder:1},a={forecolor:"color",backcolor:"background-color",fontsize:"font-size",fontfamily:"font-family"};d.setOpt({fontfamily:[{name:"songti",val:",SimSun"},{name:"yahei",val:",Microsoft YaHei"},{name:"kaiti",val:",_GB2312, SimKai"},{name:"heiti",val:", SimHei"},{name:"lishu",val:", SimLi"},{name:"andaleMono",val:"andale mono"},{name:"arial",val:"arial, helvetica,sans-serif"},{name:"arialBlack",val:"arial black,avant garde"},{name:"comicSansMs",val:"comic sans ms"},{name:"impact",val:"impact,chicago"},{name:"timesNewRoman",val:"times new roman"}],fontsize:[10,11,12,14,16,18,20,24,36]});function g(k){var j;while(j=k.parentNode){if(j.tagName=="SPAN"&&domUtils.getChildCount(j,function(l){return !domUtils.isBookmarkNode(l)&&!domUtils.isBr(l)})==1){j.style.cssText+=k.style.cssText;domUtils.remove(k,true);k=j}else{break}}}function f(k,l,m){if(a[l]){k.adjustmentBoundary();if(!k.collapsed&&k.startContainer.nodeType==1){var n=k.startContainer.childNodes[k.startOffset];if(n&&domUtils.isTagNode(n,"span")){var j=k.createBookmark();utils.each(domUtils.getElementsByTagName(n,"span"),function(o){if(!o.parentNode||domUtils.isBookmarkNode(o)){return}if(l=="backcolor"&&domUtils.getComputedStyle(o,"background-color").toLowerCase()===m){return}domUtils.removeStyle(o,a[l]);if(o.style.cssText.replace(/^\s+$/,"").length==0){domUtils.remove(o,true)}});k.moveToBookmark(j)}}}}function c(k,l,n){var o=k.collapsed,j=k.createBookmark(),m;if(o){m=j.start.parentNode;while(dtd.$inline[m.tagName]){m=m.parentNode}}else{m=domUtils.getCommonAncestor(j.start,j.end)}utils.each(domUtils.getElementsByTagName(m,"span"),function(r){if(!r.parentNode||domUtils.isBookmarkNode(r)){return}if(/\s*border\s*:\s*none;?\s*/i.test(r.style.cssText)){if(/^\s*border\s*:\s*none;?\s*$/.test(r.style.cssText)){domUtils.remove(r,true)}else{domUtils.removeStyle(r,"border")}return}if(/border/i.test(r.style.cssText)&&r.parentNode.tagName=="SPAN"&&/border/i.test(r.parentNode.style.cssText)){r.style.cssText=r.style.cssText.replace(/border[^:]*:[^;]+;?/gi,"")}if(!(l=="fontborder"&&n=="none")){var q=r.nextSibling;while(q&&q.nodeType==1&&q.tagName=="SPAN"){if(domUtils.isBookmarkNode(q)&&l=="fontborder"){r.appendChild(q);q=r.nextSibling;continue}if(q.style.cssText==r.style.cssText){domUtils.moveChild(q,r);domUtils.remove(q)}if(r.nextSibling===q){break}q=r.nextSibling}}g(r);if(browser.ie&&browser.version>8){var p=domUtils.findParent(r,function(s){return s.tagName=="SPAN"&&/background-color/.test(s.style.cssText)});if(p&&!/background-color/.test(r.style.cssText)){r.style.backgroundColor=p.style.backgroundColor}}});k.moveToBookmark(j);f(k,l,n)}d.addInputRule(function(j){utils.each(j.getNodesByTagName("u s del font strike"),function(k){if(k.tagName=="font"){var n=[];for(var l in k.attrs){switch(l){case"size":n.push("font-size:"+({"1":"10","2":"12","3":"16","4":"18","5":"24","6":"32","7":"48"}[k.attrs[l]]||k.attrs[l])+"px");break;case"color":n.push("color:"+k.attrs[l]);break;case"face":n.push("font-family:"+k.attrs[l]);break;case"style":n.push(k.attrs[l])}}k.attrs={style:n.join(";")}}else{var m=k.tagName=="u"?"underline":"line-through";k.attrs={style:(k.getAttr("style")||"")+"text-decoration:"+m+";"}}k.tagName="span"})});for(var e in h){(function(k,j){UE.commands[k]={execCommand:function(m,p){p=p||(this.queryCommandState(m)?"none":m=="underline"?"underline":m=="fontborder"?"1px solid #000":"line-through");var o=this,l=this.selection.getRange(),r;if(p=="default"){if(l.collapsed){r=o.document.createTextNode("font");l.insertNode(r).select()}o.execCommand("removeFormat","span,a",j);if(r){l.setStartBefore(r).collapse(true);domUtils.remove(r)}c(l,m,p);l.select()}else{if(!l.collapsed){if(b[k]&&o.queryCommandValue(k)){o.execCommand("removeFormat","span,a",j)}l=o.selection.getRange();l.applyInlineStyle("span",{style:j+":"+p});c(l,m,p);l.select()}else{var n=domUtils.findParentByTagName(l.startContainer,"span",true);r=o.document.createTextNode("font");if(n&&!n.children.length&&!n[browser.ie?"innerText":"textContent"].replace(fillCharReg,"").length){l.insertNode(r);if(b[k]){l.selectNode(r).select();o.execCommand("removeFormat","span,a",j,null);n=domUtils.findParentByTagName(r,"span",true);l.setStartBefore(r)}n&&(n.style.cssText+=";"+j+":"+p);l.collapse(true).select()}else{l.insertNode(r);l.selectNode(r).select();n=l.document.createElement("span");if(b[k]){if(domUtils.findParentByTagName(r,"a",true)){l.setStartBefore(r).setCursor();domUtils.remove(r);return}o.execCommand("removeFormat","span,a",j)}n.style.cssText=j+":"+p;r.parentNode.insertBefore(n,r);if(!browser.ie||browser.ie&&browser.version==9){var q=n.parentNode;while(!domUtils.isBlockElm(q)){if(q.tagName=="SPAN"){n.style.cssText=q.style.cssText+";"+n.style.cssText}q=q.parentNode}}if(opera){setTimeout(function(){l.setStart(n,0).collapse(true);c(l,m,p);l.select()})}else{l.setStart(n,0).collapse(true);c(l,m,p);l.select()}}domUtils.remove(r)}}return true},queryCommandValue:function(m){var l=this.selection.getStart();if(m=="underline"||m=="strikethrough"){var o=l,p;while(o&&!domUtils.isBlockElm(o)&&!domUtils.isBody(o)){if(o.nodeType==1){p=domUtils.getComputedStyle(o,j);if(p!="none"){return p}}o=o.parentNode}return"none"}if(m=="fontborder"){var n=l,r;while(n&&dtd.$inline[n.tagName]){if(r=domUtils.getComputedStyle(n,"border")){if(/1px/.test(r)&&/solid/.test(r)){return r}}n=n.parentNode}return""}if(m=="FontSize"){var q=domUtils.getComputedStyle(l,j),n=/^([\d\.]+)(\w+)$/.exec(q);if(n){return Math.floor(n[1])+n[2]}return q}return domUtils.getComputedStyle(l,j)},queryCommandState:function(l){if(!b[l]){return 0}var m=this.queryCommandValue(l);if(l=="fontborder"){return/1px/.test(m)&&/solid/.test(m)}else{return l=="underline"?/underline/.test(m):/line\-through/.test(m)}}}})(e,h[e])}};UE.plugins.link=function(){function a(d){var e=d.startContainer,c=d.endContainer;if(e=domUtils.findParentByTagName(e,"a",true)){d.setStartBefore(e)}if(c=domUtils.findParentByTagName(c,"a",true)){d.setEndAfter(c)}}UE.commands.unlink={execCommand:function(){var c=this.selection.getRange(),d;if(c.collapsed&&!domUtils.findParentByTagName(c.startContainer,"a",true)){return}d=c.createBookmark();a(c);c.removeInlineStyle("a").moveToBookmark(d).select()},queryCommandState:function(){return !this.highlight&&this.queryCommandValue("link")?0:-1}};function b(d,e,g){var h=d.cloneRange(),f=g.queryCommandValue("link");a(d=d.adjustmentBoundary());var k=d.startContainer;if(k.nodeType==1&&f){k=k.childNodes[d.startOffset];if(k&&k.nodeType==1&&k.tagName=="A"&&/^(?:https?|ftp|file)\s*:\s*\/\//.test(k[browser.ie?"innerText":"textContent"])){k[browser.ie?"innerText":"textContent"]=utils.html(e.textValue||e.href)}}if(!h.collapsed||f){d.removeInlineStyle("a");h=d.cloneRange()}if(h.collapsed){var c=d.document.createElement("a"),j="";if(e.textValue){j=utils.html(e.textValue);delete e.textValue}else{j=utils.html(e.href)}domUtils.setAttributes(c,e);k=domUtils.findParentByTagName(h.startContainer,"a",true);if(k&&domUtils.isInNodeEndBoundary(h,k)){d.setStartAfter(k).collapse(true)}c[browser.ie?"innerText":"textContent"]=j;d.insertNode(c).selectNode(c)}else{d.applyInlineStyle("a",e)}}UE.commands.link={execCommand:function(d,e){var c;e._href&&(e._href=utils.unhtml(e._href,/[<">]/g));e.href&&(e.href=utils.unhtml(e.href,/[<">]/g));e.textValue&&(e.textValue=utils.unhtml(e.textValue,/[<">]/g));b(c=this.selection.getRange(),e,this);c.collapse().select(true)},queryCommandValue:function(){var j=this.selection.getRange(),e;if(j.collapsed){e=j.startContainer;e=e.nodeType==1?e:e.parentNode;if(e&&(e=domUtils.findParentByTagName(e,"a",true))&&!domUtils.isInNodeEndBoundary(j,e)){return e}}else{j.shrinkBoundary();var d=j.startContainer.nodeType==3||!j.startContainer.childNodes[j.startOffset]?j.startContainer:j.startContainer.childNodes[j.startOffset],g=j.endContainer.nodeType==3||j.endOffset==0?j.endContainer:j.endContainer.childNodes[j.endOffset-1],k=j.getCommonAncestor();e=domUtils.findParentByTagName(k,"a",true);if(!e&&k.nodeType==1){var f=k.getElementsByTagName("a"),c,l;for(var h=0,m;m=f[h++];){c=domUtils.getPosition(m,d),l=domUtils.getPosition(m,g);if((c&domUtils.POSITION_FOLLOWING||c&domUtils.POSITION_CONTAINS)&&(l&domUtils.POSITION_PRECEDING||l&domUtils.POSITION_CONTAINS)){e=m;break}}}return e}},queryCommandState:function(){var d=this.selection.getRange().getClosedNode(),c=d&&(d.className=="edui-faked-video"||d.className.indexOf("edui-upload-video")!=-1);return c?-1:0}}};UE.plugins.insertframe=function(){var b=this;function a(){b._iframe&&delete b._iframe}b.addListener("selectionchange",function(){a()})};UE.commands.scrawl={queryCommandState:function(){return(browser.ie&&browser.version<=8)?-1:0}};UE.plugins.removeformat=function(){var a=this;a.setOpt({removeFormatTags:"b,big,code,del,dfn,em,font,i,ins,kbd,q,samp,small,span,strike,strong,sub,sup,tt,u,var",removeFormatAttributes:"class,style,lang,width,height,align,hspace,valign"});a.commands.removeformat={execCommand:function(n,p,b,l,m){var g=new RegExp("^(?:"+(p||this.options.removeFormatTags).replace(/,/g,"|")+")$","i"),f=b?[]:(l||this.options.removeFormatAttributes).split(","),h=new dom.Range(this.document),j,e,k,c=function(q){return q.nodeType==1};function d(t){if(t.nodeType==3||t.tagName.toLowerCase()!="span"){return 0}if(browser.ie){var r=t.attributes;if(r.length){for(var s=0,q=r.length;s<q;s++){if(r[s].specified){return 0}}return 1}}return !t.attributes.length}function o(w){var q=w.createBookmark();if(w.collapsed){w.enlarge(true)}if(!m){var r=domUtils.findParentByTagName(w.startContainer,"a",true);if(r){w.setStartBefore(r)}r=domUtils.findParentByTagName(w.endContainer,"a",true);if(r){w.setEndAfter(r)}}j=w.createBookmark();s=j.start;while((k=s.parentNode)&&!domUtils.isBlockElm(k)){domUtils.breakParent(s,k);domUtils.clearEmptySibling(s)}if(j.end){s=j.end;while((k=s.parentNode)&&!domUtils.isBlockElm(k)){domUtils.breakParent(s,k);domUtils.clearEmptySibling(s)}var x=domUtils.getNextDomNode(j.start,false,c),v;while(x){if(x==j.end){break}v=domUtils.getNextDomNode(x,true,c);if(!dtd.$empty[x.tagName.toLowerCase()]&&!domUtils.isBookmarkNode(x)){if(g.test(x.tagName)){if(b){domUtils.removeStyle(x,b);if(d(x)&&b!="text-decoration"){domUtils.remove(x,true)}}else{domUtils.remove(x,true)}}else{if(!dtd.$tableContent[x.tagName]&&!dtd.$list[x.tagName]){domUtils.removeAttributes(x,f);if(d(x)){domUtils.remove(x,true)}}}}x=v}}var y=j.start.parentNode;if(domUtils.isBlockElm(y)&&!dtd.$tableContent[y.tagName]&&!dtd.$list[y.tagName]){domUtils.removeAttributes(y,f)}y=j.end.parentNode;if(j.end&&domUtils.isBlockElm(y)&&!dtd.$tableContent[y.tagName]&&!dtd.$list[y.tagName]){domUtils.removeAttributes(y,f)}w.moveToBookmark(j).moveToBookmark(q);var s=w.startContainer,u,t=w.collapsed;while(s.nodeType==1&&domUtils.isEmptyNode(s)&&dtd.$removeEmpty[s.tagName]){u=s.parentNode;w.setStartBefore(s);if(w.startContainer===w.endContainer){w.endOffset--}domUtils.remove(s);s=u}if(!t){s=w.endContainer;while(s.nodeType==1&&domUtils.isEmptyNode(s)&&dtd.$removeEmpty[s.tagName]){u=s.parentNode;w.setEndBefore(s);domUtils.remove(s);s=u}}}h=this.selection.getRange();o(h);h.select()}}};UE.plugins.blockquote=function(){var a=this;function b(c){return domUtils.filterNodeList(c.selection.getStartElementPath(),"blockquote")}a.commands.blockquote={execCommand:function(n,r){var q=this.selection.getRange(),p=b(this),d=dtd.blockquote,m=q.createBookmark();if(p){var k=q.startContainer,l=domUtils.isBlockElm(k)?k:domUtils.findParent(k,function(w){return domUtils.isBlockElm(w)}),f=q.endContainer,g=domUtils.isBlockElm(f)?f:domUtils.findParent(f,function(w){return domUtils.isBlockElm(w)});l=domUtils.findParentByTagName(l,"li",true)||l;g=domUtils.findParentByTagName(g,"li",true)||g;if(l.tagName=="LI"||l.tagName=="TD"||l===p||domUtils.isBody(l)){domUtils.remove(p,true)}else{domUtils.breakParent(l,p)}if(l!==g){p=domUtils.findParentByTagName(g,"blockquote");if(p){if(g.tagName=="LI"||g.tagName=="TD"||domUtils.isBody(g)){p.parentNode&&domUtils.remove(p,true)}else{domUtils.breakParent(g,p)}}}var j=domUtils.getElementsByTagName(this.document,"blockquote");for(var u=0,e;e=j[u++];){if(!e.childNodes.length){domUtils.remove(e)}else{if(domUtils.getPosition(e,l)&domUtils.POSITION_FOLLOWING&&domUtils.getPosition(e,g)&domUtils.POSITION_PRECEDING){domUtils.remove(e,true)}}}}else{var v=q.cloneRange(),s=v.startContainer.nodeType==1?v.startContainer:v.startContainer.parentNode,c=s,t=1;while(1){if(domUtils.isBody(s)){if(c!==s){if(q.collapsed){v.selectNode(c);t=0}else{v.setStartBefore(c)}}else{v.setStart(s,0)}break}if(!d[s.tagName]){if(q.collapsed){v.selectNode(c)}else{v.setStartBefore(c)}break}c=s;s=s.parentNode}if(t){c=s=s=v.endContainer.nodeType==1?v.endContainer:v.endContainer.parentNode;while(1){if(domUtils.isBody(s)){if(c!==s){v.setEndAfter(c)}else{v.setEnd(s,s.childNodes.length)}break}if(!d[s.tagName]){v.setEndAfter(c);break}c=s;s=s.parentNode}}s=q.document.createElement("blockquote");domUtils.setAttributes(s,r);s.appendChild(v.extractContents());v.insertNode(s);var h=domUtils.getElementsByTagName(s,"blockquote");for(var u=0,o;o=h[u++];){if(o.parentNode){domUtils.remove(o,true)}}}q.moveToBookmark(m).select()},queryCommandState:function(){return b(this)?1:0}}};UE.commands.touppercase=UE.commands.tolowercase={execCommand:function(f){var e=this;var c=e.selection.getRange();if(c.collapsed){return c}var b=c.createBookmark(),a=b.end,g=function(h){return !domUtils.isBr(h)&&!domUtils.isWhitespace(h)},d=domUtils.getNextDomNode(b.start,false,g);while(d&&(domUtils.getPosition(d,a)&domUtils.POSITION_PRECEDING)){if(d.nodeType==3){d.nodeValue=d.nodeValue[f=="touppercase"?"toUpperCase":"toLowerCase"]()}d=domUtils.getNextDomNode(d,true,g);if(d===a){break}}c.moveToBookmark(b).select()}};UE.commands.indent={execCommand:function(){var a=this,b=a.queryCommandState("indent")?"0em":(a.options.indentValue||"2em");a.execCommand("Paragraph","p",{style:"text-indent:"+b})},queryCommandState:function(){var a=domUtils.filterNodeList(this.selection.getStartElementPath(),"p h1 h2 h3 h4 h5 h6");return a&&a.style.textIndent&&parseInt(a.style.textIndent)?1:0}};UE.commands.print={execCommand:function(){this.window.print()},notNeedUndo:1};UE.commands.preview={execCommand:function(){var a=window.open("","_blank",""),b=a.document;b.open();b.write('<!DOCTYPE html><html><head><meta charset="utf-8"/><script src="'+this.options.UEDITOR_HOME_URL+"ueditor.parse.js\"><\/script><script>setTimeout(function(){uParse('div',{rootPath: '"+this.options.UEDITOR_HOME_URL+"'})},300)<\/script></head><body><div>"+this.getContent(null,null,true)+"</div></body></html>");b.close()},notNeedUndo:1};UE.plugins.selectall=function(){var a=this;a.commands.selectall={execCommand:function(){var d=this,b=d.body,c=d.selection.getRange();c.selectNodeContents(b);if(domUtils.isEmptyBlock(b)){if(browser.opera&&b.firstChild&&b.firstChild.nodeType==1){c.setStartAtFirst(b.firstChild)}c.collapse(true)}c.select(true)},notNeedUndo:1};a.addshortcutkey({selectAll:"ctrl+65"})};UE.plugins.paragraph=function(){var b=this,d=domUtils.isBlockElm,c=["TD","LI","PRE"],a=function(g,e,n,k){var j=g.createBookmark(),o=function(r){return r.nodeType==1?r.tagName.toLowerCase()!="br"&&!domUtils.isBookmarkNode(r):!domUtils.isWhitespace(r)},q;g.enlarge(true);var p=g.createBookmark(),h=domUtils.getNextDomNode(p.start,false,o),m=g.cloneRange(),f;while(h&&!(domUtils.getPosition(h,p.end)&domUtils.POSITION_FOLLOWING)){if(h.nodeType==3||!d(h)){m.setStartBefore(h);while(h&&h!==p.end&&!d(h)){f=h;h=domUtils.getNextDomNode(h,false,null,function(r){return !d(r)})}m.setEndAfter(f);q=g.document.createElement(e);if(n){domUtils.setAttributes(q,n);if(k&&k=="customstyle"&&n.style){q.style.cssText=n.style}}q.appendChild(m.extractContents());if(domUtils.isEmptyNode(q)){domUtils.fillChar(g.document,q)}m.insertNode(q);var l=q.parentNode;if(d(l)&&!domUtils.isBody(q.parentNode)&&utils.indexOf(c,l.tagName)==-1){if(!(k&&k=="customstyle")){l.getAttribute("dir")&&q.setAttribute("dir",l.getAttribute("dir"));l.style.cssText&&(q.style.cssText=l.style.cssText+";"+q.style.cssText);l.style.textAlign&&!q.style.textAlign&&(q.style.textAlign=l.style.textAlign);l.style.textIndent&&!q.style.textIndent&&(q.style.textIndent=l.style.textIndent);l.style.padding&&!q.style.padding&&(q.style.padding=l.style.padding)}if(n&&/h\d/i.test(l.tagName)&&!/h\d/i.test(q.tagName)){domUtils.setAttributes(l,n);if(k&&k=="customstyle"&&n.style){l.style.cssText=n.style}domUtils.remove(q,true);q=l}else{domUtils.remove(q.parentNode,true)}}if(utils.indexOf(c,l.tagName)!=-1){h=l}else{h=q}h=domUtils.getNextDomNode(h,false,o)}else{h=domUtils.getNextDomNode(h,true,o)}}return g.moveToBookmark(p).moveToBookmark(j)};b.setOpt("paragraph",{p:"",h1:"",h2:"",h3:"",h4:"",h5:"",h6:""});b.commands.paragraph={execCommand:function(j,k,h,g){var f=this.selection.getRange();if(f.collapsed){var e=this.document.createTextNode("p");f.insertNode(e);if(browser.ie){var l=e.previousSibling;if(l&&domUtils.isWhitespace(l)){domUtils.remove(l)}l=e.nextSibling;if(l&&domUtils.isWhitespace(l)){domUtils.remove(l)}}}f=a(f,k,h,g);if(e){f.setStartBefore(e).collapse(true);pN=e.parentNode;domUtils.remove(e);if(domUtils.isBlockElm(pN)&&domUtils.isEmptyNode(pN)){domUtils.fillNode(this.document,pN)}}if(browser.gecko&&f.collapsed&&f.startContainer.nodeType==1){var m=f.startContainer.childNodes[f.startOffset];if(m&&m.nodeType==1&&m.tagName.toLowerCase()==k){f.setStart(m,0).collapse(true)}}f.select();return true},queryCommandValue:function(){var e=domUtils.filterNodeList(this.selection.getStartElementPath(),"p h1 h2 h3 h4 h5 h6");return e?e.tagName.toLowerCase():""}}};(function(){var c=domUtils.isBlockElm,b=function(d){return domUtils.filterNodeList(d.selection.getStartElementPath(),function(e){return e&&e.nodeType==1&&e.getAttribute("dir")})},a=function(h,j,g){var m,q=function(p){return p.nodeType==1?!domUtils.isBookmarkNode(p):!domUtils.isWhitespace(p)},f=b(j);if(f&&h.collapsed){f.setAttribute("dir",g);return h}m=h.createBookmark();h.enlarge(true);var r=h.createBookmark(),l=domUtils.getNextDomNode(r.start,false,q),n=h.cloneRange(),e;while(l&&!(domUtils.getPosition(l,r.end)&domUtils.POSITION_FOLLOWING)){if(l.nodeType==3||!c(l)){n.setStartBefore(l);while(l&&l!==r.end&&!c(l)){e=l;l=domUtils.getNextDomNode(l,false,null,function(p){return !c(p)})}n.setEndAfter(e);var k=n.getCommonAncestor();if(!domUtils.isBody(k)&&c(k)){k.setAttribute("dir",g);l=k}else{var d=h.document.createElement("p");d.setAttribute("dir",g);var o=n.extractContents();d.appendChild(o);n.insertNode(d);l=d}l=domUtils.getNextDomNode(l,false,q)}else{l=domUtils.getNextDomNode(l,true,q)}}return h.moveToBookmark(r).moveToBookmark(m)};UE.commands.directionality={execCommand:function(g,f){var e=this.selection.getRange();if(e.collapsed){var d=this.document.createTextNode("d");e.insertNode(d)}a(e,this,f);if(d){e.setStartBefore(d).collapse(true);domUtils.remove(d)}e.select();return true},queryCommandValue:function(){var d=b(this);return d?d.getAttribute("dir"):"ltr"}}})();UE.plugins.horizontal=function(){var a=this;a.commands.horizontal={execCommand:function(c){var e=this;if(e.queryCommandState(c)!==-1){e.execCommand("insertHtml","<hr>");var b=e.selection.getRange(),f=b.startContainer;if(f.nodeType==1&&!f.childNodes[b.startOffset]){var d;if(d=f.childNodes[b.startOffset-1]){if(d.nodeType==1&&d.tagName=="HR"){if(e.options.enterTag=="p"){d=e.document.createElement("p");b.insertNode(d);b.setStart(d,0).setCursor()}else{d=e.document.createElement("br");b.insertNode(d);b.setStartBefore(d).setCursor()}}}}return true}},queryCommandState:function(){return domUtils.filterNodeList(this.selection.getStartElementPath(),"table")?-1:0}};a.addListener("delkeydown",function(d,c){var b=this.selection.getRange();b.txtToElmBoundary(true);if(domUtils.isStartInblock(b)){var e=b.startContainer;var f=e.previousSibling;if(f&&domUtils.isTagNode(f,"hr")){domUtils.remove(f);b.select();domUtils.preventDefault(c);return true}}})};UE.commands.time=UE.commands.date={execCommand:function(c,d){var a=new Date;function e(f,k){var h=("0"+f.getHours()).slice(-2),j=("0"+f.getMinutes()).slice(-2),g=("0"+f.getSeconds()).slice(-2);k=k||"hh:ii:ss";return k.replace(/hh/ig,h).replace(/ii/ig,j).replace(/ss/ig,g)}function b(g,h){var l=("000"+g.getFullYear()).slice(-4),k=l.slice(-2),j=("0"+(g.getMonth()+1)).slice(-2),f=("0"+g.getDate()).slice(-2);h=h||"yyyy-mm-dd";return h.replace(/yyyy/ig,l).replace(/yy/ig,k).replace(/mm/ig,j).replace(/dd/ig,f)}this.execCommand("insertHtml",c=="time"?e(a,d):b(a,d))}};UE.plugins.rowspacing=function(){var a=this;a.setOpt({rowspacingtop:["5","10","15","20","25"],rowspacingbottom:["5","10","15","20","25"]});a.commands.rowspacing={execCommand:function(c,d,b){this.execCommand("paragraph","p",{style:"margin-"+b+":"+d+"px"});return true},queryCommandValue:function(d,c){var b=domUtils.filterNodeList(this.selection.getStartElementPath(),function(f){return domUtils.isBlockElm(f)}),e;if(b){e=domUtils.getComputedStyle(b,"margin-"+c).replace(/[^\d]/g,"");return !e?0:e}return 0}}};UE.plugins.lineheight=function(){var a=this;a.setOpt({lineheight:["1","1.5","1.75","2","3","4","5"]});a.commands.lineheight={execCommand:function(b,c){this.execCommand("paragraph","p",{style:"line-height:"+(c=="1"?"normal":c+"em")});return true},queryCommandValue:function(){var b=domUtils.filterNodeList(this.selection.getStartElementPath(),function(d){return domUtils.isBlockElm(d)});if(b){var c=domUtils.getComputedStyle(b,"line-height");return c=="normal"?1:c.replace(/[^\d.]*/ig,"")}}}};UE.plugins.insertcode=function(){var b=this;b.ready(function(){utils.cssRule("pre","pre{margin:.5em 0;padding:.4em .6em;border-radius:8px;background:#f8f8f8;}",b.document)});b.setOpt("insertcode",{as3:"ActionScript3",bash:"Bash/Shell",cpp:"C/C++",css:"Css",cf:"CodeFunction","c#":"C#",delphi:"Delphi",diff:"Diff",erlang:"Erlang",groovy:"Groovy",html:"Html",java:"Java",jfx:"JavaFx",js:"Javascript",pl:"Perl",php:"Php",plain:"Plain Text",ps:"PowerShell",python:"Python",ruby:"Ruby",scala:"Scala",sql:"Sql",vb:"Vb",xml:"Xml"});b.commands.insertcode={execCommand:function(h,f){var k=this,c=k.selection.getRange(),j=domUtils.findParentByTagName(c.startContainer,"pre",true);if(j){j.className="brush:"+f+";toolbar:false;"}else{var e="";if(c.collapsed){e=browser.ie&&browser.ie11below?(browser.version<=8?"&nbsp;":""):"<br/>"}else{var l=c.extractContents();var d=k.document.createElement("div");d.appendChild(l);utils.each(UE.filterNode(UE.htmlparser(d.innerHTML.replace(/[\r\t]/g,"")),k.options.filterTxtRules).children,function(m){if(browser.ie&&browser.ie11below&&browser.version>8){if(m.type=="element"){if(m.tagName=="br"){e+="\n"}else{if(!dtd.$empty[m.tagName]){utils.each(m.children,function(n){if(n.type=="element"){if(n.tagName=="br"){e+="\n"}else{if(!dtd.$empty[m.tagName]){e+=n.innerText()}}}else{e+=n.data}});if(!/\n$/.test(e)){e+="\n"}}}}else{e+=m.data+"\n"}if(!m.nextSibling()&&/\n$/.test(e)){e=e.replace(/\n$/,"")}}else{if(browser.ie&&browser.ie11below){if(m.type=="element"){if(m.tagName=="br"){e+="<br>"}else{if(!dtd.$empty[m.tagName]){utils.each(m.children,function(n){if(n.type=="element"){if(n.tagName=="br"){e+="<br>"}else{if(!dtd.$empty[m.tagName]){e+=n.innerText()}}}else{e+=n.data}});if(!/br>$/.test(e)){e+="<br>"}}}}else{e+=m.data+"<br>"}if(!m.nextSibling()&&/<br>$/.test(e)){e=e.replace(/<br>$/,"")}}else{e+=(m.type=="element"?(dtd.$empty[m.tagName]?"":m.innerText()):m.data);if(!/br\/?\s*>$/.test(e)){if(!m.nextSibling()){return}e+="<br>"}}}})}k.execCommand("inserthtml",'<pre id="coder"class="brush:'+f+';toolbar:false">'+e+"</pre>",true);j=k.document.getElementById("coder");domUtils.removeAttributes(j,"id");var g=j.previousSibling;if(g&&(g.nodeType==3&&g.nodeValue.length==1&&browser.ie&&browser.version==6||domUtils.isEmptyBlock(g))){domUtils.remove(g)}var c=k.selection.getRange();if(domUtils.isEmptyBlock(j)){c.setStart(j,0).setCursor(false,true)}else{c.selectNodeContents(j).select()}}},queryCommandValue:function(){var c=this.selection.getStartElementPath();var d="";utils.each(c,function(f){if(f.nodeName=="PRE"){var e=f.className.match(/brush:([^;]+)/);d=e&&e[1]?e[1]:"";return false}});return d}};b.addInputRule(function(c){utils.each(c.getNodesByTagName("pre"),function(f){var e=f.getNodesByTagName("br");if(e.length){browser.ie&&browser.ie11below&&browser.version>8&&utils.each(e,function(h){var g=UE.uNode.createText("\n");h.parentNode.insertBefore(g,h);h.parentNode.removeChild(h)});return}if(browser.ie&&browser.ie11below&&browser.version>8){return}var d=f.innerText().split(/\n/);f.innerHTML("");utils.each(d,function(g){if(g.length){f.appendChild(UE.uNode.createText(g))}f.appendChild(UE.uNode.createElement("br"))})})});b.addOutputRule(function(c){utils.each(c.getNodesByTagName("pre"),function(e){var d="";utils.each(e.children,function(f){if(f.type=="text"){d+=f.data.replace(/[ ]/g,"&nbsp;").replace(/\n$/,"")}else{if(f.tagName=="br"){d+="\n"}else{d+=(!dtd.$empty[f.tagName]?"":f.innerText())}}});e.innerText(d.replace(/(&nbsp;|\n)+$/,""))})});b.notNeedCodeQuery={help:1,undo:1,redo:1,source:1,print:1,searchreplace:1,fullscreen:1,preview:1,insertparagraph:1,elementpath:1,insertcode:1,inserthtml:1,selectall:1};var a=b.queryCommandState;b.queryCommandState=function(d){var c=this;if(!c.notNeedCodeQuery[d.toLowerCase()]&&c.selection&&c.queryCommandValue("insertcode")){return -1}return UE.Editor.prototype.queryCommandState.apply(this,arguments)};b.addListener("beforeenterkeydown",function(){var c=b.selection.getRange();var f=domUtils.findParentByTagName(c.startContainer,"pre",true);if(f){b.fireEvent("saveScene");if(!c.collapsed){c.deleteContents()}if(!browser.ie||browser.ie9above){var e=b.document.createElement("br"),f;c.insertNode(e).setStartAfter(e).collapse(true);var l=e.nextSibling;if(!l&&(!browser.ie||browser.version>10)){c.insertNode(e.cloneNode(false))}else{c.setStartAfter(e)}f=e.previousSibling;var h;while(f){h=f;f=f.previousSibling;if(!f||f.nodeName=="BR"){f=h;break}}if(f){var n="";while(f&&f.nodeName!="BR"&&new RegExp("^[\\s"+domUtils.fillChar+"]*$").test(f.nodeValue)){n+=f.nodeValue;f=f.nextSibling}if(f.nodeName!="BR"){var m=f.nodeValue.match(new RegExp("^([\\s"+domUtils.fillChar+"]+)"));if(m&&m[1]){n+=m[1]}}if(n){n=b.document.createTextNode(n);c.insertNode(n).setStartAfter(n)}}c.collapse(true).select(true)}else{if(browser.version>8){var j=b.document.createTextNode("\n");var d=c.startContainer;if(c.startOffset==0){var k=d.previousSibling;if(k){c.insertNode(j);var g=b.document.createTextNode(" ");c.setStartAfter(j).insertNode(g).setStart(g,0).collapse(true).select(true)}}else{c.insertNode(j).setStartAfter(j);var g=b.document.createTextNode(" ");d=c.startContainer.childNodes[c.startOffset];if(d&&!/^\n/.test(d.nodeValue)){c.setStartBefore(j)}c.insertNode(g).setStart(g,0).collapse(true).select(true)}}else{var e=b.document.createElement("br");c.insertNode(e);c.insertNode(b.document.createTextNode(domUtils.fillChar));c.setStartAfter(e);f=e.previousSibling;var h;while(f){h=f;f=f.previousSibling;if(!f||f.nodeName=="BR"){f=h;break}}if(f){var n="";while(f&&f.nodeName!="BR"&&new RegExp("^[ "+domUtils.fillChar+"]*$").test(f.nodeValue)){n+=f.nodeValue;f=f.nextSibling}if(f.nodeName!="BR"){var m=f.nodeValue.match(new RegExp("^([ "+domUtils.fillChar+"]+)"));if(m&&m[1]){n+=m[1]}}n=b.document.createTextNode(n);c.insertNode(n).setStartAfter(n)}c.collapse(true).select()}}b.fireEvent("saveScene");return true}});b.addListener("tabkeydown",function(h,f){var e=b.selection.getRange();var j=domUtils.findParentByTagName(e.startContainer,"pre",true);if(j){b.fireEvent("saveScene");if(f.shiftKey){}else{if(!e.collapsed){var c=e.createBookmark();var k=c.start.previousSibling;while(k){if(j.firstChild===k&&!domUtils.isBr(k)){j.insertBefore(b.document.createTextNode("    "),k);break}if(domUtils.isBr(k)){j.insertBefore(b.document.createTextNode("    "),k.nextSibling);break}k=k.previousSibling}var d=c.end;k=c.start.nextSibling;if(j.firstChild===c.start){j.insertBefore(b.document.createTextNode("    "),k.nextSibling)}while(k&&k!==d){if(domUtils.isBr(k)&&k.nextSibling){if(k.nextSibling===d){break}j.insertBefore(b.document.createTextNode("    "),k.nextSibling)}k=k.nextSibling}e.moveToBookmark(c).select()}else{var g=b.document.createTextNode("    ");e.insertNode(g).setStartAfter(g).collapse(true).select(true)}}b.fireEvent("saveScene");return true}});b.addListener("beforeinserthtml",function(j,e){var g=this,c=g.selection.getRange(),h=domUtils.findParentByTagName(c.startContainer,"pre",true);if(h){if(!c.collapsed){c.deleteContents()}var d="";if(browser.ie&&browser.version>8){utils.each(UE.filterNode(UE.htmlparser(e),g.options.filterTxtRules).children,function(l){if(l.type=="element"){if(l.tagName=="br"){d+="\n"}else{if(!dtd.$empty[l.tagName]){utils.each(l.children,function(m){if(m.type=="element"){if(m.tagName=="br"){d+="\n"}else{if(!dtd.$empty[l.tagName]){d+=m.innerText()}}}else{d+=m.data}});if(!/\n$/.test(d)){d+="\n"}}}}else{d+=l.data+"\n"}if(!l.nextSibling()&&/\n$/.test(d)){d=d.replace(/\n$/,"")}});var f=g.document.createTextNode(utils.html(d.replace(/&nbsp;/g," ")));c.insertNode(f).selectNode(f).select()}else{var k=g.document.createDocumentFragment();utils.each(UE.filterNode(UE.htmlparser(e),g.options.filterTxtRules).children,function(l){if(l.type=="element"){if(l.tagName=="br"){k.appendChild(g.document.createElement("br"))}else{if(!dtd.$empty[l.tagName]){utils.each(l.children,function(m){if(m.type=="element"){if(m.tagName=="br"){k.appendChild(g.document.createElement("br"))}else{if(!dtd.$empty[l.tagName]){k.appendChild(g.document.createTextNode(utils.html(m.innerText().replace(/&nbsp;/g," "))))}}}else{k.appendChild(g.document.createTextNode(utils.html(m.data.replace(/&nbsp;/g," "))))}});if(k.lastChild.nodeName!="BR"){k.appendChild(g.document.createElement("br"))}}}}else{k.appendChild(g.document.createTextNode(utils.html(l.data.replace(/&nbsp;/g," "))))}if(!l.nextSibling()&&k.lastChild.nodeName=="BR"){k.removeChild(k.lastChild)}});c.insertNode(k).select()}return true}});b.addListener("keydown",function(g,d){var f=this,j=d.keyCode||d.which;if(j==40){var c=f.selection.getRange(),h,k=c.startContainer;if(c.collapsed&&(h=domUtils.findParentByTagName(c.startContainer,"pre",true))&&!h.nextSibling){var e=h.lastChild;while(e&&e.nodeName=="BR"){e=e.previousSibling}if(e===k||c.startContainer===h&&c.startOffset==h.childNodes.length){f.execCommand("insertparagraph");domUtils.preventDefault(d)}}}});b.addListener("delkeydown",function(e,d){var c=this.selection.getRange();c.txtToElmBoundary(true);var g=c.startContainer;if(domUtils.isTagNode(g,"pre")&&c.collapsed&&domUtils.isStartInblock(c)){var f=b.document.createElement("p");domUtils.fillNode(b.document,f);g.parentNode.insertBefore(f,g);domUtils.remove(g);c.setStart(f,0).setCursor(false,true);domUtils.preventDefault(d);return true}})};UE.commands.cleardoc={execCommand:function(c){var d=this,b=d.options.enterTag,a=d.selection.getRange();if(b=="br"){d.body.innerHTML="<br/>";a.setStart(d.body,0).setCursor()}else{d.body.innerHTML="<p>"+(ie?"":"<br/>")+"</p>";a.setStart(d.body.firstChild,0).setCursor(false,true)}setTimeout(function(){d.fireEvent("clearDoc")},0)}};UE.plugin.register("anchor",function(){return{bindEvents:{ready:function(){utils.cssRule("anchor",".anchorclass{background: url('"+this.options.themePath+this.options.theme+"/images/anchor.gif') no-repeat scroll left center transparent;cursor: auto;display: inline-block;height: 16px;width: 15px;}",this.document)}},outputRule:function(a){utils.each(a.getNodesByTagName("img"),function(b){var c;if(c=b.getAttr("anchorname")){b.tagName="a";b.setAttr({anchorname:"",name:c,"class":""})}})},inputRule:function(a){utils.each(a.getNodesByTagName("a"),function(b){var c;if((c=b.getAttr("name"))&&!b.getAttr("href")){b.tagName="img";b.setAttr({anchorname:b.getAttr("name"),"class":"anchorclass"});b.setAttr("name")}})},commands:{anchor:{execCommand:function(e,d){var b=this.selection.getRange(),a=b.getClosedNode();if(a&&a.getAttribute("anchorname")){if(d){a.setAttribute("anchorname",d)}else{b.setStartBefore(a).setCursor();domUtils.remove(a)}}else{if(d){var c=this.document.createElement("img");b.collapse(true);domUtils.setAttributes(c,{anchorname:d,"class":"anchorclass"});b.insertNode(c).setStartAfter(c).setCursor(false,true)}}}}}}});UE.plugins.wordcount=function(){var a=this;a.setOpt("wordCount",true);a.addListener("contentchange",function(){a.fireEvent("wordcount")});var b;a.addListener("ready",function(){var c=this;domUtils.on(c.body,"keyup",function(d){var e=d.keyCode||d.which,f={"16":1,"18":1,"20":1,"37":1,"38":1,"39":1,"40":1};if(e in f){return}clearTimeout(b);b=setTimeout(function(){c.fireEvent("wordcount")},200)})})};UE.plugins.pagebreak=function(){var d=this,b=["td"];d.setOpt("pageBreakTag","_ueditor_page_break_tag_");function a(f){if(domUtils.isEmptyBlock(f)){var g=f.firstChild,e;while(g&&g.nodeType==1&&domUtils.isEmptyBlock(g)){e=g;g=g.firstChild}!e&&(e=f);domUtils.fillNode(d.document,e)}}d.ready(function(){utils.cssRule("pagebreak",".pagebreak{display:block;clear:both !important;cursor:default !important;width: 100% !important;margin:0;}",d.document)});function c(e){return e&&e.nodeType==1&&e.tagName=="HR"&&e.className=="pagebreak"}d.addInputRule(function(e){e.traversal(function(g){if(g.type=="text"&&g.data==d.options.pageBreakTag){var f=UE.uNode.createElement('<hr class="pagebreak" noshade="noshade" size="5" style="-webkit-user-select: none;">');g.parentNode.insertBefore(f,g);g.parentNode.removeChild(g)}})});d.addOutputRule(function(e){utils.each(e.getNodesByTagName("hr"),function(g){if(g.getAttr("class")=="pagebreak"){var f=UE.uNode.createText(d.options.pageBreakTag);g.parentNode.insertBefore(f,g);g.parentNode.removeChild(g)}})});d.commands.pagebreak={execCommand:function(){var k=d.selection.getRange(),n=d.document.createElement("hr");domUtils.setAttributes(n,{"class":"pagebreak",noshade:"noshade",size:"5"});domUtils.unSelectable(n);var g=domUtils.findParentByTagName(k.startContainer,b,true),m=[],l;if(g){switch(g.tagName){case"TD":l=g.parentNode;if(!l.previousSibling){var o=domUtils.findParentByTagName(l,"table");o.parentNode.insertBefore(n,o);m=domUtils.findParents(n,true)}else{l.parentNode.insertBefore(n,l);m=domUtils.findParents(n)}l=m[1];if(n!==l){domUtils.breakParent(n,l)}d.fireEvent("afteradjusttable",d.document)}}else{if(!k.collapsed){k.deleteContents();var f=k.startContainer;while(!domUtils.isBody(f)&&domUtils.isBlockElm(f)&&domUtils.isEmptyNode(f)){k.setStartBefore(f).collapse(true);domUtils.remove(f);f=k.startContainer}}k.insertNode(n);var l=n.parentNode,j;while(!domUtils.isBody(l)){domUtils.breakParent(n,l);j=n.nextSibling;if(j&&domUtils.isEmptyBlock(j)){domUtils.remove(j)}l=n.parentNode}j=n.nextSibling;var h=n.previousSibling;if(c(h)){domUtils.remove(h)}else{h&&a(h)}if(!j){var e=d.document.createElement("p");n.parentNode.appendChild(e);domUtils.fillNode(d.document,e);k.setStart(e,0).collapse(true)}else{if(c(j)){domUtils.remove(j)}else{a(j)}k.setEndAfter(n).collapse(false)}k.select(true)}}}};UE.plugin.register("wordimage",function(){var b=this,a=[];return{commands:{wordimage:{execCommand:function(){var c=domUtils.getElementsByTagName(b.body,"img");var d=[];for(var g=0,f;f=c[g++];){var e=f.getAttribute("word_img");e&&d.push(e)}return d},queryCommandState:function(){a=domUtils.getElementsByTagName(b.body,"img");for(var d=0,c;c=a[d++];){if(c.getAttribute("word_img")){return 1}}return -1},notNeedUndo:true}},inputRule:function(c){utils.each(c.getNodesByTagName("img"),function(e){var f=e.attrs,d=parseInt(f.width)<128||parseInt(f.height)<43,g=b.options,h=g.UEDITOR_HOME_URL+"themes/default/images/spacer.gif";if(f.src&&/^(?:(file:\/+))/.test(f.src)){e.setAttr({width:f.width,height:f.height,alt:f.alt,word_img:f.src,src:h,style:"background:url("+(d?g.themePath+g.theme+"/images/word.gif":g.langPath+g.lang+"/images/localimage.png")+") no-repeat center center;border:1px solid #ddd"})}})}}});UE.plugins.dragdrop=function(){var a=this;a.ready(function(){domUtils.on(this.body,"dragend",function(){var b=a.selection.getRange();var d=b.getClosedNode()||a.selection.getStart();if(d&&d.tagName=="IMG"){var e=d.previousSibling,c;while(c=d.nextSibling){if(c.nodeType==1&&c.tagName=="SPAN"&&!c.firstChild){domUtils.remove(c)}else{break}}if((e&&e.nodeType==1&&!domUtils.isEmptyBlock(e)||!e)&&(!c||c&&!domUtils.isEmptyBlock(c))){if(e&&e.tagName=="P"&&!domUtils.isEmptyBlock(e)){e.appendChild(d);domUtils.moveChild(c,e);domUtils.remove(c)}else{if(c&&c.tagName=="P"&&!domUtils.isEmptyBlock(c)){c.insertBefore(d,c.firstChild)}}if(e&&e.tagName=="P"&&domUtils.isEmptyBlock(e)){domUtils.remove(e)}if(c&&c.tagName=="P"&&domUtils.isEmptyBlock(c)){domUtils.remove(c)}b.selectNode(d).select();a.fireEvent("saveScene")}}})});a.addListener("keyup",function(d,c){var f=c.keyCode||c.which;if(f==13){var b=a.selection.getRange(),e;if(e=domUtils.findParentByTagName(b.startContainer,"p",true)){if(domUtils.getComputedStyle(e,"text-align")=="center"){domUtils.removeStyle(e,"text-align")}}}})};UE.plugins.undo=function(){var d;var n=this,q=n.options.maxUndoCount||20,m=n.options.maxInputCount||20,g=new RegExp(domUtils.fillChar+"|</hr>","gi");var j={ol:1,ul:1,table:1,tbody:1,tr:1,body:1};var e=n.options.autoClearEmptyNode;function k(u,t){if(u.length!=t.length){return 0}for(var s=0,r=u.length;s<r;s++){if(u[s]!=t[s]){return 0}}return 1}function o(s,r){if(s.collapsed!=r.collapsed){return 0}if(!k(s.startAddress,r.startAddress)||!k(s.endAddress,r.endAddress)){return 0}return 1}function b(){this.list=[];this.index=0;this.hasUndo=false;this.hasRedo=false;this.undo=function(){if(this.hasUndo){if(!this.list[this.index-1]&&this.list.length==1){this.reset();return}while(this.list[this.index].content==this.list[this.index-1].content){this.index--;if(this.index==0){return this.restore(0)}}this.restore(--this.index)}};this.redo=function(){if(this.hasRedo){while(this.list[this.index].content==this.list[this.index+1].content){this.index++;if(this.index==this.list.length-1){return this.restore(this.index)}}this.restore(++this.index)}};this.restore=function(){var t=this.editor;var v=this.list[this.index];var s=UE.htmlparser(v.content.replace(g,""));t.options.autoClearEmptyNode=false;t.filterInputRule(s);t.options.autoClearEmptyNode=e;t.document.body.innerHTML=s.toHtml();t.fireEvent("afterscencerestore");if(browser.ie){utils.each(domUtils.getElementsByTagName(t.document,"td th caption p"),function(w){if(domUtils.isEmptyNode(w)){domUtils.fillNode(t.document,w)}})}try{var r=new dom.Range(t.document).moveToAddress(v.address);r.select(j[r.startContainer.nodeName.toLowerCase()])}catch(u){}this.update();this.clearKey();t.fireEvent("reset",true)};this.getScene=function(){var u=this.editor;var t=u.selection.getRange(),v=t.createAddress(false,true);u.fireEvent("beforegetscene");var s=UE.htmlparser(u.body.innerHTML);u.options.autoClearEmptyNode=false;u.filterOutputRule(s);u.options.autoClearEmptyNode=e;var r=s.toHtml();u.fireEvent("aftergetscene");return{address:v,content:r}};this.save=function(u,r){clearTimeout(d);var t=this.getScene(r),s=this.list[this.index];if(s&&s.content!=t.content){n.trigger("contentchange")}if(s&&s.content==t.content&&(u?1:o(s.address,t.address))){return}this.list=this.list.slice(0,this.index+1);this.list.push(t);if(this.list.length>q){this.list.shift()}this.index=this.list.length-1;this.clearKey();this.update()};this.update=function(){this.hasRedo=!!this.list[this.index+1];this.hasUndo=!!this.list[this.index-1]};this.reset=function(){this.list=[];this.index=0;this.hasUndo=false;this.hasRedo=false;this.clearKey()};this.clearKey=function(){h=0;a=null}}n.undoManger=new b();n.undoManger.editor=n;function l(){this.undoManger.save()}n.addListener("saveScene",function(){var r=Array.prototype.splice.call(arguments,1);this.undoManger.save.apply(this.undoManger,r)});n.addListener("reset",function(s,r){if(!r){this.undoManger.reset()}});n.commands.redo=n.commands.undo={execCommand:function(r){this.undoManger[r]()},queryCommandState:function(r){return this.undoManger["has"+(r.toLowerCase()=="undo"?"Undo":"Redo")]?0:-1},notNeedUndo:1};var p={16:1,17:1,18:1,37:1,38:1,39:1,40:1},h=0,a;var c=false;n.addListener("ready",function(){domUtils.on(this.body,"compositionstart",function(){c=true});domUtils.on(this.body,"compositionend",function(){c=false})});n.addshortcutkey({Undo:"ctrl+90",Redo:"ctrl+89"});var f=true;n.addListener("keydown",function(s,r){var u=this;var v=r.keyCode||r.which;if(!p[v]&&!r.ctrlKey&&!r.metaKey&&!r.shiftKey&&!r.altKey){if(c){return}if(!u.selection.getRange().collapsed){u.undoManger.save(false,true);f=false;return}if(u.undoManger.list.length==0){u.undoManger.save(true)}clearTimeout(d);function t(w){w.undoManger.save(false,true);w.fireEvent("selectionchange")}d=setTimeout(function(){if(c){var w=setInterval(function(){if(!c){t(u);clearInterval(w)}},300);return}t(u)},200);a=v;h++;if(h>=m){t(u)}}});n.addListener("keyup",function(s,r){var t=r.keyCode||r.which;if(!p[t]&&!r.ctrlKey&&!r.metaKey&&!r.shiftKey&&!r.altKey){if(c){return}if(!f){this.undoManger.save(false,true);f=true}}});n.stopCmdUndo=function(){n.__hasEnterExecCommand=true};n.startCmdUndo=function(){n.__hasEnterExecCommand=false}};UE.plugin.register("copy",function(){var b=this;function a(){ZeroClipboard.config({debug:false,swfPath:b.options.UEDITOR_HOME_URL+"third-party/zeroclipboard/ZeroClipboard.swf"});var c=b.zeroclipboard=new ZeroClipboard();c.on("copy",function(g){var f=g.client,d=b.selection.getRange(),h=document.createElement("div");h.appendChild(d.cloneContents());f.setText(h.innerText||h.textContent);f.setHtml(h.innerHTML);d.select()});c.on("mouseover mouseout",function(f){var d=f.target;if(f.type=="mouseover"){domUtils.addClass(d,"edui-state-hover")}else{if(f.type=="mouseout"){domUtils.removeClasses(d,"edui-state-hover")}}});c.on("wrongflash noflash",function(){ZeroClipboard.destroy()})}return{bindEvents:{ready:function(){if(!browser.ie){if(window.ZeroClipboard){a()}else{utils.loadFile(document,{src:b.options.UEDITOR_HOME_URL+"third-party/zeroclipboard/ZeroClipboard.js",tag:"script",type:"text/javascript",defer:"defer"},function(){a()})}}}},commands:{copy:{execCommand:function(c){if(!b.document.execCommand("copy")){alert(b.getLang("copymsg"))}}}}}});UE.plugins.paste=function(){function d(m){var k=this.document;if(k.getElementById("baidu_pastebin")){return}var j=this.selection.getRange(),h=j.createBookmark(),l=k.createElement("div");l.id="baidu_pastebin";browser.webkit&&l.appendChild(k.createTextNode(domUtils.fillChar+domUtils.fillChar));k.body.appendChild(l);h.start.style.display="";l.style.cssText="position:absolute;width:1px;height:1px;overflow:hidden;left:-1000px;white-space:nowrap;top:"+domUtils.getXY(h.start).y+"px";j.selectNodeContents(l).select(true);setTimeout(function(){if(browser.webkit){for(var n=0,o=k.querySelectorAll("#baidu_pastebin"),q;q=o[n++];){if(domUtils.isEmptyNode(q)){domUtils.remove(q)}else{l=q;break}}}try{l.parentNode.removeChild(l)}catch(p){}j.moveToBookmark(h).select(true);m(l)},0)}var e=this;e.setOpt({retainOnlyLabelPasted:false});var c,g,a;function f(h){return h.replace(/<(\/?)([\w\-]+)([^>]*)>/gi,function(k,j,m,l){m=m.toLowerCase();if({img:1}[m]){return k}l=l.replace(/([\w\-]*?)\s*=\s*(("([^"]*)")|('([^']*)')|([^\s>]+))/gi,function(p,n,o){if({src:1,href:1,name:1}[n.toLowerCase()]){return n+"="+o+" "}return""});if({span:1,div:1}[m]){return""}else{return"<"+j+m+" "+utils.trim(l)+">"}})}function b(h){var n;if(h.firstChild){var j=domUtils.getElementsByTagName(h,"span");for(var m=0,k;k=j[m++];){if(k.id=="_baidu_cut_start"||k.id=="_baidu_cut_end"){domUtils.remove(k)}}if(browser.webkit){var r=h.querySelectorAll("div br");for(var m=0,l;l=r[m++];){var s=l.parentNode;if(s.tagName=="DIV"&&s.childNodes.length==1){s.innerHTML="<p><br/></p>";domUtils.remove(s)}}var t=h.querySelectorAll("#baidu_pastebin");for(var m=0,q;q=t[m++];){var y=e.document.createElement("p");q.parentNode.insertBefore(y,q);while(q.firstChild){y.appendChild(q.firstChild)}domUtils.remove(q)}var p=h.querySelectorAll("meta");for(var m=0,x;x=p[m++];){domUtils.remove(x)}var r=h.querySelectorAll("br");for(m=0;x=r[m++];){if(/^apple-/i.test(x.className)){domUtils.remove(x)}}}if(browser.gecko){var w=h.querySelectorAll("[_moz_dirty]");for(m=0;x=w[m++];){x.removeAttribute("_moz_dirty")}}if(!browser.ie){var o=h.querySelectorAll("span.Apple-style-span");for(var m=0,x;x=o[m++];){domUtils.remove(x,true)}}n=h.innerHTML;n=UE.filterWord(n);var u=UE.htmlparser(n);if(e.options.filterRules){UE.filterNode(u,e.options.filterRules)}e.filterInputRule(u);if(browser.webkit){var v=u.lastChild();if(v&&v.type=="element"&&v.tagName=="br"){u.removeChild(v)}utils.each(e.body.querySelectorAll("div"),function(z){if(domUtils.isEmptyBlock(z)){domUtils.remove(z,true)}})}n={html:u.toHtml()};e.fireEvent("beforepaste",n,u);if(!n.html){return}u=UE.htmlparser(n.html,true);if(e.queryCommandState("pasteplain")===1){e.execCommand("insertHtml",UE.filterNode(u,e.options.filterTxtRules).toHtml(),true)}else{UE.filterNode(u,e.options.filterTxtRules);c=u.toHtml();g=n.html;a=e.selection.getRange().createAddress(true);e.execCommand("insertHtml",e.getOpt("retainOnlyLabelPasted")===true?f(g):g,true)}e.fireEvent("afterpaste",n)}}e.addListener("pasteTransfer",function(l,m){if(a&&c&&g&&c!=g){var r=e.selection.getRange();r.moveToAddress(a,true);if(!r.collapsed){while(!domUtils.isBody(r.startContainer)){var k=r.startContainer;if(k.nodeType==1){k=k.childNodes[r.startOffset];if(!k){r.setStartBefore(r.startContainer);continue}var n=k.previousSibling;if(n&&n.nodeType==3&&new RegExp("^[\n\r\t "+domUtils.fillChar+"]*$").test(n.nodeValue)){r.setStartBefore(n)}}if(r.startOffset==0){r.setStartBefore(r.startContainer)}else{break}}while(!domUtils.isBody(r.endContainer)){var o=r.endContainer;if(o.nodeType==1){o=o.childNodes[r.endOffset];if(!o){r.setEndAfter(r.endContainer);continue}var p=o.nextSibling;if(p&&p.nodeType==3&&new RegExp("^[\n\r\t"+domUtils.fillChar+"]*$").test(p.nodeValue)){r.setEndAfter(p)}}if(r.endOffset==r.endContainer[r.endContainer.nodeType==3?"nodeValue":"childNodes"].length){r.setEndAfter(r.endContainer)}else{break}}}r.deleteContents();r.select(true);e.__hasEnterExecCommand=true;var q=g;if(m===2){q=f(q)}else{if(m){q=c}}e.execCommand("inserthtml",q,true);e.__hasEnterExecCommand=false;var h=e.selection.getRange();while(!domUtils.isBody(h.startContainer)&&!h.startOffset&&h.startContainer[h.startContainer.nodeType==3?"nodeValue":"childNodes"].length){h.setStartBefore(h.startContainer)}var j=h.createAddress(true);a.endAddress=j.startAddress}});e.addListener("ready",function(){domUtils.on(e.body,"cut",function(){var h=e.selection.getRange();if(!h.collapsed&&e.undoManger){e.undoManger.save()}});domUtils.on(e.body,browser.ie||browser.opera?"keydown":"paste",function(h){if((browser.ie||browser.opera)&&((!h.ctrlKey&&!h.metaKey)||h.keyCode!="86")){return}d.call(e,function(j){b(j)})})});e.commands.paste={execCommand:function(h){if(browser.ie){d.call(e,function(j){b(j)});e.document.execCommand("paste")}else{alert(e.getLang("pastemsg"))}}}};UE.plugins.pasteplain=function(){var b=this;b.setOpt({pasteplain:false,filterTxtRules:function(){function d(e){e.tagName="p";e.setStyle()}function c(e){e.parentNode.removeChild(e,true)}return{"-":"script style object iframe embed input select",p:{$:{}},br:{$:{}},div:function(f){var e,g=UE.uNode.createElement("p");while(e=f.firstChild()){if(e.type=="text"||!UE.dom.dtd.$block[e.tagName]){g.appendChild(e)}else{if(g.firstChild()){f.parentNode.insertBefore(g,f);g=UE.uNode.createElement("p")}else{f.parentNode.insertBefore(e,f)}}}if(g.firstChild()){f.parentNode.insertBefore(g,f)}f.parentNode.removeChild(f)},ol:c,ul:c,dl:c,dt:c,dd:c,li:c,caption:d,th:d,tr:d,h1:d,h2:d,h3:d,h4:d,h5:d,h6:d,td:function(f){var e=!!f.innerText();if(e){f.parentNode.insertAfter(UE.uNode.createText(" &nbsp; &nbsp;"),f)}f.parentNode.removeChild(f,f.innerText())}}}()});var a=b.options.pasteplain;b.commands.pasteplain={queryCommandState:function(){return a?1:0},execCommand:function(){a=!a|0},notNeedUndo:1}};UE.plugins.list=function(){var g=this,b={TD:1,PRE:1,BLOCKQUOTE:1};var h={cn:"cn-1-",cn1:"cn-2-",cn2:"cn-3-",num:"num-1-",num1:"num-2-",num2:"num-3-",dash:"dash",dot:"dot"};g.setOpt({autoTransWordToList:false,insertorderedlist:{num:"",num1:"",num2:"",cn:"",cn1:"",cn2:"",decimal:"","lower-alpha":"","lower-roman":"","upper-alpha":"","upper-roman":""},insertunorderedlist:{circle:"",disc:"",square:"",dash:"",dot:""},listDefaultPaddingLeft:"30",listiconpath:"http://bs.baidu.com/listicon/",maxListLevel:-1,disablePInList:false});function k(q){var o=[];for(var r in q){o.push(r)}return o}var j={OL:k(g.options.insertorderedlist),UL:k(g.options.insertunorderedlist)};var a=g.options.listiconpath;for(var n in h){if(!g.options.insertorderedlist.hasOwnProperty(n)&&!g.options.insertunorderedlist.hasOwnProperty(n)){delete h[n]}}g.ready(function(){var r=[];for(var q in h){if(q=="dash"||q=="dot"){r.push("li.list-"+h[q]+"{background-image:url("+a+h[q]+".gif)}");r.push("ul.custom_"+q+"{list-style:none;}ul.custom_"+q+" li{background-position:0 3px;background-repeat:no-repeat}")}else{for(var o=0;o<99;o++){r.push("li.list-"+h[q]+o+"{background-image:url("+a+"list-"+h[q]+o+".gif)}")}r.push("ol.custom_"+q+"{list-style:none;}ol.custom_"+q+" li{background-position:0 3px;background-repeat:no-repeat}")}switch(q){case"cn":r.push("li.list-"+q+"-paddingleft-1{padding-left:25px}");r.push("li.list-"+q+"-paddingleft-2{padding-left:40px}");r.push("li.list-"+q+"-paddingleft-3{padding-left:55px}");break;case"cn1":r.push("li.list-"+q+"-paddingleft-1{padding-left:30px}");r.push("li.list-"+q+"-paddingleft-2{padding-left:40px}");r.push("li.list-"+q+"-paddingleft-3{padding-left:55px}");break;case"cn2":r.push("li.list-"+q+"-paddingleft-1{padding-left:40px}");r.push("li.list-"+q+"-paddingleft-2{padding-left:55px}");r.push("li.list-"+q+"-paddingleft-3{padding-left:68px}");break;case"num":case"num1":r.push("li.list-"+q+"-paddingleft-1{padding-left:25px}");break;case"num2":r.push("li.list-"+q+"-paddingleft-1{padding-left:35px}");r.push("li.list-"+q+"-paddingleft-2{padding-left:40px}");break;case"dash":r.push("li.list-"+q+"-paddingleft{padding-left:35px}");break;case"dot":r.push("li.list-"+q+"-paddingleft{padding-left:20px}")}}r.push(".list-paddingleft-1{padding-left:0}");r.push(".list-paddingleft-2{padding-left:"+g.options.listDefaultPaddingLeft+"px}");r.push(".list-paddingleft-3{padding-left:"+g.options.listDefaultPaddingLeft*2+"px}");utils.cssRule("list","ol,ul{margin:0;pading:0;"+(browser.ie?"":"width:95%")+"}li{clear:both;}"+r.join("\n"),g.document)});g.ready(function(){domUtils.on(g.body,"cut",function(){setTimeout(function(){var p=g.selection.getRange(),o;if(!p.collapsed){if(o=domUtils.findParentByTagName(p.startContainer,"li",true)){if(!o.nextSibling&&domUtils.isEmptyBlock(o)){var q=o.parentNode,s;if(s=q.previousSibling){domUtils.remove(q);p.setStartAtLast(s).collapse(true);p.select(true)}else{if(s=q.nextSibling){domUtils.remove(q);p.setStartAtFirst(s).collapse(true);p.select(true)}else{var r=g.document.createElement("p");domUtils.fillNode(g.document,r);q.parentNode.insertBefore(r,q);domUtils.remove(q);p.setStart(r,0).collapse(true);p.select(true)}}}}}})})});function f(p){var o=p.className;if(domUtils.hasClass(p,/custom_/)){return o.match(/custom_(\w+)/)[1]}return domUtils.getStyle(p,"list-style-type")}g.addListener("beforepaste",function(t,s){var u=this,q=u.selection.getRange(),o;var p=UE.htmlparser(s.html,true);if(o=domUtils.findParentByTagName(q.startContainer,"li",true)){var v=o.parentNode,r=v.tagName=="OL"?"ul":"ol";utils.each(p.getNodesByTagName(r),function(z){z.tagName=v.tagName;z.setAttr();if(z.parentNode===p){t=f(v)||(v.tagName=="OL"?"decimal":"disc")}else{var y=z.parentNode.getAttr("class");if(y&&/custom_/.test(y)){t=y.match(/custom_(\w+)/)[1]}else{t=z.parentNode.getStyle("list-style-type")}if(!t){t=v.tagName=="OL"?"decimal":"disc"}}var x=utils.indexOf(j[v.tagName],t);if(z.parentNode!==p){x=x+1==j[v.tagName].length?0:x+1}var w=j[v.tagName][x];if(h[w]){z.setAttr("class","custom_"+w)}else{z.setStyle("list-style-type",w)}})}s.html=p.toHtml()});g.getOpt("disablePInList")===true&&g.addOutputRule(function(o){utils.each(o.getNodesByTagName("li"),function(p){var r=[],q=0;utils.each(p.children,function(u){if(u.tagName=="p"){var t;while(t=u.children.pop()){r.splice(q,0,t);t.parentNode=p;lastNode=t}t=r[r.length-1];if(!t||t.type!="element"||t.tagName!="br"){var s=UE.uNode.createElement("br");s.parentNode=p;r.push(s)}q=r.length}});if(r.length){p.children=r}})});g.addInputRule(function(q){utils.each(q.getNodesByTagName("li"),function(s){var x=UE.uNode.createElement("p");for(var u=0,t;t=s.children[u];){if(t.type=="text"||dtd.p[t.tagName]){x.appendChild(t)}else{if(x.firstChild()){s.insertBefore(x,t);x=UE.uNode.createElement("p");u=u+2}else{u++}}}if(x.firstChild()&&!x.parentNode||!s.firstChild()){s.appendChild(x)}if(!x.firstChild()){x.innerHTML(browser.ie?"&nbsp;":"<br/>")}var w=s.firstChild();var v=w.lastChild();if(v&&v.type=="text"&&/^\s*$/.test(v.data)){w.removeChild(v)}});if(g.options.autoTransWordToList){var p={num1:/^\d+\)/,decimal:/^\d+\./,"lower-alpha":/^[a-z]+\)/,"upper-alpha":/^[A-Z]+\./,cn:/^[\u4E00\u4E8C\u4E09\u56DB\u516d\u4e94\u4e03\u516b\u4e5d]+[\u3001]/,cn2:/^\([\u4E00\u4E8C\u4E09\u56DB\u516d\u4e94\u4e03\u516b\u4e5d]+\)/},o={square:"n"};function r(u,s){var t=s.firstChild();if(t&&t.type=="element"&&t.tagName=="span"&&/Wingdings|Symbol/.test(t.getStyle("font-family"))){for(var v in o){if(o[v]==t.data){return v}}return"disc"}for(var v in p){if(p[v].test(u)){return v}}}utils.each(q.getNodesByTagName("p"),function(x){if(x.getAttr("class")!="MsoListParagraph"){return}x.setStyle("margin","");x.setStyle("margin-left","");x.setAttr("class","");function u(B,C,A){if(B.tagName=="ol"){if(browser.ie){var D=C.firstChild();if(D.type=="element"&&D.tagName=="span"&&p[A].test(D.innerText())){C.removeChild(D)}}else{C.innerHTML(C.innerHTML().replace(p[A],""))}}else{C.removeChild(C.firstChild())}var z=UE.uNode.createElement("li");z.appendChild(C);B.appendChild(z)}var t=x,w,s=x;if(x.parentNode.tagName!="li"&&(w=r(x.innerText(),x))){var y=UE.uNode.createElement(g.options.insertorderedlist.hasOwnProperty(w)?"ol":"ul");if(h[w]){y.setAttr("class","custom_"+w)}else{y.setStyle("list-style-type",w)}while(x&&x.parentNode.tagName!="li"&&r(x.innerText(),x)){t=x.nextSibling();if(!t){x.parentNode.insertBefore(y,x)}u(y,x,w);x=t}if(!y.parentNode&&x&&x.parentNode){x.parentNode.insertBefore(y,x)}}var v=s.firstChild();if(v&&v.type=="element"&&v.tagName=="span"&&/^\s*(&nbsp;)+\s*$/.test(v.innerText())){v.parentNode.removeChild(v)}})}});g.addListener("contentchange",function(){e(g.document)});function e(o,p){utils.each(domUtils.getElementsByTagName(o,"ol ul"),function(w){if(!domUtils.inDoc(w,o)){return}var v=w.parentNode;if(v.tagName==w.tagName){var q=f(w)||(w.tagName=="OL"?"decimal":"disc"),s=f(v)||(v.tagName=="OL"?"decimal":"disc");if(q==s){var x=utils.indexOf(j[w.tagName],q);x=x+1==j[w.tagName].length?0:x+1;m(w,j[w.tagName][x])}}var r=0,u=2;if(domUtils.hasClass(w,/custom_/)){if(!(/[ou]l/i.test(v.tagName)&&domUtils.hasClass(v,/custom_/))){u=1}}else{if(/[ou]l/i.test(v.tagName)&&domUtils.hasClass(v,/custom_/)){u=3}}var t=domUtils.getStyle(w,"list-style-type");t&&(w.style.cssText="list-style-type:"+t);w.className=utils.trim(w.className.replace(/list-paddingleft-\w+/,""))+" list-paddingleft-"+u;utils.each(domUtils.getElementsByTagName(w,"li"),function(y){y.style.cssText&&(y.style.cssText="");if(!y.firstChild){domUtils.remove(y);return}if(y.parentNode!==w){return}r++;if(domUtils.hasClass(w,/custom_/)){var A=1,z=f(w);if(w.tagName=="OL"){if(z){switch(z){case"cn":case"cn1":case"cn2":if(r>10&&(r%10==0||r>10&&r<20)){A=2}else{if(r>20){A=3}}break;case"num2":if(r>9){A=2}}}y.className="list-"+h[z]+r+" list-"+z+"-paddingleft-"+A}else{y.className="list-"+h[z]+" list-"+z+"-paddingleft"}}else{y.className=y.className.replace(/list-[\w\-]+/gi,"")}var B=y.getAttribute("class");if(B!==null&&!B.replace(/\s/g,"")){domUtils.removeAttributes(y,"class")}});!p&&d(w,w.tagName.toLowerCase(),f(w)||domUtils.getStyle(w,"list-style-type"),true)})}function d(t,p,s,r){var q=t.nextSibling;if(q&&q.nodeType==1&&q.tagName.toLowerCase()==p&&(f(q)||domUtils.getStyle(q,"list-style-type")||(p=="ol"?"decimal":"disc"))==s){domUtils.moveChild(q,t);if(q.childNodes.length==0){domUtils.remove(q)}}if(q&&domUtils.isFillChar(q)){domUtils.remove(q)}var o=t.previousSibling;if(o&&o.nodeType==1&&o.tagName.toLowerCase()==p&&(f(o)||domUtils.getStyle(o,"list-style-type")||(p=="ol"?"decimal":"disc"))==s){domUtils.moveChild(t,o)}if(o&&domUtils.isFillChar(o)){domUtils.remove(o)}!r&&domUtils.isEmptyBlock(t)&&domUtils.remove(t);if(f(t)){e(t.ownerDocument,true)}}function m(p,o){if(h[o]){p.className="custom_"+o}try{domUtils.setStyle(p,"list-style-type",o)}catch(q){}}function c(p){var o=p.previousSibling;if(o&&domUtils.isEmptyBlock(o)){domUtils.remove(o)}o=p.nextSibling;if(o&&domUtils.isEmptyBlock(o)){domUtils.remove(o)}}g.addListener("keydown",function(q,E){function D(){E.preventDefault?E.preventDefault():(E.returnValue=false);g.fireEvent("contentchange");g.undoManger&&g.undoManger.save()}function x(p,J){while(p&&!domUtils.isBody(p)){if(J(p)){return null}if(p.nodeType==1&&/[ou]l/i.test(p.tagName)){return p}p=p.parentNode}return null}var v=E.keyCode||E.which;if(v==13&&!E.shiftKey){var u=g.selection.getRange(),w=domUtils.findParent(u.startContainer,function(p){return domUtils.isBlockElm(p)},true),A=domUtils.findParentByTagName(u.startContainer,"li",true);if(w&&w.tagName!="PRE"&&!A){var y=w.innerHTML.replace(new RegExp(domUtils.fillChar,"g"),"");if(/^\s*1\s*\.[^\d]/.test(y)){w.innerHTML=y.replace(/^\s*1\s*\./,"");u.setStartAtLast(w).collapse(true).select();g.__hasEnterExecCommand=true;g.execCommand("insertorderedlist");g.__hasEnterExecCommand=false}}var C=g.selection.getRange(),s=x(C.startContainer,function(p){return p.tagName=="TABLE"}),r=C.collapsed?s:x(C.endContainer,function(p){return p.tagName=="TABLE"});if(s&&r&&s===r){if(!C.collapsed){s=domUtils.findParentByTagName(C.startContainer,"li",true);r=domUtils.findParentByTagName(C.endContainer,"li",true);if(s&&r&&s===r){C.deleteContents();A=domUtils.findParentByTagName(C.startContainer,"li",true);if(A&&domUtils.isEmptyBlock(A)){F=A.previousSibling;next=A.nextSibling;G=g.document.createElement("p");domUtils.fillNode(g.document,G);B=A.parentNode;if(F&&next){C.setStart(next,0).collapse(true).select(true);domUtils.remove(A)}else{if(!F&&!next||!F){B.parentNode.insertBefore(G,B)}else{A.parentNode.parentNode.insertBefore(G,B.nextSibling)}domUtils.remove(A);if(!B.firstChild){domUtils.remove(B)}C.setStart(G,0).setCursor()}D();return}}else{var I=C.cloneRange(),o=I.collapse(false).createBookmark();C.deleteContents();I.moveToBookmark(o);var A=domUtils.findParentByTagName(I.startContainer,"li",true);c(A);I.select();D();return}}A=domUtils.findParentByTagName(C.startContainer,"li",true);if(A){if(domUtils.isEmptyBlock(A)){o=C.createBookmark();var B=A.parentNode;if(A!==B.lastChild){domUtils.breakParent(A,B);c(A)}else{B.parentNode.insertBefore(A,B.nextSibling);if(domUtils.isEmptyNode(B)){domUtils.remove(B)}}if(!dtd.$list[A.parentNode.tagName]){if(!domUtils.isBlockElm(A.firstChild)){G=g.document.createElement("p");A.parentNode.insertBefore(G,A);while(A.firstChild){G.appendChild(A.firstChild)}domUtils.remove(A)}else{domUtils.remove(A,true)}}C.moveToBookmark(o).select()}else{var t=A.firstChild;if(!t||!domUtils.isBlockElm(t)){var G=g.document.createElement("p");!A.firstChild&&domUtils.fillNode(g.document,G);while(A.firstChild){G.appendChild(A.firstChild)}A.appendChild(G);t=G}var H=g.document.createElement("span");C.insertNode(H);domUtils.breakParent(H,A);var z=H.nextSibling;t=z.firstChild;if(!t){G=g.document.createElement("p");domUtils.fillNode(g.document,G);z.appendChild(G);t=G}if(domUtils.isEmptyNode(t)){t.innerHTML="";domUtils.fillNode(g.document,t)}C.setStart(t,0).collapse(true).shrinkBoundary().select();domUtils.remove(H);var F=z.previousSibling;if(F&&domUtils.isEmptyBlock(F)){F.innerHTML="<p></p>";domUtils.fillNode(g.document,F.firstChild)}}D()}}}if(v==8){C=g.selection.getRange();if(C.collapsed&&domUtils.isStartInblock(C)){I=C.cloneRange().trimBoundary();A=domUtils.findParentByTagName(C.startContainer,"li",true);if(A&&domUtils.isStartInblock(I)){s=domUtils.findParentByTagName(C.startContainer,"p",true);if(s&&s!==A.firstChild){var B=domUtils.findParentByTagName(s,["ol","ul"]);domUtils.breakParent(s,B);c(s);g.fireEvent("contentchange");C.setStart(s,0).setCursor(false,true);g.fireEvent("saveScene");domUtils.preventDefault(E);return}if(A&&(F=A.previousSibling)){if(v==46&&A.childNodes.length){return}if(dtd.$list[F.tagName]){F=F.lastChild}g.undoManger&&g.undoManger.save();t=A.firstChild;if(domUtils.isBlockElm(t)){if(domUtils.isEmptyNode(t)){F.appendChild(t);C.setStart(t,0).setCursor(false,true);while(A.firstChild){F.appendChild(A.firstChild)}}else{H=g.document.createElement("span");C.insertNode(H);if(domUtils.isEmptyBlock(F)){F.innerHTML=""}domUtils.moveChild(A,F);C.setStartBefore(H).collapse(true).select(true);domUtils.remove(H)}}else{if(domUtils.isEmptyNode(A)){var G=g.document.createElement("p");F.appendChild(G);C.setStart(G,0).setCursor()}else{C.setEnd(F,F.childNodes.length).collapse().select(true);while(A.firstChild){F.appendChild(A.firstChild)}}}domUtils.remove(A);g.fireEvent("contentchange");g.fireEvent("saveScene");domUtils.preventDefault(E);return}if(A&&!A.previousSibling){var B=A.parentNode;var o=C.createBookmark();if(domUtils.isTagNode(B.parentNode,"ol ul")){B.parentNode.insertBefore(A,B);if(domUtils.isEmptyNode(B)){domUtils.remove(B)}}else{while(A.firstChild){B.parentNode.insertBefore(A.firstChild,B)}domUtils.remove(A);if(domUtils.isEmptyNode(B)){domUtils.remove(B)}}C.moveToBookmark(o).setCursor(false,true);g.fireEvent("contentchange");g.fireEvent("saveScene");domUtils.preventDefault(E);return}}}}});g.addListener("keyup",function(q,p){var s=p.keyCode||p.which;if(s==8){var o=g.selection.getRange(),r;if(r=domUtils.findParentByTagName(o.startContainer,["ol","ul"],true)){d(r,r.tagName.toLowerCase(),f(r)||domUtils.getComputedStyle(r,"list-style-type"),true)}}});g.addListener("tabkeydown",function(){var t=g.selection.getRange();function z(C){if(g.options.maxListLevel!=-1){var E=C.parentNode,D=0;while(/[ou]l/i.test(E.tagName)){D++;E=E.parentNode}if(D>=g.options.maxListLevel){return true}}}var A=domUtils.findParentByTagName(t.startContainer,"li",true);if(A){var r;if(t.collapsed){if(z(A)){return true}var q=A.parentNode,x=g.document.createElement(q.tagName),u=utils.indexOf(j[x.tagName],f(q)||domUtils.getComputedStyle(q,"list-style-type"));u=u+1==j[x.tagName].length?0:u+1;var p=j[x.tagName][u];m(x,p);if(domUtils.isStartInblock(t)){g.fireEvent("saveScene");r=t.createBookmark();q.insertBefore(x,A);x.appendChild(A);d(x,x.tagName.toLowerCase(),p);g.fireEvent("contentchange");t.moveToBookmark(r).select(true);return true}}else{g.fireEvent("saveScene");r=t.createBookmark();for(var s=0,o,y=domUtils.findParents(A),B;B=y[s++];){if(domUtils.isTagNode(B,"ol ul")){o=B;break}}var w=A;if(r.end){while(w&&!(domUtils.getPosition(w,r.end)&domUtils.POSITION_FOLLOWING)){if(z(w)){w=domUtils.getNextDomNode(w,false,null,function(C){return C!==o});continue}var q=w.parentNode,x=g.document.createElement(q.tagName),u=utils.indexOf(j[x.tagName],f(q)||domUtils.getComputedStyle(q,"list-style-type"));var v=u+1==j[x.tagName].length?0:u+1;var p=j[x.tagName][v];m(x,p);q.insertBefore(x,w);while(w&&!(domUtils.getPosition(w,r.end)&domUtils.POSITION_FOLLOWING)){A=w.nextSibling;x.appendChild(w);if(!A||domUtils.isTagNode(A,"ol ul")){if(A){while(A=A.firstChild){if(A.tagName=="LI"){break}}}else{A=domUtils.getNextDomNode(w,false,null,function(C){return C!==o})}break}w=A}d(x,x.tagName.toLowerCase(),p);w=A}}g.fireEvent("contentchange");t.moveToBookmark(r).select();return true}}});function l(o){while(o&&!domUtils.isBody(o)){if(o.nodeName=="TABLE"){return null}if(o.nodeName=="LI"){return o}o=o.parentNode}}g.commands.insertorderedlist=g.commands.insertunorderedlist={execCommand:function(t,K){if(!K){K=t.toLowerCase()=="insertorderedlist"?"decimal":"disc"}var S=this,D=this.selection.getRange(),E=function(p){return p.nodeType==1?p.tagName.toLowerCase()!="br":!domUtils.isWhitespace(p)},U=t.toLowerCase()=="insertorderedlist"?"ol":"ul",s=S.document.createDocumentFragment();D.adjustmentBoundary().shrinkBoundary();var x=D.createBookmark(true),v=l(S.document.getElementById(x.start)),H=0,u=l(S.document.getElementById(x.end)),I=0,Q,A,L,N;if(v||u){v&&(Q=v.parentNode);if(!x.end){u=v}u&&(A=u.parentNode);if(Q===A){while(v!==u){N=v;v=v.nextSibling;if(!domUtils.isBlockElm(N.firstChild)){var F=S.document.createElement("p");while(N.firstChild){F.appendChild(N.firstChild)}N.appendChild(F)}s.appendChild(N)}N=S.document.createElement("span");Q.insertBefore(N,u);if(!domUtils.isBlockElm(u.firstChild)){F=S.document.createElement("p");while(u.firstChild){F.appendChild(u.firstChild)}u.appendChild(F)}s.appendChild(u);domUtils.breakParent(N,Q);if(domUtils.isEmptyNode(N.previousSibling)){domUtils.remove(N.previousSibling)}if(domUtils.isEmptyNode(N.nextSibling)){domUtils.remove(N.nextSibling)}var w=f(Q)||domUtils.getComputedStyle(Q,"list-style-type")||(t.toLowerCase()=="insertorderedlist"?"decimal":"disc");if(Q.tagName.toLowerCase()==U&&w==K){for(var J=0,B,y=S.document.createDocumentFragment();B=s.firstChild;){if(domUtils.isTagNode(B,"ol ul")){y.appendChild(B)}else{while(B.firstChild){y.appendChild(B.firstChild);domUtils.remove(B)}}}N.parentNode.insertBefore(y,N)}else{L=S.document.createElement(U);m(L,K);L.appendChild(s);N.parentNode.insertBefore(L,N)}domUtils.remove(N);L&&d(L,U,K);D.moveToBookmark(x).select();return}if(v){while(v){N=v.nextSibling;if(domUtils.isTagNode(v,"ol ul")){s.appendChild(v)}else{var q=S.document.createDocumentFragment(),P=0;while(v.firstChild){if(domUtils.isBlockElm(v.firstChild)){P=1}q.appendChild(v.firstChild)}if(!P){var T=S.document.createElement("p");T.appendChild(q);s.appendChild(T)}else{s.appendChild(q)}domUtils.remove(v)}v=N}Q.parentNode.insertBefore(s,Q.nextSibling);if(domUtils.isEmptyNode(Q)){D.setStartBefore(Q);domUtils.remove(Q)}else{D.setStartAfter(Q)}H=1}if(u&&domUtils.inDoc(A,S.document)){v=A.firstChild;while(v&&v!==u){N=v.nextSibling;if(domUtils.isTagNode(v,"ol ul")){s.appendChild(v)}else{q=S.document.createDocumentFragment();P=0;while(v.firstChild){if(domUtils.isBlockElm(v.firstChild)){P=1}q.appendChild(v.firstChild)}if(!P){T=S.document.createElement("p");T.appendChild(q);s.appendChild(T)}else{s.appendChild(q)}domUtils.remove(v)}v=N}var o=domUtils.createElement(S.document,"div",{tmpDiv:1});domUtils.moveChild(u,o);s.appendChild(o);domUtils.remove(u);A.parentNode.insertBefore(s,A);D.setEndBefore(A);if(domUtils.isEmptyNode(A)){domUtils.remove(A)}I=1}}if(!H){D.setStartBefore(S.document.getElementById(x.start))}if(x.end&&!I){D.setEndAfter(S.document.getElementById(x.end))}D.enlarge(true,function(p){return b[p.tagName]});s=S.document.createDocumentFragment();var r=D.createBookmark(),G=domUtils.getNextDomNode(r.start,false,E),R=D.cloneRange(),M,z=domUtils.isBlockElm;while(G&&G!==r.end&&(domUtils.getPosition(G,r.end)&domUtils.POSITION_PRECEDING)){if(G.nodeType==3||dtd.li[G.tagName]){if(G.nodeType==1&&dtd.$list[G.tagName]){while(G.firstChild){s.appendChild(G.firstChild)}M=domUtils.getNextDomNode(G,false,E);domUtils.remove(G);G=M;continue}M=G;R.setStartBefore(G);while(G&&G!==r.end&&(!z(G)||domUtils.isBookmarkNode(G))){M=G;G=domUtils.getNextDomNode(G,false,null,function(p){return !b[p.tagName]})}if(G&&z(G)){N=domUtils.getNextDomNode(M,false,E);if(N&&domUtils.isBookmarkNode(N)){G=domUtils.getNextDomNode(N,false,E);M=N}}R.setEndAfter(M);G=domUtils.getNextDomNode(M,false,E);var C=D.document.createElement("li");C.appendChild(R.extractContents());if(domUtils.isEmptyNode(C)){var M=D.document.createElement("p");while(C.firstChild){M.appendChild(C.firstChild)}C.appendChild(M)}s.appendChild(C)}else{G=domUtils.getNextDomNode(G,true,E)}}D.moveToBookmark(r).collapse(true);L=S.document.createElement(U);m(L,K);L.appendChild(s);D.insertNode(L);d(L,U,K);for(var J=0,B,O=domUtils.getElementsByTagName(L,"div");B=O[J++];){if(B.getAttribute("tmpDiv")){domUtils.remove(B,true)}}D.moveToBookmark(x).select()},queryCommandState:function(s){var o=s.toLowerCase()=="insertorderedlist"?"ol":"ul";var r=this.selection.getStartElementPath();for(var q=0,p;p=r[q++];){if(p.nodeName=="TABLE"){return 0}if(o==p.nodeName.toLowerCase()){return 1}}return 0},queryCommandValue:function(t){var o=t.toLowerCase()=="insertorderedlist"?"ol":"ul";var s=this.selection.getStartElementPath(),r;for(var q=0,p;p=s[q++];){if(p.nodeName=="TABLE"){r=null;break}if(o==p.nodeName.toLowerCase()){r=p;break}}return r?f(r)||domUtils.getComputedStyle(r,"list-style-type"):null}}};(function(){var a={textarea:function(d,c){var b=c.ownerDocument.createElement("textarea");b.style.cssText="position:absolute;resize:none;width:100%;height:100%;border:0;padding:0;margin:0;overflow-y:auto;";if(browser.ie&&browser.version<8){b.style.width=c.offsetWidth+"px";b.style.height=c.offsetHeight+"px";c.onresize=function(){b.style.width=c.offsetWidth+"px";b.style.height=c.offsetHeight+"px"}}c.appendChild(b);return{setContent:function(e){b.value=e},getContent:function(){return b.value},select:function(){var e;if(browser.ie){e=b.createTextRange();e.collapse(true);e.select()}else{b.setSelectionRange(0,0);b.focus()}},dispose:function(){c.removeChild(b);c.onresize=null;b=null;c=null}}},codemirror:function(d,c){var b=window.CodeMirror(c,{mode:"text/html",tabMode:"indent",lineNumbers:true,lineWrapping:true});var e=b.getWrapperElement();e.style.cssText='position:absolute;left:0;top:0;width:100%;height:100%;font-family:consolas,"Courier new",monospace;font-size:13px;';b.getScrollerElement().style.cssText="position:absolute;left:0;top:0;width:100%;height:100%;";b.refresh();return{getCodeMirror:function(){return b},setContent:function(f){b.setValue(f)},getContent:function(){return b.getValue()},select:function(){b.focus()},dispose:function(){c.removeChild(e);e=null;b=null}}}};UE.plugins.source=function(){var h=this;var b=this.options;var g=false;var k;var d;b.sourceEditor=browser.ie?"textarea":(b.sourceEditor||"codemirror");h.setOpt({sourceEditorFirst:false});function c(m){return a[b.sourceEditor=="codemirror"&&window.CodeMirror?"codemirror":"textarea"](h,m)}var l;var j,f;h.commands.source={execCommand:function(){g=!g;if(g){f=h.selection.getRange().createAddress(false,true);h.undoManger&&h.undoManger.save(true);if(browser.gecko){h.body.contentEditable=false}l=h.iframe.style.cssText;h.iframe.style.cssText+="position:absolute;left:-32768px;top:-32768px;";h.fireEvent("beforegetcontent");var n=UE.htmlparser(h.body.innerHTML);h.filterOutputRule(n);n.traversal(function(s){if(s.type=="element"){switch(s.tagName){case"td":case"th":case"caption":if(s.children&&s.children.length==1){if(s.firstChild().tagName=="br"){s.removeChild(s.firstChild())}}break;case"pre":s.innerText(s.innerText().replace(/&nbsp;/g," "))}}});h.fireEvent("aftergetcontent");var p=n.toHtml(true);k=c(h.iframe.parentNode);k.setContent(p);d=h.setContent;h.setContent=function(t){var s=UE.htmlparser(t);h.filterInputRule(s);t=s.toHtml();k.setContent(t)};setTimeout(function(){k.select();h.addListener("fullscreenchanged",function(){try{k.getCodeMirror().refresh()}catch(s){}})});j=h.getContent;h.getContent=function(){return k.getContent()||"<p>"+(browser.ie?"":"<br/>")+"</p>"}}else{h.iframe.style.cssText=l;var m=k.getContent()||"<p>"+(browser.ie?"":"<br/>")+"</p>";m=m.replace(new RegExp("[\\r\\t\\n ]*</?(\\w+)\\s*(?:[^>]*)>","g"),function(t,s){if(s&&!dtd.$inlineWithA[s.toLowerCase()]){return t.replace(/(^[\n\r\t ]*)|([\n\r\t ]*$)/g,"")}return t.replace(/(^[\n\r\t]*)|([\n\r\t]*$)/g,"")});h.setContent=d;h.setContent(m);k.dispose();k=null;h.getContent=j;var r=h.body.firstChild;if(!r){h.body.innerHTML="<p>"+(browser.ie?"":"<br/>")+"</p>";r=h.body.firstChild}h.undoManger&&h.undoManger.save(true);if(browser.gecko){var o=document.createElement("input");o.style.cssText="position:absolute;left:0;top:-32768px";document.body.appendChild(o);h.body.contentEditable=false;setTimeout(function(){domUtils.setViewportOffset(o,{left:-32768,top:0});o.focus();setTimeout(function(){h.body.contentEditable=true;h.selection.getRange().moveToAddress(f).select(true);domUtils.remove(o)})})}else{try{h.selection.getRange().moveToAddress(f).select(true)}catch(q){}}}this.fireEvent("sourcemodechanged",g)},queryCommandState:function(){return g|0},notNeedUndo:1};var e=h.queryCommandState;h.queryCommandState=function(m){m=m.toLowerCase();if(g){return m in {source:1,fullscreen:1}?1:-1}return e.apply(this,arguments)};if(b.sourceEditor=="codemirror"){h.addListener("ready",function(){utils.loadFile(document,{src:b.codeMirrorJsUrl||b.UEDITOR_HOME_URL+"third-party/codemirror/codemirror.js",tag:"script",type:"text/javascript",defer:"defer"},function(){if(b.sourceEditorFirst){setTimeout(function(){h.execCommand("source")},0)}});utils.loadFile(document,{tag:"link",rel:"stylesheet",type:"text/css",href:b.codeMirrorCssUrl||b.UEDITOR_HOME_URL+"third-party/codemirror/codemirror.css"})})}}})();UE.plugins.enterkey=function(){var b,c=this,a=c.options.enterTag;c.addListener("keyup",function(m,n){var o=n.keyCode||n.which;if(o==13){var l=c.selection.getRange(),g=l.startContainer,d;if(!browser.ie){if(/h\d/i.test(b)){if(browser.gecko){var k=domUtils.findParentByTagName(g,["h1","h2","h3","h4","h5","h6","blockquote","caption","table"],true);if(!k){c.document.execCommand("formatBlock",false,"<p>");d=1}}else{if(g.nodeType==1){var j=c.document.createTextNode(""),e;l.insertNode(j);e=domUtils.findParentByTagName(j,"div",true);if(e){var f=c.document.createElement("p");while(e.firstChild){f.appendChild(e.firstChild)}e.parentNode.insertBefore(f,e);domUtils.remove(e);l.setStartBefore(j).setCursor();d=1}domUtils.remove(j)}}if(c.undoManger&&d){c.undoManger.save()}}browser.opera&&l.select()}else{c.fireEvent("saveScene",true,true)}}});c.addListener("keydown",function(j,l){var n=l.keyCode||l.which;if(n==13){if(c.fireEvent("beforeenterkeydown")){domUtils.preventDefault(l);return}c.fireEvent("saveScene",true,true);b="";var f=c.selection.getRange();if(!f.collapsed){var d=f.startContainer,e=f.endContainer,g=domUtils.findParentByTagName(d,"td",true),h=domUtils.findParentByTagName(e,"td",true);if(g&&h&&g!==h||!g&&h||g&&!h){l.preventDefault?l.preventDefault():(l.returnValue=false);return}}if(a=="p"){if(!browser.ie){d=domUtils.findParentByTagName(f.startContainer,["ol","ul","p","h1","h2","h3","h4","h5","h6","blockquote","caption"],true);if(!d&&!browser.opera){c.document.execCommand("formatBlock",false,"<p>");if(browser.gecko){f=c.selection.getRange();d=domUtils.findParentByTagName(f.startContainer,"p",true);d&&domUtils.removeDirtyAttr(d)}}else{b=d.tagName;d.tagName.toLowerCase()=="p"&&browser.gecko&&domUtils.removeDirtyAttr(d)}}}else{l.preventDefault?l.preventDefault():(l.returnValue=false);if(!f.collapsed){f.deleteContents();d=f.startContainer;if(d.nodeType==1&&(d=d.childNodes[f.startOffset])){while(d.nodeType==1){if(dtd.$empty[d.tagName]){f.setStartBefore(d).setCursor();if(c.undoManger){c.undoManger.save()}return false}if(!d.firstChild){var m=f.document.createElement("br");d.appendChild(m);f.setStart(d,0).setCursor();if(c.undoManger){c.undoManger.save()}return false}d=d.firstChild}if(d===f.startContainer.childNodes[f.startOffset]){m=f.document.createElement("br");f.insertNode(m).setCursor()}else{f.setStart(d,0).setCursor()}}else{m=f.document.createElement("br");f.insertNode(m).setStartAfter(m).setCursor()}}else{m=f.document.createElement("br");f.insertNode(m);var k=m.parentNode;if(k.lastChild===m){m.parentNode.insertBefore(m.cloneNode(true),m);f.setStartBefore(m)}else{f.setStartAfter(m)}f.setCursor()}}}})};UE.plugins.keystrokes=function(){var a=this;var b=true;a.addListener("keydown",function(c,o){var h=o.keyCode||o.which,f=a.selection.getRange();if(!f.collapsed&&!(o.ctrlKey||o.shiftKey||o.altKey||o.metaKey)&&(h>=65&&h<=90||h>=48&&h<=57||h>=96&&h<=111||{13:1,8:1,46:1}[h])){var v=f.startContainer;if(domUtils.isFillChar(v)){f.setStartBefore(v)}v=f.endContainer;if(domUtils.isFillChar(v)){f.setEndAfter(v)}f.txtToElmBoundary();if(f.endContainer&&f.endContainer.nodeType==1){v=f.endContainer.childNodes[f.endOffset];if(v&&domUtils.isBr(v)){f.setEndAfter(v)}}if(f.startOffset==0){v=f.startContainer;if(domUtils.isBoundaryNode(v,"firstChild")){v=f.endContainer;if(f.endOffset==(v.nodeType==3?v.nodeValue.length:v.childNodes.length)&&domUtils.isBoundaryNode(v,"lastChild")){a.fireEvent("saveScene");a.body.innerHTML="<p>"+(browser.ie?"":"<br/>")+"</p>";f.setStart(a.body.firstChild,0).setCursor(false,true);a._selectionChange();return}}}}if(h==keymap.Backspace){f=a.selection.getRange();b=f.collapsed;if(a.fireEvent("delkeydown",o)){return}var e,d;if(f.collapsed&&f.inFillChar()){e=f.startContainer;if(domUtils.isFillChar(e)){f.setStartBefore(e).shrinkBoundary(true).collapse(true);domUtils.remove(e)}else{e.nodeValue=e.nodeValue.replace(new RegExp("^"+domUtils.fillChar),"");f.startOffset--;f.collapse(true).select(true)}}if(e=f.getClosedNode()){a.fireEvent("saveScene");f.setStartBefore(e);domUtils.remove(e);f.setCursor();a.fireEvent("saveScene");domUtils.preventDefault(o);return}if(!browser.ie){e=domUtils.findParentByTagName(f.startContainer,"table",true);d=domUtils.findParentByTagName(f.endContainer,"table",true);if(e&&!d||!e&&d||e!==d){o.preventDefault();return}}}if(h==keymap.Tab){var j={ol:1,ul:1,table:1};if(a.fireEvent("tabkeydown",o)){domUtils.preventDefault(o);return}var l=a.selection.getRange();a.fireEvent("saveScene");for(var u=0,m="",p=a.options.tabSize||4,s=a.options.tabNode||"&nbsp;";u<p;u++){m+=s}var t=a.document.createElement("span");t.innerHTML=m+domUtils.fillChar;if(l.collapsed){l.insertNode(t.cloneNode(true).firstChild).setCursor(true)}else{var n=function(w){return domUtils.isBlockElm(w)&&!j[w.tagName.toLowerCase()]};e=domUtils.findParent(l.startContainer,n,true);d=domUtils.findParent(l.endContainer,n,true);if(e&&d&&e===d){l.deleteContents();l.insertNode(t.cloneNode(true).firstChild).setCursor(true)}else{var g=l.createBookmark();l.enlarge(true);var r=l.createBookmark(),q=domUtils.getNextDomNode(r.start,false,n);while(q&&!(domUtils.getPosition(q,r.end)&domUtils.POSITION_FOLLOWING)){q.insertBefore(t.cloneNode(true).firstChild,q.firstChild);q=domUtils.getNextDomNode(q,false,n)}l.moveToBookmark(r).moveToBookmark(g).select()}}domUtils.preventDefault(o)}if(browser.gecko&&h==46){l=a.selection.getRange();if(l.collapsed){e=l.startContainer;if(domUtils.isEmptyBlock(e)){var k=e.parentNode;while(domUtils.getChildCount(k)==1&&!domUtils.isBody(k)){e=k;k=k.parentNode}if(e===k.lastChild){o.preventDefault()}return}}}});a.addListener("keyup",function(h,k){var m=k.keyCode||k.which,c,g=this;if(m==keymap.Backspace){if(g.fireEvent("delkeyup")){return}c=g.selection.getRange();if(c.collapsed){var d,l=["h1","h2","h3","h4","h5","h6"];if(d=domUtils.findParentByTagName(c.startContainer,l,true)){if(domUtils.isEmptyBlock(d)){var e=d.previousSibling;if(e&&e.nodeName!="TABLE"){domUtils.remove(d);c.setStartAtLast(e).setCursor(false,true);return}else{var f=d.nextSibling;if(f&&f.nodeName!="TABLE"){domUtils.remove(d);c.setStartAtFirst(f).setCursor(false,true);return}}}}if(domUtils.isBody(c.startContainer)){var d=domUtils.createElement(g.document,"p",{innerHTML:browser.ie?domUtils.fillChar:"<br/>"});c.insertNode(d).setStart(d,0).setCursor(false,true)}}if(!b&&(c.startContainer.nodeType==3||c.startContainer.nodeType==1&&domUtils.isEmptyBlock(c.startContainer))){if(browser.ie){var j=c.document.createElement("span");c.insertNode(j).setStartBefore(j).collapse(true);c.select();domUtils.remove(j)}else{c.select()}}}})};UE.plugins.fiximgclick=(function(){var a=false;function b(){this.editor=null;this.resizer=null;this.cover=null;this.doc=document;this.prePos={x:0,y:0};this.startPos={x:0,y:0}}(function(){var c=[[0,0,-1,-1],[0,0,0,-1],[0,0,1,-1],[0,0,-1,0],[0,0,1,0],[0,0,-1,1],[0,0,0,1],[0,0,1,1]];b.prototype={init:function(d){var e=this;e.editor=d;e.startPos=this.prePos={x:0,y:0};e.dragId=-1;var h=[],f=e.cover=document.createElement("div"),g=e.resizer=document.createElement("div");f.id=e.editor.ui.id+"_imagescale_cover";f.style.cssText="position:absolute;display:none;z-index:"+(e.editor.options.zIndex)+";filter:alpha(opacity=0); opacity:0;background:#CCC;";domUtils.on(f,"mousedown click",function(){e.hide()});for(i=0;i<8;i++){h.push('<span class="edui-editor-imagescale-hand'+i+'"></span>')}g.id=e.editor.ui.id+"_imagescale";g.className="edui-editor-imagescale";g.innerHTML=h.join("");g.style.cssText+=";display:none;border:1px solid #3b77ff;z-index:"+(e.editor.options.zIndex)+";";e.editor.ui.getDom().appendChild(f);e.editor.ui.getDom().appendChild(g);e.initStyle();e.initEvents()},initStyle:function(){utils.cssRule("imagescale",".edui-editor-imagescale{display:none;position:absolute;border:1px solid #38B2CE;cursor:hand;-webkit-box-sizing: content-box;-moz-box-sizing: content-box;box-sizing: content-box;}.edui-editor-imagescale span{position:absolute;width:6px;height:6px;overflow:hidden;font-size:0px;display:block;background-color:#3C9DD0;}.edui-editor-imagescale .edui-editor-imagescale-hand0{cursor:nw-resize;top:0;margin-top:-4px;left:0;margin-left:-4px;}.edui-editor-imagescale .edui-editor-imagescale-hand1{cursor:n-resize;top:0;margin-top:-4px;left:50%;margin-left:-4px;}.edui-editor-imagescale .edui-editor-imagescale-hand2{cursor:ne-resize;top:0;margin-top:-4px;left:100%;margin-left:-3px;}.edui-editor-imagescale .edui-editor-imagescale-hand3{cursor:w-resize;top:50%;margin-top:-4px;left:0;margin-left:-4px;}.edui-editor-imagescale .edui-editor-imagescale-hand4{cursor:e-resize;top:50%;margin-top:-4px;left:100%;margin-left:-3px;}.edui-editor-imagescale .edui-editor-imagescale-hand5{cursor:sw-resize;top:100%;margin-top:-3px;left:0;margin-left:-4px;}.edui-editor-imagescale .edui-editor-imagescale-hand6{cursor:s-resize;top:100%;margin-top:-3px;left:50%;margin-left:-4px;}.edui-editor-imagescale .edui-editor-imagescale-hand7{cursor:se-resize;top:100%;margin-top:-3px;left:100%;margin-left:-3px;}")},initEvents:function(){var d=this;d.startPos.x=d.startPos.y=0;d.isDraging=false},_eventHandler:function(g){var f=this;switch(g.type){case"mousedown":var d=g.target||g.srcElement,d;if(d.className.indexOf("edui-editor-imagescale-hand")!=-1&&f.dragId==-1){f.dragId=d.className.slice(-1);f.startPos.x=f.prePos.x=g.clientX;f.startPos.y=f.prePos.y=g.clientY;domUtils.on(f.doc,"mousemove",f.proxy(f._eventHandler,f))}break;case"mousemove":if(f.dragId!=-1){f.updateContainerStyle(f.dragId,{x:g.clientX-f.prePos.x,y:g.clientY-f.prePos.y});f.prePos.x=g.clientX;f.prePos.y=g.clientY;a=true;f.updateTargetElement()}break;case"mouseup":if(f.dragId!=-1){f.updateContainerStyle(f.dragId,{x:g.clientX-f.prePos.x,y:g.clientY-f.prePos.y});f.updateTargetElement();if(f.target.parentNode){f.attachTo(f.target)}f.dragId=-1}domUtils.un(f.doc,"mousemove",f.proxy(f._eventHandler,f));if(a){a=false;f.editor.fireEvent("contentchange")}break;default:break}},updateTargetElement:function(){var d=this;domUtils.setStyles(d.target,{width:d.resizer.style.width,height:d.resizer.style.height});d.target.width=parseInt(d.resizer.style.width);d.target.height=parseInt(d.resizer.style.height);d.attachTo(d.target)},updateContainerStyle:function(d,h){var f=this,g=f.resizer,e;if(c[d][0]!=0){e=parseInt(g.style.left)+h.x;g.style.left=f._validScaledProp("left",e)+"px"}if(c[d][1]!=0){e=parseInt(g.style.top)+h.y;g.style.top=f._validScaledProp("top",e)+"px"}if(c[d][2]!=0){e=g.clientWidth+c[d][2]*h.x;g.style.width=f._validScaledProp("width",e)+"px"}if(c[d][3]!=0){e=g.clientHeight+c[d][3]*h.y;g.style.height=f._validScaledProp("height",e)+"px"}},_validScaledProp:function(g,f){var e=this.resizer,d=document;f=isNaN(f)?0:f;switch(g){case"left":return f<0?0:(f+e.clientWidth)>d.clientWidth?d.clientWidth-e.clientWidth:f;case"top":return f<0?0:(f+e.clientHeight)>d.clientHeight?d.clientHeight-e.clientHeight:f;case"width":return f<=0?1:(f+e.offsetLeft)>d.clientWidth?d.clientWidth-e.offsetLeft:f;case"height":return f<=0?1:(f+e.offsetTop)>d.clientHeight?d.clientHeight-e.offsetTop:f}},hideCover:function(){this.cover.style.display="none"},showCover:function(){var f=this,e=domUtils.getXY(f.editor.ui.getDom()),d=domUtils.getXY(f.editor.iframe);domUtils.setStyles(f.cover,{width:f.editor.iframe.offsetWidth+"px",height:f.editor.iframe.offsetHeight+"px",top:d.y-e.y+"px",left:d.x-e.x+"px",position:"absolute",display:""})},show:function(d){var e=this;e.resizer.style.display="block";if(d){e.attachTo(d)}domUtils.on(this.resizer,"mousedown",e.proxy(e._eventHandler,e));domUtils.on(e.doc,"mouseup",e.proxy(e._eventHandler,e));e.showCover();e.editor.fireEvent("afterscaleshow",e);e.editor.fireEvent("saveScene")},hide:function(){var d=this;d.hideCover();d.resizer.style.display="none";domUtils.un(d.resizer,"mousedown",d.proxy(d._eventHandler,d));domUtils.un(d.doc,"mouseup",d.proxy(d._eventHandler,d));d.editor.fireEvent("afterscalehide",d)},proxy:function(e,d){return function(f){return e.apply(d||this,arguments)}},attachTo:function(f){var h=this,j=h.target=f,k=this.resizer,g=domUtils.getXY(j),e=domUtils.getXY(h.editor.iframe),d=domUtils.getXY(k.parentNode);domUtils.setStyles(k,{width:j.width+"px",height:j.height+"px",left:e.x+g.x-h.editor.document.body.scrollLeft-d.x-parseInt(k.style.borderLeftWidth)+"px",top:e.y+g.y-h.editor.document.body.scrollTop-d.y-parseInt(k.style.borderTopWidth)+"px"})}}})();return function(){var d=this,c;d.setOpt("imageScaleEnabled",true);if(!browser.ie&&d.options.imageScaleEnabled){d.addListener("click",function(k,l){var h=d.selection.getRange(),g=h.getClosedNode();if(g&&g.tagName=="IMG"&&d.body.contentEditable!="false"){if(g.className.indexOf("edui-faked-music")!=-1||g.getAttribute("anchorname")||domUtils.hasClass(g,"loadingclass")||domUtils.hasClass(g,"loaderrorclass")){return}if(!c){c=new b();c.init(d);d.ui.getDom().appendChild(c.resizer);var j=function(n){c.hide();if(c.target){d.selection.getRange().selectNode(c.target).select()}},f=function(o){var n=o.target||o.srcElement;if(n&&(n.className===undefined||n.className.indexOf("edui-editor-imagescale")==-1)){j(o)}},m;d.addListener("afterscaleshow",function(n){d.addListener("beforekeydown",j);d.addListener("beforemousedown",f);domUtils.on(document,"keydown",j);domUtils.on(document,"mousedown",f);d.selection.getNative().removeAllRanges()});d.addListener("afterscalehide",function(o){d.removeListener("beforekeydown",j);d.removeListener("beforemousedown",f);domUtils.un(document,"keydown",j);domUtils.un(document,"mousedown",f);var n=c.target;if(n.parentNode){d.selection.getRange().selectNode(n).select()}});domUtils.on(c.resizer,"mousedown",function(o){d.selection.getNative().removeAllRanges();var n=o.target||o.srcElement;if(n&&n.className.indexOf("edui-editor-imagescale-hand")==-1){m=setTimeout(function(){c.hide();if(c.target){d.selection.getRange().selectNode(n).select()}},200)}});domUtils.on(c.resizer,"mouseup",function(o){var n=o.target||o.srcElement;if(n&&n.className.indexOf("edui-editor-imagescale-hand")==-1){clearTimeout(m)}})}c.show(g)}else{if(c&&c.resizer.style.display!="none"){c.hide()}}})}if(browser.webkit){d.addListener("click",function(g,h){if(h.target.tagName=="IMG"&&d.body.contentEditable!="false"){var f=new dom.Range(d.document);f.selectNode(h.target).select()}})}}})();UE.plugin.register("autolink",function(){var a=0;return !browser.ie?{bindEvents:{reset:function(){a=0},keydown:function(k,m){var j=this;var p=m.keyCode||m.which;if(p==32||p==13){var d=j.selection.getNative(),g=d.getRangeAt(0).cloneRange(),f,o;var c=g.startContainer;while(c.nodeType==1&&g.startOffset>0){c=g.startContainer.childNodes[g.startOffset-1];if(!c){break}g.setStart(c,c.nodeType==1?c.childNodes.length:c.nodeValue.length);g.collapse(true);c=g.startContainer}do{if(g.startOffset==0){c=g.startContainer.previousSibling;while(c&&c.nodeType==1){c=c.lastChild}if(!c||domUtils.isFillChar(c)){break}f=c.nodeValue.length}else{c=g.startContainer;f=g.startOffset}g.setStart(c,f-1);o=g.toString().charCodeAt(0)}while(o!=160&&o!=32);if(g.toString().replace(new RegExp(domUtils.fillChar,"g"),"").match(/(?:https?:\/\/|ssh:\/\/|ftp:\/\/|file:\/|www\.)/i)){while(g.toString().length){if(/^(?:https?:\/\/|ssh:\/\/|ftp:\/\/|file:\/|www\.)/i.test(g.toString())){break}try{g.setStart(g.startContainer,g.startOffset+1)}catch(h){var c=g.startContainer;while(!(next=c.nextSibling)){if(domUtils.isBody(c)){return}c=c.parentNode}g.setStart(next,0)}}if(domUtils.findParentByTagName(g.startContainer,"a",true)){return}var l=j.document.createElement("a"),n=j.document.createTextNode(" "),b;j.undoManger&&j.undoManger.save();l.appendChild(g.extractContents());l.href=l.innerHTML=l.innerHTML.replace(/<[^>]+>/g,"");b=l.getAttribute("href").replace(new RegExp(domUtils.fillChar,"g"),"");b=/^(?:https?:\/\/)/ig.test(b)?b:"http://"+b;l.setAttribute("_src",utils.html(b));l.href=utils.html(b);g.insertNode(l);l.parentNode.insertBefore(n,l.nextSibling);g.setStart(n,0);g.collapse(true);d.removeAllRanges();d.addRange(g);j.undoManger&&j.undoManger.save()}}}}}:{}},function(){var b={37:1,38:1,39:1,40:1,13:1,32:1};function a(d){if(d.nodeType==3){return null}if(d.nodeName=="A"){return d}var c=d.lastChild;while(c){if(c.nodeName=="A"){return c}if(c.nodeType==3){if(domUtils.isWhitespace(c)){c=c.previousSibling;continue}return null}c=c.lastChild}}browser.ie&&this.addListener("keyup",function(g,e){var f=this,j=e.keyCode;if(b[j]){var d=f.selection.getRange();var k=d.startContainer;if(j==13){while(k&&!domUtils.isBody(k)&&!domUtils.isBlockElm(k)){k=k.parentNode}if(k&&!domUtils.isBody(k)&&k.nodeName=="P"){var h=k.previousSibling;if(h&&h.nodeType==1){var h=a(h);if(h&&!h.getAttribute("_href")){domUtils.remove(h,true)}}}}else{if(j==32){if(k.nodeType==3&&/^\s$/.test(k.nodeValue)){k=k.previousSibling;if(k&&k.nodeName=="A"&&!k.getAttribute("_href")){domUtils.remove(k,true)}}}else{k=domUtils.findParentByTagName(k,"a",true);if(k&&!k.getAttribute("_href")){var c=d.createBookmark();domUtils.remove(k,true);d.moveToBookmark(c).select(true)}}}}})});UE.plugins.autoheight=function(){var d=this;d.autoHeightEnabled=d.options.autoHeightEnabled!==false;if(!d.autoHeightEnabled){return}var a,e=0,b=d.options,f,h;function g(){var j=this;clearTimeout(h);if(c){return}if(!j.queryCommandState||j.queryCommandState&&j.queryCommandState("source")!=1){h=setTimeout(function(){var k=j.body.lastChild;while(k&&k.nodeType!=1){k=k.previousSibling}if(k&&k.nodeType==1){k.style.clear="both";f=Math.max(domUtils.getXY(k).y+k.offsetHeight+25,Math.max(b.minFrameHeight,b.initialFrameHeight));if(f!=e){if(f!==parseInt(j.iframe.parentNode.style.height)){j.iframe.parentNode.style.height=f+"px"}j.body.style.height=f+"px";e=f}domUtils.removeStyle(k,"clear")}},50)}}var c;d.addListener("fullscreenchanged",function(k,j){c=j});d.addListener("destroy",function(){d.removeListener("contentchange afterinserthtml keyup mouseup",g)});d.enableAutoHeight=function(){var j=this;if(!j.autoHeightEnabled){return}var k=j.document;j.autoHeightEnabled=true;a=k.body.style.overflowY;k.body.style.overflowY="hidden";j.addListener("contentchange afterinserthtml keyup mouseup",g);setTimeout(function(){g.call(j)},browser.gecko?100:0);j.fireEvent("autoheightchanged",j.autoHeightEnabled)};d.disableAutoHeight=function(){d.body.style.overflowY=a||"";d.removeListener("contentchange",g);d.removeListener("keyup",g);d.removeListener("mouseup",g);d.autoHeightEnabled=false;d.fireEvent("autoheightchanged",d.autoHeightEnabled)};d.on("setHeight",function(){d.disableAutoHeight()});d.addListener("ready",function(){d.enableAutoHeight();var k;domUtils.on(browser.ie?d.body:d.document,browser.webkit?"dragover":"drop",function(){clearTimeout(k);k=setTimeout(function(){g.call(d)},100)});var j;window.onscroll=function(){if(j===null){j=this.scrollY}else{if(this.scrollY==0&&j!=0){d.window.scrollTo(0,0);j=null}}}})};UE.plugins.autofloat=function(){var s=this,t=s.getLang();s.setOpt({topOffset:0});var n=s.options.autoFloatEnabled!==false,l=s.options.topOffset;if(!n){return}var f=UE.ui.uiUtils,g=browser.ie&&browser.version<=6,m=browser.quirks;function a(){if(!UE.ui){alert(t.autofloatMsg);return 0}return 1}function h(){var u=document.body.style;u.backgroundImage='url("about:blank")';u.backgroundAttachment="fixed"}var j,o=document.createElement("div"),d,c,r,p=true;function k(){var v=domUtils.getXY(d),u=domUtils.getComputedStyle(d,"position"),w=domUtils.getComputedStyle(d,"left");d.style.width=d.offsetWidth+"px";d.style.zIndex=s.options.zIndex*1+1;d.parentNode.insertBefore(o,d);if(g||(m&&browser.ie)){if(d.style.position!="absolute"){d.style.position="absolute"}d.style.top=(document.body.scrollTop||document.documentElement.scrollTop)-c+l+"px"}else{if(browser.ie7Compat&&p){p=false;d.style.left=domUtils.getXY(d).x-document.documentElement.getBoundingClientRect().left+2+"px"}if(d.style.position!="fixed"){d.style.position="fixed";d.style.top=l+"px";((u=="absolute"||u=="relative")&&parseFloat(w))&&(d.style.left=v.x+"px")}}}function e(){p=true;if(o.parentNode){o.parentNode.removeChild(o)}d.style.cssText=j}function b(){var u=r(s.container);var v=s.options.toolbarTopOffset||0;if(u.top<0&&u.bottom-d.offsetHeight>v){k()}else{e()}}var q=utils.defer(function(){b()},browser.ie?200:100,true);s.addListener("destroy",function(){domUtils.un(window,["scroll","resize"],b);s.removeListener("keydown",q)});s.addListener("ready",function(){if(a(s)){if(!s.ui){return}r=f.getClientRect;d=s.ui.getDom("toolbarbox");c=r(d).top;j=d.style.cssText;o.style.height=d.offsetHeight+"px";if(g){h()}domUtils.on(window,["scroll","resize"],b);s.addListener("keydown",q);s.addListener("beforefullscreenchange",function(v,u){if(u){e()}});s.addListener("fullscreenchanged",function(v,u){if(!u){b()}});s.addListener("sourcemodechanged",function(v,u){setTimeout(function(){b()},0)});s.addListener("clearDoc",function(){setTimeout(function(){b()},0)})}})};UE.plugins.video=function(){var c=this;function b(d,f,m,e,j,h,l){d=utils.unhtmlForUrl(d);j=utils.unhtml(j);h=utils.unhtml(h);f=parseInt(f,10)||0;m=parseInt(m,10)||0;var k;switch(l){case"image":k="<img "+(e?'id="'+e+'"':"")+' width="'+f+'" height="'+m+'" _url="'+d+'" class="'+h.replace(/\bvideo-js\b/,"")+'" src="'+c.options.UEDITOR_HOME_URL+'themes/default/images/spacer.gif" style="background:url('+c.options.UEDITOR_HOME_URL+"themes/default/images/videologo.gif) no-repeat center center; border:1px solid gray;"+(j?"float:"+j+";":"")+'" />';break;case"embed":k='<embed type="application/x-shockwave-flash" class="'+h+'" pluginspage="http://www.macromedia.com/go/getflashplayer" src="'+utils.html(d)+'" width="'+f+'" height="'+m+'"'+(j?' style="float:'+j+'"':"")+' wmode="transparent" play="true" loop="false" menu="false" allowscriptaccess="never" allowfullscreen="true" >';break;case"video":var g=d.substr(d.lastIndexOf(".")+1);if(g=="ogv"){g="ogg"}k="<video"+(e?' id="'+e+'"':"")+' class="'+h+' video-js" '+(j?' style="float:'+j+'"':"")+' controls preload="none" width="'+f+'" height="'+m+'" src="'+d+'" data-setup="{}"><source src="'+d+'" type="video/'+g+'" /></video>';break}return k}function a(d,e){utils.each(d.getNodesByTagName(e?"img":"embed video"),function(h){var g=h.getAttr("class");if(g&&g.indexOf("edui-faked-video")!=-1){var f=b(e?h.getAttr("_url"):h.getAttr("src"),h.getAttr("width"),h.getAttr("height"),null,h.getStyle("float")||"",g,e?"embed":"image");h.parentNode.replaceChild(UE.uNode.createElement(f),h)}if(g&&g.indexOf("edui-upload-video")!=-1){var f=b(e?h.getAttr("_url"):h.getAttr("src"),h.getAttr("width"),h.getAttr("height"),null,h.getStyle("float")||"",g,e?"video":"image");h.parentNode.replaceChild(UE.uNode.createElement(f),h)}})}c.addOutputRule(function(d){a(d,true)});c.addInputRule(function(d){a(d)});c.commands.insertvideo={execCommand:function(f,m,n){m=utils.isArray(m)?m:[m];var k=[],e="tmpVedio",o;for(var j=0,g,l=m.length;j<l;j++){g=m[j];o=(n=="upload"?"edui-upload-video video-js vjs-default-skin":"edui-faked-video");k.push(b(g.url,g.width||420,g.height||280,e+j,null,o,"image"))}c.execCommand("inserthtml",k.join(""),true);var d=this.selection.getRange();for(var j=0,l=m.length;j<l;j++){var h=this.document.getElementById("tmpVedio"+j);domUtils.removeAttributes(h,"id");d.selectNode(h).select();c.execCommand("imagefloat",m[j].align)}},queryCommandState:function(){var e=c.selection.getRange().getClosedNode(),d=e&&(e.className=="edui-faked-video"||e.className.indexOf("edui-upload-video")!=-1);return d?1:0}}};(function(){var b=UE.UETable=function(c){this.table=c;this.indexTable=[];this.selectedTds=[];this.cellsRange={};this.update(c)};b.removeSelectedClass=function(c){utils.each(c,function(d){domUtils.removeClasses(d,"selectTdClass")})};b.addSelectedClass=function(c){utils.each(c,function(d){domUtils.addClass(d,"selectTdClass")})};b.isEmptyBlock=function(e){var d=new RegExp(domUtils.fillChar,"g");if(e[browser.ie?"innerText":"textContent"].replace(/^\s*$/,"").replace(d,"").length>0){return 0}for(var c in dtd.$isNotEmpty){if(dtd.$isNotEmpty.hasOwnProperty(c)){if(e.getElementsByTagName(c).length){return 0}}}return 1};b.getWidth=function(c){if(!c){return 0}return parseInt(domUtils.getComputedStyle(c,"width"),10)};b.getTableCellAlignState=function(f){!utils.isArray(f)&&(f=[f]);var d={},e=["align","valign"],g=null,c=true;utils.each(f,function(h){utils.each(e,function(j){g=h.getAttribute(j);if(!d[j]&&g){d[j]=g}else{if(!d[j]||(g!==d[j])){c=false;return false}}});return c});return c?d:null};b.getTableItemsByRange=function(e){var h=e.selection.getStart();if(h&&h.id&&h.id.indexOf("_baidu_bookmark_start_")===0&&h.nextSibling){h=h.nextSibling}var c=h&&domUtils.findParentByTagName(h,["td","th"],true),g=c&&c.parentNode,d=h&&domUtils.findParentByTagName(h,"caption",true),f=d?d.parentNode:g&&g.parentNode.parentNode;return{cell:c,tr:g,table:f,caption:d}};b.getUETableBySelected=function(c){var d=b.getTableItemsByRange(c).table;if(d&&d.ueTable&&d.ueTable.selectedTds.length){return d.ueTable}return null};b.getDefaultValue=function(e,f){var k={thin:"0px",medium:"1px",thick:"2px"},d,h,g,c;if(!f){f=e.document.createElement("table");f.insertRow(0).insertCell(0).innerHTML="xxx";e.body.appendChild(f);var j=f.getElementsByTagName("td")[0];c=domUtils.getComputedStyle(f,"border-left-width");d=parseInt(k[c]||c,10);c=domUtils.getComputedStyle(j,"padding-left");h=parseInt(k[c]||c,10);c=domUtils.getComputedStyle(j,"border-left-width");g=parseInt(k[c]||c,10);domUtils.remove(f);return{tableBorder:d,tdPadding:h,tdBorder:g}}else{j=f.getElementsByTagName("td")[0];c=domUtils.getComputedStyle(f,"border-left-width");d=parseInt(k[c]||c,10);c=domUtils.getComputedStyle(j,"padding-left");h=parseInt(k[c]||c,10);c=domUtils.getComputedStyle(j,"border-left-width");g=parseInt(k[c]||c,10);return{tableBorder:d,tdPadding:h,tdBorder:g}}};b.getUETable=function(d){var c=d.tagName.toLowerCase();d=(c=="td"||c=="th"||c=="caption")?domUtils.findParentByTagName(d,"table",true):d;if(!d.ueTable){d.ueTable=new b(d)}return d.ueTable};b.cloneCell=function(c,f,e){if(!c||utils.isString(c)){return this.table.ownerDocument.createElement(c||"td")}var d=domUtils.hasClass(c,"selectTdClass");d&&domUtils.removeClasses(c,"selectTdClass");var g=c.cloneNode(true);if(f){g.rowSpan=g.colSpan=1}!e&&domUtils.removeAttributes(g,"width height");!e&&domUtils.removeAttributes(g,"style");g.style.borderLeftStyle="";g.style.borderTopStyle="";g.style.borderLeftColor=c.style.borderRightColor;g.style.borderLeftWidth=c.style.borderRightWidth;g.style.borderTopColor=c.style.borderBottomColor;g.style.borderTopWidth=c.style.borderBottomWidth;d&&domUtils.addClass(c,"selectTdClass");return g};b.prototype={getMaxRows:function(){var h=this.table.rows,c=1;for(var f=0,k;k=h[f];f++){var g=1;for(var e=0,d;d=k.cells[e++];){g=Math.max(d.rowSpan||1,g)}c=Math.max(g+f,c)}return c},getMaxCols:function(){var n=this.table.rows,e=0,c={};for(var h=0,m;m=n[h];h++){var d=0;for(var g=0,l;l=m.cells[g++];){d+=(l.colSpan||1);if(l.rowSpan&&l.rowSpan>1){for(var f=1;f<l.rowSpan;f++){if(!c["row_"+(h+f)]){c["row_"+(h+f)]=(l.colSpan||1)}else{c["row_"+(h+f)]++}}}}d+=c["row_"+h]||0;e=Math.max(d,e)}return e},getCellColIndex:function(c){},getHSideCell:function(d,j){try{var h=this.getCellInfo(d),g,l;var c=this.selectedTds.length,f=this.cellsRange;if((!j&&(!c?!h.colIndex:!f.beginColIndex))||(j&&(!c?(h.colIndex==(this.colsNum-1)):(f.endColIndex==this.colsNum-1)))){return null}g=!c?h.rowIndex:f.beginRowIndex;l=!j?(!c?(h.colIndex<1?0:(h.colIndex-1)):f.beginColIndex-1):(!c?h.colIndex+1:f.endColIndex+1);return this.getCell(this.indexTable[g][l].rowIndex,this.indexTable[g][l].cellIndex)}catch(k){a(k)}},getTabNextCell:function(c,k){var f=this.getCellInfo(c),j=k||f.rowIndex,d=f.colIndex+1+(f.colSpan-1),g;try{g=this.getCell(this.indexTable[j][d].rowIndex,this.indexTable[j][d].cellIndex)}catch(h){try{j=j*1+1;d=0;g=this.getCell(this.indexTable[j][d].rowIndex,this.indexTable[j][d].cellIndex)}catch(h){}}return g},getVSideCell:function(m,c,h){try{var f=this.getCellInfo(m),l,d;var j=this.selectedTds.length&&!h,g=this.cellsRange;if((!c&&(f.rowIndex==0))||(c&&(!j?(f.rowIndex+f.rowSpan>this.rowsNum-1):(g.endRowIndex==this.rowsNum-1)))){return null}l=!c?(!j?f.rowIndex-1:g.beginRowIndex-1):(!j?(f.rowIndex+f.rowSpan):g.endRowIndex+1);d=!j?f.colIndex:g.beginColIndex;return this.getCell(this.indexTable[l][d].rowIndex,this.indexTable[l][d].cellIndex)}catch(k){a(k)}},getSameEndPosCells:function(o,d){try{var l=(d.toLowerCase()==="x"),f=domUtils.getXY(o)[l?"x":"y"]+o["offset"+(l?"Width":"Height")],q=this.table.rows,p=null,m=[];for(var h=0;h<this.rowsNum;h++){p=q[h].cells;for(var g=0,n;n=p[g++];){var c=domUtils.getXY(n)[l?"x":"y"]+n["offset"+(l?"Width":"Height")];if(c>f&&l){break}if(o==n||f==c){if(n[l?"colSpan":"rowSpan"]==1){m.push(n)}if(l){break}}}}return m}catch(k){a(k)}},setCellContent:function(c,d){c.innerHTML=d||(browser.ie?domUtils.fillChar:"<br />")},cloneCell:b.cloneCell,getSameStartPosXCells:function(m){try{var c=domUtils.getXY(m).x+m.offsetWidth,o=this.table.rows,n,k=[];for(var f=0;f<this.rowsNum;f++){n=o[f].cells;for(var d=0,l;l=n[d++];){var g=domUtils.getXY(l).x;if(g>c){break}if(g==c&&l.colSpan==1){k.push(l);break}}}return k}catch(h){a(h)}},update:function(A){this.table=A||this.table;this.selectedTds=[];this.cellsRange={};this.indexTable=[];var p=this.table.rows,B=this.getMaxRows(),s=B-p.length,e=this.getMaxCols();while(s--){this.table.insertRow(p.length)}this.rowsNum=B;this.colsNum=e;for(var y=0,z=p.length;y<z;y++){this.indexTable[y]=new Array(e)}for(var q=0,m;m=p[q];q++){for(var o=0,c,g=m.cells;c=g[o];o++){if(c.rowSpan>B){c.rowSpan=B}var t=o,h=c.rowSpan||1,n=c.colSpan||1;while(this.indexTable[q][t]){t++}for(var w=0;w<h;w++){for(var u=0;u<n;u++){this.indexTable[q+w][t+u]={rowIndex:q,cellIndex:o,colIndex:t,rowSpan:h,colSpan:n}}}}}for(w=0;w<B;w++){for(u=0;u<e;u++){if(this.indexTable[w][u]===undefined){m=p[w];c=m.cells[m.cells.length-1];c=c?c.cloneNode(true):this.table.ownerDocument.createElement("td");this.setCellContent(c);if(c.colSpan!==1){c.colSpan=1}if(c.rowSpan!==1){c.rowSpan=1}m.appendChild(c);this.indexTable[w][u]={rowIndex:w,cellIndex:c.cellIndex,colIndex:u,rowSpan:1,colSpan:1}}}}var x=domUtils.getElementsByTagName(this.table,"td"),r=[];utils.each(x,function(j){if(domUtils.hasClass(j,"selectTdClass")){r.push(j)}});if(r.length){var l=r[0],f=r[r.length-1],d=this.getCellInfo(l),v=this.getCellInfo(f);this.selectedTds=r;this.cellsRange={beginRowIndex:d.rowIndex,beginColIndex:d.colIndex,endRowIndex:v.rowIndex+v.rowSpan-1,endColIndex:v.colIndex+v.colSpan-1}}if(!domUtils.hasClass(this.table.rows[0],"firstRow")){domUtils.addClass(this.table.rows[0],"firstRow");for(var y=1;y<this.table.rows.length;y++){domUtils.removeClasses(this.table.rows[y],"firstRow")}}},getCellInfo:function(c){if(!c){return}var f=c.cellIndex,j=c.parentNode.rowIndex,g=this.indexTable[j],h=this.colsNum;for(var e=f;e<h;e++){var d=g[e];if(d.rowIndex===j&&d.cellIndex===f){return d}}},getCell:function(d,c){return d<this.rowsNum&&this.table.rows[d].cells[c]||null},deleteCell:function(c,e){e=typeof e=="number"?e:c.parentNode.rowIndex;var d=this.table.rows[e];d.deleteCell(c.cellIndex)},getCellsRange:function(d,c){function h(y,q,r,t){var s=y,u=q,w=r,e=t,p,x,v;if(y>0){for(x=q;x<t;x++){p=n.indexTable[y][x];v=p.rowIndex;if(v<y){s=Math.min(v,s)}}}if(t<n.colsNum){for(v=y;v<r;v++){p=n.indexTable[v][t];x=p.colIndex+p.colSpan-1;if(x>t){e=Math.max(x,e)}}}if(r<n.rowsNum){for(x=q;x<t;x++){p=n.indexTable[r][x];v=p.rowIndex+p.rowSpan-1;if(v>r){w=Math.max(v,w)}}}if(q>0){for(v=y;v<r;v++){p=n.indexTable[v][q];x=p.colIndex;if(x<q){u=Math.min(p.colIndex,u)}}}if(s!=y||u!=q||w!=r||e!=t){return h(s,u,w,e)}else{return{beginRowIndex:y,beginColIndex:q,endRowIndex:r,endColIndex:t}}}try{var n=this,g=n.getCellInfo(d);if(d===c){return{beginRowIndex:g.rowIndex,beginColIndex:g.colIndex,endRowIndex:g.rowIndex+g.rowSpan-1,endColIndex:g.colIndex+g.colSpan-1}}var f=n.getCellInfo(c);var o=Math.min(g.rowIndex,f.rowIndex),j=Math.min(g.colIndex,f.colIndex),k=Math.max(g.rowIndex+g.rowSpan-1,f.rowIndex+f.rowSpan-1),l=Math.max(g.colIndex+g.colSpan-1,f.colIndex+f.colSpan-1);return h(o,j,k,l)}catch(m){}},getCells:function(h){this.clearSelected();var q=h.beginRowIndex,d=h.beginColIndex,g=h.endRowIndex,k=h.endColIndex,c,m,p,l={},o=[];for(var f=q;f<=g;f++){for(var e=d;e<=k;e++){c=this.indexTable[f][e];m=c.rowIndex;p=c.colIndex;var n=m+"|"+p;if(l[n]){continue}l[n]=1;if(m<f||p<e||m+c.rowSpan-1>g||p+c.colSpan-1>k){return null}o.push(this.getCell(m,c.cellIndex))}}return o},clearSelected:function(){b.removeSelectedClass(this.selectedTds);this.selectedTds=[];this.cellsRange={}},setSelected:function(c){var d=this.getCells(c);b.addSelectedClass(d);this.selectedTds=d;this.cellsRange=c},isFullRow:function(){var c=this.cellsRange;return(c.endColIndex-c.beginColIndex+1)==this.colsNum},isFullCol:function(){var d=this.cellsRange,e=this.table,c=e.getElementsByTagName("th"),f=d.endRowIndex-d.beginRowIndex+1;return !c.length?f==this.rowsNum:f==this.rowsNum||(f==this.rowsNum-1)},getNextCell:function(m,c,h){try{var f=this.getCellInfo(m),l,d;var j=this.selectedTds.length&&!h,g=this.cellsRange;if((!c&&(f.rowIndex==0))||(c&&(!j?(f.rowIndex+f.rowSpan>this.rowsNum-1):(g.endRowIndex==this.rowsNum-1)))){return null}l=!c?(!j?f.rowIndex-1:g.beginRowIndex-1):(!j?(f.rowIndex+f.rowSpan):g.endRowIndex+1);d=!j?f.colIndex:g.beginColIndex;return this.getCell(this.indexTable[l][d].rowIndex,this.indexTable[l][d].cellIndex)}catch(k){a(k)}},getPreviewCell:function(d,l){try{var h=this.getCellInfo(d),g,k;var c=this.selectedTds.length,f=this.cellsRange;if((!l&&(!c?!h.colIndex:!f.beginColIndex))||(l&&(!c?(h.rowIndex>(this.colsNum-1)):(f.endColIndex==this.colsNum-1)))){return null}g=!l?(!c?h.rowIndex:f.beginRowIndex):(!c?(h.rowIndex<1?0:(h.rowIndex-1)):f.beginRowIndex);k=!l?(!c?(h.colIndex<1?0:(h.colIndex-1)):f.beginColIndex-1):(!c?h.colIndex:f.endColIndex+1);return this.getCell(this.indexTable[g][k].rowIndex,this.indexTable[g][k].cellIndex)}catch(j){a(j)}},moveContent:function(d,c){if(b.isEmptyBlock(c)){return}if(b.isEmptyBlock(d)){d.innerHTML=c.innerHTML;return}var e=d.lastChild;if(e.nodeType==3||!dtd.$block[e.tagName]){d.appendChild(d.ownerDocument.createElement("br"))}while(e=c.firstChild){d.appendChild(e)}},mergeRight:function(c){var f=this.getCellInfo(c),e=f.colIndex+f.colSpan,d=this.indexTable[f.rowIndex][e],g=this.getCell(d.rowIndex,d.cellIndex);c.colSpan=f.colSpan+d.colSpan;c.removeAttribute("width");this.moveContent(c,g);this.deleteCell(g,d.rowIndex);this.update()},mergeDown:function(c){var e=this.getCellInfo(c),g=e.rowIndex+e.rowSpan,f=this.indexTable[g][e.colIndex],d=this.getCell(f.rowIndex,f.cellIndex);c.rowSpan=e.rowSpan+f.rowSpan;c.removeAttribute("height");this.moveContent(c,d);this.deleteCell(d,f.rowIndex);this.update()},mergeRange:function(){var f=this.cellsRange,g=this.getCell(f.beginRowIndex,this.indexTable[f.beginRowIndex][f.beginColIndex].cellIndex);if(g.tagName=="TH"&&f.endRowIndex!==f.beginRowIndex){var j=this.indexTable,d=this.getCellInfo(g);g=this.getCell(1,j[1][d.colIndex].cellIndex);f=this.getCellsRange(g,this.getCell(j[this.rowsNum-1][d.colIndex].rowIndex,j[this.rowsNum-1][d.colIndex].cellIndex))}var l=this.getCells(f);for(var e=0,n;n=l[e++];){if(n!==g){this.moveContent(g,n);this.deleteCell(n)}}g.rowSpan=f.endRowIndex-f.beginRowIndex+1;g.rowSpan>1&&g.removeAttribute("height");g.colSpan=f.endColIndex-f.beginColIndex+1;g.colSpan>1&&g.removeAttribute("width");if(g.rowSpan==this.rowsNum&&g.colSpan!=1){g.colSpan=1}if(g.colSpan==this.colsNum&&g.rowSpan!=1){var k=g.parentNode.rowIndex;if(this.table.deleteRow){for(var e=k+1,c=k+1,h=g.rowSpan;e<h;e++){this.table.deleteRow(c)}}else{for(var e=0,h=g.rowSpan-1;e<h;e++){var m=this.table.rows[k+1];m.parentNode.removeChild(m)}}g.rowSpan=1}this.update()},insertRow:function(h,m){var e=this.colsNum,n=this.table,o=n.insertRow(h),l,c=typeof m=="string"&&m.toUpperCase()=="TH";function f(r,q,p){if(r==0){var t=p.nextSibling||p.previousSibling,s=t.cells[r];if(s.tagName=="TH"){s=q.ownerDocument.createElement("th");s.appendChild(q.firstChild);p.insertBefore(s,q);domUtils.remove(q)}}else{if(q.tagName=="TH"){var u=q.ownerDocument.createElement("td");u.appendChild(q.firstChild);p.insertBefore(u,q);domUtils.remove(q)}}}if(h==0||h==this.rowsNum){for(var k=0;k<e;k++){l=this.cloneCell(m,true);this.setCellContent(l);l.getAttribute("vAlign")&&l.setAttribute("vAlign",l.getAttribute("vAlign"));o.appendChild(l);if(!c){f(k,l,o)}}}else{var j=this.indexTable[h],g=0;for(k=0;k<e;k++){var d=j[k];if(d.rowIndex<h){l=this.getCell(d.rowIndex,d.cellIndex);l.rowSpan=d.rowSpan+1}else{l=this.cloneCell(m,true);this.setCellContent(l);o.appendChild(l)}if(!c){f(k,l,o)}}}this.update();return o},deleteRow:function(q){var m=this.table.rows[q],n=this.indexTable[q],h=this.colsNum,o=0;for(var r=0;r<h;){var p=n[r],d=this.getCell(p.rowIndex,p.cellIndex);if(d.rowSpan>1){if(p.rowIndex==q){var t=d.cloneNode(true);t.rowSpan=d.rowSpan-1;t.innerHTML="";d.rowSpan=1;var k=q+1,s=this.table.rows[k],u,e=this.getPreviewMergedCellsNum(k,r)-o;if(e<r){u=r-e-1;domUtils.insertAfter(s.cells[u],t)}else{if(s.cells.length){s.insertBefore(t,s.cells[0])}}o+=1}}r+=d.colSpan||1}var f=[],l={};for(r=0;r<h;r++){var j=n[r].rowIndex,g=n[r].cellIndex,v=j+"_"+g;if(l[v]){continue}l[v]=1;d=this.getCell(j,g);f.push(d)}var c=[];utils.each(f,function(w){if(w.rowSpan==1){w.parentNode.removeChild(w)}else{c.push(w)}});utils.each(c,function(w){w.rowSpan--});m.parentNode.removeChild(m);this.update()},insertCol:function(m,o,k){var c=this.rowsNum,l=0,f,n,h=parseInt((this.table.offsetWidth-(this.colsNum+1)*20-(this.colsNum+1))/(this.colsNum+1),10),e=typeof o=="string"&&o.toUpperCase()=="TH";function j(t,q,p){if(t==0){var r=q.nextSibling||q.previousSibling;if(r.tagName=="TH"){r=q.ownerDocument.createElement("th");r.appendChild(q.firstChild);p.insertBefore(r,q);domUtils.remove(q)}}else{if(q.tagName=="TH"){var s=q.ownerDocument.createElement("td");s.appendChild(q.firstChild);p.insertBefore(s,q);domUtils.remove(q)}}}var d;if(m==0||m==this.colsNum){for(;l<c;l++){f=this.table.rows[l];d=f.cells[m==0?m:f.cells.length];n=this.cloneCell(o,true);this.setCellContent(n);n.setAttribute("vAlign",n.getAttribute("vAlign"));d&&n.setAttribute("width",d.getAttribute("width"));if(!m){f.insertBefore(n,f.cells[0])}else{domUtils.insertAfter(f.cells[f.cells.length-1],n)}if(!e){j(l,n,f)}}}else{for(;l<c;l++){var g=this.indexTable[l][m];if(g.colIndex<m){n=this.getCell(g.rowIndex,g.cellIndex);n.colSpan=g.colSpan+1}else{f=this.table.rows[l];d=f.cells[g.cellIndex];n=this.cloneCell(o,true);this.setCellContent(n);n.setAttribute("vAlign",n.getAttribute("vAlign"));d&&n.setAttribute("width",d.getAttribute("width"));d?f.insertBefore(n,d):f.appendChild(n)}if(!e){j(l,n,f)}}}this.update();this.updateWidth(h,k||{tdPadding:10,tdBorder:1})},updateWidth:function(f,d){var g=this.table,c=b.getWidth(g)-d.tdPadding*2-d.tdBorder+f;if(c<g.ownerDocument.body.offsetWidth){g.setAttribute("width",c);return}var e=domUtils.getElementsByTagName(this.table,"td th");utils.each(e,function(h){h.setAttribute("width",f)})},deleteCol:function(m){var d=this.indexTable,h=this.table.rows,f=this.table.getAttribute("width"),o=0,c=this.rowsNum,n={};for(var g=0;g<c;){var j=d[g],e=j[m],l=e.rowIndex+"_"+e.colIndex;if(n[l]){continue}n[l]=1;var k=this.getCell(e.rowIndex,e.cellIndex);if(!o){o=k&&parseInt(k.offsetWidth/k.colSpan,10).toFixed(0)}if(k.colSpan>1){k.colSpan--}else{h[g].deleteCell(e.cellIndex)}g+=e.rowSpan||1}this.table.setAttribute("width",f-o);this.update()},splitToCells:function(c){var e=this,d=this.splitToRows(c);utils.each(d,function(f){e.splitToCols(f)})},splitToRows:function(l){var d=this.getCellInfo(l),h=d.rowIndex,k=d.colIndex,f=[];l.rowSpan=1;f.push(l);for(var g=h,e=h+d.rowSpan;g<e;g++){if(g==h){continue}var c=this.table.rows[g],j=c.insertCell(k-this.getPreviewMergedCellsNum(g,k));j.colSpan=d.colSpan;this.setCellContent(j);j.setAttribute("vAlign",l.getAttribute("vAlign"));j.setAttribute("align",l.getAttribute("align"));if(l.style.cssText){j.style.cssText=l.style.cssText}f.push(j)}this.update();return f},getPreviewMergedCellsNum:function(j,e){var h=this.indexTable[j],d=0;for(var f=0;f<e;){var g=h[f].colSpan,c=h[f].rowIndex;d+=(g-(c==j?1:0));f+=g}return d},splitToCols:function(o){var f=(o.offsetWidth/o.colSpan-22).toFixed(0),e=this.getCellInfo(o),l=e.rowIndex,n=e.colIndex,h=[];o.colSpan=1;o.setAttribute("width",f);h.push(o);for(var g=n,k=n+e.colSpan;g<k;g++){if(g==n){continue}var d=this.table.rows[l],m=d.insertCell(this.indexTable[l][g].cellIndex+1);m.rowSpan=e.rowSpan;this.setCellContent(m);m.setAttribute("vAlign",o.getAttribute("vAlign"));m.setAttribute("align",o.getAttribute("align"));m.setAttribute("width",f);if(o.style.cssText){m.style.cssText=o.style.cssText}if(o.tagName=="TH"){var c=o.ownerDocument.createElement("th");c.appendChild(m.firstChild);c.setAttribute("vAlign",o.getAttribute("vAlign"));c.rowSpan=m.rowSpan;d.insertBefore(c,m);domUtils.remove(m)}h.push(m)}this.update();return h},isLastCell:function(d,f,c){f=f||this.rowsNum;c=c||this.colsNum;var e=this.getCellInfo(d);return((e.rowIndex+e.rowSpan)==f)&&((e.colIndex+e.colSpan)==c)},getLastCell:function(c){c=c||this.table.getElementsByTagName("td");var k=this.getCellInfo(c[0]);var f=this,e=c[0],h=e.parentNode,d=0,j=0,g;utils.each(c,function(l){if(l.parentNode==h){j+=l.colSpan||1}d+=l.rowSpan*l.colSpan||1});g=d/j;utils.each(c,function(l){if(f.isLastCell(l,g,j)){e=l;return false}});return e},selectRow:function(g){var e=this.indexTable[g],f=this.getCell(e[0].rowIndex,e[0].cellIndex),c=this.getCell(e[this.colsNum-1].rowIndex,e[this.colsNum-1].cellIndex),d=this.getCellsRange(f,c);this.setSelected(d)},selectTable:function(){var d=this.table.getElementsByTagName("td"),c=this.getCellsRange(d[0],d[d.length-1]);this.setSelected(c)},setBackground:function(l,h){if(typeof h==="string"){utils.each(l,function(m){m.style.backgroundColor=h})}else{if(typeof h==="object"){h=utils.extend({repeat:true,colorList:["#ddd","#fff"]},h);var g=this.getCellInfo(l[0]).rowIndex,f=0,c=h.colorList,k=function(o,m,n){return o[m]?o[m]:n?o[m%o.length]:""};for(var e=0,j;j=l[e++];){var d=this.getCellInfo(j);j.style.backgroundColor=k(c,((g+f)==d.rowIndex)?f:++f,h.repeat)}}}},removeBackground:function(c){utils.each(c,function(d){d.style.backgroundColor=""})}};function a(c){}})();(function(){var g=UE.UETable,c=function(j){return g.getTableItemsByRange(j)},h=function(j){return g.getUETableBySelected(j)},b=function(j,k){return g.getDefaultValue(j,k)},a=function(j){return g.getUETable(j)};UE.commands.inserttable={queryCommandState:function(){return c(this).table?-1:0},execCommand:function(l,k){function r(v,z){var u=[],x=v.numRows,t=v.numCols;for(var w=0;w<x;w++){u.push("<tr"+(w==0?' class="firstRow"':"")+">");for(var y=0;y<t;y++){u.push('<td width="'+z+'"  vAlign="'+v.tdvalign+'" >'+(browser.ie&&browser.version<11?domUtils.fillChar:"<br/>")+"</td>")}u.push("</tr>")}return"<table><tbody>"+u.join("")+"</tbody></table>"}if(!k){k=utils.extend({},{numCols:this.options.defaultCols,numRows:this.options.defaultRows,tdvalign:this.options.tdvalign})}var p=this;var m=this.selection.getRange(),j=m.startContainer,s=domUtils.findParent(j,function(t){return domUtils.isBlockElm(t)},true)||p.body;var q=b(p),o=s.offsetWidth,n=Math.floor(o/k.numCols-q.tdPadding*2-q.tdBorder);!k.tdvalign&&(k.tdvalign=p.options.tdvalign);p.execCommand("inserthtml",r(k,n))}};UE.commands.insertparagraphbeforetable={queryCommandState:function(){return c(this).cell?0:-1},execCommand:function(){var j=c(this).table;if(j){var k=this.document.createElement("p");k.innerHTML=browser.ie?"&nbsp;":"<br />";j.parentNode.insertBefore(k,j);this.selection.getRange().setStart(k,0).setCursor()}}};UE.commands.deletetable={queryCommandState:function(){var j=this.selection.getRange();return domUtils.findParentByTagName(j.startContainer,"table",true)?0:-1},execCommand:function(m,l){var j=this.selection.getRange();l=l||domUtils.findParentByTagName(j.startContainer,"table",true);if(l){var k=l.nextSibling;if(!k){k=domUtils.createElement(this.document,"p",{innerHTML:browser.ie?domUtils.fillChar:"<br/>"});l.parentNode.insertBefore(k,l)}domUtils.remove(l);j=this.selection.getRange();if(k.nodeType==3){j.setStartBefore(k)}else{j.setStart(k,0)}j.setCursor(false,true);this.fireEvent("tablehasdeleted")}}};UE.commands.cellalign={queryCommandState:function(){return f(this).length?0:-1},execCommand:function(m,n){var j=f(this);if(j.length){for(var l=0,k;k=j[l++];){k.setAttribute("align",n)}}}};UE.commands.cellvalign={queryCommandState:function(){return f(this).length?0:-1},execCommand:function(n,m){var j=f(this);if(j.length){for(var l=0,k;k=j[l++];){k.setAttribute("vAlign",m)}}}};UE.commands.insertcaption={queryCommandState:function(){var j=c(this).table;if(j){return j.getElementsByTagName("caption").length==0?1:-1}return -1},execCommand:function(){var l=c(this).table;if(l){var k=this.document.createElement("caption");k.innerHTML=browser.ie?domUtils.fillChar:"<br/>";l.insertBefore(k,l.firstChild);var j=this.selection.getRange();j.setStart(k,0).setCursor()}}};UE.commands.deletecaption={queryCommandState:function(){var j=this.selection.getRange(),k=domUtils.findParentByTagName(j.startContainer,"table");if(k){return k.getElementsByTagName("caption").length==0?-1:1}return -1},execCommand:function(){var j=this.selection.getRange(),l=domUtils.findParentByTagName(j.startContainer,"table");if(l){domUtils.remove(l.getElementsByTagName("caption")[0]);var k=this.selection.getRange();k.setStart(l.rows[0].cells[0],0).setCursor()}}};UE.commands.inserttitle={queryCommandState:function(){var j=c(this).table;if(j){var k=j.rows[0];return k.cells[k.cells.length-1].tagName.toLowerCase()!="th"?0:-1}return -1},execCommand:function(){var k=c(this).table;if(k){a(k).insertRow(0,"th")}var j=k.getElementsByTagName("th")[0];this.selection.getRange().setStart(j,0).setCursor(false,true)}};UE.commands.deletetitle={queryCommandState:function(){var j=c(this).table;if(j){var k=j.rows[0];return k.cells[k.cells.length-1].tagName.toLowerCase()=="th"?0:-1}return -1},execCommand:function(){var j=c(this).table;if(j){domUtils.remove(j.rows[0])}var k=j.getElementsByTagName("td")[0];this.selection.getRange().setStart(k,0).setCursor(false,true)}};UE.commands.inserttitlecol={queryCommandState:function(){var k=c(this).table;if(k){var j=k.rows[k.rows.length-1];return j.getElementsByTagName("th").length?-1:0}return -1},execCommand:function(l){var k=c(this).table;if(k){a(k).insertCol(0,"th")}d(k,this);var j=k.getElementsByTagName("th")[0];this.selection.getRange().setStart(j,0).setCursor(false,true)}};UE.commands.deletetitlecol={queryCommandState:function(){var k=c(this).table;if(k){var j=k.rows[k.rows.length-1];return j.getElementsByTagName("th").length?0:-1}return -1},execCommand:function(){var k=c(this).table;if(k){for(var j=0;j<k.rows.length;j++){domUtils.remove(k.rows[j].children[0])}}d(k,this);var l=k.getElementsByTagName("td")[0];this.selection.getRange().setStart(l,0).setCursor(false,true)}};UE.commands.mergeright={queryCommandState:function(l){var j=c(this),r=j.table,q=j.cell;if(!r||!q){return -1}var m=a(r);if(m.selectedTds.length){return -1}var n=m.getCellInfo(q),k=n.colIndex+n.colSpan;if(k>=m.colsNum){return -1}var p=m.indexTable[n.rowIndex][k],o=r.rows[p.rowIndex].cells[p.cellIndex];if(!o||q.tagName!=o.tagName){return -1}return(p.rowIndex==n.rowIndex&&p.rowSpan==n.rowSpan)?0:-1},execCommand:function(n){var l=this.selection.getRange(),k=l.createBookmark(true);var j=c(this).cell,m=a(j);m.mergeRight(j);l.moveToBookmark(k).select()}};UE.commands.mergedown={queryCommandState:function(m){var j=c(this),r=j.table,q=j.cell;if(!r||!q){return -1}var n=a(r);if(n.selectedTds.length){return -1}var o=n.getCellInfo(q),l=o.rowIndex+o.rowSpan;if(l>=n.rowsNum){return -1}var k=n.indexTable[l][o.colIndex],p=r.rows[k.rowIndex].cells[k.cellIndex];if(!p||q.tagName!=p.tagName){return -1}return(k.colIndex==o.colIndex&&k.colSpan==o.colSpan)?0:-1},execCommand:function(){var l=this.selection.getRange(),k=l.createBookmark(true);var j=c(this).cell,m=a(j);m.mergeDown(j);l.moveToBookmark(k).select()}};UE.commands.mergecells={queryCommandState:function(){return h(this)?0:-1},execCommand:function(){var l=h(this);if(l&&l.selectedTds.length){var j=l.selectedTds[0];l.mergeRange();var k=this.selection.getRange();if(domUtils.isEmptyBlock(j)){k.setStart(j,0).collapse(true)}else{k.selectNodeContents(j)}k.select()}}};UE.commands.insertrow={queryCommandState:function(){var k=c(this),j=k.cell;return j&&(j.tagName=="TD"||(j.tagName=="TH"&&k.tr!==k.table.rows[0]))&&a(k.table).rowsNum<this.options.maxRowNum?0:-1},execCommand:function(){var j=this.selection.getRange(),m=j.createBookmark(true);var k=c(this),r=k.cell,s=k.table,l=a(s),n=l.getCellInfo(r);if(!l.selectedTds.length){l.insertRow(n.rowIndex,r)}else{var p=l.cellsRange;for(var o=0,q=p.endRowIndex-p.beginRowIndex+1;o<q;o++){l.insertRow(p.beginRowIndex,r)}}j.moveToBookmark(m).select();if(s.getAttribute("interlaced")==="enabled"){this.fireEvent("interlacetable",s)}}};UE.commands.insertrownext={queryCommandState:function(){var k=c(this),j=k.cell;return j&&(j.tagName=="TD")&&a(k.table).rowsNum<this.options.maxRowNum?0:-1},execCommand:function(){var j=this.selection.getRange(),m=j.createBookmark(true);var k=c(this),r=k.cell,s=k.table,l=a(s),n=l.getCellInfo(r);if(!l.selectedTds.length){l.insertRow(n.rowIndex+n.rowSpan,r)}else{var p=l.cellsRange;for(var o=0,q=p.endRowIndex-p.beginRowIndex+1;o<q;o++){l.insertRow(p.endRowIndex+1,r)}}j.moveToBookmark(m).select();if(s.getAttribute("interlaced")==="enabled"){this.fireEvent("interlacetable",s)}}};UE.commands.deleterow={queryCommandState:function(){var j=c(this);return j.cell?0:-1},execCommand:function(){var r=c(this).cell,m=a(r),j=m.cellsRange,n=m.getCellInfo(r),l=m.getVSideCell(r),t=m.getVSideCell(r,true),k=this.selection.getRange();if(utils.isEmptyObject(j)){m.deleteRow(n.rowIndex)}else{for(var q=j.beginRowIndex;q<j.endRowIndex+1;q++){m.deleteRow(j.beginRowIndex)}}var s=m.table;if(!s.getElementsByTagName("td").length){var o=s.nextSibling;domUtils.remove(s);if(o){k.setStart(o,0).setCursor(false,true)}}else{if(n.rowSpan==1||n.rowSpan==j.endRowIndex-j.beginRowIndex+1){if(t||l){k.selectNodeContents(t||l).setCursor(false,true)}}else{var p=m.getCell(n.rowIndex,m.indexTable[n.rowIndex][n.colIndex].cellIndex);if(p){k.selectNodeContents(p).setCursor(false,true)}}}if(s.getAttribute("interlaced")==="enabled"){this.fireEvent("interlacetable",s)}}};UE.commands.insertcol={queryCommandState:function(k){var l=c(this),j=l.cell;return j&&(j.tagName=="TD"||(j.tagName=="TH"&&j!==l.tr.cells[0]))&&a(l.table).colsNum<this.options.maxColNum?0:-1},execCommand:function(k){var j=this.selection.getRange(),m=j.createBookmark(true);if(this.queryCommandState(k)==-1){return}var r=c(this).cell,l=a(r),n=l.getCellInfo(r);if(!l.selectedTds.length){l.insertCol(n.colIndex,r)}else{var p=l.cellsRange;for(var o=0,q=p.endColIndex-p.beginColIndex+1;o<q;o++){l.insertCol(p.beginColIndex,r)}}j.moveToBookmark(m).select(true)}};UE.commands.insertcolnext={queryCommandState:function(){var k=c(this),j=k.cell;return j&&a(k.table).colsNum<this.options.maxColNum?0:-1},execCommand:function(){var m=this.selection.getRange(),l=m.createBookmark(true);var k=c(this).cell,q=a(k),o=q.getCellInfo(k);if(!q.selectedTds.length){q.insertCol(o.colIndex+o.colSpan,k)}else{var n=q.cellsRange;for(var p=0,j=n.endColIndex-n.beginColIndex+1;p<j;p++){q.insertCol(n.endColIndex+1,k)}}m.moveToBookmark(l).select()}};UE.commands.deletecol={queryCommandState:function(){var j=c(this);return j.cell?0:-1},execCommand:function(){var q=c(this).cell,l=a(q),p=l.cellsRange,m=l.getCellInfo(q),k=l.getHSideCell(q),s=l.getHSideCell(q,true);if(utils.isEmptyObject(p)){l.deleteCol(m.colIndex)}else{for(var o=p.beginColIndex;o<p.endColIndex+1;o++){l.deleteCol(p.beginColIndex)}}var r=l.table,j=this.selection.getRange();if(!r.getElementsByTagName("td").length){var n=r.nextSibling;domUtils.remove(r);if(n){j.setStart(n,0).setCursor(false,true)}}else{if(domUtils.inDoc(q,this.document)){j.setStart(q,0).setCursor(false,true)}else{if(s&&domUtils.inDoc(s,this.document)){j.selectNodeContents(s).setCursor(false,true)}else{if(k&&domUtils.inDoc(k,this.document)){j.selectNodeContents(k).setCursor(true,true)}}}}}};UE.commands.splittocells={queryCommandState:function(){var l=c(this),j=l.cell;if(!j){return -1}var k=a(l.table);if(k.selectedTds.length>0){return -1}return j&&(j.colSpan>1||j.rowSpan>1)?0:-1},execCommand:function(){var l=this.selection.getRange(),k=l.createBookmark(true);var j=c(this).cell,m=a(j);m.splitToCells(j);l.moveToBookmark(k).select()}};UE.commands.splittorows={queryCommandState:function(){var l=c(this),j=l.cell;if(!j){return -1}var k=a(l.table);if(k.selectedTds.length>0){return -1}return j&&j.rowSpan>1?0:-1},execCommand:function(){var l=this.selection.getRange(),k=l.createBookmark(true);var j=c(this).cell,m=a(j);m.splitToRows(j);l.moveToBookmark(k).select()}};UE.commands.splittocols={queryCommandState:function(){var l=c(this),j=l.cell;if(!j){return -1}var k=a(l.table);if(k.selectedTds.length>0){return -1}return j&&j.colSpan>1?0:-1},execCommand:function(){var l=this.selection.getRange(),k=l.createBookmark(true);var j=c(this).cell,m=a(j);m.splitToCols(j);l.moveToBookmark(k).select()}};UE.commands.adaptbytext=UE.commands.adaptbywindow={queryCommandState:function(){return c(this).table?0:-1},execCommand:function(l){var m=c(this),k=m.table;if(k){if(l=="adaptbywindow"){d(k,this)}else{var j=domUtils.getElementsByTagName(k,"td th");utils.each(j,function(n){n.removeAttribute("width")});k.removeAttribute("width")}}}};UE.commands.averagedistributecol={queryCommandState:function(){var j=h(this);if(!j){return -1}return j.isFullRow()||j.isFullCol()?0:-1},execCommand:function(n){var l=this,m=h(l);function k(){var t=m.table,o,r=0,v=0,w=b(l,t);if(m.isFullRow()){r=t.offsetWidth;v=m.colsNum}else{var p=m.cellsRange.beginColIndex,s=m.cellsRange.endColIndex,q;for(var u=p;u<=s;){q=m.selectedTds[u];r+=q.offsetWidth;u+=q.colSpan;v+=1}}o=Math.ceil(r/v)-w.tdBorder*2-w.tdPadding*2;return o}function j(p){utils.each(domUtils.getElementsByTagName(m.table,"th"),function(q){q.setAttribute("width","")});var o=m.isFullRow()?domUtils.getElementsByTagName(m.table,"td"):m.selectedTds;utils.each(o,function(q){if(q.colSpan==1){q.setAttribute("width",p)}})}if(m&&m.selectedTds.length){j(k())}}};UE.commands.averagedistributerow={queryCommandState:function(){var j=h(this);if(!j){return -1}if(j.selectedTds&&/th/ig.test(j.selectedTds[0].tagName)){return -1}return j.isFullRow()||j.isFullCol()?0:-1},execCommand:function(m){var k=this,l=h(k);function j(){var o,z,C=0,u=l.table,B=b(k,u),p=parseInt(domUtils.getComputedStyle(u.getElementsByTagName("td")[0],"padding-top"));if(l.isFullCol()){var A=domUtils.getElementsByTagName(u,"caption"),r=domUtils.getElementsByTagName(u,"th"),t,y;if(A.length>0){t=A[0].offsetHeight}if(r.length>0){y=r[0].offsetHeight}C=u.offsetHeight-(t||0)-(y||0);z=r.length==0?l.rowsNum:(l.rowsNum-1)}else{var q=l.cellsRange.beginRowIndex,s=l.cellsRange.endRowIndex,x=0,w=domUtils.getElementsByTagName(u,"tr");for(var v=q;v<=s;v++){C+=w[v].offsetHeight;x+=1}z=x}if(browser.ie&&browser.version<9){o=Math.ceil(C/z)}else{o=Math.ceil(C/z)-B.tdBorder*2-p*2}return o}function n(p){var o=l.isFullCol()?domUtils.getElementsByTagName(l.table,"td"):l.selectedTds;utils.each(o,function(q){if(q.rowSpan==1){q.setAttribute("height",p)}})}if(l&&l.selectedTds.length){n(j())}}};UE.commands.cellalignment={queryCommandState:function(){return c(this).table?0:-1},execCommand:function(n,m){var k=this,l=h(k);if(!l){var o=k.selection.getStart(),j=o&&domUtils.findParentByTagName(o,["td","th","caption"],true);if(!/caption/ig.test(j.tagName)){domUtils.setAttributes(j,m)}else{j.style.textAlign=m.align;j.style.verticalAlign=m.vAlign}k.selection.getRange().setCursor(true)}else{utils.each(l.selectedTds,function(p){domUtils.setAttributes(p,m)})}},queryCommandValue:function(l){var j=c(this).cell;if(!j){j=f(this)[0]}if(!j){return null}else{var k=UE.UETable.getUETable(j).selectedTds;!k.length&&(k=j);return UE.UETable.getTableCellAlignState(k)}}};UE.commands.tablealignment={queryCommandState:function(){if(browser.ie&&browser.version<8){return -1}return c(this).table?0:-1},execCommand:function(m,l){var k=this,n=k.selection.getStart(),j=n&&domUtils.findParentByTagName(n,["table"],true);if(j){j.setAttribute("align",l)}}};UE.commands.edittable={queryCommandState:function(){return c(this).table?0:-1},execCommand:function(n,l){var k=this.selection.getRange(),m=domUtils.findParentByTagName(k.startContainer,"table");if(m){var j=domUtils.getElementsByTagName(m,"td").concat(domUtils.getElementsByTagName(m,"th"),domUtils.getElementsByTagName(m,"caption"));utils.each(j,function(o){o.style.borderColor=l})}}};UE.commands.edittd={queryCommandState:function(){return c(this).table?0:-1},execCommand:function(n,k){var l=this,m=h(l);if(!m){var o=l.selection.getStart(),j=o&&domUtils.findParentByTagName(o,["td","th","caption"],true);if(j){j.style.backgroundColor=k}}else{utils.each(m.selectedTds,function(p){p.style.backgroundColor=k})}}};UE.commands.settablebackground={queryCommandState:function(){return f(this).length>1?0:-1},execCommand:function(m,l){var j,k;j=f(this);k=a(j[0]);k.setBackground(j,l)}};UE.commands.cleartablebackground={queryCommandState:function(){var k=f(this);if(!k.length){return -1}for(var l=0,j;j=k[l++];){if(j.style.backgroundColor!==""){return 0}}return -1},execCommand:function(){var j=f(this),k=a(j[0]);k.removeBackground(j)}};UE.commands.interlacetable=UE.commands.uninterlacetable={queryCommandState:function(l){var k=c(this).table;if(!k){return -1}var j=k.getAttribute("interlaced");if(l=="interlacetable"){return(j==="enabled")?-1:0}else{return(!j||j==="disabled")?-1:0}},execCommand:function(k,l){var j=c(this).table;if(k=="interlacetable"){j.setAttribute("interlaced","enabled");this.fireEvent("interlacetable",j,l)}else{j.setAttribute("interlaced","disabled");this.fireEvent("uninterlacetable",j)}}};UE.commands.setbordervisible={queryCommandState:function(k){var j=c(this).table;if(!j){return -1}return 0},execCommand:function(){var j=c(this).table;utils.each(domUtils.getElementsByTagName(j,"td"),function(k){k.style.borderWidth="1px";k.style.borderStyle="solid"})}};function d(m,l){var k=domUtils.getElementsByTagName(m,"td th");utils.each(k,function(n){n.removeAttribute("width")});m.setAttribute("width",e(l,true,b(l,m)));var j=[];setTimeout(function(){utils.each(k,function(n){(n.colSpan==1)&&j.push(n.offsetWidth)});utils.each(k,function(o,n){(o.colSpan==1)&&o.setAttribute("width",j[n]+"")})},0)}function e(l,m,k){var j=l.body;return j.offsetWidth-(m?parseInt(domUtils.getComputedStyle(j,"margin-left"),10)*2:0)-k.tableBorder*2-(l.options.offsetWidth||0)}function f(k){var j=c(k).cell;if(j){var l=a(j);return l.selectedTds.length?l.selectedTds:[j]}else{return[]}}})();UE.plugins.table=function(){var al=this,X=null,C=null,ap=null,G=5,k=false,Z=5,Q=10,L=0,x=null,ah=360,aj=UE.UETable,s=function(ax){return aj.getUETable(ax)},j=function(ax){return aj.getUETableBySelected(ax)},n=function(ax,ay){return aj.getDefaultValue(ax,ay)},K=function(ax){return aj.removeSelectedClass(ax)};function av(ax){}al.ready(function(){var ax=this;var ay=ax.selection.getText;ax.selection.getText=function(){var az=j(ax);if(az){var aA="";utils.each(az.selectedTds,function(aB){aA+=aB[browser.ie?"innerText":"textContent"]});return aA}else{return ay.call(ax.selection)}}});var F=null,M=null,O="",D=false,u=null,I=false,A=null,v=null;var o=false,B=true;al.setOpt({maxColNum:20,maxRowNum:100,defaultCols:5,defaultRows:5,tdvalign:"top",cursorpath:al.options.UEDITOR_HOME_URL+"themes/default/images/cursor_",tableDragable:false,classList:["ue-table-interlace-color-single","ue-table-interlace-color-double"]});al.getUETable=s;var p={deletetable:1,inserttable:1,cellvalign:1,insertcaption:1,deletecaption:1,inserttitle:1,deletetitle:1,mergeright:1,mergedown:1,mergecells:1,insertrow:1,insertrownext:1,deleterow:1,insertcol:1,insertcolnext:1,deletecol:1,splittocells:1,splittorows:1,splittocols:1,adaptbytext:1,adaptbywindow:1,adaptbycustomer:1,insertparagraph:1,insertparagraphbeforetable:1,averagedistributecol:1,averagedistributerow:1};al.ready(function(){utils.cssRule("table",".selectTdClass{background-color:#edf5fa !important}table.noBorderTable td,table.noBorderTable th,table.noBorderTable caption{border:1px dashed #ddd !important}table{margin-bottom:10px;border-collapse:collapse;display:table;}td,th{padding: 5px 10px;border: 1px solid #DDD;}caption{border:1px dashed #DDD;border-bottom:0;padding:3px;text-align:center;}th{border-top:1px solid #BBB;background-color:#F7F7F7;}table tr.firstRow th{border-top-width:2px;}.ue-table-interlace-color-single{ background-color: #fcfcfc; } .ue-table-interlace-color-double{ background-color: #f7faff; }td p{margin:0;padding:0;}",al.document);var ay,aA,ax;al.addListener("keydown",function(aF,aO){var aM=this;var aP=aO.keyCode||aO.which;if(aP==8){var aG=j(aM);if(aG&&aG.selectedTds.length){if(aG.isFullCol()){aM.execCommand("deletecol")}else{if(aG.isFullRow()){aM.execCommand("deleterow")}else{aM.fireEvent("delcells")}}domUtils.preventDefault(aO)}var aR=domUtils.findParentByTagName(aM.selection.getStart(),"caption",true),aL=aM.selection.getRange();if(aL.collapsed&&aR&&am(aR)){aM.fireEvent("saveScene");var aQ=aR.parentNode;domUtils.remove(aR);if(aQ){aL.setStart(aQ.rows[0].cells[0],0).setCursor(false,true)}aM.fireEvent("saveScene")}}if(aP==46){aG=j(aM);if(aG){aM.fireEvent("saveScene");for(var aI=0,aS;aS=aG.selectedTds[aI++];){domUtils.fillNode(aM.document,aS)}aM.fireEvent("saveScene");domUtils.preventDefault(aO)}}if(aP==13){var aD=aM.selection.getRange(),aR=domUtils.findParentByTagName(aD.startContainer,"caption",true);if(aR){var aQ=domUtils.findParentByTagName(aR,"table");if(!aD.collapsed){aD.deleteContents();aM.fireEvent("saveScene")}else{if(aR){aD.setStart(aQ.rows[0].cells[0],0).setCursor(false,true)}}domUtils.preventDefault(aO);return}if(aD.collapsed){var aQ=domUtils.findParentByTagName(aD.startContainer,"table");if(aQ){var aN=aQ.rows[0].cells[0],aE=domUtils.findParentByTagName(aM.selection.getStart(),["td","th"],true),aK=aQ.previousSibling;if(aN===aE&&(!aK||aK.nodeType==1&&aK.tagName=="TABLE")&&domUtils.isStartInblock(aD)){var aJ=domUtils.findParent(aM.selection.getStart(),function(aT){return domUtils.isBlockElm(aT)},true);if(aJ&&(/t(h|d)/i.test(aJ.tagName)||aJ===aE.firstChild)){aM.execCommand("insertparagraphbeforetable");domUtils.preventDefault(aO)}}}}}if((aO.ctrlKey||aO.metaKey)&&aO.keyCode=="67"){ay=null;var aG=j(aM);if(aG){var aH=aG.selectedTds;aA=aG.isFullCol();ax=aG.isFullRow();ay=[[aG.cloneCell(aH[0],null,true)]];for(var aI=1,aS;aS=aH[aI];aI++){if(aS.parentNode!==aH[aI-1].parentNode){ay.push([aG.cloneCell(aS,null,true)])}else{ay[ay.length-1].push(aG.cloneCell(aS,null,true))}}}}});al.addListener("tablehasdeleted",function(){R(this,false,"",null);if(u){domUtils.remove(u)}});al.addListener("beforepaste",function(aV,aP){var aZ=this;var aG=aZ.selection.getRange();if(domUtils.findParentByTagName(aG.startContainer,"caption",true)){var aR=aZ.document.createElement("div");aR.innerHTML=aP.html;aP.html=aR[browser.ie9below?"innerText":"textContent"];return}var aX=j(aZ);if(ay){aZ.fireEvent("saveScene");var aG=aZ.selection.getRange();var aH=domUtils.findParentByTagName(aG.startContainer,["td","th"],true),aY,aD;if(aH){var aI=s(aH);if(ax){var aN=aI.getCellInfo(aH).rowIndex;if(aH.tagName=="TH"){aN++}for(var aW=0,aO;aO=ay[aW++];){var aE=aI.insertRow(aN++,"td");for(var aU=0,aM;aM=aO[aU];aU++){var aF=aE.cells[aU];if(!aF){aF=aE.insertCell(aU)}aF.innerHTML=aM.innerHTML;aM.getAttribute("width")&&aF.setAttribute("width",aM.getAttribute("width"));aM.getAttribute("vAlign")&&aF.setAttribute("vAlign",aM.getAttribute("vAlign"));aM.getAttribute("align")&&aF.setAttribute("align",aM.getAttribute("align"));aM.style.cssText&&(aF.style.cssText=aM.style.cssText)}for(var aU=0,aM;aM=aE.cells[aU];aU++){if(!aO[aU]){break}aM.innerHTML=aO[aU].innerHTML;aO[aU].getAttribute("width")&&aM.setAttribute("width",aO[aU].getAttribute("width"));aO[aU].getAttribute("vAlign")&&aM.setAttribute("vAlign",aO[aU].getAttribute("vAlign"));aO[aU].getAttribute("align")&&aM.setAttribute("align",aO[aU].getAttribute("align"));aO[aU].style.cssText&&(aM.style.cssText=aO[aU].style.cssText)}}}else{if(aA){aK=aI.getCellInfo(aH);var aL=0;for(var aU=0,aO=ay[0],aM;aM=aO[aU++];){aL+=aM.colSpan||1}aZ.__hasEnterExecCommand=true;for(aW=0;aW<aL;aW++){aZ.execCommand("insertcol")}aZ.__hasEnterExecCommand=false;aH=aI.table.rows[0].cells[aK.cellIndex];if(aH.tagName=="TH"){aH=aI.table.rows[1].cells[aK.cellIndex]}}for(var aW=0,aO;aO=ay[aW++];){aY=aH;for(var aU=0,aM;aM=aO[aU++];){if(aH){aH.innerHTML=aM.innerHTML;aM.getAttribute("width")&&aH.setAttribute("width",aM.getAttribute("width"));aM.getAttribute("vAlign")&&aH.setAttribute("vAlign",aM.getAttribute("vAlign"));aM.getAttribute("align")&&aH.setAttribute("align",aM.getAttribute("align"));aM.style.cssText&&(aH.style.cssText=aM.style.cssText);aD=aH;aH=aH.nextSibling}else{var aQ=aM.cloneNode(true);domUtils.removeAttributes(aQ,["class","rowSpan","colSpan"]);aD.parentNode.appendChild(aQ)}}aH=aI.getNextCell(aY,true,true);if(!ay[aW]){break}if(!aH){var aK=aI.getCellInfo(aY);aI.table.insertRow(aI.table.rows.length);aI.update();aH=aI.getVSideCell(aY,true)}}}aI.update()}else{aX=aZ.document.createElement("table");for(var aW=0,aO;aO=ay[aW++];){var aE=aX.insertRow(aX.rows.length);for(var aU=0,aM;aM=aO[aU++];){aQ=aj.cloneCell(aM,null,true);domUtils.removeAttributes(aQ,["class"]);aE.appendChild(aQ)}if(aU==2&&aQ.rowSpan>1){aQ.rowSpan=1}}var aT=n(aZ),aS=aZ.body.offsetWidth-(B?parseInt(domUtils.getComputedStyle(aZ.body,"margin-left"),10)*2:0)-aT.tableBorder*2-(aZ.options.offsetWidth||0);aZ.execCommand("insertHTML","<table  "+(aA&&ax?'width="'+aS+'"':"")+">"+aX.innerHTML.replace(/>\s*</g,"><").replace(/\bth\b/gi,"td")+"</table>")}aZ.fireEvent("contentchange");aZ.fireEvent("saveScene");aP.html="";return true}else{var aR=aZ.document.createElement("div"),aJ;aR.innerHTML=aP.html;aJ=aR.getElementsByTagName("table");if(domUtils.findParentByTagName(aZ.selection.getStart(),"table")){utils.each(aJ,function(a0){domUtils.remove(a0)});if(domUtils.findParentByTagName(aZ.selection.getStart(),"caption",true)){aR.innerHTML=aR[browser.ie?"innerText":"textContent"]}}else{utils.each(aJ,function(a0){an(a0,true);domUtils.removeAttributes(a0,["style","border"]);utils.each(domUtils.getElementsByTagName(a0,"td"),function(a1){if(am(a1)){domUtils.fillNode(aZ.document,a1)}an(a1,true)})})}aP.html=aR.innerHTML}});al.addListener("afterpaste",function(){utils.each(domUtils.getElementsByTagName(al.body,"table"),function(aE){if(aE.offsetWidth>al.body.offsetWidth){var aD=n(al,aE);aE.style.width=al.body.offsetWidth-(B?parseInt(domUtils.getComputedStyle(al.body,"margin-left"),10)*2:0)-aD.tableBorder*2-(al.options.offsetWidth||0)+"px"}})});al.addListener("blur",function(){ay=null});var aC;al.addListener("keydown",function(){clearTimeout(aC);aC=setTimeout(function(){var aE=al.selection.getRange(),aD=domUtils.findParentByTagName(aE.startContainer,["th","td"],true);if(aD){var aF=aD.parentNode.parentNode.parentNode;if(aF.offsetWidth>aF.getAttribute("width")){aD.style.wordBreak="break-all"}}},100)});al.addListener("selectionchange",function(){R(al,false,"",null)});al.addListener("contentchange",function(){var aE=this;d(aE);if(j(aE)){return}var aD=aE.selection.getRange();var aF=aD.startContainer;aF=domUtils.findParentByTagName(aF,["td","th"],true);utils.each(domUtils.getElementsByTagName(aE.document,"table"),function(aG){if(aE.fireEvent("excludetable",aG)===true){return}aG.ueTable=new aj(aG);aG.onmouseover=function(){aE.fireEvent("tablemouseover",aG)};aG.onmousemove=function(){aE.fireEvent("tablemousemove",aG);aE.options.tableDragable&&ak(true,this,aE);utils.defer(function(){aE.fireEvent("contentchange",50)},true)};aG.onmouseout=function(){aE.fireEvent("tablemouseout",aG);R(aE,false,"",null);d(aE)};aG.onclick=function(aN){aN=aE.window.event||aN;var aL=aw(aN.target||aN.srcElement);if(!aL){return}var aJ=s(aL),aO=aJ.table,aK=aJ.getCellInfo(aL),aH,aI=aE.selection.getRange();if(ac(aO,aL,aN,true)){var aP=aJ.getCell(aJ.indexTable[aJ.rowsNum-1][aK.colIndex].rowIndex,aJ.indexTable[aJ.rowsNum-1][aK.colIndex].cellIndex);if(aN.shiftKey&&aJ.selectedTds.length){if(aJ.selectedTds[0]!==aP){aH=aJ.getCellsRange(aJ.selectedTds[0],aP);aJ.setSelected(aH)}else{aI&&aI.selectNodeContents(aP).select()}}else{if(aL!==aP){aH=aJ.getCellsRange(aL,aP);aJ.setSelected(aH)}else{aI&&aI.selectNodeContents(aP).select()}}return}if(ac(aO,aL,aN)){var aM=aJ.getCell(aJ.indexTable[aK.rowIndex][aJ.colsNum-1].rowIndex,aJ.indexTable[aK.rowIndex][aJ.colsNum-1].cellIndex);if(aN.shiftKey&&aJ.selectedTds.length){if(aJ.selectedTds[0]!==aM){aH=aJ.getCellsRange(aJ.selectedTds[0],aM);aJ.setSelected(aH)}else{aI&&aI.selectNodeContents(aM).select()}}else{if(aL!==aM){aH=aJ.getCellsRange(aL,aM);aJ.setSelected(aH)}else{aI&&aI.selectNodeContents(aM).select()}}}}});e(aE,true)});domUtils.on(al.document,"mousemove",E);domUtils.on(al.document,"mouseout",function(aD){var aE=aD.target||aD.srcElement;if(aE.tagName=="TABLE"){R(al,false,"",null)}});al.addListener("interlacetable",function(aG,aI,aK){if(!aI){return}var aH=this,aJ=aI.rows,aD=aJ.length,aE=function(aN,aL,aM){return aN[aL]?aN[aL]:aM?aN[aL%aN.length]:""};for(var aF=0;aF<aD;aF++){aJ[aF].className=aE(aK||aH.options.classList,aF,true)}});al.addListener("uninterlacetable",function(aF,aH){if(!aH){return}var aG=this,aI=aH.rows,aJ=aG.options.classList,aD=aI.length;for(var aE=0;aE<aD;aE++){domUtils.removeClasses(aI[aE],aJ)}});al.addListener("mousedown",J);al.addListener("mouseup",V);domUtils.on(al.body,"dragstart",function(aD){V.call(al,"dragstart",aD)});al.addOutputRule(function(aD){utils.each(aD.getNodesByTagName("div"),function(aE){if(aE.getAttr("id")=="ue_tableDragLine"){aE.parentNode.removeChild(aE)}})});var aB=0;al.addListener("mousedown",function(){aB=0});al.addListener("tabkeydown",function(){var aE=this.selection.getRange(),aH=aE.getCommonAncestor(true,true),aI=domUtils.findParentByTagName(aH,"table");if(aI){if(domUtils.findParentByTagName(aH,"caption",true)){var aD=domUtils.getElementsByTagName(aI,"th td");if(aD&&aD.length){aE.setStart(aD[0],0).setCursor(false,true)}}else{var aD=domUtils.findParentByTagName(aH,["td","th"],true),aF=s(aD);aB=aD.rowSpan>1?aB:aF.getCellInfo(aD).rowIndex;var aG=aF.getTabNextCell(aD,aB);if(aG){if(am(aG)){aE.setStart(aG,0).setCursor(false,true)}else{aE.selectNodeContents(aG).select()}}else{al.fireEvent("saveScene");al.__hasEnterExecCommand=true;this.execCommand("insertrownext");al.__hasEnterExecCommand=false;aE=this.selection.getRange();aE.setStart(aI.rows[aI.rows.length-1].cells[0],0).setCursor();al.fireEvent("saveScene")}}return true}});browser.ie&&al.addListener("selectionchange",function(){R(this,false,"",null)});al.addListener("keydown",function(aE,aD){var aF=this;var aH=aD.keyCode||aD.which;if(aH==8||aH==46){return}var aI=!aD.ctrlKey&&!aD.metaKey&&!aD.shiftKey&&!aD.altKey;aI&&K(domUtils.getElementsByTagName(aF.body,"td"));var aG=j(aF);if(!aG){return}aI&&aG.clearSelected()});al.addListener("beforegetcontent",function(){e(this,false);browser.ie&&utils.each(this.document.getElementsByTagName("caption"),function(aD){if(domUtils.isEmptyNode(aD)){aD.innerHTML="&nbsp;"}})});al.addListener("aftergetcontent",function(){e(this,true)});al.addListener("getAllHtml",function(){K(al.document.getElementsByTagName("td"))});al.addListener("fullscreenchanged",function(aF,aG){if(!aG){var aE=this.body.offsetWidth/document.body.offsetWidth,aD=domUtils.getElementsByTagName(this.body,"table");utils.each(aD,function(aJ){if(aJ.offsetWidth<al.body.offsetWidth){return false}var aI=domUtils.getElementsByTagName(aJ,"td"),aK=[];utils.each(aI,function(aM){aK.push(aM.offsetWidth)});for(var aH=0,aL;aL=aI[aH];aH++){aL.setAttribute("width",Math.floor(aK[aH]*aE))}aJ.setAttribute("width",Math.floor(N(al,B,n(al))))})}});var az=al.execCommand;al.execCommand=function(aF,aR){var aN=this,aM=arguments;aF=aF.toLowerCase();var aG=j(aN),aJ,aK=new dom.Range(aN.document),aL=aN.commands[aF]||UE.commands[aF],aQ;if(!aL){return}if(aG&&!p[aF]&&!aL.notNeedUndo&&!aN.__hasEnterExecCommand){aN.__hasEnterExecCommand=true;aN.fireEvent("beforeexeccommand",aF);aJ=aG.selectedTds;var aD=-2,aO=-2,aP,aE;for(var aI=0,aH;aH=aJ[aI];aI++){if(am(aH)){aK.setStart(aH,0).setCursor(false,true)}else{aK.selectNode(aH).select(true)}aE=aN.queryCommandState(aF);aP=aN.queryCommandValue(aF);if(aE!=-1){if(aD!==aE||aO!==aP){aN._ignoreContentChange=true;aQ=az.apply(aN,arguments);aN._ignoreContentChange=false}aD=aN.queryCommandState(aF);aO=aN.queryCommandValue(aF);if(domUtils.isEmptyBlock(aH)){domUtils.fillNode(aN.document,aH)}}}aK.setStart(aJ[0],0).shrinkBoundary(true).setCursor(false,true);aN.fireEvent("contentchange");aN.fireEvent("afterexeccommand",aF);aN.__hasEnterExecCommand=false;aN._selectionChange()}else{aQ=az.apply(aN,arguments)}return aQ}});function an(ay,ax){U(ay,"width",true);U(ay,"height",true)}function U(az,ay,ax){if(az.style[ay]){ax&&az.setAttribute(ay,parseInt(az.style[ay],10));az.style[ay]=""}}function aw(ax){if(ax.tagName=="TD"||ax.tagName=="TH"){return ax}var ay;if(ay=domUtils.findParentByTagName(ax,"td",true)||domUtils.findParentByTagName(ax,"th",true)){return ay}return null}function am(ay){var ax=new RegExp(domUtils.fillChar,"g");if(ay[browser.ie?"innerText":"textContent"].replace(/^\s*$/,"").replace(ax,"").length>0){return 0}for(var az in dtd.$isNotEmpty){if(ay.getElementsByTagName(az).length){return 0}}return 1}function t(ax){if(ax.pageX||ax.pageY){return{x:ax.pageX,y:ax.pageY}}return{x:ax.clientX+al.document.body.scrollLeft-al.document.body.clientLeft,y:ax.clientY+al.document.body.scrollTop-al.document.body.clientTop}}function E(ax){if(z()){return}try{var aB=aw(ax.target||ax.srcElement),aD;if(k){al.body.style.webkitUserSelect="none";if(Math.abs(x.x-ax.clientX)>Q||Math.abs(x.y-ax.clientY)>Q){y();k=false;L=0;ao(ax)}}if(O&&v){L=0;al.body.style.webkitUserSelect="none";al.selection.getNative()[browser.ie9below?"empty":"removeAllRanges"]();aD=t(ax);R(al,true,O,aD,aB);if(O=="h"){A.style.left=f(v,ax)+"px"}else{if(O=="v"){A.style.top=b(v,ax)+"px"}}return}if(aB){if(al.fireEvent("excludetable",aB)===true){return}aD=t(ax);var az=H(aB,aD),ay=domUtils.findParentByTagName(aB,"table",true);if(ac(ay,aB,ax,true)){if(al.fireEvent("excludetable",ay)===true){return}al.body.style.cursor="url("+al.options.cursorpath+"h.png),pointer"}else{if(ac(ay,aB,ax)){if(al.fireEvent("excludetable",ay)===true){return}al.body.style.cursor="url("+al.options.cursorpath+"v.png),pointer"}else{al.body.style.cursor="text";var aC=aB;if(/\d/.test(az)){az=az.replace(/\d/,"");aB=s(aB).getPreviewCell(aB,az=="v")}R(al,aB?!!az:false,aB?az:"",aD,aB)}}}else{ak(false,ay,al)}}catch(aA){av(aA)}}var at;function ak(ax,az,ay){if(!ax){if(I){return}at=setTimeout(function(){!I&&u&&u.parentNode&&u.parentNode.removeChild(u)},2000)}else{c(az,ay)}}function c(ay,ax){var aD=domUtils.getXY(ay),az=ay.ownerDocument;if(u&&u.parentNode){return u}u=az.createElement("div");u.contentEditable=false;u.innerHTML="";u.style.cssText="width:15px;height:15px;background-image:url("+ax.options.UEDITOR_HOME_URL+"dialogs/table/dragicon.png);position: absolute;cursor:move;top:"+(aD.y-15)+"px;left:"+(aD.x)+"px;";domUtils.unSelectable(u);u.onmouseover=function(aE){I=true};u.onmouseout=function(aE){I=false};domUtils.on(u,"click",function(aF,aE){aB(aE,this)});domUtils.on(u,"dblclick",function(aF,aE){aA(aE)});domUtils.on(u,"dragstart",function(aF,aE){domUtils.preventDefault(aE)});var aC;function aB(aE,aF){clearTimeout(aC);aC=setTimeout(function(){ax.fireEvent("tableClicked",ay,aF)},300)}function aA(aF){clearTimeout(aC);var aH=s(ay),aI=ay.rows[0].cells[0],aE=aH.getLastCell(),aG=aH.getCellsRange(aI,aE);ax.selection.getRange().setStart(aI,0).setCursor(false,true);aH.setSelected(aG)}az.body.appendChild(u)}function ac(aB,ax,az,aD){var aE=t(az),aC=H(ax,aE);if(aD){var aA=aB.getElementsByTagName("caption")[0],ay=aA?aA.offsetHeight:0;return(aC=="v1")&&((aE.y-domUtils.getXY(aB).y-ay)<8)}else{return(aC=="h1")&&((aE.x-domUtils.getXY(aB).x)<8)}}function f(aC,ax){var aD=s(aC);if(aD){var aA=aD.getSameEndPosCells(aC,"x")[0],aB=aD.getSameStartPosXCells(aC)[0],az=t(ax).x,aE=(aA?domUtils.getXY(aA).x:domUtils.getXY(aD.table).x)+20,ay=aB?domUtils.getXY(aB).x+aB.offsetWidth-20:(al.body.offsetWidth+5||parseInt(domUtils.getComputedStyle(al.body,"width"),10));aE+=G;ay-=G;return az<aE?aE:az>ay?ay:az}}function b(ay,ax){try{var aA=domUtils.getXY(ay).y,aB=t(ax).y;return aB<aA?aA:aB}catch(az){av(az)}}function R(aB,az,aA,ay,ax){try{aB.body.style.cursor=aA=="h"?"col-resize":aA=="v"?"row-resize":"text";if(browser.ie){if(aA&&!o&&!j(aB)){ar(aB,aB.document);r(aA,ax)}else{d(aB)}}D=az}catch(aC){av(aC)}}function P(){var ax="_UETableResizeLine",ay=this.document.getElementById(ax);if(!ay){ay=this.document.createElement("div");ay.id=ax;ay.contnetEditable=false;ay.setAttribute("unselectable","on");var az={width:2*Z+1+"px",position:"absolute","z-index":100000,cursor:"col-resize",background:"red",display:"none"};ay.onmouseout=function(){this.style.display="none"};utils.extend(ay.style,az);this.document.body.appendChild(ay)}return ay}function ag(ax,aB){var ay=P.call(this),aA=aB.table,az={top:domUtils.getXY(aA).y+"px",left:domUtils.getXY(ax).x+ax.offsetWidth-Z+"px",display:"block",height:aA.offsetHeight+"px"};utils.extend(ay.style,az)}function q(ax){var ay=s(ax);ag.call(this,ax,ay)}function H(ay,ax){var az=domUtils.getXY(ay);if(!az){return""}if(az.x+ay.offsetWidth-ax.x<Z){return"h"}if(ax.x-az.x<Z){return"h1"}if(az.y+ay.offsetHeight-ax.y<Z){return"v"}if(ax.y-az.y<Z){return"v1"}return""}function J(az,ay){if(z()){return}x={x:ay.clientX,y:ay.clientY};if(ay.button==2){var aA=j(al),ax=false;if(aA){var aB=S(al,ay);utils.each(aA.selectedTds,function(aC){if(aC===aB){ax=true}});if(!ax){K(domUtils.getElementsByTagName(al.body,"th td"));aA.clearSelected()}else{aB=aA.selectedTds[0];setTimeout(function(){al.selection.getRange().setStart(aB,0).setCursor(false,true)},0)}}}else{w(ay)}}function m(){X&&clearTimeout(X);X=null}function Y(aD){L=0;aD=aD||al.window.event;var aC=aw(aD.target||aD.srcElement);if(aC){var aB;if(aB=H(aC,t(aD))){d(al);if(aB=="h1"){aB="h";if(ac(domUtils.findParentByTagName(aC,"table"),aC,aD)){al.execCommand("adaptbywindow")}else{aC=s(aC).getPreviewCell(aC);if(aC){var ax=al.selection.getRange();ax.selectNodeContents(aC).setCursor(true,true)}}}if(aB=="h"){var ay=s(aC),aE=ay.table,aF=T(aC,aE,true);aF=ai(aF,"left");ay.width=ay.offsetWidth;var az=[],aA=[];utils.each(aF,function(aG){az.push(aG.offsetWidth)});utils.each(aF,function(aG){aG.removeAttribute("width")});window.setTimeout(function(){var aG=true;utils.each(aF,function(aI,aJ){var aK=aI.offsetWidth;if(aK>az[aJ]){aG=false;return false}aA.push(aK)});var aH=aG?aA:az;utils.each(aF,function(aI,aJ){aI.width=aH[aJ]-ab()})},0)}}}}function w(ax){K(domUtils.getElementsByTagName(al.body,"td th"));utils.each(al.document.getElementsByTagName("table"),function(az){az.ueTable=null});F=S(al,ax);if(!F){return}var ay=domUtils.findParentByTagName(F,"table",true);ut=s(ay);ut&&ut.clearSelected();if(!D){al.document.body.style.webkitUserSelect="";o=true;al.addListener("mouseover",af)}else{W(ax)}}function W(ax){if(browser.ie){ax=ad(ax)}y();k=true;C=setTimeout(function(){ao(ax)},ah)}function ai(aC,aB){var ay=[],aA=null;for(var az=0,ax=aC.length;az<ax;az++){aA=aC[az][aB];if(aA){ay.push(aA)}}return ay}function y(){C&&clearTimeout(C);C=null}function ad(aB){var ay=["pageX","pageY","clientX","clientY","srcElement","target"],ax={};if(aB){for(var aA=0,az,aC;az=ay[aA];aA++){aC=aB[az];aC&&(ax[az]=aC)}}return ax}function ao(ax){k=false;F=ax.target||ax.srcElement;if(!F){return}var ay=H(F,t(ax));if(/\d/.test(ay)){ay=ay.replace(/\d/,"");F=s(F).getPreviewCell(F,ay=="v")}d(al);ar(al,al.document);al.fireEvent("saveScene");r(ay,F);o=true;O=ay;v=F}function V(aF,aH){if(z()){return}y();k=false;if(D){L=++L%3;x={x:aH.clientX,y:aH.clientY};ap=setTimeout(function(){L>0&&L--},ah);if(L===2){L=0;Y(aH);return}}if(aH.button==2){return}var aE=this;var aC=aE.selection.getRange(),ax=domUtils.findParentByTagName(aC.startContainer,"table",true),aA=domUtils.findParentByTagName(aC.endContainer,"table",true);if(ax||aA){if(ax===aA){ax=domUtils.findParentByTagName(aC.startContainer,["td","th","caption"],true);aA=domUtils.findParentByTagName(aC.endContainer,["td","th","caption"],true);if(ax!==aA){aE.selection.clearRange()}}else{aE.selection.clearRange()}}o=false;aE.document.body.style.webkitUserSelect="";if(O&&v){aE.selection.getNative()[browser.ie9below?"empty":"removeAllRanges"]();L=0;A=aE.document.getElementById("ue_tableDragLine");if(A){var az=domUtils.getXY(v),aB=domUtils.getXY(A);switch(O){case"h":l(v,aB.x-az.x);break;case"v":aq(v,aB.y-az.y-v.offsetHeight);break;default:}O="";v=null;d(aE);aE.fireEvent("saveScene");return}}if(!F){var aD=domUtils.findParentByTagName(aH.target||aH.srcElement,"td",true);if(!aD){aD=domUtils.findParentByTagName(aH.target||aH.srcElement,"th",true)}if(aD&&(aD.tagName=="TD"||aD.tagName=="TH")){if(aE.fireEvent("excludetable",aD)===true){return}aC=new dom.Range(aE.document);aC.setStart(aD,0).setCursor(false,true)}}else{var ay=s(F),aG=ay?ay.selectedTds[0]:null;if(aG){aC=new dom.Range(aE.document);if(domUtils.isEmptyBlock(aG)){aC.setStart(aG,0).setCursor(false,true)}else{aC.selectNodeContents(aG).shrinkBoundary().setCursor(false,true)}}else{aC=aE.selection.getRange().shrinkBoundary();if(!aC.collapsed){var ax=domUtils.findParentByTagName(aC.startContainer,["td","th"],true),aA=domUtils.findParentByTagName(aC.endContainer,["td","th"],true);if(ax&&!aA||!ax&&aA||ax&&aA&&ax!==aA){aC.setCursor(false,true)}}}F=null;aE.removeListener("mouseover",af)}aE._selectionChange(250,aH)}function af(aA,ay){if(z()){return}var aB=this,ax=ay.target||ay.srcElement;M=domUtils.findParentByTagName(ax,"td",true)||domUtils.findParentByTagName(ax,"th",true);if(F&&M&&((F.tagName=="TD"&&M.tagName=="TD")||(F.tagName=="TH"&&M.tagName=="TH"))&&domUtils.findParentByTagName(F,"table")==domUtils.findParentByTagName(M,"table")){var aC=s(M);if(F!=M){aB.document.body.style.webkitUserSelect="none";aB.selection.getNative()[browser.ie9below?"empty":"removeAllRanges"]();var az=aC.getCellsRange(F,M);aC.setSelected(az)}else{aB.document.body.style.webkitUserSelect="";aC.clearSelected()}}ay.preventDefault?ay.preventDefault():(ay.returnValue=false)}function aa(ay,ax,az){var aA=parseInt(domUtils.getComputedStyle(ay,"line-height"),10),aB=az+ax;ax=aB<aA?aA:aB;if(ay.style.height){ay.style.height=""}ay.rowSpan==1?ay.setAttribute("height",ax):(ay.removeAttribute&&ay.removeAttribute("height"))}function h(ax){if(!ax){return 0}return parseInt(domUtils.getComputedStyle(ax,"width"),10)}function l(ax,aB){var aC=s(ax);if(aC){var aA=aC.table,ay=T(ax,aA);aA.style.width="";aA.removeAttribute("width");aB=au(aB,ax,ay);if(ax.nextSibling){var az=0;utils.each(ay,function(aD){aD.left.width=(+aD.left.width)+aB;aD.right&&(aD.right.width=(+aD.right.width)-aB)})}else{utils.each(ay,function(aD){aD.left.width-=-aB})}}}function z(){return al.body.contentEditable==="false"}function aq(aD,aB){if(Math.abs(aB)<10){return}var aC=s(aD);if(aC){var az=aC.getSameEndPosCells(aD,"y"),ay=az[0]?az[0].offsetHeight:0;for(var aA=0,ax;ax=az[aA++];){aa(ax,aB,ay)}}}function T(ay,aC,aE){if(!aC){aC=domUtils.findParentByTagName(ay,"table")}if(!aC){return null}var aB=domUtils.getNodeIndex(ay),az=ay,aD=aC.rows,aA=0;while(az){if(az.nodeType===1){aA+=(az.colSpan||1)}az=az.previousSibling}az=null;var ax=[];utils.each(aD,function(aG){var aF=aG.cells,aH=0;utils.each(aF,function(aI){aH+=(aI.colSpan||1);if(aH===aA){ax.push({left:aI,right:aI.nextSibling||null});return false}else{if(aH>aA){if(aE){ax.push({left:aI})}return false}}})});return ax}function g(ax){var az=Number.MAX_VALUE;for(var ay=0,aA;aA=ax[ay];ay++){az=Math.min(az,aA.width||a(aA))}return az}function au(az,ax,ay){az-=ab();if(az<0){return 0}az-=a(ax);var aA=az<0?"left":"right";az=Math.abs(az);utils.each(ay,function(aB){var aC=aB[aA];if(aC){az=Math.min(az,a(aC)-G)}});az=az<0?0:az;return aA==="left"?-az:az}function a(ax){var ay=0,aA=0,ay=ax.offsetWidth-ab();if(!ax.nextSibling){ay-=ae(ax)}ay=ay<0?0:ay;try{ax.width=ay}catch(az){}return ay}function ae(ax){tab=domUtils.findParentByTagName(ax,"table",false);if(tab.offsetVal===undefined){var ay=ax.previousSibling;if(ay){tab.offsetVal=ax.offsetWidth-ay.offsetWidth===aj.borderWidth?aj.borderWidth:0}else{tab.offsetVal=0}}return tab.offsetVal}function ab(){if(aj.tabcellSpace===undefined){var ax=null,aA=al.document.createElement("table"),az=al.document.createElement("tbody"),ay=al.document.createElement("tr"),aC=al.document.createElement("td"),aD=null;aC.style.cssText="border: 0;";aC.width=1;ay.appendChild(aC);ay.appendChild(aD=aC.cloneNode(false));az.appendChild(ay);aA.appendChild(az);aA.style.cssText="visibility: hidden;";al.body.appendChild(aA);aj.paddingSpace=aC.offsetWidth-1;var aB=aA.offsetWidth;aC.style.cssText="";aD.style.cssText="";aj.borderWidth=(aA.offsetWidth-aB)/3;aj.tabcellSpace=aj.paddingSpace+aj.borderWidth;al.body.removeChild(aA)}ab=function(){return aj.tabcellSpace};return aj.tabcellSpace}function ar(ax,ay){if(o){return}A=ax.document.createElement("div");domUtils.setAttributes(A,{id:"ue_tableDragLine",unselectable:"on",contenteditable:false,onresizestart:"return false",ondragstart:"return false",onselectstart:"return false",style:"background-color:blue;position:absolute;padding:0;margin:0;background-image:none;border:0px none;opacity:0;filter:alpha(opacity=0)"});ax.body.appendChild(A)}function d(ay){if(o){return}var ax;while(ax=ay.document.getElementById("ue_tableDragLine")){domUtils.remove(ax)}}function r(ax,aB){if(!aB){return}var aD=domUtils.findParentByTagName(aB,"table"),aF=aD.getElementsByTagName("caption"),ay=aD.offsetWidth,aC=aD.offsetHeight-(aF.length>0?aF[0].offsetHeight:0),aA=domUtils.getXY(aD),aE=domUtils.getXY(aB),az;switch(ax){case"h":az="height:"+aC+"px;top:"+(aA.y+(aF.length>0?aF[0].offsetHeight:0))+"px;left:"+(aE.x+aB.offsetWidth);A.style.cssText=az+"px;position: absolute;display:block;background-color:blue;width:1px;border:0; color:blue;opacity:.3;filter:alpha(opacity=30)";break;case"v":az="width:"+ay+"px;left:"+aA.x+"px;top:"+(aE.y+aB.offsetHeight);A.style.cssText=az+"px;overflow:hidden;position: absolute;display:block;background-color:blue;height:1px;border:0;color:blue;opacity:.2;filter:alpha(opacity=20)";break;default:}}function e(aB,ax){var az=domUtils.getElementsByTagName(aB.body,"table"),ay;for(var aA=0,aC;aC=az[aA++];){var aD=domUtils.getElementsByTagName(aC,"td");if(aD[0]){if(ax){ay=(aD[0].style.borderColor).replace(/\s/g,"");if(/(#ffffff)|(rgb\(255,255,255\))/ig.test(ay)){domUtils.addClass(aC,"noBorderTable")}}else{domUtils.removeClasses(aC,"noBorderTable")}}}}function N(az,aA,ay){var ax=az.body;return ax.offsetWidth-(aA?parseInt(domUtils.getComputedStyle(ax,"margin-left"),10)*2:0)-ay.tableBorder*2-(az.options.offsetWidth||0)}function S(aC,az){var aD=domUtils.findParentByTagName(az.target||az.srcElement,["td","th"],true),aA=null;if(!aD){return null}aA=H(aD,t(az));if(!aD){return null}if(aA==="h1"&&aD.previousSibling){var ay=domUtils.getXY(aD),aB=aD.offsetWidth;if(Math.abs(ay.x+aB-az.clientX)>aB/3){aD=aD.previousSibling}}else{if(aA==="v1"&&aD.parentNode.previousSibling){var ay=domUtils.getXY(aD),ax=aD.offsetHeight;if(Math.abs(ay.y+ax-az.clientY)>ax/3){aD=aD.parentNode.previousSibling.firstChild}}}return aD&&!(aC.fireEvent("excludetable",aD)===true)?aD:null}};UE.UETable.prototype.sortTable=function(l,a){var o=this.table,p=o.rows,c=[],m=p[0].cells[0].tagName==="TH",b=0;if(this.selectedTds.length){var g=this.cellsRange,h=g.endRowIndex+1;for(var f=g.beginRowIndex;f<h;f++){c[f]=p[f]}c.splice(0,g.beginRowIndex);b=(g.endRowIndex+1)===this.rowsNum?0:g.endRowIndex+1}else{for(var f=0,h=p.length;f<h;f++){c[f]=p[f]}}var n={reversecurrent:function(q,j){return 1},orderbyasc:function(s,r){var q=s.innerText||s.textContent,j=r.innerText||r.textContent;return q.localeCompare(j)},reversebyasc:function(s,r){var q=s.innerHTML,j=r.innerHTML;return j.localeCompare(q)},orderbynum:function(s,r){var q=s[browser.ie?"innerText":"textContent"].match(/\d+/),j=r[browser.ie?"innerText":"textContent"].match(/\d+/);if(q){q=+q[0]}if(j){j=+j[0]}return(q||0)-(j||0)},reversebynum:function(s,r){var q=s[browser.ie?"innerText":"textContent"].match(/\d+/),j=r[browser.ie?"innerText":"textContent"].match(/\d+/);if(q){q=+q[0]}if(j){j=+j[0]}return(j||0)-(q||0)}};o.setAttribute("data-sort-type",a&&typeof a==="string"&&n[a]?a:"");m&&c.splice(0,1);c=utils.sort(c,function(q,r){var j;if(a&&typeof a==="function"){j=a.call(this,q.cells[l],r.cells[l])}else{if(a&&typeof a==="number"){j=1}else{if(a&&typeof a==="string"&&n[a]){j=n[a].call(this,q.cells[l],r.cells[l])}else{j=n.orderbyasc.call(this,q.cells[l],r.cells[l])}}}return j});var k=o.ownerDocument.createDocumentFragment();for(var d=0,h=c.length;d<h;d++){k.appendChild(c[d])}var e=o.getElementsByTagName("tbody")[0];if(!b){e.appendChild(k)}else{e.insertBefore(k,p[b-g.endRowIndex+g.beginRowIndex-1])}};UE.plugins.tablesort=function(){var c=this,d=UE.UETable,b=function(e){return d.getUETable(e)},a=function(e){return d.getTableItemsByRange(e)};c.ready(function(){utils.cssRule("tablesort","table.sortEnabled tr.firstRow th,table.sortEnabled tr.firstRow td{padding-right:20px;background-repeat: no-repeat;background-position: center right;   background-image:url("+c.options.themePath+c.options.theme+"/images/sortable.png);}",c.document);c.addListener("afterexeccommand",function(e,f){if(f=="mergeright"||f=="mergedown"||f=="mergecells"){this.execCommand("disablesort")}})});UE.commands.sorttable={queryCommandState:function(){var j=this,k=a(j);if(!k.cell){return -1}var h=k.table,f=h.getElementsByTagName("td");for(var g=0,e;e=f[g++];){if(e.rowSpan!=1||e.colSpan!=1){return -1}}return 0},execCommand:function(g,o){var n=this,l=n.selection.getRange(),j=l.createBookmark(true),f=a(n),p=f.cell,h=b(f.table),k=h.getCellInfo(p);h.sortTable(k.cellIndex,o);l.moveToBookmark(j);try{l.select()}catch(m){}}};UE.commands.enablesort=UE.commands.disablesort={queryCommandState:function(h){var g=a(this).table;if(g&&h=="enablesort"){var e=domUtils.getElementsByTagName(g,"th td");for(var f=0;f<e.length;f++){if(e[f].getAttribute("colspan")>1||e[f].getAttribute("rowspan")>1){return -1}}}return !g?-1:h=="enablesort"^g.getAttribute("data-sort")!="sortEnabled"?-1:0},execCommand:function(f){var e=a(this).table;e.setAttribute("data-sort",f=="enablesort"?"sortEnabled":"sortDisabled");f=="enablesort"?domUtils.addClass(e,"sortEnabled"):domUtils.removeClasses(e,"sortEnabled")}}};UE.plugins.contextmenu=function(){var c=this;c.setOpt("enableContextMenu",true);if(c.getOpt("enableContextMenu")===false){return}var e=c.getLang("contextMenu"),d,a=c.options.contextMenu||[{label:e.selectall,cmdName:"selectall"},{label:e.cleardoc,cmdName:"cleardoc",exec:function(){if(confirm(e.confirmclear)){this.execCommand("cleardoc")}}},"-",{label:e.unlink,cmdName:"unlink"},"-",{group:e.paragraph,icon:"justifyjustify",subMenu:[{label:e.justifyleft,cmdName:"justify",value:"left"},{label:e.justifyright,cmdName:"justify",value:"right"},{label:e.justifycenter,cmdName:"justify",value:"center"},{label:e.justifyjustify,cmdName:"justify",value:"justify"}]},"-",{group:e.table,icon:"table",subMenu:[{label:e.inserttable,cmdName:"inserttable"},{label:e.deletetable,cmdName:"deletetable"},"-",{label:e.deleterow,cmdName:"deleterow"},{label:e.deletecol,cmdName:"deletecol"},{label:e.insertcol,cmdName:"insertcol"},{label:e.insertcolnext,cmdName:"insertcolnext"},{label:e.insertrow,cmdName:"insertrow"},{label:e.insertrownext,cmdName:"insertrownext"},"-",{label:e.insertcaption,cmdName:"insertcaption"},{label:e.deletecaption,cmdName:"deletecaption"},{label:e.inserttitle,cmdName:"inserttitle"},{label:e.deletetitle,cmdName:"deletetitle"},{label:e.inserttitlecol,cmdName:"inserttitlecol"},{label:e.deletetitlecol,cmdName:"deletetitlecol"},"-",{label:e.mergecells,cmdName:"mergecells"},{label:e.mergeright,cmdName:"mergeright"},{label:e.mergedown,cmdName:"mergedown"},"-",{label:e.splittorows,cmdName:"splittorows"},{label:e.splittocols,cmdName:"splittocols"},{label:e.splittocells,cmdName:"splittocells"},"-",{label:e.averageDiseRow,cmdName:"averagedistributerow"},{label:e.averageDisCol,cmdName:"averagedistributecol"},"-",{label:e.edittd,cmdName:"edittd",exec:function(){if(UE.ui.edittd){new UE.ui.edittd(this)}this.getDialog("edittd").open()}},{label:e.edittable,cmdName:"edittable",exec:function(){if(UE.ui.edittable){new UE.ui.edittable(this)}this.getDialog("edittable").open()}},{label:e.setbordervisible,cmdName:"setbordervisible"}]},{group:e.tablesort,icon:"tablesort",subMenu:[{label:e.enablesort,cmdName:"enablesort"},{label:e.disablesort,cmdName:"disablesort"},"-",{label:e.reversecurrent,cmdName:"sorttable",value:"reversecurrent"},{label:e.orderbyasc,cmdName:"sorttable",value:"orderbyasc"},{label:e.reversebyasc,cmdName:"sorttable",value:"reversebyasc"},{label:e.orderbynum,cmdName:"sorttable",value:"orderbynum"},{label:e.reversebynum,cmdName:"sorttable",value:"reversebynum"}]},{group:e.borderbk,icon:"borderBack",subMenu:[{label:e.setcolor,cmdName:"interlacetable",exec:function(){this.execCommand("interlacetable")}},{label:e.unsetcolor,cmdName:"uninterlacetable",exec:function(){this.execCommand("uninterlacetable")}},{label:e.setbackground,cmdName:"settablebackground",exec:function(){this.execCommand("settablebackground",{repeat:true,colorList:["#bbb","#ccc"]})}},{label:e.unsetbackground,cmdName:"cleartablebackground",exec:function(){this.execCommand("cleartablebackground")}},{label:e.redandblue,cmdName:"settablebackground",exec:function(){this.execCommand("settablebackground",{repeat:true,colorList:["red","blue"]})}},{label:e.threecolorgradient,cmdName:"settablebackground",exec:function(){this.execCommand("settablebackground",{repeat:true,colorList:["#aaa","#bbb","#ccc"]})}}]},{group:e.aligntd,icon:"aligntd",subMenu:[{cmdName:"cellalignment",value:{align:"left",vAlign:"top"}},{cmdName:"cellalignment",value:{align:"center",vAlign:"top"}},{cmdName:"cellalignment",value:{align:"right",vAlign:"top"}},{cmdName:"cellalignment",value:{align:"left",vAlign:"middle"}},{cmdName:"cellalignment",value:{align:"center",vAlign:"middle"}},{cmdName:"cellalignment",value:{align:"right",vAlign:"middle"}},{cmdName:"cellalignment",value:{align:"left",vAlign:"bottom"}},{cmdName:"cellalignment",value:{align:"center",vAlign:"bottom"}},{cmdName:"cellalignment",value:{align:"right",vAlign:"bottom"}}]},{group:e.aligntable,icon:"aligntable",subMenu:[{cmdName:"tablealignment",className:"left",label:e.tableleft,value:"left"},{cmdName:"tablealignment",className:"center",label:e.tablecenter,value:"center"},{cmdName:"tablealignment",className:"right",label:e.tableright,value:"right"}]},"-",{label:e.insertparagraphbefore,cmdName:"insertparagraph",value:true},{label:e.insertparagraphafter,cmdName:"insertparagraph"},{label:e.copy,cmdName:"copy"},{label:e.paste,cmdName:"paste"}];if(!a.length){return}var b=UE.ui.uiUtils;c.addListener("contextmenu",function(m,o){var h=b.getViewportOffsetByEvent(o);c.fireEvent("beforeselectionchange");if(d){d.destroy()}for(var j=0,f,p=[];f=a[j];j++){var n;(function(t){if(t=="-"){if((n=p[p.length-1])&&n!=="-"){p.push("-")}}else{if(t.hasOwnProperty("group")){for(var s=0,r,q=[];r=t.subMenu[s];s++){(function(v){if(v=="-"){if((n=q[q.length-1])&&n!=="-"){q.push("-")}else{q.splice(q.length-1)}}else{if((c.commands[v.cmdName]||UE.commands[v.cmdName]||v.query)&&(v.query?v.query():c.queryCommandState(v.cmdName))>-1){q.push({label:v.label||c.getLang("contextMenu."+v.cmdName+(v.value||""))||"",className:"edui-for-"+v.cmdName+(v.className?(" edui-for-"+v.cmdName+"-"+v.className):""),onclick:v.exec?function(){v.exec.call(c)}:function(){c.execCommand(v.cmdName,v.value)}})}}})(r)}if(q.length){function u(){switch(t.icon){case"table":return c.getLang("contextMenu.table");case"justifyjustify":return c.getLang("contextMenu.paragraph");case"aligntd":return c.getLang("contextMenu.aligntd");case"aligntable":return c.getLang("contextMenu.aligntable");case"tablesort":return e.tablesort;case"borderBack":return e.borderbk;default:return""}}p.push({label:u(),className:"edui-for-"+t.icon,subMenu:{items:q,editor:c}})}}else{if((c.commands[t.cmdName]||UE.commands[t.cmdName]||t.query)&&(t.query?t.query.call(c):c.queryCommandState(t.cmdName))>-1){p.push({label:t.label||c.getLang("contextMenu."+t.cmdName),className:"edui-for-"+(t.icon?t.icon:t.cmdName+(t.value||"")),onclick:t.exec?function(){t.exec.call(c)}:function(){c.execCommand(t.cmdName,t.value)}})}}}})(f)}if(p[p.length-1]=="-"){p.pop()}d=new UE.ui.Menu({items:p,className:"edui-contextmenu",editor:c});d.render();d.showAt(h);c.fireEvent("aftershowcontextmenu",d);domUtils.preventDefault(o);if(browser.ie){var g;try{g=c.selection.getNative().createRange()}catch(l){return}if(g.item){var k=new dom.Range(c.document);k.selectNode(g.item(0)).select(true,true)}}});c.addListener("aftershowcontextmenu",function(h,j){if(c.zeroclipboard){var f=j.items;for(var g in f){if(f[g].className=="edui-for-copy"){c.zeroclipboard.clip(f[g].getDom())}}}})};UE.plugins.shortcutmenu=function(){var b=this,c,a=b.options.shortcutMenu||[];if(!a.length){return}b.addListener("contextmenu mouseup",function(f,k){var h=this,g={type:f,target:k.target||k.srcElement,screenX:k.screenX,screenY:k.screenY,clientX:k.clientX,clientY:k.clientY};setTimeout(function(){var e=h.selection.getRange();if(e.collapsed===false||f=="contextmenu"){if(!c){c=new baidu.editor.ui.ShortCutMenu({editor:h,items:a,theme:h.options.theme,className:"edui-shortcutmenu"});c.render();h.fireEvent("afterrendershortcutmenu",c)}c.show(g,!!UE.plugins.contextmenu)}});if(f=="contextmenu"){domUtils.preventDefault(k);if(browser.ie9below){var j;try{j=h.selection.getNative().createRange()}catch(k){return}if(j.item){var d=new dom.Range(h.document);d.selectNode(j.item(0)).select(true,true)}}}});b.addListener("keydown",function(d){if(d=="keydown"){c&&!c.isHidden&&c.hide()}})};UE.plugins.basestyle=function(){var d={bold:["strong","b"],italic:["em","i"],subscript:["sub"],superscript:["sup"]},c=function(f,e){return domUtils.filterNodeList(f.selection.getStartElementPath(),e)},b=this;b.addshortcutkey({Bold:"ctrl+66",Italic:"ctrl+73",Underline:"ctrl+85"});b.addInputRule(function(e){utils.each(e.getNodesByTagName("b i"),function(f){switch(f.tagName){case"b":f.tagName="strong";break;case"i":f.tagName="em"}})});for(var a in d){(function(f,e){b.commands[f]={execCommand:function(h){var g=b.selection.getRange(),l=c(this,e);if(g.collapsed){if(l){var k=b.document.createTextNode("");g.insertNode(k).removeInlineStyle(e);g.setStartBefore(k);domUtils.remove(k)}else{var j=g.document.createElement(e[0]);if(h=="superscript"||h=="subscript"){k=b.document.createTextNode("");g.insertNode(k).removeInlineStyle(["sub","sup"]).setStartBefore(k).collapse(true)}g.insertNode(j).setStart(j,0)}g.collapse(true)}else{if(h=="superscript"||h=="subscript"){if(!l||l.tagName.toLowerCase()!=h){g.removeInlineStyle(["sub","sup"])}}l?g.removeInlineStyle(e):g.applyInlineStyle(e[0])}g.select()},queryCommandState:function(){return c(this,e)?1:0}}})(a,d[a])}};UE.plugins.elementpath=function(){var c,a,b=this;b.setOpt("elementPathEnabled",true);if(!b.options.elementPathEnabled){return}b.commands.elementpath={execCommand:function(e,g){var f=a[g],d=b.selection.getRange();c=g*1;d.selectNode(f).select()},queryCommandValue:function(){var e=[].concat(this.selection.getStartElementPath()).reverse(),h=[];a=e;for(var g=0,f;f=e[g];g++){if(f.nodeType==3){continue}var d=f.tagName.toLowerCase();if(d=="img"&&f.getAttribute("anchorname")){d="anchor"}h[g]=d;if(c==g){c=-1;break}}return h}}};UE.plugins.formatmatch=function(){var c=this,d=[],b,a=0;c.addListener("reset",function(){d=[];a=0});function e(l,n){if(browser.webkit){var k=n.target.tagName=="IMG"?n.target:null}function f(p){if(o){p.selectNode(o)}return p.applyInlineStyle(d[d.length-1].tagName,null,d)}c.undoManger&&c.undoManger.save();var j=c.selection.getRange(),m=k||j.getClosedNode();if(b&&m&&m.tagName=="IMG"){m.style.cssText+=";float:"+(b.style.cssFloat||b.style.styleFloat||"none")+";display:"+(b.style.display||"inline");b=null}else{if(!b){var h=j.collapsed;if(h){var o=c.document.createTextNode("match");j.insertNode(o).select()}c.__hasEnterExecCommand=true;var g=c.options.removeFormatAttributes;c.options.removeFormatAttributes="";c.execCommand("removeformat");c.options.removeFormatAttributes=g;c.__hasEnterExecCommand=false;j=c.selection.getRange();if(d.length){f(j)}if(o){j.setStartBefore(o).collapse(true)}j.select();o&&domUtils.remove(o)}}c.undoManger&&c.undoManger.save();c.removeListener("mouseup",e);a=0}c.commands.formatmatch={execCommand:function(g){if(a){a=0;d=[];c.removeListener("mouseup",e);return}var f=c.selection.getRange();b=f.getClosedNode();if(!b||b.tagName!="IMG"){f.collapse(true).shrinkBoundary();var k=f.startContainer;d=domUtils.findParents(k,true,function(l){return !domUtils.isBlockElm(l)&&l.nodeType==1});for(var j=0,h;h=d[j];j++){if(h.tagName=="A"){d.splice(j,1);break}}}c.addListener("mouseup",e);a=1},queryCommandState:function(){return a},notNeedUndo:1}};UE.plugin.register("searchreplace",function(){var e=this;var g={table:1,tbody:1,tr:1,ol:1,ul:1};function a(m,k,h){var n=k.searchStr;if(k.dir==-1){m=m.split("").reverse().join("");n=n.split("").reverse().join("");h=m.length-h}var l=new RegExp(n,"g"+(k.casesensitive?"":"i")),j;while(j=l.exec(m)){if(j.index>=h){return k.dir==-1?m.length-j.index-k.searchStr.length:j.index}}return -1}function c(n,h,l){var m,k,j=l.all||l.dir==1?"getNextDomNode":"getPreDomNode";if(domUtils.isBody(n)){n=n.firstChild}var o=1;while(n){m=n.nodeType==3?n.nodeValue:n[browser.ie?"innerText":"textContent"];k=a(m,l,h);o=0;if(k!=-1){return{node:n,index:k}}n=domUtils[j](n);while(n&&g[n.nodeName.toLowerCase()]){n=domUtils[j](n,true)}if(n){h=l.dir==-1?(n.nodeType==3?n.nodeValue:n[browser.ie?"innerText":"textContent"]).length:0}}}function f(n,l,o){var j=0,m=n.firstChild,k=0,h;while(m){if(m.nodeType==3){k=m.nodeValue.replace(/(^[\t\r\n]+)|([\t\r\n]+$)/,"").length;j+=k;if(j>=l){return{node:m,index:k-(j-l)}}}else{if(!dtd.$empty[m.tagName]){k=m[browser.ie?"innerText":"textContent"].replace(/(^[\t\r\n]+)|([\t\r\n]+$)/,"").length;j+=k;if(j>=l){h=f(m,k-(j-l),o);if(h){return h}}}}m=domUtils.getNextDomNode(m)}}function d(n,k){var h=n.selection.getRange(),j,l=k.searchStr,p=n.document.createElement("span");p.innerHTML="$$ueditor_searchreplace_key$$";h.shrinkBoundary(true);if(!h.collapsed){h.select();var q=n.selection.getText();if(new RegExp("^"+k.searchStr+"$",(k.casesensitive?"":"i")).test(q)){if(k.replaceStr!=undefined){b(h,k.replaceStr);h.select();return true}else{h.collapse(k.dir==-1)}}}h.insertNode(p);h.enlargeToBlockElm(true);j=h.startContainer;var m=j[browser.ie?"innerText":"textContent"].indexOf("$$ueditor_searchreplace_key$$");h.setStartBefore(p);domUtils.remove(p);var s=c(j,m,k);if(s){var o=f(s.node,s.index,l);var r=f(s.node,s.index+l.length,l);h.setStart(o.node,o.index).setEnd(r.node,r.index);if(k.replaceStr!==undefined){b(h,k.replaceStr)}h.select();return true}else{h.setCursor()}}function b(h,j){j=e.document.createTextNode(j);h.deleteContents().insertNode(j)}return{commands:{searchreplace:{execCommand:function(k,l){utils.extend(l,{all:false,casesensitive:false,dir:1},true);var j=0;if(l.all){var h=e.selection.getRange(),m=e.body.firstChild;if(m&&m.nodeType==1){h.setStart(m,0);h.shrinkBoundary(true)}else{if(m.nodeType==3){h.setStartBefore(m)}}h.collapse(true).select(true);if(l.replaceStr!==undefined){e.fireEvent("saveScene")}while(d(this,l)){j++}if(j){e.fireEvent("saveScene")}}else{if(l.replaceStr!==undefined){e.fireEvent("saveScene")}if(d(this,l)){j++}if(j){e.fireEvent("saveScene")}}return j},notNeedUndo:1}}}});UE.plugins.customstyle=function(){var a=this;a.setOpt({customstyle:[{tag:"h1",name:"tc",style:"font-size:32px;font-weight:bold;border-bottom:#ccc 2px solid;padding:0 4px 0 0;text-align:center;margin:0 0 20px 0;"},{tag:"h1",name:"tl",style:"font-size:32px;font-weight:bold;border-bottom:#ccc 2px solid;padding:0 4px 0 0;text-align:left;margin:0 0 10px 0;"},{tag:"span",name:"im",style:"font-size:16px;font-style:italic;font-weight:bold;line-height:18px;"},{tag:"span",name:"hi",style:"font-size:16px;font-style:italic;font-weight:bold;color:rgb(51, 153, 204);line-height:18px;"}]});a.commands.customstyle={execCommand:function(s,l){var q=this,f=l.tag,g=domUtils.findParent(q.selection.getStart(),function(p){return p.getAttribute("label")},true),m,h,j={};for(var d in l){if(l[d]!==undefined){j[d]=l[d]}}delete j.tag;if(g&&g.getAttribute("label")==l.label){m=this.selection.getRange();h=m.createBookmark();if(m.collapsed){if(dtd.$block[g.tagName]){var t=q.document.createElement("p");domUtils.moveChild(g,t);g.parentNode.insertBefore(t,g);domUtils.remove(g)}else{domUtils.remove(g,true)}}else{var n=domUtils.getCommonAncestor(h.start,h.end),c=domUtils.getElementsByTagName(n,f);if(new RegExp(f,"i").test(n.tagName)){c.push(n)}for(var k=0,e;e=c[k++];){if(e.getAttribute("label")==l.label){var b=domUtils.getPosition(e,h.start),o=domUtils.getPosition(e,h.end);if((b&domUtils.POSITION_FOLLOWING||b&domUtils.POSITION_CONTAINS)&&(o&domUtils.POSITION_PRECEDING||o&domUtils.POSITION_CONTAINS)){if(dtd.$block[f]){var t=q.document.createElement("p");domUtils.moveChild(e,t);e.parentNode.insertBefore(t,e)}}domUtils.remove(e,true)}}g=domUtils.findParent(n,function(p){return p.getAttribute("label")==l.label},true);if(g){domUtils.remove(g,true)}}m.moveToBookmark(h).select()}else{if(dtd.$block[f]){this.execCommand("paragraph",f,j,"customstyle");m=q.selection.getRange();if(!m.collapsed){m.collapse();g=domUtils.findParent(q.selection.getStart(),function(p){return p.getAttribute("label")==l.label},true);var r=q.document.createElement("p");domUtils.insertAfter(g,r);domUtils.fillNode(q.document,r);m.setStart(r,0).setCursor()}}else{m=q.selection.getRange();if(m.collapsed){g=q.document.createElement(f);domUtils.setAttributes(g,j);m.insertNode(g).setStart(g,0).setCursor();return}h=m.createBookmark();m.applyInlineStyle(f,j).moveToBookmark(h).select()}}},queryCommandValue:function(){var b=domUtils.filterNodeList(this.selection.getStartElementPath(),function(c){return c.getAttribute("label")});return b?b.getAttribute("label"):""}};a.addListener("keyup",function(d,b){var g=b.keyCode||b.which;if(g==32||g==13){var c=a.selection.getRange();if(c.collapsed){var e=domUtils.findParent(a.selection.getStart(),function(h){return h.getAttribute("label")},true);if(e&&dtd.$block[e.tagName]&&domUtils.isEmptyNode(e)){var f=a.document.createElement("p");domUtils.insertAfter(e,f);domUtils.fillNode(a.document,f);domUtils.remove(e);c.setStart(f,0).setCursor()}}}})};UE.plugins.catchremoteimage=function(){var me=this,ajax=UE.ajax;if(me.options.catchRemoteImageEnable===false){return}me.setOpt({catchRemoteImageEnable:false});me.addListener("afterpaste",function(){me.fireEvent("catchRemoteImage")});me.addListener("catchRemoteImage",function(){var catcherLocalDomain=me.getOpt("catcherLocalDomain"),catcherActionUrl=me.getActionUrl(me.getOpt("catcherActionName")),catcherUrlPrefix=me.getOpt("catcherUrlPrefix"),catcherFieldName=me.getOpt("catcherFieldName");var remoteImages=[],imgs=domUtils.getElementsByTagName(me.document,"img"),test=function(src,urls){if(src.indexOf(location.host)!=-1||/(^\.)|(^\/)/.test(src)){return true}if(urls){for(var j=0,url;url=urls[j++];){if(src.indexOf(url)!==-1){return true}}}return false};for(var i=0,ci;ci=imgs[i++];){if(ci.getAttribute("word_img")){continue}var src=ci.getAttribute("_src")||ci.src||"";if(/^(https?|ftp):/i.test(src)&&!test(src,catcherLocalDomain)){remoteImages.push(src)}}if(remoteImages.length){catchremoteimage(remoteImages,{success:function(r){try{var info=r.state!==undefined?r:eval("("+r.responseText+")")}catch(e){return}var i,j,ci,cj,oldSrc,newSrc,list=info.list;for(i=0;ci=imgs[i++];){oldSrc=ci.getAttribute("_src")||ci.src||"";for(j=0;cj=list[j++];){if(oldSrc==cj.source&&cj.state=="SUCCESS"){newSrc=catcherUrlPrefix+cj.url;domUtils.setAttributes(ci,{src:newSrc,_src:newSrc});break}}}me.fireEvent("catchremotesuccess")},error:function(){me.fireEvent("catchremoteerror")}})}function catchremoteimage(imgs,callbacks){var params=utils.serializeParam(me.queryCommandValue("serverparam"))||"",url=utils.formatUrl(catcherActionUrl+(catcherActionUrl.indexOf("?")==-1?"?":"&")+params),isJsonp=utils.isCrossDomainUrl(url),opt={method:"POST",dataType:isJsonp?"jsonp":"",timeout:60000,onsuccess:callbacks.success,onerror:callbacks.error};opt[catcherFieldName]=imgs;ajax.request(url,opt)}})};UE.plugin.register("snapscreen",function(){var me=this;var snapplugin;function getLocation(url){var search,a=document.createElement("a"),params=utils.serializeParam(me.queryCommandValue("serverparam"))||"";a.href=url;if(browser.ie){a.href=a.href}search=a.search;if(params){search=search+(search.indexOf("?")==-1?"?":"&")+params;search=search.replace(/[&]+/ig,"&")}return{port:a.port,hostname:a.hostname,path:a.pathname+search||+a.hash}}return{commands:{snapscreen:{execCommand:function(cmd){var url,local,res;var lang=me.getLang("snapScreen_plugin");if(!snapplugin){var container=me.container;var doc=me.container.ownerDocument||me.container.document;snapplugin=doc.createElement("object");try{snapplugin.type="application/x-pluginbaidusnap"}catch(e){return}snapplugin.style.cssText="position:absolute;left:-9999px;width:0;height:0;";snapplugin.setAttribute("width","0");snapplugin.setAttribute("height","0");container.appendChild(snapplugin)}function onSuccess(rs){try{rs=eval("("+rs+")");if(rs.state=="SUCCESS"){var opt=me.options;me.execCommand("insertimage",{src:opt.snapscreenUrlPrefix+rs.url,_src:opt.snapscreenUrlPrefix+rs.url,alt:rs.title||"",floatStyle:opt.snapscreenImgAlign})}else{alert(rs.state)}}catch(e){alert(lang.callBackErrorMsg)}}url=me.getActionUrl(me.getOpt("snapscreenActionName"));local=getLocation(url);setTimeout(function(){try{res=snapplugin.saveSnapshot(local.hostname,local.path,local.port)}catch(e){me.ui._dialogs.snapscreenDialog.open();return}onSuccess(res)},50)},queryCommandState:function(){return(navigator.userAgent.indexOf("Windows",0)!=-1)?0:-1}}}}});UE.commands.insertparagraph={execCommand:function(b,e){var d=this,a=d.selection.getRange(),g=a.startContainer,c;while(g){if(domUtils.isBody(g)){break}c=g;g=g.parentNode}if(c){var f=d.document.createElement("p");if(e){c.parentNode.insertBefore(f,c)}else{c.parentNode.insertBefore(f,c.nextSibling)}domUtils.fillNode(d.document,f);a.setStart(f,0).setCursor(false,true)}}};UE.plugin.register("webapp",function(){var a=this;function b(d,c){return !c?'<img title="'+d.title+'" width="'+d.width+'" height="'+d.height+'" src="'+a.options.UEDITOR_HOME_URL+'themes/default/images/spacer.gif" _logo_url="'+d.logo+'" style="background:url('+d.logo+') no-repeat center center; border:1px solid gray;" class="edui-faked-webapp" _url="'+d.url+'" '+(d.align&&!d.cssfloat?'align="'+d.align+'"':"")+(d.cssfloat?'style="float:'+d.cssfloat+'"':"")+"/>":'<iframe class="edui-faked-webapp" title="'+d.title+'" '+(d.align&&!d.cssfloat?'align="'+d.align+'"':"")+(d.cssfloat?'style="float:'+d.cssfloat+'"':"")+'width="'+d.width+'" height="'+d.height+'"  scrolling="no" frameborder="0" src="'+d.url+'" logo_url = "'+d.logo+'"></iframe>'}return{outputRule:function(c){utils.each(c.getNodesByTagName("img"),function(e){var d;if(e.getAttr("class")=="edui-faked-webapp"){d=b({title:e.getAttr("title"),width:e.getAttr("width"),height:e.getAttr("height"),align:e.getAttr("align"),cssfloat:e.getStyle("float"),url:e.getAttr("_url"),logo:e.getAttr("_logo_url")},true);var f=UE.uNode.createElement(d);e.parentNode.replaceChild(f,e)}})},inputRule:function(c){utils.each(c.getNodesByTagName("iframe"),function(e){if(e.getAttr("class")=="edui-faked-webapp"){var d=UE.uNode.createElement(b({title:e.getAttr("title"),width:e.getAttr("width"),height:e.getAttr("height"),align:e.getAttr("align"),cssfloat:e.getStyle("float"),url:e.getAttr("src"),logo:e.getAttr("logo_url")}));e.parentNode.replaceChild(d,e)}})},commands:{webapp:{execCommand:function(d,e){var c=this,f=b(utils.extend(e,{align:"none"}),false);c.execCommand("inserthtml",f)},queryCommandState:function(){var e=this,d=e.selection.getRange().getClosedNode(),c=d&&(d.className=="edui-faked-webapp");return c?1:0}}}}});UE.plugins.template=function(){UE.commands.template={execCommand:function(a,b){b.html&&this.execCommand("inserthtml",b.html)}};this.addListener("click",function(d,a){var c=a.target||a.srcElement,b=this.selection.getRange();var e=domUtils.findParent(c,function(f){if(f.className&&domUtils.hasClass(f,"ue_t")){return f}},true);e&&b.selectNode(e).shrinkBoundary().select()});this.addListener("keydown",function(c,a){var b=this.selection.getRange();if(!b.collapsed){if(!a.ctrlKey&&!a.metaKey&&!a.shiftKey&&!a.altKey){var d=domUtils.findParent(b.startContainer,function(e){if(e.className&&domUtils.hasClass(e,"ue_t")){return e}},true);if(d){domUtils.removeClasses(d,["ue_t"])}}}})};UE.plugin.register("music",function(){var b=this;function a(d,f,c,h,g,e){return !e?"<img "+(h&&!g?'align="'+h+'"':"")+(g?'style="float:'+g+'"':"")+' width="'+f+'" height="'+c+'" _url="'+d+'" class="edui-faked-music" src="'+b.options.langPath+b.options.lang+'/images/music.png" />':'<embed type="application/x-shockwave-flash" class="edui-faked-music" pluginspage="http://www.macromedia.com/go/getflashplayer" src="'+d+'" width="'+f+'" height="'+c+'" '+(h&&!g?'align="'+h+'"':"")+(g?'style="float:'+g+'"':"")+' wmode="transparent" play="true" loop="false" menu="false" allowscriptaccess="never" allowfullscreen="true" >'}return{outputRule:function(c){utils.each(c.getNodesByTagName("img"),function(e){var d;if(e.getAttr("class")=="edui-faked-music"){var f=e.getStyle("float");var h=e.getAttr("align");d=a(e.getAttr("_url"),e.getAttr("width"),e.getAttr("height"),h,f,true);var g=UE.uNode.createElement(d);e.parentNode.replaceChild(g,e)}})},inputRule:function(c){utils.each(c.getNodesByTagName("embed"),function(e){if(e.getAttr("class")=="edui-faked-music"){var f=e.getStyle("float");var g=e.getAttr("align");html=a(e.getAttr("src"),e.getAttr("width"),e.getAttr("height"),g,f,false);var d=UE.uNode.createElement(html);e.parentNode.replaceChild(d,e)}})},commands:{music:{execCommand:function(d,e){var c=this,f=a(e.url,e.width||400,e.height||95,"none",false);c.execCommand("inserthtml",f)},queryCommandState:function(){var e=this,d=e.selection.getRange().getClosedNode(),c=d&&(d.className=="edui-faked-music");return c?1:0}}}}});UE.plugin.register("autoupload",function(){function a(t,h){var v=h;var d,o,e,p,m,k,l,r,u=/image\/\w+/i.test(t.type)?"image":"file",g="loading_"+(+new Date()).toString(36);d=v.getOpt(u+"FieldName");o=v.getOpt(u+"UrlPrefix");e=v.getOpt(u+"MaxSize");p=v.getOpt(u+"AllowFiles");m=v.getActionUrl(v.getOpt(u+"ActionName"));l=function(x){var w=v.document.getElementById(g);w&&domUtils.remove(w);v.fireEvent("showmessage",{id:g,content:x,type:"error",timeout:4000})};if(u=="image"){k='<img class="loadingclass" id="'+g+'" src="'+v.options.themePath+v.options.theme+'/images/spacer.gif" title="'+(v.getLang("autoupload.loading")||"")+'" >';r=function(y){var x=o+y.url,w=v.document.getElementById(g);if(w){w.setAttribute("src",x);w.setAttribute("_src",x);w.setAttribute("title",y.title||"");w.setAttribute("alt",y.original||"");w.removeAttribute("id");domUtils.removeClasses(w,"loadingclass")}}}else{k='<p><img class="loadingclass" id="'+g+'" src="'+v.options.themePath+v.options.theme+'/images/spacer.gif" title="'+(v.getLang("autoupload.loading")||"")+'" ></p>';r=function(A){var z=o+A.url,x=v.document.getElementById(g);var y=v.selection.getRange(),w=y.createBookmark();y.selectNode(x).select();v.execCommand("insertfile",{url:z});y.moveToBookmark(w).select()}}v.execCommand("inserthtml",k);if(!v.getOpt(u+"ActionName")){l(v.getLang("autoupload.errorLoadConfig"));return}if(t.size>e){l(v.getLang("autoupload.exceedSizeError"));return}var f=t.name?t.name.substr(t.name.lastIndexOf(".")):"";if((f&&u!="image")||(p&&(p.join("")+".").indexOf(f.toLowerCase()+".")==-1)){l(v.getLang("autoupload.exceedTypeError"));return}var n=new XMLHttpRequest(),q=new FormData(),s=utils.serializeParam(v.queryCommandValue("serverparam"))||"",j=utils.formatUrl(m+(m.indexOf("?")==-1?"?":"&")+s);q.append(d,t,t.name||("blob."+t.type.substr("image/".length)));q.append("type","ajax");n.open("post",j,true);n.setRequestHeader("X-Requested-With","XMLHttpRequest");n.addEventListener("load",function(x){try{var w=(new Function("return "+utils.trim(x.target.response)))();if(w.state=="SUCCESS"&&w.url){r(w)}else{l(w.state)}}catch(y){l(v.getLang("autoupload.loadError"))}});n.send(q)}function c(d){return d.clipboardData&&d.clipboardData.items&&d.clipboardData.items.length==1&&/^image\//.test(d.clipboardData.items[0].type)?d.clipboardData.items:null}function b(d){return d.dataTransfer&&d.dataTransfer.files?d.dataTransfer.files:null}return{outputRule:function(d){utils.each(d.getNodesByTagName("img"),function(e){if(/\b(loaderrorclass)|(bloaderrorclass)\b/.test(e.getAttr("class"))){e.parentNode.removeChild(e)}});utils.each(d.getNodesByTagName("p"),function(e){if(/\bloadpara\b/.test(e.getAttr("class"))){e.parentNode.removeChild(e)}})},bindEvents:{ready:function(f){var d=this;if(window.FormData&&window.FileReader){domUtils.on(d.body,"paste drop",function(l){var h=false,j;j=l.type=="paste"?c(l):b(l);if(j){var g=j.length,k;while(g--){k=j[g];if(k.getAsFile){k=k.getAsFile()}if(k&&k.size>0){a(k,d);h=true}}h&&l.preventDefault()}});domUtils.on(d.body,"dragover",function(g){if(g.dataTransfer.types[0]=="Files"){g.preventDefault()}});utils.cssRule("loading",".loadingclass{display:inline-block;cursor:default;background: url('"+this.options.themePath+this.options.theme+"/images/loading.gif') no-repeat center center transparent;border:1px solid #cccccc;margin-left:1px;height: 22px;width: 22px;}\n.loaderrorclass{display:inline-block;cursor:default;background: url('"+this.options.themePath+this.options.theme+"/images/loaderror.png') no-repeat center center transparent;border:1px solid #cccccc;margin-right:1px;height: 22px;width: 22px;}",this.document)}}}}});UE.plugin.register("autosave",function(){var d=this,b=new Date(),a=20,e=null;function c(g){var f;if(new Date()-b<a){return}if(!g.hasContents()){e&&d.removePreferences(e);return}b=new Date();g._saveFlag=null;f=d.body.innerHTML;if(g.fireEvent("beforeautosave",{content:f})===false){return}d.setPreferences(e,f);g.fireEvent("afterautosave",{content:f})}return{defaultOptions:{saveInterval:500},bindEvents:{ready:function(){var f="-drafts-data",g=null;if(d.key){g=d.key+f}else{g=(d.container.parentNode.id||"ue-common")+f}e=(location.protocol+location.host+location.pathname).replace(/[.:\/]/g,"_")+g},contentchange:function(){if(!e){return}if(d._saveFlag){window.clearTimeout(d._saveFlag)}if(d.options.saveInterval>0){d._saveFlag=window.setTimeout(function(){c(d)},d.options.saveInterval)}else{c(d)}}},commands:{clearlocaldata:{execCommand:function(g,f){if(e&&d.getPreferences(e)){d.removePreferences(e)}},notNeedUndo:true,ignoreContentChange:true},getlocaldata:{execCommand:function(g,f){return e?d.getPreferences(e)||"":""},notNeedUndo:true,ignoreContentChange:true},drafts:{execCommand:function(g,f){if(e){d.body.innerHTML=d.getPreferences(e)||"<p>"+domUtils.fillHtml+"</p>";d.focus(true)}},queryCommandState:function(){return e?(d.getPreferences(e)===null?-1:0):-1},notNeedUndo:true,ignoreContentChange:true}}}});UE.plugin.register("charts",function(){var a=this;return{bindEvents:{chartserror:function(){}},commands:{charts:{execCommand:function(h,g){var f=domUtils.findParentByTagName(this.selection.getRange().startContainer,"table",true),d=[],c={};if(!f){return false}if(!b(f)){a.fireEvent("chartserror");return false}c.title=g.title||"";c.subTitle=g.subTitle||"";c.xTitle=g.xTitle||"";c.yTitle=g.yTitle||"";c.suffix=g.suffix||"";c.tip=g.tip||"";c.dataFormat=g.tableDataFormat||"";c.chartType=g.chartType||0;for(var e in c){if(!c.hasOwnProperty(e)){continue}d.push(e+":"+c[e])}f.setAttribute("data-chart",d.join(";"));domUtils.addClass(f,"edui-charts-table")},queryCommandState:function(e,c){var d=domUtils.findParentByTagName(this.selection.getRange().startContainer,"table",true);return d&&b(d)?0:-1}}},inputRule:function(c){utils.each(c.getNodesByTagName("table"),function(d){if(d.getAttr("data-chart")!==undefined){d.setAttr("style")}})},outputRule:function(c){utils.each(c.getNodesByTagName("table"),function(d){if(d.getAttr("data-chart")!==undefined){d.setAttr("style","display: none;")}})}};function b(g){var l=null,f=0;if(g.rows.length<2){return false}if(g.rows[0].cells.length<2){return false}l=g.rows[0].cells;f=l.length;for(var e=0,c;c=l[e];e++){if(c.tagName.toLowerCase()!=="th"){return false}}for(var e=1,k;k=g.rows[e];e++){if(k.cells.length!=f){return false}if(k.cells[0].tagName.toLowerCase()!=="th"){return false}for(var d=1,c;c=k.cells[d];d++){var h=utils.trim((c.innerText||c.textContent||""));h=h.replace(new RegExp(UE.dom.domUtils.fillChar,"g"),"").replace(/^\s+|\s+$/g,"");if(!/^\d*\.?\d+$/.test(h)){return false}}}return true}});UE.plugin.register("section",function(){function d(e){this.tag="";this.level=-1,this.dom=null;this.nextSection=null;this.previousSection=null;this.parentSection=null;this.startAddress=[];this.endAddress=[];this.children=[]}function a(e){var f=new d();return utils.extend(f,e)}function b(f,e){var h=e;for(var g=0;g<f.length;g++){if(!h.childNodes){return null}h=h.childNodes[f[g]]}return h}var c=this;return{bindMultiEvents:{type:"aftersetcontent afterscencerestore",handler:function(){c.fireEvent("updateSections")}},bindEvents:{ready:function(){c.fireEvent("updateSections");domUtils.on(c.body,"drop paste",function(){c.fireEvent("updateSections")})},afterexeccommand:function(e,f){if(f=="paragraph"){c.fireEvent("updateSections")}},keyup:function(g,k){var h=this,f=h.selection.getRange();if(f.collapsed!=true){h.fireEvent("updateSections")}else{var j=k.keyCode||k.which;if(j==13||j==8||j==46){h.fireEvent("updateSections")}}}},commands:{getsections:{execCommand:function(e,m){var g=m||["h1","h2","h3","h4","h5","h6"];for(var f=0;f<g.length;f++){if(typeof g[f]=="string"){g[f]=function(o){return function(p){return p.tagName==o.toUpperCase()}}(g[f])}else{if(typeof g[f]!="function"){g[f]=function(o){return null}}}}function n(p){for(var o=0;o<g.length;o++){if(g[o](p)){return o}}return -1}var k=this,l=a({level:-1,title:"root"}),h=l;function j(r,w){var o,s=null,y,p,q=r.childNodes;for(var t=0,u=q.length;t<u;t++){p=q[t];o=n(p);if(o>=0){var x=k.selection.getRange().selectNode(p).createAddress(true).startAddress,v=a({tag:p.tagName,title:p.innerText||p.textContent||"",level:o,dom:p,startAddress:utils.clone(x,[]),endAddress:utils.clone(x,[]),children:[]});h.nextSection=v;v.previousSection=h;y=h;while(o<=y.level){y=y.parentSection}v.parentSection=y;y.children.push(v);s=h=v}else{p.nodeType===1&&j(p,w);s&&s.endAddress[s.endAddress.length-1]++}}}j(k.body,l);return l},notNeedUndo:true},movesection:{execCommand:function(f,j,o,p){var m=this,q,l;if(!j||!o||o.level==-1){return}q=p?o.endAddress:o.startAddress;l=b(q,m.body);if(!q||!l||n(j.startAddress,j.endAddress,q)){return}var e=b(j.startAddress,m.body),h=b(j.endAddress,m.body),k,g;if(p){k=h;while(k&&!(domUtils.getPosition(e,k)&domUtils.POSITION_FOLLOWING)){g=k.previousSibling;domUtils.insertAfter(l,k);if(k==e){break}k=g}}else{k=e;while(k&&!(domUtils.getPosition(k,h)&domUtils.POSITION_FOLLOWING)){g=k.nextSibling;l.parentNode.insertBefore(k,l);if(k==h){break}k=g}}m.fireEvent("updateSections");function n(s,r,u){var w=false,v=false;for(var t=0;t<s.length;t++){if(t>=u.length){break}if(u[t]>s[t]){w=true;break}else{if(u[t]<s[t]){break}}}for(var t=0;t<r.length;t++){if(t>=u.length){break}if(u[t]<s[t]){v=true;break}else{if(u[t]>s[t]){break}}}return w&&v}}},deletesection:{execCommand:function(g,n,h){var m=this;if(!n){return}function f(o){var q=m.body;for(var p=0;p<o.length;p++){if(!q.childNodes){return null}q=q.childNodes[o[p]]}return q}var e=f(n.startAddress),k=f(n.endAddress),l=e,j;if(!h){while(l&&domUtils.inDoc(k,m.document)&&!(domUtils.getPosition(l,k)&domUtils.POSITION_FOLLOWING)){j=l.nextSibling;domUtils.remove(l);l=j}}else{domUtils.remove(l)}m.fireEvent("updateSections")}},selectsection:{execCommand:function(h,j){if(!j&&!j.dom){return false}var g=this,f=g.selection.getRange(),e={startAddress:utils.clone(j.startAddress,[]),endAddress:utils.clone(j.endAddress,[])};e.endAddress[e.endAddress.length-1]++;f.moveToAddress(e).select().scrollToView();return true},notNeedUndo:true},scrolltosection:{execCommand:function(h,j){if(!j&&!j.dom){return false}var g=this,f=g.selection.getRange(),e={startAddress:j.startAddress,endAddress:j.endAddress};e.endAddress[e.endAddress.length-1]++;f.moveToAddress(e).scrollToView();return true},notNeedUndo:true}}}});UE.plugin.register("simpleupload",function(){var d=this,a=false,c;function b(){var e=c.offsetWidth||20,f=c.offsetHeight||20,j=document.createElement("iframe"),g="display:block;width:"+e+"px;height:"+f+"px;overflow:hidden;border:0;margin:0;padding:0;position:absolute;top:0;left:0;filter:alpha(opacity=0);-moz-opacity:0;-khtml-opacity: 0;opacity: 0;cursor:pointer;";domUtils.on(j,"load",function(){var l=(+new Date()).toString(36),q,o,p;o=(j.contentDocument||j.contentWindow.document);p=o.body;q=o.createElement("div");q.innerHTML='<form id="edui_form_'+l+'" target="edui_iframe_'+l+'" method="POST" enctype="multipart/form-data" action="'+d.getOpt("serverUrl")+'" style="'+g+'"><input id="edui_input_'+l+'" type="file" accept="image/*" name="'+d.options.imageFieldName+'" style="'+g+'"></form><iframe id="edui_iframe_'+l+'" name="edui_iframe_'+l+'" style="display:none;width:0;height:0;border:0;margin:0;padding:0;position:absolute;"></iframe>';q.className="edui-"+d.options.theme;q.id=d.ui.id+"_iframeupload";p.style.cssText=g;p.style.width=e+"px";p.style.height=f+"px";p.appendChild(q);if(p.parentNode){p.parentNode.style.width=e+"px";p.parentNode.style.height=e+"px"}var n=o.getElementById("edui_form_"+l);var k=o.getElementById("edui_input_"+l);var m=o.getElementById("edui_iframe_"+l);domUtils.on(k,"change",function(){if(!k.value){return}var t="loading_"+(+new Date()).toString(36);var x=utils.serializeParam(d.queryCommandValue("serverparam"))||"";var u=d.getActionUrl(d.getOpt("imageActionName"));var w=d.getOpt("imageAllowFiles");d.focus();d.execCommand("inserthtml",'<img class="loadingclass" id="'+t+'" src="'+d.options.themePath+d.options.theme+'/images/spacer.gif" title="'+(d.getLang("simpleupload.loading")||"")+'" >');function y(){try{var D,C,B,A=(m.contentDocument||m.contentWindow.document).body,z=A.innerText||A.textContent||"";C=(new Function("return "+z))();D=d.options.imageUrlPrefix+C.url;if(C.state=="SUCCESS"&&C.url){B=d.document.getElementById(t);B.setAttribute("src",D);B.setAttribute("_src",D);B.setAttribute("title",C.title||"");B.setAttribute("alt",C.original||"");B.removeAttribute("id");domUtils.removeClasses(B,"loadingclass")}else{r&&r(C.state)}}catch(E){r&&r(d.getLang("simpleupload.loadError"))}n.reset();domUtils.un(m,"load",y)}function r(A){if(t){var z=d.document.getElementById(t);z&&domUtils.remove(z);d.fireEvent("showmessage",{id:t,content:A,type:"error",timeout:4000})}}if(!d.getOpt("imageActionName")){errorHandler(d.getLang("autoupload.errorLoadConfig"));return}var s=k.value,v=s?s.substr(s.lastIndexOf(".")):"";if(!v||(w&&(w.join("")+".").indexOf(v.toLowerCase()+".")==-1)){r(d.getLang("simpleupload.exceedTypeError"));return}domUtils.on(m,"load",y);n.action=utils.formatUrl(u+(u.indexOf("?")==-1?"?":"&")+x);n.submit()});var h;d.addListener("selectionchange",function(){clearTimeout(h);h=setTimeout(function(){var r=d.queryCommandState("simpleupload");if(r==-1){k.disabled="disabled"}else{k.disabled=false}},400)});a=true});j.style.cssText=g;c.appendChild(j)}return{bindEvents:{ready:function(){utils.cssRule("loading",".loadingclass{display:inline-block;cursor:default;background: url('"+this.options.themePath+this.options.theme+"/images/loading.gif') no-repeat center center transparent;border:1px solid #cccccc;margin-right:1px;height: 22px;width: 22px;}\n.loaderrorclass{display:inline-block;cursor:default;background: url('"+this.options.themePath+this.options.theme+"/images/loaderror.png') no-repeat center center transparent;border:1px solid #cccccc;margin-right:1px;height: 22px;width: 22px;}",this.document)},simpleuploadbtnready:function(f,e){c=e;d.afterConfigReady(b)}},outputRule:function(e){utils.each(e.getNodesByTagName("img"),function(f){if(/\b(loaderrorclass)|(bloaderrorclass)\b/.test(f.getAttr("class"))){f.parentNode.removeChild(f)}})},commands:{simpleupload:{queryCommandState:function(){return a?0:-1}}}}});UE.plugin.register("serverparam",function(){var b=this,a={};return{commands:{serverparam:{execCommand:function(e,c,d){if(c===undefined||c===null){a={}}else{if(utils.isString(c)){if(d===undefined||d===null){delete a[c]}else{a[c]=d}}else{if(utils.isObject(c)){utils.extend(a,c,true)}else{if(utils.isFunction(c)){utils.extend(a,c(),true)}}}}},queryCommandValue:function(){return a||{}}}}}});UE.plugin.register("insertfile",function(){var a=this;function b(c){var d=c.substr(c.lastIndexOf(".")+1).toLowerCase(),e={rar:"icon_rar.gif",zip:"icon_rar.gif",tar:"icon_rar.gif",gz:"icon_rar.gif",bz2:"icon_rar.gif",doc:"icon_doc.gif",docx:"icon_doc.gif",pdf:"icon_pdf.gif",mp3:"icon_mp3.gif",xls:"icon_xls.gif",chm:"icon_chm.gif",ppt:"icon_ppt.gif",pptx:"icon_ppt.gif",avi:"icon_mv.gif",rmvb:"icon_mv.gif",wmv:"icon_mv.gif",flv:"icon_mv.gif",swf:"icon_mv.gif",rm:"icon_mv.gif",exe:"icon_exe.gif",psd:"icon_psd.gif",txt:"icon_txt.gif",jpg:"icon_jpg.gif",png:"icon_jpg.gif",jpeg:"icon_jpg.gif",gif:"icon_jpg.gif",ico:"icon_jpg.gif",bmp:"icon_jpg.gif"};return e[d]?e[d]:e.txt}return{commands:{insertfile:{execCommand:function(d,g){g=utils.isArray(g)?g:[g];var e,l,j,k,f="",h=a.getOpt("UEDITOR_HOME_URL"),c=h+(h.substr(h.length-1)=="/"?"":"/")+"dialogs/attachment/fileTypeImages/";for(e=0;e<g.length;e++){l=g[e];j=c+b(l.url);k=l.title||l.url.substr(l.url.lastIndexOf("/")+1);f+='<p style="line-height: 16px;"><img style="vertical-align: middle; margin-right: 2px;" src="'+j+'" _src="'+j+'" /><a style="font-size:12px; color:#0066cc;" href="'+l.url+'" title="'+k+'">'+k+"</a></p>"}a.execCommand("insertHtml",f)}}}}});UE.plugin.register("custom",function(){var a={submit:{execCommand:function(){$("#submit_id").click()},queryCommandState:function(){return 0}},close:{execCommand:function(){$("#close_id").click()},queryCommandState:function(){return 0}}};return{commands:a}});UE.plugins.xssFilter=function(){var b=UEDITOR_CONFIG;var a=b.whitList;function c(g){var f=g.tagName;var e=g.attrs;if(!a.hasOwnProperty(f)){g.parentNode.removeChild(g);return false}UE.utils.each(e,function(j,h){if(a[f].indexOf(h)===-1){g.setAttr(h)}})}if(a&&b.xssFilterRules){this.options.filterRules=function(){var e={};UE.utils.each(a,function(g,f){e[f]=function(h){return c(h)}});return e}()}var d=[];UE.utils.each(a,function(f,e){d.push(e)});if(a&&b.inputXssFilter){this.addInputRule(function(e){e.traversal(function(f){if(f.type!=="element"){return false}c(f)})})}if(a&&b.outputXssFilter){this.addOutputRule(function(e){e.traversal(function(f){if(f.type!=="element"){return false}c(f)})})}};var baidu=baidu||{};baidu.editor=baidu.editor||{};UE.ui=baidu.editor.ui={};(function(){var d=baidu.editor.browser,c=baidu.editor.dom.domUtils;var g="$EDITORUI";var f=window[g]={};var a="ID"+g;var j=0;var b=baidu.editor.ui.uiUtils={uid:function(k){return(k?k[a]||(k[a]=++j):++j)},hook:function(k,m){var l;if(k&&k._callbacks){l=k}else{l=function(){var s;if(k){s=k.apply(this,arguments)}var p=l._callbacks;var n=p.length;while(n--){var o=p[n].apply(this,arguments);if(s===undefined){s=o}}return s};l._callbacks=[]}l._callbacks.push(m);return l},createElementByHtml:function(k){var l=document.createElement("div");l.innerHTML=k;l=l.firstChild;l.parentNode.removeChild(l);return l},getViewportElement:function(){return(d.ie&&d.quirks)?document.body:document.documentElement},getClientRect:function(k){var o;try{o=k.getBoundingClientRect()}catch(n){o={left:0,top:0,height:0,width:0}}var l={left:Math.round(o.left),top:Math.round(o.top),height:Math.round(o.bottom-o.top),width:Math.round(o.right-o.left)};var m;while((m=k.ownerDocument)!==document&&(k=c.getWindow(m).frameElement)){o=k.getBoundingClientRect();l.left+=o.left;l.top+=o.top}l.bottom=l.top+l.height;l.right=l.left+l.width;return l},getViewportRect:function(){var l=b.getViewportElement();var m=(window.innerWidth||l.clientWidth)|0;var k=(window.innerHeight||l.clientHeight)|0;return{left:0,top:0,height:k,width:m,bottom:k,right:m}},setViewportOffset:function(k,n){var l;var m=b.getFixedLayer();if(k.parentNode===m){k.style.left=n.left+"px";k.style.top=n.top+"px"}else{c.setViewportOffset(k,n)}},getEventOffset:function(k){var l=k.target||k.srcElement;var m=b.getClientRect(l);var n=b.getViewportOffsetByEvent(k);return{left:n.left-m.left,top:n.top-m.top}},getViewportOffsetByEvent:function(l){var m=l.target||l.srcElement;var k=c.getWindow(m).frameElement;var o={left:l.clientX,top:l.clientY};if(k&&m.ownerDocument!==document){var n=b.getClientRect(k);o.left+=n.left;o.top+=n.top}return o},setGlobal:function(l,k){f[l]=k;return g+'["'+l+'"]'},unsetGlobal:function(k){delete f[k]},copyAttributes:function(p,o){var m=o.attributes;var l=m.length;while(l--){var n=m[l];if(n.nodeName!="style"&&n.nodeName!="class"&&(!d.ie||n.specified)){p.setAttribute(n.nodeName,n.nodeValue)}}if(o.className){c.addClass(p,o.className)}if(o.style.cssText){p.style.cssText+=";"+o.style.cssText}},removeStyle:function(l,k){if(l.style.removeProperty){l.style.removeProperty(k)}else{if(l.style.removeAttribute){l.style.removeAttribute(k)}else{throw""}}},contains:function(l,k){return l&&k&&(l===k?false:(l.contains?l.contains(k):l.compareDocumentPosition(k)&16))},startDrag:function(s,o,q){var q=q||document;var n=s.clientX;var m=s.clientY;function l(u){var t=u.clientX-n;var v=u.clientY-m;o.ondragmove(t,v,u);if(u.stopPropagation){u.stopPropagation()}else{u.cancelBubble=true}}if(q.addEventListener){function r(t){q.removeEventListener("mousemove",l,true);q.removeEventListener("mouseup",r,true);window.removeEventListener("mouseup",r,true);o.ondragstop()}q.addEventListener("mousemove",l,true);q.addEventListener("mouseup",r,true);window.addEventListener("mouseup",r,true);s.preventDefault()}else{var p=s.srcElement;p.setCapture();function k(){p.releaseCapture();p.detachEvent("onmousemove",l);p.detachEvent("onmouseup",k);p.detachEvent("onlosecaptrue",k);o.ondragstop()}p.attachEvent("onmousemove",l);p.attachEvent("onmouseup",k);p.attachEvent("onlosecaptrue",k);s.returnValue=false}o.ondragstart()},getFixedLayer:function(){var k=document.getElementById("edui_fixedlayer");if(k==null){k=document.createElement("div");k.id="edui_fixedlayer";document.body.appendChild(k);if(d.ie&&d.version<=8){k.style.position="absolute";h();setTimeout(e)}else{k.style.position="fixed"}k.style.left="0";k.style.top="0";k.style.width="0";k.style.height="0"}return k},makeUnselectable:function(l){if(d.opera||(d.ie&&d.version<9)){l.unselectable="on";if(l.hasChildNodes()){for(var k=0;k<l.childNodes.length;k++){if(l.childNodes[k].nodeType==1){b.makeUnselectable(l.childNodes[k])}}}}else{if(l.style.MozUserSelect!==undefined){l.style.MozUserSelect="none"}else{if(l.style.WebkitUserSelect!==undefined){l.style.WebkitUserSelect="none"}else{if(l.style.KhtmlUserSelect!==undefined){l.style.KhtmlUserSelect="none"}}}}}};function e(){var k=document.getElementById("edui_fixedlayer");b.setViewportOffset(k,{left:0,top:0})}function h(k){c.on(window,"scroll",e);c.on(window,"resize",baidu.editor.utils.defer(e,0,true))}})();(function(){var a=baidu.editor.utils,b=baidu.editor.ui.uiUtils,c=baidu.editor.EventBase,d=baidu.editor.ui.UIBase=function(){};d.prototype={className:"",uiName:"",initOptions:function(f){var g=this;for(var e in f){g[e]=f[e]}this.id=this.id||"edui"+b.uid()},initUIBase:function(){this._globalKey=a.unhtml(b.setGlobal(this.id,this))},render:function(n){var j=this.renderHtml();var e=b.createElementByHtml(j);var l=domUtils.getElementsByTagName(e,"*");var g="edui-"+(this.theme||this.editor.options.theme);var k=document.getElementById("edui_fixedlayer");for(var h=0,f;f=l[h++];){domUtils.addClass(f,g)}domUtils.addClass(e,g);if(k){k.className="";domUtils.addClass(k,g)}var m=this.getDom();if(m!=null){m.parentNode.replaceChild(e,m);b.copyAttributes(e,m)}else{if(typeof n=="string"){n=document.getElementById(n)}n=n||b.getFixedLayer();domUtils.addClass(n,g);n.appendChild(e)}this.postRender()},getDom:function(e){if(!e){return document.getElementById(this.id)}else{return document.getElementById(this.id+"_"+e)}},postRender:function(){this.fireEvent("postrender")},getHtmlTpl:function(){return""},formatHtml:function(e){var f="edui-"+this.uiName;return(e.replace(/##/g,this.id).replace(/%%-/g,this.uiName?f+"-":"").replace(/%%/g,(this.uiName?f:"")+" "+this.className).replace(/\$\$/g,this._globalKey))},renderHtml:function(){return this.formatHtml(this.getHtmlTpl())},dispose:function(){var e=this.getDom();if(e){baidu.editor.dom.domUtils.remove(e)}b.unsetGlobal(this.id)}};a.inherits(d,c)})();(function(){var a=baidu.editor.utils,b=baidu.editor.ui.UIBase,c=baidu.editor.ui.Separator=function(d){this.initOptions(d);this.initSeparator()};c.prototype={uiName:"separator",initSeparator:function(){this.initUIBase()},getHtmlTpl:function(){return'<div id="##" class="edui-box %%"></div>'}};a.inherits(c,b)})();(function(){var b=baidu.editor.utils,a=baidu.editor.dom.domUtils,d=baidu.editor.ui.UIBase,c=baidu.editor.ui.uiUtils;var e=baidu.editor.ui.Mask=function(f){this.initOptions(f);this.initUIBase()};e.prototype={getHtmlTpl:function(){return'<div id="##" class="edui-mask %%" onclick="return $$._onClick(event, this);" onmousedown="return $$._onMouseDown(event, this);"></div>'},postRender:function(){var f=this;a.on(window,"resize",function(){setTimeout(function(){if(!f.isHidden()){f._fill()}})})},show:function(f){this._fill();this.getDom().style.display="";this.getDom().style.zIndex=f},hide:function(){this.getDom().style.display="none";this.getDom().style.zIndex=""},isHidden:function(){return this.getDom().style.display=="none"},_onMouseDown:function(){return false},_onClick:function(g,f){this.fireEvent("click",g,f)},_fill:function(){var f=this.getDom();var g=c.getViewportRect();f.style.width=g.width+"px";f.style.height=g.height+"px"}};b.inherits(e,d)})();(function(){var c=baidu.editor.utils,e=baidu.editor.ui.uiUtils,a=baidu.editor.dom.domUtils,h=baidu.editor.ui.UIBase,g=baidu.editor.ui.Popup=function(j){this.initOptions(j);this.initPopup()};var b=[];function f(j,m){for(var l=0;l<b.length;l++){var k=b[l];if(!k.isHidden()){if(k.queryAutoHide(m)!==false){if(j&&/scroll/ig.test(j.type)&&k.className=="edui-wordpastepop"){return}k.hide()}}}if(b.length){k.editor.fireEvent("afterhidepop")}}g.postHide=f;var d=["edui-anchor-topleft","edui-anchor-topright","edui-anchor-bottomleft","edui-anchor-bottomright"];g.prototype={SHADOW_RADIUS:5,content:null,_hidden:false,autoRender:true,canSideLeft:true,canSideUp:true,initPopup:function(){this.initUIBase();b.push(this)},getHtmlTpl:function(){return'<div id="##" class="edui-popup %%" onmousedown="return false;"> <div id="##_body" class="edui-popup-body"> <iframe style="position:absolute;z-index:-1;left:0;top:0;background-color: transparent;" frameborder="0" width="100%" height="100%" src="about:blank"></iframe> <div class="edui-shadow"></div> <div id="##_content" class="edui-popup-content">'+this.getContentHtmlTpl()+"  </div> </div></div>"},getContentHtmlTpl:function(){if(this.content){if(typeof this.content=="string"){return this.content}return this.content.renderHtml()}else{return""}},_UIBase_postRender:h.prototype.postRender,postRender:function(){if(this.content instanceof h){this.content.postRender()}if(this.captureWheel&&!this.captured){this.captured=true;var j=(document.documentElement.clientHeight||document.body.clientHeight)-80,k=this.getDom().offsetHeight,n=e.getClientRect(this.combox.getDom()).top,m=this.getDom("content"),o=this.getDom("body").getElementsByTagName("iframe"),l=this;o.length&&(o=o[0]);while(n+k>j){k-=30}m.style.height=k+"px";o&&(o.style.height=k+"px");if(window.XMLHttpRequest){a.on(m,("onmousewheel" in document.body)?"mousewheel":"DOMMouseScroll",function(p){if(p.preventDefault){p.preventDefault()}else{p.returnValue=false}if(p.wheelDelta){m.scrollTop-=(p.wheelDelta/120)*60}else{m.scrollTop-=(p.detail/-3)*60}})}else{a.on(this.getDom(),"mousewheel",function(p){p.returnValue=false;l.getDom("content").scrollTop-=(p.wheelDelta/120)*60})}}this.fireEvent("postRenderAfter");this.hide(true);this._UIBase_postRender()},_doAutoRender:function(){if(!this.getDom()&&this.autoRender){this.render()}},mesureSize:function(){var j=this.getDom("content");return e.getClientRect(j)},fitSize:function(){if(this.captureWheel&&this.sized){return this.__size}this.sized=true;var k=this.getDom("body");k.style.width="";k.style.height="";var l=this.mesureSize();if(this.captureWheel){k.style.width=-(-20-l.width)+"px";var j=parseInt(this.getDom("content").style.height,10);!window.isNaN(j)&&(l.height=j)}else{k.style.width=l.width+"px"}k.style.height=l.height+"px";this.__size=l;this.captureWheel&&(this.getDom("content").style.overflow="auto");return l},showAnchor:function(k,j){this.showAnchorRect(e.getClientRect(k),j)},showAnchorRect:function(q,n,o){this._doAutoRender();var l=e.getViewportRect();this.getDom().style.visibility="hidden";this._show();var k=this.fitSize();var r,m,j,p;if(n){r=this.canSideLeft&&(q.right+k.width>l.right&&q.left>k.width);m=this.canSideUp&&(q.top+k.height>l.bottom&&q.bottom>k.height);j=(r?q.left-k.width:q.right);p=(m?q.bottom-k.height:q.top)}else{r=this.canSideLeft&&(q.right+k.width>l.right&&q.left>k.width);m=this.canSideUp&&(q.top+k.height>l.bottom&&q.bottom>k.height);j=(r?q.right-k.width:q.left);p=(m?q.top-k.height:q.bottom)}var s=this.getDom();e.setViewportOffset(s,{left:j,top:p});a.removeClasses(s,d);s.className+=" "+d[(m?1:0)*2+(r?1:0)];if(this.editor){s.style.zIndex=this.editor.container.style.zIndex*1+10;baidu.editor.ui.uiUtils.getFixedLayer().style.zIndex=s.style.zIndex-1}this.getDom().style.visibility="visible"},showAt:function(m){var l=m.left;var k=m.top;var j={left:l,top:k,right:l,bottom:k,height:0,width:0};this.showAnchorRect(j,false,true)},_show:function(){if(this._hidden){var j=this.getDom();j.style.display="";this._hidden=false;this.fireEvent("show")}},isHidden:function(){return this._hidden},show:function(){this._doAutoRender();this._show()},hide:function(j){if(!this._hidden&&this.getDom()){this.getDom().style.display="none";this._hidden=true;if(!j){this.fireEvent("hide")}}},queryAutoHide:function(j){return !j||!e.contains(this.getDom(),j)}};c.inherits(g,h);a.on(document,"mousedown",function(j){var k=j.target||j.srcElement;f(j,k)});a.on(window,"scroll",function(j,k){f(j,k)})})();(function(){var a=baidu.editor.utils,c=baidu.editor.ui.UIBase,b=baidu.editor.ui.ColorPicker=function(f){this.initOptions(f);this.noColorText=this.noColorText||this.editor.getLang("clearColor");this.initUIBase()};b.prototype={getHtmlTpl:function(){return e(this.noColorText,this.editor)},_onTableClick:function(f){var h=f.target||f.srcElement;var g=h.getAttribute("data-color");if(g){this.fireEvent("pickcolor",g)}},_onTableOver:function(f){var h=f.target||f.srcElement;var g=h.getAttribute("data-color");if(g){this.getDom("preview").style.backgroundColor=g}},_onTableOut:function(){this.getDom("preview").style.backgroundColor=""},_onPickNoColor:function(){this.fireEvent("picknocolor")}};a.inherits(b,c);var d=("ffffff,000000,eeece1,1f497d,4f81bd,c0504d,9bbb59,8064a2,4bacc6,f79646,f2f2f2,7f7f7f,ddd9c3,c6d9f0,dbe5f1,f2dcdb,ebf1dd,e5e0ec,dbeef3,fdeada,d8d8d8,595959,c4bd97,8db3e2,b8cce4,e5b9b7,d7e3bc,ccc1d9,b7dde8,fbd5b5,bfbfbf,3f3f3f,938953,548dd4,95b3d7,d99694,c3d69b,b2a2c7,92cddc,fac08f,a5a5a5,262626,494429,17365d,366092,953734,76923c,5f497a,31859b,e36c09,7f7f7f,0c0c0c,1d1b10,0f243e,244061,632423,4f6128,3f3151,205867,974806,c00000,ff0000,ffc000,ffff00,92d050,00b050,00b0f0,0000FF,002060,7030a0,").split(",");function e(f,j){var h='<div id="##" class="edui-colorpicker %%"><div class="edui-colorpicker-topbar edui-clearfix"><div unselectable="on" id="##_preview" class="edui-colorpicker-preview"></div><div unselectable="on" class="edui-colorpicker-nocolor" onclick="$$._onPickNoColor(event, this);">'+f+'</div></div><table  class="edui-box" style="border-collapse: collapse;" onmouseover="$$._onTableOver(event, this);" onmouseout="$$._onTableOut(event, this);" onclick="return $$._onTableClick(event, this);" cellspacing="0" cellpadding="0"><tr style="border-bottom: 1px solid #ddd;font-size: 13px;line-height: 25px;color:#39C;padding-top: 2px"><td colspan="10">'+j.getLang("themeColor")+'</td> </tr><tr class="edui-colorpicker-tablefirstrow" >';for(var g=0;g<d.length;g++){if(g&&g%10===0){h+="</tr>"+(g==60?'<tr style="border-bottom: 1px solid #ddd;font-size: 13px;line-height: 25px;color:#39C;"><td colspan="10">'+j.getLang("standardColor")+"</td></tr>":"")+"<tr"+(g==60?' class="edui-colorpicker-tablefirstrow"':"")+">"}h+=g<70?'<td style="padding: 0 2px;"><a hidefocus title="'+d[g]+'" onclick="return false;" href="javascript:" unselectable="on" class="edui-box edui-colorpicker-colorcell" data-color="#'+d[g]+'" style="background-color:#'+d[g]+";border:solid #ccc;"+(g<10||g>=60?"border-width:1px;":g>=10&&g<20?"border-width:1px 1px 0 1px;":"border-width:0 1px 0 1px;")+'"></a></td>':""}h+="</tr></table></div>";return h}})();(function(){var a=baidu.editor.utils,b=baidu.editor.ui.uiUtils,c=baidu.editor.ui.UIBase;var d=baidu.editor.ui.TablePicker=function(e){this.initOptions(e);this.initTablePicker()};d.prototype={defaultNumRows:10,defaultNumCols:10,maxNumRows:20,maxNumCols:20,numRows:10,numCols:10,lengthOfCellSide:22,initTablePicker:function(){this.initUIBase()},getHtmlTpl:function(){var e=this;return'<div id="##" class="edui-tablepicker %%"><div class="edui-tablepicker-body"><div class="edui-infoarea"><span id="##_label" class="edui-label"></span></div><div class="edui-pickarea" onmousemove="$$._onMouseMove(event, this);" onmouseover="$$._onMouseOver(event, this);" onmouseout="$$._onMouseOut(event, this);" onclick="$$._onClick(event, this);"><div id="##_overlay" class="edui-overlay"></div></div></div></div>'},_UIBase_render:c.prototype.render,render:function(e){this._UIBase_render(e);this.getDom("label").innerHTML="0"+this.editor.getLang("t_row")+" x 0"+this.editor.getLang("t_col")},_track:function(j,h){var f=this.getDom("overlay").style;var g=this.lengthOfCellSide;f.width=j*g+"px";f.height=h*g+"px";var e=this.getDom("label");e.innerHTML=j+this.editor.getLang("t_col")+" x "+h+this.editor.getLang("t_row");this.numCols=j;this.numRows=h},_onMouseOver:function(f,g){var e=f.relatedTarget||f.fromElement;if(!b.contains(g,e)&&g!==e){this.getDom("label").innerHTML="0"+this.editor.getLang("t_col")+" x 0"+this.editor.getLang("t_row");this.getDom("overlay").style.visibility=""}},_onMouseOut:function(f,g){var e=f.relatedTarget||f.toElement;if(!b.contains(g,e)&&g!==e){this.getDom("label").innerHTML="0"+this.editor.getLang("t_col")+" x 0"+this.editor.getLang("t_row");this.getDom("overlay").style.visibility="hidden"}},_onMouseMove:function(e,g){var f=this.getDom("overlay").style;var l=b.getEventOffset(e);var j=this.lengthOfCellSide;var k=Math.ceil(l.left/j);var h=Math.ceil(l.top/j);this._track(k,h)},_onClick:function(){this.fireEvent("picktable",this.numCols,this.numRows)}};a.inherits(d,c)})();(function(){var c=baidu.editor.browser,a=baidu.editor.dom.domUtils,b=baidu.editor.ui.uiUtils;var d='onmousedown="$$.Stateful_onMouseDown(event, this);" onmouseup="$$.Stateful_onMouseUp(event, this);"'+(c.ie?(' onmouseenter="$$.Stateful_onMouseEnter(event, this);" onmouseleave="$$.Stateful_onMouseLeave(event, this);"'):(' onmouseover="$$.Stateful_onMouseOver(event, this);" onmouseout="$$.Stateful_onMouseOut(event, this);"'));baidu.editor.ui.Stateful={alwalysHoverable:false,target:null,Stateful_init:function(){this._Stateful_dGetHtmlTpl=this.getHtmlTpl;this.getHtmlTpl=this.Stateful_getHtmlTpl},Stateful_getHtmlTpl:function(){var e=this._Stateful_dGetHtmlTpl();return e.replace(/stateful/g,function(){return d})},Stateful_onMouseEnter:function(e,f){this.target=f;if(!this.isDisabled()||this.alwalysHoverable){this.addState("hover");this.fireEvent("over")}},Stateful_onMouseLeave:function(e,f){if(!this.isDisabled()||this.alwalysHoverable){this.removeState("hover");this.removeState("active");this.fireEvent("out")}},Stateful_onMouseOver:function(f,g){var e=f.relatedTarget;if(!b.contains(g,e)&&g!==e){this.Stateful_onMouseEnter(f,g)}},Stateful_onMouseOut:function(f,g){var e=f.relatedTarget;if(!b.contains(g,e)&&g!==e){this.Stateful_onMouseLeave(f,g)}},Stateful_onMouseDown:function(e,f){if(!this.isDisabled()){this.addState("active")}},Stateful_onMouseUp:function(e,f){if(!this.isDisabled()){this.removeState("active")}},Stateful_postRender:function(){if(this.disabled&&!this.hasState("disabled")){this.addState("disabled")}},hasState:function(e){return a.hasClass(this.getStateDom(),"edui-state-"+e)},addState:function(e){if(!this.hasState(e)){this.getStateDom().className+=" edui-state-"+e}},removeState:function(e){if(this.hasState(e)){a.removeClasses(this.getStateDom(),["edui-state-"+e])}},getStateDom:function(){return this.getDom("state")},isChecked:function(){return this.hasState("checked")},setChecked:function(e){if(!this.isDisabled()&&e){this.addState("checked")}else{this.removeState("checked")}},isDisabled:function(){return this.hasState("disabled")},setDisabled:function(e){if(e){this.removeState("hover");this.removeState("checked");this.removeState("active");this.addState("disabled")}else{this.removeState("disabled")}}}})();(function(){var b=baidu.editor.utils,d=baidu.editor.ui.UIBase,c=baidu.editor.ui.Stateful,a=baidu.editor.ui.Button=function(f){if(f.name){var g=f.name;var e=f.cssRules;if(!f.className){f.className="edui-for-"+g}f.cssRules=".edui-default  .edui-for-"+g+" .edui-icon {"+e+"}"}this.initOptions(f);this.initButton()};a.prototype={uiName:"button",label:"",title:"",showIcon:true,showText:true,cssRules:"",initButton:function(){this.initUIBase();this.Stateful_init();if(this.cssRules){b.cssRule("edui-customize-"+this.name+"-style",this.cssRules)}},getHtmlTpl:function(){return'<div id="##" class="edui-box %%"><div id="##_state" stateful><div class="%%-wrap"><div id="##_body" unselectable="on" '+(this.title?'title="'+this.title+'"':"")+' class="%%-body" onmousedown="return $$._onMouseDown(event, this);" onclick="return $$._onClick(event, this);">'+(this.showIcon?'<div class="edui-box edui-icon"></div>':"")+(this.showText?'<div class="edui-box edui-label">'+this.label+"</div>":"")+"</div></div></div></div>"},postRender:function(){this.Stateful_postRender();this.setDisabled(this.disabled)},_onMouseDown:function(h){var g=h.target||h.srcElement,f=g&&g.tagName&&g.tagName.toLowerCase();if(f=="input"||f=="object"||f=="object"){return false}},_onClick:function(){if(!this.isDisabled()){this.fireEvent("click")}},setTitle:function(f){var e=this.getDom("label");e.innerHTML=f}};b.inherits(a,d);b.extend(a.prototype,c)})();(function(){var c=baidu.editor.utils,e=baidu.editor.ui.uiUtils,a=baidu.editor.dom.domUtils,f=baidu.editor.ui.UIBase,d=baidu.editor.ui.Stateful,b=baidu.editor.ui.SplitButton=function(g){this.initOptions(g);this.initSplitButton()};b.prototype={popup:null,uiName:"splitbutton",title:"",initSplitButton:function(){this.initUIBase();this.Stateful_init();var h=this;if(this.popup!=null){var g=this.popup;this.popup=null;this.setPopup(g)}},_UIBase_postRender:f.prototype.postRender,postRender:function(){this.Stateful_postRender();this._UIBase_postRender()},setPopup:function(g){if(this.popup===g){return}if(this.popup!=null){this.popup.dispose()}g.addListener("show",c.bind(this._onPopupShow,this));g.addListener("hide",c.bind(this._onPopupHide,this));g.addListener("postrender",c.bind(function(){g.getDom("body").appendChild(e.createElementByHtml('<div id="'+this.popup.id+'_bordereraser" class="edui-bordereraser edui-background" style="width:'+(e.getClientRect(this.getDom()).width+20)+'px"></div>'));g.getDom().className+=" "+this.className},this));this.popup=g},_onPopupShow:function(){this.addState("opened")},_onPopupHide:function(){this.removeState("opened")},getHtmlTpl:function(){return'<div id="##" class="edui-box %%"><div '+(this.title?'title="'+this.title+'"':"")+' id="##_state" stateful><div class="%%-body"><div id="##_button_body" class="edui-box edui-button-body" onclick="$$._onButtonClick(event, this);"><div class="edui-box edui-icon"></div></div><div class="edui-box edui-splitborder"></div><div class="edui-box edui-arrow" onclick="$$._onArrowClick();"></div></div></div></div>'},showPopup:function(){var g=e.getClientRect(this.getDom());g.top-=this.popup.SHADOW_RADIUS;g.height+=this.popup.SHADOW_RADIUS;this.popup.showAnchorRect(g)},_onArrowClick:function(h,g){if(!this.isDisabled()){this.showPopup()}},_onButtonClick:function(){if(!this.isDisabled()){this.fireEvent("buttonclick")}}};c.inherits(b,f);c.extend(b.prototype,d,true)})();(function(){var b=baidu.editor.utils,c=baidu.editor.ui.uiUtils,d=baidu.editor.ui.ColorPicker,f=baidu.editor.ui.Popup,a=baidu.editor.ui.SplitButton,e=baidu.editor.ui.ColorButton=function(g){this.initOptions(g);this.initColorButton()};e.prototype={initColorButton:function(){var g=this;this.popup=new f({content:new d({noColorText:g.editor.getLang("clearColor"),editor:g.editor,onpickcolor:function(j,h){g._onPickColor(h)},onpicknocolor:function(j,h){g._onPickNoColor(h)}}),editor:g.editor});this.initSplitButton()},_SplitButton_postRender:a.prototype.postRender,postRender:function(){this._SplitButton_postRender();this.getDom("button_body").appendChild(c.createElementByHtml('<div id="'+this.id+'_colorlump" class="edui-colorlump"></div>'));this.getDom().className+=" edui-colorbutton"},setColor:function(g){this.getDom("colorlump").style.backgroundColor=g;this.color=g},_onPickColor:function(g){if(this.fireEvent("pickcolor",g)!==false){this.setColor(g);this.popup.hide()}},_onPickNoColor:function(g){if(this.fireEvent("picknocolor")!==false){this.popup.hide()}}};b.inherits(e,a)})();(function(){var b=baidu.editor.utils,c=baidu.editor.ui.Popup,d=baidu.editor.ui.TablePicker,a=baidu.editor.ui.SplitButton,e=baidu.editor.ui.TableButton=function(f){this.initOptions(f);this.initTableButton()};e.prototype={initTableButton:function(){var f=this;this.popup=new c({content:new d({editor:f.editor,onpicktable:function(g,j,h){f._onPickTable(j,h)}}),editor:f.editor});this.initSplitButton()},_onPickTable:function(g,f){if(this.fireEvent("picktable",g,f)!==false){this.popup.hide()}}};b.inherits(e,a)})();(function(){var a=baidu.editor.utils,b=baidu.editor.ui.UIBase;var c=baidu.editor.ui.AutoTypeSetPicker=function(d){this.initOptions(d);this.initAutoTypeSetPicker()};c.prototype={initAutoTypeSetPicker:function(){this.initUIBase()},getHtmlTpl:function(){var g=this.editor,d=g.options.autotypeset,j=g.getLang("autoTypeSet");var f="textAlignValue"+g.uid,e="imageBlockLineValue"+g.uid,h="symbolConverValue"+g.uid;return'<div id="##" class="edui-autotypesetpicker %%"><div class="edui-autotypesetpicker-body"><table ><tr><td nowrap><input type="checkbox" name="mergeEmptyline" '+(d.mergeEmptyline?"checked":"")+">"+j.mergeLine+'</td><td colspan="2"><input type="checkbox" name="removeEmptyline" '+(d.removeEmptyline?"checked":"")+">"+j.delLine+'</td></tr><tr><td nowrap><input type="checkbox" name="removeClass" '+(d.removeClass?"checked":"")+">"+j.removeFormat+'</td><td colspan="2"><input type="checkbox" name="indent" '+(d.indent?"checked":"")+">"+j.indent+'</td></tr><tr><td nowrap><input type="checkbox" name="textAlign" '+(d.textAlign?"checked":"")+">"+j.alignment+'</td><td colspan="2" id="'+f+'"><input type="radio" name="'+f+'" value="left" '+((d.textAlign&&d.textAlign=="left")?"checked":"")+">"+g.getLang("justifyleft")+'<input type="radio" name="'+f+'" value="center" '+((d.textAlign&&d.textAlign=="center")?"checked":"")+">"+g.getLang("justifycenter")+'<input type="radio" name="'+f+'" value="right" '+((d.textAlign&&d.textAlign=="right")?"checked":"")+">"+g.getLang("justifyright")+'</td></tr><tr><td nowrap><input type="checkbox" name="imageBlockLine" '+(d.imageBlockLine?"checked":"")+">"+j.imageFloat+'</td><td nowrap id="'+e+'"><input type="radio" name="'+e+'" value="none" '+((d.imageBlockLine&&d.imageBlockLine=="none")?"checked":"")+">"+g.getLang("default")+'<input type="radio" name="'+e+'" value="left" '+((d.imageBlockLine&&d.imageBlockLine=="left")?"checked":"")+">"+g.getLang("justifyleft")+'<input type="radio" name="'+e+'" value="center" '+((d.imageBlockLine&&d.imageBlockLine=="center")?"checked":"")+">"+g.getLang("justifycenter")+'<input type="radio" name="'+e+'" value="right" '+((d.imageBlockLine&&d.imageBlockLine=="right")?"checked":"")+">"+g.getLang("justifyright")+'</td></tr><tr><td nowrap><input type="checkbox" name="clearFontSize" '+(d.clearFontSize?"checked":"")+">"+j.removeFontsize+'</td><td colspan="2"><input type="checkbox" name="clearFontFamily" '+(d.clearFontFamily?"checked":"")+">"+j.removeFontFamily+'</td></tr><tr><td nowrap colspan="3"><input type="checkbox" name="removeEmptyNode" '+(d.removeEmptyNode?"checked":"")+">"+j.removeHtml+'</td></tr><tr><td nowrap colspan="3"><input type="checkbox" name="pasteFilter" '+(d.pasteFilter?"checked":"")+">"+j.pasteFilter+'</td></tr><tr><td nowrap><input type="checkbox" name="symbolConver" '+(d.bdc2sb||d.tobdc?"checked":"")+">"+j.symbol+'</td><td id="'+h+'"><input type="radio" name="bdc" value="bdc2sb" '+(d.bdc2sb?"checked":"")+">"+j.bdc2sb+'<input type="radio" name="bdc" value="tobdc" '+(d.tobdc?"checked":"")+">"+j.tobdc+'</td><td nowrap align="right"><button >'+j.run+"</button></td></tr></table></div></div>"},_UIBase_render:b.prototype.render};a.inherits(c,b)})();(function(){var b=baidu.editor.utils,d=baidu.editor.ui.Popup,e=baidu.editor.ui.AutoTypeSetPicker,a=baidu.editor.ui.SplitButton,f=baidu.editor.ui.AutoTypeSetButton=function(g){this.initOptions(g);this.initAutoTypeSetButton()};function c(t){var h={},x=t.getDom(),l=t.editor.uid,k=null,u=null,r=domUtils.getElementsByTagName(x,"input");for(var o=r.length-1,w;w=r[o--];){k=w.getAttribute("type");if(k=="checkbox"){u=w.getAttribute("name");h[u]&&delete h[u];if(w.checked){var p=document.getElementById(u+"Value"+l);if(p){if(/input/ig.test(p.tagName)){h[u]=p.value}else{var g=p.getElementsByTagName("input");for(var m=g.length-1,v;v=g[m--];){if(v.checked){h[u]=v.value;break}}}}else{h[u]=true}}else{h[u]=false}}else{h[w.getAttribute("value")]=w.checked}}var s=domUtils.getElementsByTagName(x,"select");for(var o=0,n;n=s[o++];){var q=n.getAttribute("name");h[q]=h[q]?n.value:""}b.extend(t.editor.options.autotypeset,h);t.editor.setPreferences("autotypeset",h)}f.prototype={initAutoTypeSetButton:function(){var h=this;this.popup=new d({content:new e({editor:h.editor}),editor:h.editor,hide:function(){if(!this._hidden&&this.getDom()){c(this);this.getDom().style.display="none";this._hidden=true;this.fireEvent("hide")}}});var g=0;this.popup.addListener("postRenderAfter",function(){var k=this;if(g){return}var j=this.getDom(),l=j.getElementsByTagName("button")[0];l.onclick=function(){c(k);h.editor.execCommand("autotypeset");k.hide()};domUtils.on(j,"click",function(q){var r=q.target||q.srcElement,n=h.editor.uid;if(r&&r.tagName=="INPUT"){if(r.name=="imageBlockLine"||r.name=="textAlign"||r.name=="symbolConver"){var t=r.checked,m=document.getElementById(r.name+"Value"+n),s=m.getElementsByTagName("input"),p={imageBlockLine:"none",textAlign:"left",symbolConver:"tobdc"};for(var o=0;o<s.length;o++){if(t){if(s[o].value==p[r.name]){s[o].checked="checked"}}else{s[o].checked=false}}}if(r.name==("imageBlockLineValue"+n)||r.name==("textAlignValue"+n)||r.name=="bdc"){var u=r.parentNode.previousSibling.getElementsByTagName("input");u&&(u[0].checked=true)}c(k)}});g=1});this.initSplitButton()}};b.inherits(f,a)})();(function(){var a=baidu.editor.utils,e=baidu.editor.ui.Popup,c=baidu.editor.ui.Stateful,d=baidu.editor.ui.UIBase;var b=baidu.editor.ui.CellAlignPicker=function(f){this.initOptions(f);this.initSelected();this.initCellAlignPicker()};b.prototype={initSelected:function(){var g={valign:{top:0,middle:1,bottom:2},align:{left:0,center:1,right:2},count:3},f=-1;if(this.selected){this.selectedIndex=g.valign[this.selected.valign]*g.count+g.align[this.selected.align]}},initCellAlignPicker:function(){this.initUIBase();this.Stateful_init()},getHtmlTpl:function(){var h=["left","center","right"],l=9,k=null,f=-1,g=[];for(var j=0;j<l;j++){k=this.selectedIndex===j?' class="edui-cellalign-selected" ':"";f=j%3;f===0&&g.push("<tr>");g.push('<td index="'+j+'" '+k+' stateful><div class="edui-icon edui-'+h[f]+'"></div></td>');f===2&&g.push("</tr>")}return'<div id="##" class="edui-cellalignpicker %%"><div class="edui-cellalignpicker-body"><table onclick="$$._onClick(event);">'+g.join("")+"</table></div></div>"},getStateDom:function(){return this.target},_onClick:function(f){var g=f.target||f.srcElement;if(/icon/.test(g.className)){this.items[g.parentNode.getAttribute("index")].onclick();e.postHide(f)}},_UIBase_render:d.prototype.render};a.inherits(b,d);a.extend(b.prototype,c,true)})();(function(){var a=baidu.editor.utils,c=baidu.editor.ui.Stateful,b=baidu.editor.ui.uiUtils,e=baidu.editor.ui.UIBase;var d=baidu.editor.ui.PastePicker=function(f){this.initOptions(f);this.initPastePicker()};d.prototype={initPastePicker:function(){this.initUIBase();this.Stateful_init()},getHtmlTpl:function(){return'<div class="edui-pasteicon" onclick="$$._onClick(this)"></div><div class="edui-pastecontainer"><div class="edui-title">'+this.editor.getLang("pasteOpt")+'</div><div class="edui-button"><div title="'+this.editor.getLang("pasteSourceFormat")+'" onclick="$$.format(false)" stateful><div class="edui-richtxticon"></div></div><div title="'+this.editor.getLang("tagFormat")+'" onclick="$$.format(2)" stateful><div class="edui-tagicon"></div></div><div title="'+this.editor.getLang("pasteTextFormat")+'" onclick="$$.format(true)" stateful><div class="edui-plaintxticon"></div></div></div></div></div>'},getStateDom:function(){return this.target},format:function(f){this.editor.ui._isTransfer=true;this.editor.fireEvent("pasteTransfer",f)},_onClick:function(j){var g=domUtils.getNextDomNode(j),f=b.getViewportRect().height,h=b.getClientRect(g);if((h.top+h.height)>f){g.style.top=(-h.height-j.offsetHeight)+"px"}else{g.style.top=""}if(/hidden/ig.test(domUtils.getComputedStyle(g,"visibility"))){g.style.visibility="visible";domUtils.addClass(j,"edui-state-opened")}else{g.style.visibility="hidden";domUtils.removeClasses(j,"edui-state-opened")}},_UIBase_render:e.prototype.render};a.inherits(d,e);a.extend(d.prototype,c,true)})();(function(){var a=baidu.editor.utils,b=baidu.editor.ui.uiUtils,d=baidu.editor.ui.UIBase,c=baidu.editor.ui.Toolbar=function(e){this.initOptions(e);this.initToolbar()};c.prototype={items:null,initToolbar:function(){this.items=this.items||[];this.initUIBase()},add:function(f,e){if(e===undefined){this.items.push(f)}else{this.items.splice(e,0,f)}},getHtmlTpl:function(){var f=[];for(var e=0;e<this.items.length;e++){f[e]=this.items[e].renderHtml()}return'<div id="##" class="edui-toolbar %%" onselectstart="return false;" onmousedown="return $$._onMouseDown(event, this);">'+f.join("")+"</div>"},postRender:function(){var f=this.getDom();for(var e=0;e<this.items.length;e++){this.items[e].postRender()}b.makeUnselectable(f)},_onMouseDown:function(h){var g=h.target||h.srcElement,f=g&&g.tagName&&g.tagName.toLowerCase();if(f=="input"||f=="object"||f=="object"){return false}}};a.inherits(c,d)})();(function(){var h=baidu.editor.utils,d=baidu.editor.dom.domUtils,b=baidu.editor.ui.uiUtils,c=baidu.editor.ui.UIBase,j=baidu.editor.ui.Popup,a=baidu.editor.ui.Stateful,k=baidu.editor.ui.CellAlignPicker,e=baidu.editor.ui.Menu=function(l){this.initOptions(l);this.initMenu()};var f={renderHtml:function(){return'<div class="edui-menuitem edui-menuseparator"><div class="edui-menuseparator-inner"></div></div>'},postRender:function(){},queryAutoHide:function(){return true}};e.prototype={items:null,uiName:"menu",initMenu:function(){this.items=this.items||[];this.initPopup();this.initItems()},initItems:function(){for(var l=0;l<this.items.length;l++){var m=this.items[l];if(m=="-"){this.items[l]=this.getSeparator()}else{if(!(m instanceof g)){m.editor=this.editor;m.theme=this.editor.options.theme;this.items[l]=this.createItem(m)}}}},getSeparator:function(){return f},createItem:function(l){l.menu=this;return new g(l)},_Popup_getContentHtmlTpl:j.prototype.getContentHtmlTpl,getContentHtmlTpl:function(){if(this.items.length==0){return this._Popup_getContentHtmlTpl()}var n=[];for(var l=0;l<this.items.length;l++){var m=this.items[l];n[l]=m.renderHtml()}return('<div class="%%-body">'+n.join("")+"</div>")},_Popup_postRender:j.prototype.postRender,postRender:function(){var n=this;for(var l=0;l<this.items.length;l++){var m=this.items[l];m.ownerMenu=this;m.postRender()}d.on(this.getDom(),"mouseover",function(p){p=p||event;var o=p.relatedTarget||p.fromElement;var q=n.getDom();if(!b.contains(q,o)&&q!==o){n.fireEvent("over")}});this._Popup_postRender()},queryAutoHide:function(m){if(m){if(b.contains(this.getDom(),m)){return false}for(var l=0;l<this.items.length;l++){var n=this.items[l];if(n.queryAutoHide(m)===false){return false}}}},clearItems:function(){for(var l=0;l<this.items.length;l++){var m=this.items[l];clearTimeout(m._showingTimer);clearTimeout(m._closingTimer);if(m.subMenu){m.subMenu.destroy()}}this.items=[]},destroy:function(){if(this.getDom()){d.remove(this.getDom())}this.clearItems()},dispose:function(){this.destroy()}};h.inherits(e,j);var g=baidu.editor.ui.MenuItem=function(l){this.initOptions(l);this.initUIBase();this.Stateful_init();if(this.subMenu&&!(this.subMenu instanceof e)){if(l.className&&l.className.indexOf("aligntd")!=-1){var m=this;this.subMenu.selected=this.editor.queryCommandValue("cellalignment");this.subMenu=new j({content:new k(this.subMenu),parentMenu:m,editor:m.editor,destroy:function(){if(this.getDom()){d.remove(this.getDom())}}});this.subMenu.addListener("postRenderAfter",function(){d.on(this.getDom(),"mouseover",function(){m.addState("opened")})})}else{this.subMenu=new e(this.subMenu)}}};g.prototype={label:"",subMenu:null,ownerMenu:null,uiName:"menuitem",alwalysHoverable:true,getHtmlTpl:function(){return'<div id="##" class="%%" stateful onclick="$$._onClick(event, this);"><div class="%%-body">'+this.renderLabelHtml()+"</div></div>"},postRender:function(){var l=this;this.addListener("over",function(){l.ownerMenu.fireEvent("submenuover",l);if(l.subMenu){l.delayShowSubMenu()}});if(this.subMenu){this.getDom().className+=" edui-hassubmenu";this.subMenu.render();this.addListener("out",function(){l.delayHideSubMenu()});this.subMenu.addListener("over",function(){clearTimeout(l._closingTimer);l._closingTimer=null;l.addState("opened")});this.ownerMenu.addListener("hide",function(){l.hideSubMenu()});this.ownerMenu.addListener("submenuover",function(n,m){if(m!==l){l.delayHideSubMenu()}});this.subMenu._bakQueryAutoHide=this.subMenu.queryAutoHide;this.subMenu.queryAutoHide=function(m){if(m&&b.contains(l.getDom(),m)){return false}return this._bakQueryAutoHide(m)}}this.getDom().style.tabIndex="-1";b.makeUnselectable(this.getDom());this.Stateful_postRender()},delayShowSubMenu:function(){var l=this;if(!l.isDisabled()){l.addState("opened");clearTimeout(l._showingTimer);clearTimeout(l._closingTimer);l._closingTimer=null;l._showingTimer=setTimeout(function(){l.showSubMenu()},250)}},delayHideSubMenu:function(){var l=this;if(!l.isDisabled()){l.removeState("opened");clearTimeout(l._showingTimer);if(!l._closingTimer){l._closingTimer=setTimeout(function(){if(!l.hasState("opened")){l.hideSubMenu()}l._closingTimer=null},400)}}},renderLabelHtml:function(){return'<div class="edui-arrow"></div><div class="edui-box edui-icon"></div><div class="edui-box edui-label %%-label">'+(this.label||"")+"</div>"},getStateDom:function(){return this.getDom()},queryAutoHide:function(l){if(this.subMenu&&this.hasState("opened")){return this.subMenu.queryAutoHide(l)}},_onClick:function(l,m){if(this.hasState("disabled")){return}if(this.fireEvent("click",l,m)!==false){if(this.subMenu){this.showSubMenu()}else{j.postHide(l)}}},showSubMenu:function(){var l=b.getClientRect(this.getDom());l.right-=5;l.left+=2;l.width-=7;l.top-=4;l.bottom+=4;l.height+=8;this.subMenu.showAnchorRect(l,true,true)},hideSubMenu:function(){this.subMenu.hide()}};h.inherits(g,c);h.extend(g.prototype,a,true)})();(function(){var b=baidu.editor.utils,d=baidu.editor.ui.uiUtils,e=baidu.editor.ui.Menu,a=baidu.editor.ui.SplitButton,c=baidu.editor.ui.Combox=function(f){this.initOptions(f);this.initCombox()};c.prototype={uiName:"combox",onbuttonclick:function(){this.showPopup()},initCombox:function(){var h=this;this.items=this.items||[];for(var f=0;f<this.items.length;f++){var g=this.items[f];g.uiName="listitem";g.index=f;g.onclick=function(){h.selectByIndex(this.index)}}this.popup=new e({items:this.items,uiName:"list",editor:this.editor,captureWheel:true,combox:this});this.initSplitButton()},_SplitButton_postRender:a.prototype.postRender,postRender:function(){this._SplitButton_postRender();this.setLabel(this.label||"");this.setValue(this.initValue||"")},showPopup:function(){var f=d.getClientRect(this.getDom());f.top+=1;f.bottom-=1;f.height-=2;this.popup.showAnchorRect(f)},getValue:function(){return this.value},setValue:function(g){var f=this.indexByValue(g);if(f!=-1){this.selectedIndex=f;this.setLabel(this.items[f].label);this.value=this.items[f].value}else{this.selectedIndex=-1;this.setLabel(this.getLabelForUnknowValue(g));this.value=g}},setLabel:function(f){this.getDom("button_body").innerHTML=f;this.label=f},getLabelForUnknowValue:function(f){return f},indexByValue:function(g){for(var f=0;f<this.items.length;f++){if(g==this.items[f].value){return f}}return -1},getItem:function(f){return this.items[f]},selectByIndex:function(f){if(f<this.items.length&&this.fireEvent("select",f)!==false){this.selectedIndex=f;this.value=this.items[f].value;this.setLabel(this.items[f].label)}}};b.inherits(c,a)})();(function(){var j=baidu.editor.utils,d=baidu.editor.dom.domUtils,a=baidu.editor.ui.uiUtils,e=baidu.editor.ui.Mask,b=baidu.editor.ui.UIBase,g=baidu.editor.ui.Button,h=baidu.editor.ui.Dialog=function(n){if(n.name){var m=n.name;var l=n.cssRules;if(!n.className){n.className="edui-for-"+m}if(l){n.cssRules=".edui-default .edui-for-"+m+" .edui-dialog-content  {"+l+"}"}}this.initOptions(j.extend({autoReset:true,draggable:true,onok:function(){},oncancel:function(){},onclose:function(p,o){return o?this.onok():this.oncancel()},holdScroll:false},n));this.initDialog()};var c;var k;var f;h.prototype={draggable:false,uiName:"dialog",initDialog:function(){var m=this,n=this.editor.options.theme;if(this.cssRules){j.cssRule("edui-customize-"+this.name+"-style",this.cssRules)}this.initUIBase();this.modalMask=(c||(c=new e({className:"edui-dialog-modalmask",theme:n,onclick:function(){f&&f.close(false)}})));this.dragMask=(k||(k=new e({className:"edui-dialog-dragmask",theme:n})));this.closeButton=new g({className:"edui-dialog-closebutton",title:m.closeDialog,theme:n,onclick:function(){m.close(false)}});this.fullscreen&&this.initResizeEvent();if(this.buttons){for(var l=0;l<this.buttons.length;l++){if(!(this.buttons[l] instanceof g)){this.buttons[l]=new g(j.extend(this.buttons[l],{editor:this.editor},true))}}}},initResizeEvent:function(){var l=this;d.on(window,"resize",function(){if(l._hidden||l._hidden===undefined){return}if(l.__resizeTimer){window.clearTimeout(l.__resizeTimer)}l.__resizeTimer=window.setTimeout(function(){l.__resizeTimer=null;var p=l.getDom(),o=l.getDom("content"),n=UE.ui.uiUtils.getClientRect(p),m=UE.ui.uiUtils.getClientRect(o),q=a.getViewportRect();o.style.width=(q.width-n.width+m.width)+"px";o.style.height=(q.height-n.height+m.height)+"px";p.style.width=q.width+"px";p.style.height=q.height+"px";l.fireEvent("resize")},100)})},fitSize:function(){var l=this.getDom("body");var m=this.mesureSize();l.style.width=m.width+"px";l.style.height=m.height+"px";return m},safeSetOffset:function(r){var n=this;var l=n.getDom();var q=a.getViewportRect();var m=a.getClientRect(l);var p=r.left;if(p+m.width>q.right){p=q.right-m.width}var o=r.top;if(o+m.height>q.bottom){o=q.bottom-m.height}l.style.left=Math.max(p,0)+"px";l.style.top=Math.max(o,0)+"px"},showAtCenter:function(){var p=a.getViewportRect();if(!this.fullscreen){this.getDom().style.display="";var n=this.fitSize();var q=this.getDom("titlebar").offsetHeight|0;var m=p.width/2-n.width/2;var s=p.height/2-(n.height-q)/2-q;var u=this.getDom();this.safeSetOffset({left:Math.max(m|0,0),top:Math.max(s|0,0)});if(!d.hasClass(u,"edui-state-centered")){u.className+=" edui-state-centered"}}else{var l=this.getDom(),o=this.getDom("content");l.style.display="block";var r=UE.ui.uiUtils.getClientRect(l),t=UE.ui.uiUtils.getClientRect(o);l.style.left="-100000px";o.style.width=(p.width-r.width+t.width)+"px";o.style.height=(p.height-r.height+t.height)+"px";l.style.width=p.width+"px";l.style.height=p.height+"px";l.style.left=0;this._originalContext={html:{overflowX:document.documentElement.style.overflowX,overflowY:document.documentElement.style.overflowY},body:{overflowX:document.body.style.overflowX,overflowY:document.body.style.overflowY}};document.documentElement.style.overflowX="hidden";document.documentElement.style.overflowY="hidden";document.body.style.overflowX="hidden";document.body.style.overflowY="hidden"}this._show()},getContentHtml:function(){var l="";if(typeof this.content=="string"){l=this.content}else{if(this.iframeUrl){l='<span id="'+this.id+'_contmask" class="dialogcontmask"></span><iframe id="'+this.id+'_iframe" class="%%-iframe" height="100%" width="100%" frameborder="0" src="'+this.iframeUrl+'"></iframe>'}}return l},getHtmlTpl:function(){var m="";if(this.buttons){var n=[];for(var l=0;l<this.buttons.length;l++){n[l]=this.buttons[l].renderHtml()}m='<div class="%%-foot"><div id="##_buttons" class="%%-buttons">'+n.join("")+"</div></div>"}return'<div id="##" class="%%"><div '+(!this.fullscreen?'class="%%"':'class="%%-wrap edui-dialog-fullscreen-flag"')+'><div id="##_body" class="%%-body"><div class="%%-shadow"></div><div id="##_titlebar" class="%%-titlebar"><div class="%%-draghandle" onmousedown="$$._onTitlebarMouseDown(event, this);"><span class="%%-caption">'+(this.title||"")+"</span></div>"+this.closeButton.renderHtml()+'</div><div id="##_content" class="%%-content">'+(this.autoReset?"":this.getContentHtml())+"</div>"+m+"</div></div></div>"},postRender:function(){if(!this.modalMask.getDom()){this.modalMask.render();this.modalMask.hide()}if(!this.dragMask.getDom()){this.dragMask.render();this.dragMask.hide()}var m=this;this.addListener("show",function(){m.modalMask.show(this.getDom().style.zIndex-2)});this.addListener("hide",function(){m.modalMask.hide()});if(this.buttons){for(var l=0;l<this.buttons.length;l++){this.buttons[l].postRender()}}d.on(window,"resize",function(){setTimeout(function(){if(!m.isHidden()){m.safeSetOffset(a.getClientRect(m.getDom()))}})});this._hide()},mesureSize:function(){var l=this.getDom("body");var m=a.getClientRect(this.getDom("content")).width;var n=l.style;n.width=m;return a.getClientRect(l)},_onTitlebarMouseDown:function(l,m){if(this.draggable){var o;var p=a.getViewportRect();var n=this;a.startDrag(l,{ondragstart:function(){o=a.getClientRect(n.getDom());n.getDom("contmask").style.visibility="visible";n.dragMask.show(n.getDom().style.zIndex-1)},ondragmove:function(q,t){var s=o.left+q;var r=o.top+t;n.safeSetOffset({left:s,top:r})},ondragstop:function(){n.getDom("contmask").style.visibility="hidden";d.removeClasses(n.getDom(),["edui-state-centered"]);n.dragMask.hide()}})}},reset:function(){this.getDom("content").innerHTML=this.getContentHtml();this.fireEvent("dialogafterreset")},_show:function(){if(this._hidden){this.getDom().style.display="";this.editor.container.style.zIndex&&(this.getDom().style.zIndex=this.editor.container.style.zIndex*1+10);this._hidden=false;this.fireEvent("show");baidu.editor.ui.uiUtils.getFixedLayer().style.zIndex=this.getDom().style.zIndex-4}},isHidden:function(){return this._hidden},_hide:function(){if(!this._hidden){var l=this.getDom();l.style.display="none";l.style.zIndex="";l.style.width="";l.style.height="";this._hidden=true;this.fireEvent("hide")}},open:function(){if(this.autoReset){try{this.reset()}catch(m){this.render();this.open()}}this.showAtCenter();if(this.iframeUrl){try{this.getDom("iframe").focus()}catch(l){}}f=this},_onCloseButtonClick:function(l,m){this.close(false)},close:function(l){if(this.fireEvent("close",l)!==false){if(this.fullscreen){document.documentElement.style.overflowX=this._originalContext.html.overflowX;document.documentElement.style.overflowY=this._originalContext.html.overflowY;document.body.style.overflowX=this._originalContext.body.overflowX;document.body.style.overflowY=this._originalContext.body.overflowY;delete this._originalContext}this._hide();var n=this.getDom("content");var m=this.getDom("iframe");if(n&&m){var o=m.contentDocument||m.contentWindow.document;o&&(o.body.innerHTML="");d.remove(n)}}}};j.inherits(h,b)})();(function(){var b=baidu.editor.utils,c=baidu.editor.ui.Menu,a=baidu.editor.ui.SplitButton,d=baidu.editor.ui.MenuButton=function(e){this.initOptions(e);this.initMenuButton()};d.prototype={initMenuButton:function(){var e=this;this.uiName="menubutton";this.popup=new c({items:e.items,className:e.className,editor:e.editor});this.popup.addListener("show",function(){var g=this;for(var f=0;f<g.items.length;f++){g.items[f].removeState("checked");if(g.items[f].value==e._value){g.items[f].addState("checked");this.value=e._value}}});this.initSplitButton()},setValue:function(e){this._value=e}};b.inherits(d,a)})();(function(){var c=baidu.editor.utils,d=baidu.editor.ui.Popup,b=baidu.editor.ui.SplitButton,a=baidu.editor.ui.MultiMenuPop=function(e){this.initOptions(e);this.initMultiMenu()};a.prototype={initMultiMenu:function(){var e=this;this.popup=new d({content:"",editor:e.editor,iframe_rendered:false,onshow:function(){if(!this.iframe_rendered){this.iframe_rendered=true;this.getDom("content").innerHTML='<iframe id="'+e.id+'_iframe" src="'+e.iframeUrl+'" frameborder="0"></iframe>';e.editor.container.style.zIndex&&(this.getDom().style.zIndex=e.editor.container.style.zIndex*1+1)}}});this.onbuttonclick=function(){this.showPopup()};this.initSplitButton()}};c.inherits(a,b)})();(function(){var c=baidu.editor.ui,d=c.UIBase,b=c.uiUtils,k=baidu.editor.utils,e=baidu.editor.dom.domUtils;var f=[],h,j=false;var a=c.ShortCutMenu=function(l){this.initOptions(l);this.initShortCutMenu()};a.postHide=g;a.prototype={isHidden:true,SPACE:5,initShortCutMenu:function(){this.items=this.items||[];this.initUIBase();this.initItems();this.initEvent();f.push(this)},initEvent:function(){var l=this,m=l.editor.document;e.on(m,"mousemove",function(p){if(l.isHidden===false){if(l.getSubMenuMark()||l.eventType=="contextmenu"){return}var q=true,n=l.getDom(),o=n.offsetWidth,s=n.offsetHeight,v=o/2+l.SPACE,u=s/2,t=Math.abs(p.screenX-l.left),r=Math.abs(p.screenY-l.top);clearTimeout(h);h=setTimeout(function(){if(r>0&&r<u){l.setOpacity(n,"1")}else{if(r>u&&r<u+70){l.setOpacity(n,"0.5");q=false}else{if(r>u+70&&r<u+140){l.hide()}}}if(q&&t>0&&t<v){l.setOpacity(n,"1")}else{if(t>v&&t<v+70){l.setOpacity(n,"0.5")}else{if(t>v+70&&t<v+140){l.hide()}}}})}});if(browser.chrome){e.on(m,"mouseout",function(o){var n=o.relatedTarget||o.toElement;if(n==null||n.tagName=="HTML"){l.hide()}})}l.editor.addListener("afterhidepop",function(){if(!l.isHidden){j=true}})},initItems:function(){if(k.isArray(this.items)){for(var m=0,l=this.items.length;m<l;m++){var n=this.items[m].toLowerCase();if(c[n]){this.items[m]=new c[n](this.editor);this.items[m].className+=" edui-shortcutsubmenu "}}}},setOpacity:function(l,m){if(browser.ie&&browser.version<9){l.style.filter="alpha(opacity = "+parseFloat(m)*100+");"}else{l.style.opacity=m}},getSubMenuMark:function(){j=false;var o=b.getFixedLayer();var n=e.getElementsByTagName(o,"div",function(p){return e.hasClass(p,"edui-shortcutsubmenu edui-popup")});for(var l=0,m;m=n[l++];){if(m.style.display!="none"){j=true}}return j},show:function(p,m){var q=this,o={},n=this.getDom(),r=b.getFixedLayer();function t(u){if(u.left<0){u.left=0}if(u.top<0){u.top=0}n.style.cssText="position:absolute;left:"+u.left+"px;top:"+u.top+"px;"}function s(u){if(!u.tagName){u=u.getDom()}o.left=parseInt(u.style.left);o.top=parseInt(u.style.top);o.top-=n.offsetHeight+15;t(o)}q.eventType=p.type;n.style.cssText="display:block;left:-9999px";if(p.type=="contextmenu"&&m){var l=e.getElementsByTagName(r,"div","edui-contextmenu")[0];if(l){s(l)}else{q.editor.addListener("aftershowcontextmenu",function(u,v){s(v)})}}else{o=b.getViewportOffsetByEvent(p);o.top-=n.offsetHeight+q.SPACE;o.left+=q.SPACE+20;t(o);q.setOpacity(n,0.2)}q.isHidden=false;q.left=p.screenX+n.offsetWidth/2-q.SPACE;q.top=p.screenY-(n.offsetHeight/2)-q.SPACE;if(q.editor){n.style.zIndex=q.editor.container.style.zIndex*1+10;r.style.zIndex=n.style.zIndex-1}},hide:function(){if(this.getDom()){this.getDom().style.display="none"}this.isHidden=true},postRender:function(){if(k.isArray(this.items)){for(var l=0,m;m=this.items[l++];){m.postRender()}}},getHtmlTpl:function(){var m;if(k.isArray(this.items)){m=[];for(var l=0;l<this.items.length;l++){m[l]=this.items[l].renderHtml()}m=m.join("")}else{m=this.items}return'<div id="##" class="%% edui-toolbar" data-src="shortcutmenu" onmousedown="return false;" onselectstart="return false;" >'+m+"</div>"}};k.inherits(a,d);function g(m){var p=m.target||m.srcElement,o=e.findParent(p,function(q){return e.hasClass(q,"edui-shortcutmenu")||e.hasClass(q,"edui-popup")},true);if(!o){for(var l=0,n;n=f[l++];){n.hide()}}}e.on(document,"mousedown",function(l){g(l)});e.on(window,"scroll",function(l){g(l)})})();(function(){var a=baidu.editor.utils,b=baidu.editor.ui.UIBase,c=baidu.editor.ui.Breakline=function(d){this.initOptions(d);this.initSeparator()};c.prototype={uiName:"Breakline",initSeparator:function(){this.initUIBase()},getHtmlTpl:function(){return"<br/>"}};a.inherits(c,b)})();(function(){var b=baidu.editor.utils,a=baidu.editor.dom.domUtils,d=baidu.editor.ui.UIBase,c=baidu.editor.ui.Message=function(e){this.initOptions(e);this.initMessage()};c.prototype={initMessage:function(){this.initUIBase()},getHtmlTpl:function(){return'<div id="##" class="edui-message %%"> <div id="##_closer" class="edui-message-closer"></div> <div id="##_body" class="edui-message-body edui-message-type-info"> <iframe style="position:absolute;z-index:-1;left:0;top:0;background-color: transparent;" frameborder="0" width="100%" height="100%" src="about:blank"></iframe> <div class="edui-shadow"></div> <div id="##_content" class="edui-message-content">  </div> </div></div>'},reset:function(e){var f=this;if(!e.keepshow){clearTimeout(this.timer);f.timer=setTimeout(function(){f.hide()},e.timeout||4000)}e.content!==undefined&&f.setContent(e.content);e.type!==undefined&&f.setType(e.type);f.show()},postRender:function(){var e=this,f=this.getDom("closer");f&&a.on(f,"click",function(){e.hide()})},setContent:function(e){this.getDom("content").innerHTML=e},setType:function(f){f=f||"info";var e=this.getDom("body");e.className=e.className.replace(/edui-message-type-[\w-]+/,"edui-message-type-"+f)},getContent:function(){return this.getDom("content").innerHTML},getType:function(){var e=this.getDom("body").match(/edui-message-type-([\w-]+)/);return e?e[1]:""},show:function(){this.getDom().style.display="block"},hide:function(){var e=this.getDom();if(e){e.style.display="none";e.parentNode&&e.parentNode.removeChild(e)}}};b.inherits(c,d)})();(function(){var o=baidu.editor.utils;var k=baidu.editor.ui;var e=k.Dialog;k.buttons={};k.Dialog=function(l){var p=new e(l);p.addListener("hide",function(){if(p.editor){var v=p.editor;try{if(browser.gecko){var w=v.window.scrollY,r=v.window.scrollX;v.body.focus();v.window.scrollTo(r,w)}else{v.focus()}}catch(u){}}});return p};var f={anchor:"~/dialogs/anchor/anchor.html",insertimage:"~/dialogs/image/image.html",link:"~/dialogs/link/link.html",spechars:"~/dialogs/spechars/spechars.html",searchreplace:"~/dialogs/searchreplace/searchreplace.html",map:"~/dialogs/map/map.html",gmap:"~/dialogs/gmap/gmap.html",insertvideo:"~/dialogs/video/video.html",help:"~/dialogs/help/help.html",preview:"~/dialogs/preview/preview.html",emotion:"~/dialogs/emotion/emotion.html",wordimage:"~/dialogs/wordimage/wordimage.html",attachment:"~/dialogs/attachment/attachment.html",insertframe:"~/dialogs/insertframe/insertframe.html",edittip:"~/dialogs/table/edittip.html",edittable:"~/dialogs/table/edittable.html",edittd:"~/dialogs/table/edittd.html",webapp:"~/dialogs/webapp/webapp.html",snapscreen:"~/dialogs/snapscreen/snapscreen.html",scrawl:"~/dialogs/scrawl/scrawl.html",music:"~/dialogs/music/music.html",template:"~/dialogs/template/template.html",background:"~/dialogs/background/background.html",charts:"~/dialogs/charts/charts.html"};var j=["undo","redo","formatmatch","bold","italic","underline","fontborder","touppercase","tolowercase","strikethrough","subscript","superscript","source","indent","outdent","blockquote","pasteplain","pagebreak","selectall","print","horizontal","removeformat","time","date","unlink","insertparagraphbeforetable","insertrow","insertcol","mergeright","mergedown","deleterow","deletecol","splittorows","splittocols","splittocells","mergecells","deletetable","drafts","submit","close"];for(var g=0,t;t=j[g++];){t=t.toLowerCase();k[t]=function(l){return function(p){var r=new k.Button({className:"edui-for-"+l,title:p.options.labelMap[l]||p.getLang("labelMap."+l)||"",onclick:function(){p.execCommand(l)},theme:p.options.theme,showText:false});k.buttons[l]=r;p.addListener("selectionchange",function(v,u,x){var w=p.queryCommandState(l);if(w==-1){r.setDisabled(true);r.setChecked(false)}else{if(!x){r.setDisabled(false);r.setChecked(w)}}});return r}}(t)}k.cleardoc=function(l){var p=new k.Button({className:"edui-for-cleardoc",title:l.options.labelMap.cleardoc||l.getLang("labelMap.cleardoc")||"",theme:l.options.theme,onclick:function(){if(confirm(l.getLang("confirmClear"))){l.execCommand("cleardoc")}}});k.buttons.cleardoc=p;l.addListener("selectionchange",function(){p.setDisabled(l.queryCommandState("cleardoc")==-1)});return p};var n={justify:["left","right","center","justify"],imagefloat:["none","left","center","right"],directionality:["ltr","rtl"]};for(var b in n){(function(r,u){for(var p=0,l;l=u[p++];){(function(v){k[r.replace("float","")+v]=function(w){var x=new k.Button({className:"edui-for-"+r.replace("float","")+v,title:w.options.labelMap[r.replace("float","")+v]||w.getLang("labelMap."+r.replace("float","")+v)||"",theme:w.options.theme,onclick:function(){w.execCommand(r,v)}});k.buttons[r]=x;w.addListener("selectionchange",function(z,y,A){x.setDisabled(w.queryCommandState(r)==-1);x.setChecked(w.queryCommandValue(r)==v&&!A)});return x}})(l)}})(b,n[b])}for(var g=0,t;t=["backcolor","forecolor"][g++];){k[t]=function(l){return function(p){var r=new k.ColorButton({className:"edui-for-"+l,color:"default",title:p.options.labelMap[l]||p.getLang("labelMap."+l)||"",editor:p,onpickcolor:function(v,u){p.execCommand(l,u)},onpicknocolor:function(){p.execCommand(l,"default");this.setColor("transparent");this.color="default"},onbuttonclick:function(){p.execCommand(l,this.color)}});k.buttons[l]=r;p.addListener("selectionchange",function(){r.setDisabled(p.queryCommandState(l)==-1)});return r}}(t)}var h={noOk:["searchreplace","help","spechars","webapp","preview"],ok:["attachment","anchor","link","insertimage","map","gmap","insertframe","wordimage","insertvideo","insertframe","edittip","edittable","edittd","scrawl","template","music","background","charts"]};for(var b in h){(function(r,u){for(var p=0,l;l=u[p++];){if(browser.opera&&l==="searchreplace"){continue}(function(v){k[v]=function(y,x,A){x=x||(y.options.iframeUrlMap||{})[v]||f[v];A=y.options.labelMap[v]||y.getLang("labelMap."+v)||"";var w;if(x){w=new k.Dialog(o.extend({iframeUrl:y.ui.mapUrl(x),editor:y,className:"edui-for-"+v,title:A,holdScroll:v==="insertimage",fullscreen:/charts|preview/.test(v),closeDialog:y.getLang("closeDialog")},r=="ok"?{buttons:[{className:"edui-okbutton",label:y.getLang("ok"),editor:y,onclick:function(){w.close(true)}},{className:"edui-cancelbutton",label:y.getLang("cancel"),editor:y,onclick:function(){w.close(false)}}]}:{}));y.ui._dialogs[v+"Dialog"]=w}var z=new k.Button({className:"edui-for-"+v,title:A,onclick:function(){if(w){switch(v){case"wordimage":var B=y.execCommand("wordimage");if(B&&B.length){w.render();w.open()}break;case"scrawl":if(y.queryCommandState("scrawl")!=-1){w.render();w.open()}break;default:w.render();w.open()}}},theme:y.options.theme,disabled:(v=="scrawl"&&y.queryCommandState("scrawl")==-1)||(v=="charts")});k.buttons[v]=z;y.addListener("selectionchange",function(){var B={edittable:1};if(v in B){return}var C=y.queryCommandState(v);if(z.getDom()){z.setDisabled(C==-1);z.setChecked(C)}});return z}})(l.toLowerCase())}})(b,h[b])}k.snapscreen=function(r,p,v){v=r.options.labelMap.snapscreen||r.getLang("labelMap.snapscreen")||"";var u=new k.Button({className:"edui-for-snapscreen",title:v,onclick:function(){r.execCommand("snapscreen")},theme:r.options.theme});k.buttons.snapscreen=u;p=p||(r.options.iframeUrlMap||{})["snapscreen"]||f.snapscreen;if(p){var l=new k.Dialog({iframeUrl:r.ui.mapUrl(p),editor:r,className:"edui-for-snapscreen",title:v,buttons:[{className:"edui-okbutton",label:r.getLang("ok"),editor:r,onclick:function(){l.close(true)}},{className:"edui-cancelbutton",label:r.getLang("cancel"),editor:r,onclick:function(){l.close(false)}}]});l.render();r.ui._dialogs.snapscreenDialog=l}r.addListener("selectionchange",function(){u.setDisabled(r.queryCommandState("snapscreen")==-1)});return u};k.insertcode=function(p,u,v){u=p.options.insertcode||[];v=p.options.labelMap.insertcode||p.getLang("labelMap.insertcode")||"";var l=[];o.each(u,function(w,x){l.push({label:w,value:x,theme:p.options.theme,renderLabelHtml:function(){return'<div class="edui-label %%-label" >'+(this.label||"")+"</div>"}})});var r=new k.Combox({editor:p,items:l,onselect:function(x,w){p.execCommand("insertcode",this.items[w].value)},onbuttonclick:function(){this.showPopup()},title:v,initValue:v,className:"edui-for-insertcode",indexByValue:function(y){if(y){for(var x=0,w;w=this.items[x];x++){if(w.value.indexOf(y)!=-1){return x}}}return -1}});k.buttons.insertcode=r;p.addListener("selectionchange",function(x,w,A){if(!A){var z=p.queryCommandState("insertcode");if(z==-1){r.setDisabled(true)}else{r.setDisabled(false);var y=p.queryCommandValue("insertcode");if(!y){r.setValue(v);return}y&&(y=y.replace(/['"]/g,"").split(",")[0]);r.setValue(y)}}});return r};k.fontfamily=function(u,w,y){w=u.options.fontfamily||[];y=u.options.labelMap.fontfamily||u.getLang("labelMap.fontfamily")||"";if(!w.length){return}for(var r=0,p,l=[];p=w[r];r++){var x=u.getLang("fontfamily")[p.name]||"";(function(z,A){l.push({label:z,value:A,theme:u.options.theme,renderLabelHtml:function(){return'<div class="edui-label %%-label" style="font-family:'+o.unhtml(this.value)+'">'+(this.label||"")+"</div>"}})})(p.label||x,p.val)}var v=new k.Combox({editor:u,items:l,onselect:function(A,z){u.execCommand("FontFamily",this.items[z].value)},onbuttonclick:function(){this.showPopup()},title:y,initValue:y,className:"edui-for-fontfamily",indexByValue:function(B){if(B){for(var A=0,z;z=this.items[A];A++){if(z.value.indexOf(B)!=-1){return A}}}return -1}});k.buttons.fontfamily=v;u.addListener("selectionchange",function(A,z,D){if(!D){var C=u.queryCommandState("FontFamily");if(C==-1){v.setDisabled(true)}else{v.setDisabled(false);var B=u.queryCommandValue("FontFamily");B&&(B=B.replace(/['"]/g,"").split(",")[0]);v.setValue(B)}}});return v};k.fontsize=function(u,w,x){x=u.options.labelMap.fontsize||u.getLang("labelMap.fontsize")||"";w=w||u.options.fontsize||[];if(!w.length){return}var l=[];for(var r=0;r<w.length;r++){var p=w[r]+"px";l.push({label:p,value:p,theme:u.options.theme,renderLabelHtml:function(){return'<div class="edui-label %%-label" style="line-height:1;font-size:'+this.value+'">'+(this.label||"")+"</div>"}})}var v=new k.Combox({editor:u,items:l,title:x,initValue:x,onselect:function(z,y){u.execCommand("FontSize",this.items[y].value)},onbuttonclick:function(){this.showPopup()},className:"edui-for-fontsize"});k.buttons.fontsize=v;u.addListener("selectionchange",function(z,y,B){if(!B){var A=u.queryCommandState("FontSize");if(A==-1){v.setDisabled(true)}else{v.setDisabled(false);v.setValue(u.queryCommandValue("FontSize"))}}});return v};k.paragraph=function(r,v,w){w=r.options.labelMap.paragraph||r.getLang("labelMap.paragraph")||"";v=r.options.paragraph||[];if(o.isEmptyObject(v)){return}var l=[];for(var p in v){l.push({value:p,label:v[p]||r.getLang("paragraph")[p],theme:r.options.theme,renderLabelHtml:function(){return'<div class="edui-label %%-label"><span class="edui-for-'+this.value+'">'+(this.label||"")+"</span></div>"}})}var u=new k.Combox({editor:r,items:l,title:w,initValue:w,className:"edui-for-paragraph",onselect:function(y,x){r.execCommand("Paragraph",this.items[x].value)},onbuttonclick:function(){this.showPopup()}});k.buttons.paragraph=u;r.addListener("selectionchange",function(z,y,C){if(!C){var B=r.queryCommandState("Paragraph");if(B==-1){u.setDisabled(true)}else{u.setDisabled(false);var A=r.queryCommandValue("Paragraph");var x=u.indexByValue(A);if(x!=-1){u.setValue(A)}else{u.setValue(u.initValue)}}}});return u};k.customstyle=function(v){var x=v.options.customstyle||[],y=v.options.labelMap.customstyle||v.getLang("labelMap.customstyle")||"";if(!x.length){return}var u=v.getLang("customstyle");for(var r=0,l=[],p;p=x[r++];){(function(A){var z={};z.label=A.label?A.label:u[A.name];z.style=A.style;z.className=A.className;z.tag=A.tag;l.push({label:z.label,value:z,theme:v.options.theme,renderLabelHtml:function(){return'<div class="edui-label %%-label"><'+z.tag+" "+(z.className?' class="'+z.className+'"':"")+(z.style?' style="'+z.style+'"':"")+">"+z.label+"</"+z.tag+"></div>"}})})(p)}var w=new k.Combox({editor:v,items:l,title:y,initValue:y,className:"edui-for-customstyle",onselect:function(A,z){v.execCommand("customstyle",this.items[z].value)},onbuttonclick:function(){this.showPopup()},indexByValue:function(B){for(var z=0,A;A=this.items[z++];){if(A.label==B){return z-1}}return -1}});k.buttons.customstyle=w;v.addListener("selectionchange",function(B,A,E){if(!E){var D=v.queryCommandState("customstyle");if(D==-1){w.setDisabled(true)}else{w.setDisabled(false);var C=v.queryCommandValue("customstyle");var z=w.indexByValue(C);if(z!=-1){w.setValue(C)}else{w.setValue(w.initValue)}}}});return w};k.inserttable=function(p,l,u){u=p.options.labelMap.inserttable||p.getLang("labelMap.inserttable")||"";var r=new k.TableButton({editor:p,title:u,className:"edui-for-inserttable",onpicktable:function(v,x,w){p.execCommand("InsertTable",{numRows:w,numCols:x,border:1})},onbuttonclick:function(){this.showPopup()}});k.buttons.inserttable=r;p.addListener("selectionchange",function(){r.setDisabled(p.queryCommandState("inserttable")==-1)});return r};k.lineheight=function(u){var w=u.options.lineheight||[];if(!w.length){return}for(var r=0,p,l=[];p=w[r++];){l.push({label:p,value:p,theme:u.options.theme,onclick:function(){u.execCommand("lineheight",this.value)}})}var v=new k.MenuButton({editor:u,className:"edui-for-lineheight",title:u.options.labelMap.lineheight||u.getLang("labelMap.lineheight")||"",items:l,onbuttonclick:function(){var x=u.queryCommandValue("LineHeight")||this.value;u.execCommand("LineHeight",x)}});k.buttons.lineheight=v;u.addListener("selectionchange",function(){var y=u.queryCommandState("LineHeight");if(y==-1){v.setDisabled(true)}else{v.setDisabled(false);var x=u.queryCommandValue("LineHeight");x&&v.setValue((x+"").replace(/cm/,""));v.setChecked(y)}});return v};var c=["top","bottom"];for(var a=0,m;m=c[a++];){(function(l){k["rowspacing"+l]=function(v){var x=v.options["rowspacing"+l]||[];if(!x.length){return null}for(var u=0,r,p=[];r=x[u++];){p.push({label:r,value:r,theme:v.options.theme,onclick:function(){v.execCommand("rowspacing",this.value,l)}})}var w=new k.MenuButton({editor:v,className:"edui-for-rowspacing"+l,title:v.options.labelMap["rowspacing"+l]||v.getLang("labelMap.rowspacing"+l)||"",items:p,onbuttonclick:function(){var y=v.queryCommandValue("rowspacing",l)||this.value;v.execCommand("rowspacing",y,l)}});k.buttons[l]=w;v.addListener("selectionchange",function(){var z=v.queryCommandState("rowspacing",l);if(z==-1){w.setDisabled(true)}else{w.setDisabled(false);var y=v.queryCommandValue("rowspacing",l);y&&w.setValue((y+"").replace(/%/,""));w.setChecked(z)}});return w}})(m)}var s=["insertorderedlist","insertunorderedlist"];for(var d=0,q;q=s[d++];){(function(l){k[l]=function(u){var w=u.options[l],x=function(){u.execCommand(l,this.value)},p=[];for(var r in w){p.push({label:w[r]||u.getLang()[l][r]||"",value:r,theme:u.options.theme,onclick:x})}var v=new k.MenuButton({editor:u,className:"edui-for-"+l,title:u.getLang("labelMap."+l)||"",items:p,onbuttonclick:function(){var y=u.queryCommandValue(l)||this.value;u.execCommand(l,y)}});k.buttons[l]=v;u.addListener("selectionchange",function(){var z=u.queryCommandState(l);if(z==-1){v.setDisabled(true)}else{v.setDisabled(false);var y=u.queryCommandValue(l);v.setValue(y);v.setChecked(z)}});return v}})(q)}k.fullscreen=function(l,r){r=l.options.labelMap.fullscreen||l.getLang("labelMap.fullscreen")||"";var p=new k.Button({className:"edui-for-fullscreen",title:r,theme:l.options.theme,onclick:function(){if(l.ui){l.ui.setFullScreen(!l.ui.isFullScreen())}this.setChecked(l.ui.isFullScreen())}});k.buttons.fullscreen=p;l.addListener("selectionchange",function(){var u=l.queryCommandState("fullscreen");p.setDisabled(u==-1);p.setChecked(l.ui.isFullScreen())});return p};k.emotion=function(p,l){var u="emotion";var r=new k.MultiMenuPop({title:p.options.labelMap[u]||p.getLang("labelMap."+u+"")||"",editor:p,className:"edui-for-"+u,iframeUrl:p.ui.mapUrl(l||(p.options.iframeUrlMap||{})[u]||f[u])});k.buttons[u]=r;p.addListener("selectionchange",function(){r.setDisabled(p.queryCommandState(u)==-1)});return r};k.autotypeset=function(l){var p=new k.AutoTypeSetButton({editor:l,title:l.options.labelMap.autotypeset||l.getLang("labelMap.autotypeset")||"",className:"edui-for-autotypeset",onbuttonclick:function(){l.execCommand("autotypeset")}});k.buttons.autotypeset=p;l.addListener("selectionchange",function(){p.setDisabled(l.queryCommandState("autotypeset")==-1)});return p};k.simpleupload=function(p){var l="simpleupload",r=new k.Button({className:"edui-for-"+l,title:p.options.labelMap[l]||p.getLang("labelMap."+l)||"",onclick:function(){},theme:p.options.theme,showText:false});k.buttons[l]=r;p.addListener("ready",function(){var u=r.getDom("body"),v=u.children[0];p.fireEvent("simpleuploadbtnready",v)});p.addListener("selectionchange",function(v,u,x){var w=p.queryCommandState(l);if(w==-1){r.setDisabled(true);r.setChecked(false)}else{if(!x){r.setDisabled(false);r.setChecked(w)}}});return r}})();(function(){var b=baidu.editor.utils,d=baidu.editor.ui.uiUtils,f=baidu.editor.ui.UIBase,a=baidu.editor.dom.domUtils;var e=[];function c(h){this.initOptions(h);this.initEditorUI()}c.prototype={uiName:"editor",initEditorUI:function(){this.editor.ui=this;this._dialogs={};this.initUIBase();this._initToolbars();var k=this.editor,l=this;k.addListener("ready",function(){k.getDialog=function(q){return k.ui._dialogs[q+"Dialog"]};a.on(k.window,"scroll",function(q){baidu.editor.ui.Popup.postHide(q)});k.ui._actualFrameWidth=k.options.initialFrameWidth;UE.browser.ie&&UE.browser.version===6&&k.container.ownerDocument.execCommand("BackgroundImageCache",false,true);if(k.options.elementPathEnabled){k.ui.getDom("elementpath").innerHTML='<div class="edui-editor-breadcrumb">'+k.getLang("elementPathTip")+":</div>"}if(k.options.wordCount){function p(){m(k,l);a.un(k.document,"click",arguments.callee)}a.on(k.document,"click",p);k.ui.getDom("wordcount").innerHTML=k.getLang("wordCountTip")}k.ui._scale();if(k.options.scaleEnabled){if(k.autoHeightEnabled){k.disableAutoHeight()}l.enableScale()}else{l.disableScale()}if(!k.options.elementPathEnabled&&!k.options.wordCount&&!k.options.scaleEnabled){k.ui.getDom("elementpath").style.display="none";k.ui.getDom("wordcount").style.display="none";k.ui.getDom("scale").style.display="none"}if(!k.selection.isFocus()){return}k.fireEvent("selectionchange",false,true)});k.addListener("mousedown",function(q,p){var r=p.target||p.srcElement;baidu.editor.ui.Popup.postHide(p,r);baidu.editor.ui.ShortCutMenu.postHide(p)});k.addListener("delcells",function(){if(UE.ui.edittip){new UE.ui.edittip(k)}k.getDialog("edittip").open()});var j,n=false,o;k.addListener("afterpaste",function(){if(k.queryCommandState("pasteplain")){return}if(baidu.editor.ui.PastePicker){j=new baidu.editor.ui.Popup({content:new baidu.editor.ui.PastePicker({editor:k}),editor:k,className:"edui-wordpastepop"});j.render()}n=true});k.addListener("afterinserthtml",function(){clearTimeout(o);o=setTimeout(function(){if(j&&(n||k.ui._isTransfer)){if(j.isHidden()){var r=a.createElement(k.document,"span",{style:"line-height:0px;",innerHTML:"\ufeff"}),p=k.selection.getRange();p.insertNode(r);var q=getDomNode(r,"firstChild","previousSibling");q&&j.showAnchor(q.nodeType==3?q.parentNode:q);a.remove(r)}else{j.show()}delete k.ui._isTransfer;n=false}},200)});k.addListener("contextmenu",function(q,p){baidu.editor.ui.Popup.postHide(p)});k.addListener("keydown",function(q,p){if(j){j.dispose(p)}var r=p.keyCode||p.which;if(p.altKey&&r==90){UE.ui.buttons.fullscreen.onclick()}});k.addListener("wordcount",function(p){m(this,l)});function m(s,v){s.setOpt({wordCount:true,maximumWords:10000,wordCountMsg:s.options.wordCountMsg||s.getLang("wordCountMsg"),wordOverFlowMsg:s.options.wordOverFlowMsg||s.getLang("wordOverFlowMsg")});var q=s.options,p=q.maximumWords,w=q.wordCountMsg,u=q.wordOverFlowMsg,r=v.getDom("wordcount");if(!q.wordCount){return}var t=s.getContentLength(true);if(t>p){r.innerHTML=u;s.fireEvent("wordcountoverflow")}else{r.innerHTML=w.replace("{#leave}",p-t).replace("{#count}",t)}}k.addListener("selectionchange",function(){if(k.options.elementPathEnabled){l[(k.queryCommandState("elementpath")==-1?"dis":"en")+"ableElementPath"]()}if(k.options.scaleEnabled){l[(k.queryCommandState("scale")==-1?"dis":"en")+"ableScale"]()}});var h=new baidu.editor.ui.Popup({editor:k,content:"",className:"edui-bubble",_onEditButtonClick:function(){this.hide();k.ui._dialogs.linkDialog.open()},_onImgEditButtonClick:function(p){this.hide();k.ui._dialogs[p]&&k.ui._dialogs[p].open()},_onImgSetFloat:function(p){this.hide();k.execCommand("imagefloat",p)},_setIframeAlign:function(p){var q=h.anchorEl;var r=q.cloneNode(true);switch(p){case -2:r.setAttribute("align","");break;case -1:r.setAttribute("align","left");break;case 1:r.setAttribute("align","right");break}q.parentNode.insertBefore(r,q);a.remove(q);h.anchorEl=r;h.showAnchor(h.anchorEl)},_updateIframe:function(){var p=k._iframe=h.anchorEl;if(a.hasClass(p,"ueditor_baidumap")){k.selection.getRange().selectNode(p).select();k.ui._dialogs.mapDialog.open();h.hide()}else{k.ui._dialogs.insertframeDialog.open();h.hide()}},_onRemoveButtonClick:function(p){k.execCommand(p);this.hide()},queryAutoHide:function(p){if(p&&p.ownerDocument==k.document){if(p.tagName.toLowerCase()=="img"||a.findParentByTagName(p,"a",true)){return p!==h.anchorEl}}return baidu.editor.ui.Popup.prototype.queryAutoHide.call(this,p)}});h.render();if(k.options.imagePopup){k.addListener("mouseover",function(r,p){p=p||window.event;var s=p.target||p.srcElement;if(k.ui._dialogs.insertframeDialog&&/iframe/ig.test(s.tagName)){var q=h.formatHtml("<nobr>"+k.getLang("property")+': <span onclick=$$._setIframeAlign(-2) class="edui-clickable">'+k.getLang("default")+'</span>&nbsp;&nbsp;<span onclick=$$._setIframeAlign(-1) class="edui-clickable">'+k.getLang("justifyleft")+'</span>&nbsp;&nbsp;<span onclick=$$._setIframeAlign(1) class="edui-clickable">'+k.getLang("justifyright")+'</span>&nbsp;&nbsp; <span onclick="$$._updateIframe( this);" class="edui-clickable">'+k.getLang("modify")+"</span></nobr>");if(q){h.getDom("content").innerHTML=q;h.anchorEl=s;h.showAnchor(h.anchorEl)}else{h.hide()}}});k.addListener("selectionchange",function(z,s){if(!s){return}var w="",x="",v=k.selection.getRange().getClosedNode(),q=k.ui._dialogs;if(v&&v.tagName=="IMG"){var r="insertimageDialog";if(v.className.indexOf("edui-faked-video")!=-1||v.className.indexOf("edui-upload-video")!=-1){r="insertvideoDialog"}if(v.className.indexOf("edui-faked-webapp")!=-1){r="webappDialog"}if(v.src.indexOf("http://api.map.baidu.com")!=-1){r="mapDialog"}if(v.className.indexOf("edui-faked-music")!=-1){r="musicDialog"}if(v.src.indexOf("http://maps.google.com/maps/api/staticmap")!=-1){r="gmapDialog"}if(v.getAttribute("anchorname")){r="anchorDialog";w=h.formatHtml("<nobr>"+k.getLang("property")+': <span onclick=$$._onImgEditButtonClick("anchorDialog") class="edui-clickable">'+k.getLang("modify")+"</span>&nbsp;&nbsp;<span onclick=$$._onRemoveButtonClick('anchor') class=\"edui-clickable\">"+k.getLang("delete")+"</span></nobr>")}if(v.getAttribute("word_img")){k.word_img=[v.getAttribute("word_img")];r="wordimageDialog"}if(a.hasClass(v,"loadingclass")||a.hasClass(v,"loaderrorclass")){r=""}if(!q[r]){return}x="<nobr>"+k.getLang("property")+': <span onclick=$$._onImgSetFloat("none") class="edui-clickable">'+k.getLang("default")+'</span>&nbsp;&nbsp;<span onclick=$$._onImgSetFloat("left") class="edui-clickable">'+k.getLang("justifyleft")+'</span>&nbsp;&nbsp;<span onclick=$$._onImgSetFloat("right") class="edui-clickable">'+k.getLang("justifyright")+'</span>&nbsp;&nbsp;<span onclick=$$._onImgSetFloat("center") class="edui-clickable">'+k.getLang("justifycenter")+"</span>&nbsp;&nbsp;<span onclick=\"$$._onImgEditButtonClick('"+r+'\');" class="edui-clickable">'+k.getLang("modify")+"</span></nobr>";!w&&(w=h.formatHtml(x))}if(k.ui._dialogs.linkDialog){var y=k.queryCommandValue("link");var p;if(y&&(p=(y.getAttribute("_href")||y.getAttribute("href",2)))){var u=p;if(p.length>30){u=p.substring(0,20)+"..."}if(w){w+='<div style="height:5px;"></div>'}w+=h.formatHtml("<nobr>"+k.getLang("anthorMsg")+': <a target="_blank" href="'+p+'" title="'+p+'" >'+u+'</a> <span class="edui-clickable" onclick="$$._onEditButtonClick();">'+k.getLang("modify")+'</span> <span class="edui-clickable" onclick="$$._onRemoveButtonClick(\'unlink\');"> '+k.getLang("clear")+"</span></nobr>");h.showAnchor(y)}}if(w){h.getDom("content").innerHTML=w;h.anchorEl=v||y;h.showAnchor(h.anchorEl)}else{h.hide()}})}},_initToolbars:function(){var p=this.editor;var r=this.toolbars||[];var l=[];for(var o=0;o<r.length;o++){var q=r[o];var m=new baidu.editor.ui.Toolbar({theme:p.options.theme});for(var n=0;n<q.length;n++){var h=q[n];var k=null;if(typeof h=="string"){h=h.toLowerCase();if(h=="|"){h="Separator"}if(h=="||"){h="Breakline"}if(baidu.editor.ui[h]){k=new baidu.editor.ui[h](p)}if(h=="fullscreen"){if(l&&l[0]){l[0].items.splice(0,0,k)}else{k&&m.items.splice(0,0,k)}continue}}else{k=h}if(k&&k.id){m.add(k)}}l[o]=m}b.each(UE._customizeUI,function(u,s){var t,j;if(u.id&&u.id!=p.key){return false}t=u.execFn.call(p,p,s);if(t){j=u.index;if(j===undefined){j=m.items.length}m.add(t,j)}});this.toolbars=l},getHtmlTpl:function(){return'<div id="##" class="%%"><div id="##_toolbarbox" class="%%-toolbarbox">'+(this.toolbars.length?'<div id="##_toolbarboxouter" class="%%-toolbarboxouter"><div class="%%-toolbarboxinner">'+this.renderToolbarBoxHtml()+"</div></div>":"")+'<div id="##_toolbarmsg" class="%%-toolbarmsg" style="display:none;"><div id = "##_upload_dialog" class="%%-toolbarmsg-upload" onclick="$$.showWordImageDialog();">'+this.editor.getLang("clickToUpload")+'</div><div class="%%-toolbarmsg-close" onclick="$$.hideToolbarMsg();">x</div><div id="##_toolbarmsg_label" class="%%-toolbarmsg-label"></div><div style="height:0;overflow:hidden;clear:both;"></div></div><div id="##_message_holder" class="%%-messageholder"></div></div><div id="##_iframeholder" class="%%-iframeholder"></div><div id="##_bottombar" class="%%-bottomContainer"><table><tr><td id="##_elementpath" class="%%-bottombar"></td><td id="##_wordcount" class="%%-wordcount"></td><td id="##_scale" class="%%-scale"><div class="%%-icon"></div></td></tr></table></div><div id="##_scalelayer"></div></div>'},showWordImageDialog:function(){this._dialogs.wordimageDialog.open()},renderToolbarBoxHtml:function(){var j=[];for(var h=0;h<this.toolbars.length;h++){j.push(this.toolbars[h].renderHtml())}return j.join("")},setFullScreen:function(n){var m=this.editor,k=m.container.parentNode.parentNode;if(this._fullscreen!=n){this._fullscreen=n;this.editor.fireEvent("beforefullscreenchange",n);if(baidu.editor.browser.gecko){var j=m.selection.getRange().createBookmark()}if(n){while(k.tagName!="BODY"){var h=baidu.editor.dom.domUtils.getComputedStyle(k,"position");e.push(h);k.style.position="static";k=k.parentNode}this._bakHtmlOverflow=document.documentElement.style.overflow;this._bakBodyOverflow=document.body.style.overflow;this._bakAutoHeight=this.editor.autoHeightEnabled;this._bakScrollTop=Math.max(document.documentElement.scrollTop,document.body.scrollTop);this._bakEditorContaninerWidth=m.iframe.parentNode.offsetWidth;if(this._bakAutoHeight){m.autoHeightEnabled=false;this.editor.disableAutoHeight()}document.documentElement.style.overflow="hidden";window.scrollTo(0,window.scrollY);this._bakCssText=this.getDom().style.cssText;this._bakCssText1=this.getDom("iframeholder").style.cssText;m.iframe.parentNode.style.width="";this._updateFullScreen()}else{while(k.tagName!="BODY"){k.style.position=e.shift();k=k.parentNode}this.getDom().style.cssText=this._bakCssText;this.getDom("iframeholder").style.cssText=this._bakCssText1;if(this._bakAutoHeight){m.autoHeightEnabled=true;this.editor.enableAutoHeight()}document.documentElement.style.overflow=this._bakHtmlOverflow;document.body.style.overflow=this._bakBodyOverflow;m.iframe.parentNode.style.width=this._bakEditorContaninerWidth+"px";window.scrollTo(0,this._bakScrollTop)}if(browser.gecko&&m.body.contentEditable==="true"){var l=document.createElement("input");document.body.appendChild(l);m.body.contentEditable=false;setTimeout(function(){l.focus();setTimeout(function(){m.body.contentEditable=true;m.fireEvent("fullscreenchanged",n);m.selection.getRange().moveToBookmark(j).select(true);baidu.editor.dom.domUtils.remove(l);n&&window.scroll(0,0)},0)},0)}if(m.body.contentEditable==="true"){this.editor.fireEvent("fullscreenchanged",n);this.triggerLayout()}}},_updateFullScreen:function(){if(this._fullscreen){var j=d.getViewportRect();this.getDom().style.cssText="border:0;position:absolute;left:0;top:"+(this.editor.options.topOffset||0)+"px;width:"+j.width+"px;height:"+j.height+"px;z-index:"+(this.getDom().style.zIndex*1+100);d.setViewportOffset(this.getDom(),{left:0,top:this.editor.options.topOffset||0});this.editor.setHeight(j.height-this.getDom("toolbarbox").offsetHeight-this.getDom("bottombar").offsetHeight-(this.editor.options.topOffset||0),true);if(browser.gecko){try{window.onresize()}catch(h){}}}},_updateElementPath:function(){var h=this.getDom("elementpath"),l;if(this.elementPathEnabled&&(l=this.editor.queryCommandValue("elementpath"))){var m=[];for(var k=0,j;j=l[k];k++){m[k]=this.formatHtml('<span unselectable="on" onclick="$$.editor.execCommand(&quot;elementpath&quot;, &quot;'+k+'&quot;);">'+j+"</span>")}h.innerHTML='<div class="edui-editor-breadcrumb" onmousedown="return false;">'+this.editor.getLang("elementPathTip")+": "+m.join(" &gt; ")+"</div>"}else{h.style.display="none"}},disableElementPath:function(){var h=this.getDom("elementpath");h.innerHTML="";h.style.display="none";this.elementPathEnabled=false},enableElementPath:function(){var h=this.getDom("elementpath");h.style.display="";this.elementPathEnabled=true;this._updateElementPath()},_scale:function(){var C=document,m=this.editor,A=m.container,k=m.document,o=this.getDom("toolbarbox"),p=this.getDom("bottombar"),B=this.getDom("scale"),y=this.getDom("scalelayer");var s=false,z=null,n=0,w=m.options.minFrameWidth,j=0,h=0,v=0,l=0;function r(){z=a.getXY(A);if(!n){n=m.options.minFrameHeight+o.offsetHeight+p.offsetHeight}y.style.cssText="position:absolute;left:0;display:;top:0;background-color:#41ABFF;opacity:0.4;filter: Alpha(opacity=40);width:"+A.offsetWidth+"px;height:"+A.offsetHeight+"px;z-index:"+(m.options.zIndex+1);a.on(C,"mousemove",t);a.on(k,"mouseup",q);a.on(C,"mouseup",q)}var x=this;this.editor.addListener("fullscreenchanged",function(F,D){if(D){x.disableScale()}else{if(x.editor.options.scaleEnabled){x.enableScale();var E=x.editor.document.createElement("span");x.editor.body.appendChild(E);x.editor.body.style.height=Math.max(a.getXY(E).y,x.editor.iframe.offsetHeight-20)+"px";a.remove(E)}}});function t(D){u();var E=D||window.event;j=E.pageX||(C.documentElement.scrollLeft+E.clientX);h=E.pageY||(C.documentElement.scrollTop+E.clientY);v=j-z.x;l=h-z.y;if(v>=w){s=true;y.style.width=v+"px"}if(l>=n){s=true;y.style.height=l+"px"}}function q(){if(s){s=false;m.ui._actualFrameWidth=y.offsetWidth-2;A.style.width=m.ui._actualFrameWidth+"px";m.setHeight(y.offsetHeight-p.offsetHeight-o.offsetHeight-2,true)}if(y){y.style.display="none"}u();a.un(C,"mousemove",t);a.un(k,"mouseup",q);a.un(C,"mouseup",q)}function u(){if(browser.ie){C.selection.clear()}else{window.getSelection().removeAllRanges()}}this.enableScale=function(){if(m.queryCommandState("source")==1){return}B.style.display="";this.scaleEnabled=true;a.on(B,"mousedown",r)};this.disableScale=function(){B.style.display="none";this.scaleEnabled=false;a.un(B,"mousedown",r)}},isFullScreen:function(){return this._fullscreen},postRender:function(){f.prototype.postRender.call(this);for(var k=0;k<this.toolbars.length;k++){this.toolbars[k].postRender()}var l=this;var j,h=baidu.editor.dom.domUtils,m=function(){clearTimeout(j);j=setTimeout(function(){l._updateFullScreen()})};h.on(window,"resize",m);l.addListener("destroy",function(){h.un(window,"resize",m);clearTimeout(j)})},showToolbarMsg:function(k,j){this.getDom("toolbarmsg_label").innerHTML=k;this.getDom("toolbarmsg").style.display="";if(!j){var h=this.getDom("upload_dialog");h.style.display="none"}},hideToolbarMsg:function(){this.getDom("toolbarmsg").style.display="none"},mapUrl:function(h){return h?h.replace("~/",this.editor.options.UEDITOR_HOME_URL||""):""},triggerLayout:function(){var h=this.getDom();if(h.style.zoom=="1"){h.style.zoom="100%"}else{h.style.zoom="1"}}};b.inherits(c,baidu.editor.ui.UIBase);var g={};UE.ui.Editor=function(h){var k=new UE.Editor(h);k.options.editor=k;var j=k.render;k.render=function(l){if(l.constructor===String){k.key=l;g[l]=k}b.domReady(function(){k.langIsReady?m():k.addListener("langReady",m);function m(){k.setOpt({labelMap:k.options.labelMap||k.getLang("labelMap")});new c(k.options);if(l){if(l.constructor===String){l=document.getElementById(l)}l&&l.getAttribute("name")&&(k.options.textarea=l.getAttribute("name"));if(l&&/script|textarea/ig.test(l.tagName)){var u=document.createElement("div");l.parentNode.insertBefore(u,l);var o=l.value||l.innerHTML;k.options.initialContent=/^[\t\r\n ]*$/.test(o)?k.options.initialContent:o.replace(/>[\n\r\t]+([ ]{4})+/g,">").replace(/[\n\r\t]+([ ]{4})+</g,"<").replace(/>[\n\r\t]+</g,"><");l.className&&(u.className=l.className);l.style.cssText&&(u.style.cssText=l.style.cssText);if(/textarea/i.test(l.tagName)){k.textarea=l;k.textarea.style.display="none"}else{l.parentNode.removeChild(l)}if(l.id){u.id=l.id;a.removeAttributes(l,"id")}l=u;l.innerHTML=""}}a.addClass(l,"edui-"+k.options.theme);k.ui.render(l);var t=k.options;k.container=k.ui.getDom();var q=a.findParents(l,true);var p=[];for(var s=0,r;r=q[s];s++){p[s]=r.style.display;r.style.display="block"}if(t.initialFrameWidth){t.minFrameWidth=t.initialFrameWidth}else{t.minFrameWidth=t.initialFrameWidth=l.offsetWidth;var n=l.style.width;if(/%$/.test(n)){t.initialFrameWidth=n}}if(t.initialFrameHeight){t.minFrameHeight=t.initialFrameHeight}else{t.initialFrameHeight=t.minFrameHeight=l.offsetHeight}for(var s=0,r;r=q[s];s++){r.style.display=p[s]}if(l.style.height){l.style.height=""}k.container.style.width=t.initialFrameWidth+(/%$/.test(t.initialFrameWidth)?"":"px");k.container.style.zIndex=t.zIndex;j.call(k,k.ui.getDom("iframeholder"));k.fireEvent("afteruiready")}})};return k};UE.getEditor=function(k,h){var j=g[k];if(!j){j=g[k]=new UE.ui.Editor(h);j.render(k)}return j};UE.delEditor=function(j){var h;if(h=g[j]){h.key&&h.destroy();delete g[j]}};UE.registerUI=function(l,k,h,j){b.each(l.split(/\s+/),function(m){UE._customizeUI[m]={id:j,execFn:k,index:h}})}})();UE.registerUI("message",function(e){var a=baidu.editor.ui;var d=a.Message;var c;var g=[];var f=e;f.addListener("ready",function(){c=document.getElementById(f.ui.id+"_message_holder");b();setTimeout(function(){b()},500)});f.addListener("showmessage",function(k,j){j=utils.isString(j)?{content:j}:j;var l=new d({timeout:j.timeout,type:j.type,content:j.content,keepshow:j.keepshow,editor:f}),h=j.id||("msg_"+(+new Date()).toString(36));l.render(c);g[h]=l;l.reset(j);b();return h});f.addListener("updatemessage",function(j,l,h){h=utils.isString(h)?{content:h}:h;var k=g[l];k.render(c);k&&k.reset(h)});f.addListener("hidemessage",function(h,k){var j=g[k];j&&j.hide()});function b(){var h=f.ui.getDom("toolbarbox");if(h){c.style.top=h.offsetHeight+3+"px"}c.style.zIndex=Math.max(f.options.zIndex,f.iframe.style.zIndex)+1}});UE.registerUI("autosave",function(b){var c=null,a=null;b.on("afterautosave",function(){clearTimeout(c);c=setTimeout(function(){if(a){b.trigger("hidemessage",a)}a=b.trigger("showmessage",{content:b.getLang("autosave.success"),timeout:2000})},2000)})});